var Cz=Object.defineProperty;var MP=e=>{throw TypeError(e)};var kz=(e,t,r)=>t in e?Cz(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ae=(e,t,r)=>kz(e,typeof t!="symbol"?t+"":t,r),o_=(e,t,r)=>t.has(e)||MP("Cannot "+r);var Le=(e,t,r)=>(o_(e,t,"read from private field"),r?r.call(e):t.get(e)),ir=(e,t,r)=>t.has(e)?MP("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Ut=(e,t,r,n)=>(o_(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Rn=(e,t,r)=>(o_(e,t,"access private method"),r);var Gh=(e,t,r,n)=>({set _(s){Ut(e,t,s,r)},get _(){return Le(e,t,n)}});function UA(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();function VA(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $z(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var WA={exports:{}},em={},GA={exports:{}},Jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nd=Symbol.for("react.element"),Az=Symbol.for("react.portal"),Iz=Symbol.for("react.fragment"),Oz=Symbol.for("react.strict_mode"),Dz=Symbol.for("react.profiler"),Fz=Symbol.for("react.provider"),Rz=Symbol.for("react.context"),Lz=Symbol.for("react.forward_ref"),Nz=Symbol.for("react.suspense"),jz=Symbol.for("react.memo"),zz=Symbol.for("react.lazy"),TP=Symbol.iterator;function Bz(e){return e===null||typeof e!="object"?null:(e=TP&&e[TP]||e["@@iterator"],typeof e=="function"?e:null)}var HA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},KA=Object.assign,qA={};function Nu(e,t,r){this.props=e,this.context=t,this.refs=qA,this.updater=r||HA}Nu.prototype.isReactComponent={};Nu.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Nu.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function QA(){}QA.prototype=Nu.prototype;function Ww(e,t,r){this.props=e,this.context=t,this.refs=qA,this.updater=r||HA}var Gw=Ww.prototype=new QA;Gw.constructor=Ww;KA(Gw,Nu.prototype);Gw.isPureReactComponent=!0;var EP=Array.isArray,XA=Object.prototype.hasOwnProperty,Hw={current:null},JA={key:!0,ref:!0,__self:!0,__source:!0};function YA(e,t,r){var n,s={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)XA.call(t,n)&&!JA.hasOwnProperty(n)&&(s[n]=t[n]);var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(e&&e.defaultProps)for(n in a=e.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:Nd,type:e,key:o,ref:i,props:s,_owner:Hw.current}}function Uz(e,t){return{$$typeof:Nd,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Kw(e){return typeof e=="object"&&e!==null&&e.$$typeof===Nd}function Vz(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var PP=/\/+/g;function i_(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Vz(""+e.key):t.toString(36)}function Vf(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case Nd:case Az:i=!0}}if(i)return i=e,s=s(i),e=n===""?"."+i_(i,0):n,EP(s)?(r="",e!=null&&(r=e.replace(PP,"$&/")+"/"),Vf(s,t,r,"",function(u){return u})):s!=null&&(Kw(s)&&(s=Uz(s,r+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(PP,"$&/")+"/")+e)),t.push(s)),1;if(i=0,n=n===""?".":n+":",EP(e))for(var a=0;a<e.length;a++){o=e[a];var l=n+i_(o,a);i+=Vf(o,t,r,l,s)}else if(l=Bz(e),typeof l=="function")for(e=l.call(e),a=0;!(o=e.next()).done;)o=o.value,l=n+i_(o,a++),i+=Vf(o,t,r,l,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function Hh(e,t,r){if(e==null)return e;var n=[],s=0;return Vf(e,n,"","",function(o){return t.call(r,o,s++)}),n}function Wz(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Zn={current:null},Wf={transition:null},Gz={ReactCurrentDispatcher:Zn,ReactCurrentBatchConfig:Wf,ReactCurrentOwner:Hw};function ZA(){throw Error("act(...) is not supported in production builds of React.")}Jt.Children={map:Hh,forEach:function(e,t,r){Hh(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Hh(e,function(){t++}),t},toArray:function(e){return Hh(e,function(t){return t})||[]},only:function(e){if(!Kw(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Jt.Component=Nu;Jt.Fragment=Iz;Jt.Profiler=Dz;Jt.PureComponent=Ww;Jt.StrictMode=Oz;Jt.Suspense=Nz;Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gz;Jt.act=ZA;Jt.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=KA({},e.props),s=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Hw.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)XA.call(t,l)&&!JA.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:Nd,type:e.type,key:s,ref:o,props:n,_owner:i}};Jt.createContext=function(e){return e={$$typeof:Rz,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Fz,_context:e},e.Consumer=e};Jt.createElement=YA;Jt.createFactory=function(e){var t=YA.bind(null,e);return t.type=e,t};Jt.createRef=function(){return{current:null}};Jt.forwardRef=function(e){return{$$typeof:Lz,render:e}};Jt.isValidElement=Kw;Jt.lazy=function(e){return{$$typeof:zz,_payload:{_status:-1,_result:e},_init:Wz}};Jt.memo=function(e,t){return{$$typeof:jz,type:e,compare:t===void 0?null:t}};Jt.startTransition=function(e){var t=Wf.transition;Wf.transition={};try{e()}finally{Wf.transition=t}};Jt.unstable_act=ZA;Jt.useCallback=function(e,t){return Zn.current.useCallback(e,t)};Jt.useContext=function(e){return Zn.current.useContext(e)};Jt.useDebugValue=function(){};Jt.useDeferredValue=function(e){return Zn.current.useDeferredValue(e)};Jt.useEffect=function(e,t){return Zn.current.useEffect(e,t)};Jt.useId=function(){return Zn.current.useId()};Jt.useImperativeHandle=function(e,t,r){return Zn.current.useImperativeHandle(e,t,r)};Jt.useInsertionEffect=function(e,t){return Zn.current.useInsertionEffect(e,t)};Jt.useLayoutEffect=function(e,t){return Zn.current.useLayoutEffect(e,t)};Jt.useMemo=function(e,t){return Zn.current.useMemo(e,t)};Jt.useReducer=function(e,t,r){return Zn.current.useReducer(e,t,r)};Jt.useRef=function(e){return Zn.current.useRef(e)};Jt.useState=function(e){return Zn.current.useState(e)};Jt.useSyncExternalStore=function(e,t,r){return Zn.current.useSyncExternalStore(e,t,r)};Jt.useTransition=function(){return Zn.current.useTransition()};Jt.version="18.3.1";GA.exports=Jt;var Q=GA.exports;const rt=VA(Q),qw=UA({__proto__:null,default:rt},[Q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hz=Q,Kz=Symbol.for("react.element"),qz=Symbol.for("react.fragment"),Qz=Object.prototype.hasOwnProperty,Xz=Hz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jz={key:!0,ref:!0,__self:!0,__source:!0};function eI(e,t,r){var n,s={},o=null,i=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)Qz.call(t,n)&&!Jz.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:Kz,type:e,key:o,ref:i,props:s,_owner:Xz.current}}em.Fragment=qz;em.jsx=eI;em.jsxs=eI;WA.exports=em;var J=WA.exports,tI={exports:{}},Ps={},rI={exports:{}},nI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(W,te){var le=W.length;W.push(te);e:for(;0<le;){var oe=le-1>>>1,U=W[oe];if(0<s(U,te))W[oe]=te,W[le]=U,le=oe;else break e}}function r(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var te=W[0],le=W.pop();if(le!==te){W[0]=le;e:for(var oe=0,U=W.length,R=U>>>1;oe<R;){var X=2*(oe+1)-1,ce=W[X],ne=X+1,we=W[ne];if(0>s(ce,le))ne<U&&0>s(we,ce)?(W[oe]=we,W[ne]=le,oe=ne):(W[oe]=ce,W[X]=le,oe=X);else if(ne<U&&0>s(we,le))W[oe]=we,W[ne]=le,oe=ne;else break e}}return te}function s(W,te){var le=W.sortIndex-te.sortIndex;return le!==0?le:W.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();e.unstable_now=function(){return i.now()-a}}var l=[],u=[],h=1,c=null,d=3,f=!1,p=!1,m=!1,b=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(W){for(var te=r(u);te!==null;){if(te.callback===null)n(u);else if(te.startTime<=W)n(u),te.sortIndex=te.expirationTime,t(l,te);else break;te=r(u)}}function v(W){if(m=!1,y(W),!p)if(r(l)!==null)p=!0,ee(M);else{var te=r(u);te!==null&&Y(v,te.startTime-W)}}function M(W,te){p=!1,m&&(m=!1,g(S),S=-1),f=!0;var le=d;try{for(y(te),c=r(l);c!==null&&(!(c.expirationTime>te)||W&&!V());){var oe=c.callback;if(typeof oe=="function"){c.callback=null,d=c.priorityLevel;var U=oe(c.expirationTime<=te);te=e.unstable_now(),typeof U=="function"?c.callback=U:c===r(l)&&n(l),y(te)}else n(l);c=r(l)}if(c!==null)var R=!0;else{var X=r(u);X!==null&&Y(v,X.startTime-te),R=!1}return R}finally{c=null,d=le,f=!1}}var E=!1,T=null,S=-1,A=5,I=-1;function V(){return!(e.unstable_now()-I<A)}function N(){if(T!==null){var W=e.unstable_now();I=W;var te=!0;try{te=T(!0,W)}finally{te?z():(E=!1,T=null)}}else E=!1}var z;if(typeof _=="function")z=function(){_(N)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,G=q.port2;q.port1.onmessage=N,z=function(){G.postMessage(null)}}else z=function(){b(N,0)};function ee(W){T=W,E||(E=!0,z())}function Y(W,te){S=b(function(){W(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,ee(M))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(W){switch(d){case 1:case 2:case 3:var te=3;break;default:te=d}var le=d;d=te;try{return W()}finally{d=le}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,te){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var le=d;d=W;try{return te()}finally{d=le}},e.unstable_scheduleCallback=function(W,te,le){var oe=e.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?oe+le:oe):le=oe,W){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=le+U,W={id:h++,callback:te,priorityLevel:W,startTime:le,expirationTime:U,sortIndex:-1},le>oe?(W.sortIndex=le,t(u,W),r(l)===null&&W===r(u)&&(m?(g(S),S=-1):m=!0,Y(v,le-oe))):(W.sortIndex=U,t(l,W),p||f||(p=!0,ee(M))),W},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(W){var te=d;return function(){var le=d;d=te;try{return W.apply(this,arguments)}finally{d=le}}}})(nI);rI.exports=nI;var Yz=rI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zz=Q,Es=Yz;function Xe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sI=new Set,ad={};function hl(e,t){Pu(e,t),Pu(e+"Capture",t)}function Pu(e,t){for(ad[e]=t,e=0;e<t.length;e++)sI.add(t[e])}var ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rv=Object.prototype.hasOwnProperty,eB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,SP={},CP={};function tB(e){return rv.call(CP,e)?!0:rv.call(SP,e)?!1:eB.test(e)?CP[e]=!0:(SP[e]=!0,!1)}function rB(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function nB(e,t,r,n){if(t===null||typeof t>"u"||rB(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function es(e,t,r,n,s,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var An={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){An[e]=new es(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];An[t]=new es(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){An[e]=new es(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){An[e]=new es(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){An[e]=new es(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){An[e]=new es(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){An[e]=new es(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){An[e]=new es(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){An[e]=new es(e,5,!1,e.toLowerCase(),null,!1,!1)});var Qw=/[\-:]([a-z])/g;function Xw(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Qw,Xw);An[t]=new es(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Qw,Xw);An[t]=new es(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Qw,Xw);An[t]=new es(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){An[e]=new es(e,1,!1,e.toLowerCase(),null,!1,!1)});An.xlinkHref=new es("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){An[e]=new es(e,1,!1,e.toLowerCase(),null,!0,!0)});function Jw(e,t,r,n){var s=An.hasOwnProperty(t)?An[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(nB(t,r,s,n)&&(r=null),n||s===null?tB(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var gi=Zz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kh=Symbol.for("react.element"),Kl=Symbol.for("react.portal"),ql=Symbol.for("react.fragment"),Yw=Symbol.for("react.strict_mode"),nv=Symbol.for("react.profiler"),oI=Symbol.for("react.provider"),iI=Symbol.for("react.context"),Zw=Symbol.for("react.forward_ref"),sv=Symbol.for("react.suspense"),ov=Symbol.for("react.suspense_list"),e0=Symbol.for("react.memo"),Oi=Symbol.for("react.lazy"),aI=Symbol.for("react.offscreen"),kP=Symbol.iterator;function vc(e){return e===null||typeof e!="object"?null:(e=kP&&e[kP]||e["@@iterator"],typeof e=="function"?e:null)}var Wr=Object.assign,a_;function jc(e){if(a_===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);a_=t&&t[1]||""}return`
`+a_+e}var l_=!1;function u_(e,t){if(!e||l_)return"";l_=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),o=n.stack.split(`
`),i=s.length-1,a=o.length-1;1<=i&&0<=a&&s[i]!==o[a];)a--;for(;1<=i&&0<=a;i--,a--)if(s[i]!==o[a]){if(i!==1||a!==1)do if(i--,a--,0>a||s[i]!==o[a]){var l=`
`+s[i].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=i&&0<=a);break}}}finally{l_=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?jc(e):""}function sB(e){switch(e.tag){case 5:return jc(e.type);case 16:return jc("Lazy");case 13:return jc("Suspense");case 19:return jc("SuspenseList");case 0:case 2:case 15:return e=u_(e.type,!1),e;case 11:return e=u_(e.type.render,!1),e;case 1:return e=u_(e.type,!0),e;default:return""}}function iv(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ql:return"Fragment";case Kl:return"Portal";case nv:return"Profiler";case Yw:return"StrictMode";case sv:return"Suspense";case ov:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case iI:return(e.displayName||"Context")+".Consumer";case oI:return(e._context.displayName||"Context")+".Provider";case Zw:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case e0:return t=e.displayName||null,t!==null?t:iv(e.type)||"Memo";case Oi:t=e._payload,e=e._init;try{return iv(e(t))}catch{}}return null}function oB(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return iv(t);case 8:return t===Yw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ea(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function lI(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function iB(e){var t=lI(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function qh(e){e._valueTracker||(e._valueTracker=iB(e))}function uI(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=lI(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function cp(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function av(e,t){var r=t.checked;return Wr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function $P(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=ea(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function cI(e,t){t=t.checked,t!=null&&Jw(e,"checked",t,!1)}function lv(e,t){cI(e,t);var r=ea(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?uv(e,t.type,r):t.hasOwnProperty("defaultValue")&&uv(e,t.type,ea(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function AP(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function uv(e,t,r){(t!=="number"||cp(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var zc=Array.isArray;function au(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+ea(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function cv(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Wr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function IP(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Xe(92));if(zc(r)){if(1<r.length)throw Error(Xe(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:ea(r)}}function dI(e,t){var r=ea(t.value),n=ea(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function OP(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function hI(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dv(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?hI(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Qh,fI=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Qh=Qh||document.createElement("div"),Qh.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Qh.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ld(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var qc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aB=["Webkit","ms","Moz","O"];Object.keys(qc).forEach(function(e){aB.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),qc[t]=qc[e]})});function pI(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||qc.hasOwnProperty(e)&&qc[e]?(""+t).trim():t+"px"}function mI(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=pI(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var lB=Wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hv(e,t){if(t){if(lB[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Xe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Xe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Xe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Xe(62))}}function fv(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pv=null;function t0(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var mv=null,lu=null,uu=null;function DP(e){if(e=Bd(e)){if(typeof mv!="function")throw Error(Xe(280));var t=e.stateNode;t&&(t=om(t),mv(e.stateNode,e.type,t))}}function gI(e){lu?uu?uu.push(e):uu=[e]:lu=e}function _I(){if(lu){var e=lu,t=uu;if(uu=lu=null,DP(e),t)for(e=0;e<t.length;e++)DP(t[e])}}function yI(e,t){return e(t)}function vI(){}var c_=!1;function wI(e,t,r){if(c_)return e(t,r);c_=!0;try{return yI(e,t,r)}finally{c_=!1,(lu!==null||uu!==null)&&(vI(),_I())}}function ud(e,t){var r=e.stateNode;if(r===null)return null;var n=om(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Xe(231,t,typeof r));return r}var gv=!1;if(ui)try{var wc={};Object.defineProperty(wc,"passive",{get:function(){gv=!0}}),window.addEventListener("test",wc,wc),window.removeEventListener("test",wc,wc)}catch{gv=!1}function uB(e,t,r,n,s,o,i,a,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(h){this.onError(h)}}var Qc=!1,dp=null,hp=!1,_v=null,cB={onError:function(e){Qc=!0,dp=e}};function dB(e,t,r,n,s,o,i,a,l){Qc=!1,dp=null,uB.apply(cB,arguments)}function hB(e,t,r,n,s,o,i,a,l){if(dB.apply(this,arguments),Qc){if(Qc){var u=dp;Qc=!1,dp=null}else throw Error(Xe(198));hp||(hp=!0,_v=u)}}function fl(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function bI(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function FP(e){if(fl(e)!==e)throw Error(Xe(188))}function fB(e){var t=e.alternate;if(!t){if(t=fl(e),t===null)throw Error(Xe(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return FP(s),e;if(o===n)return FP(s),t;o=o.sibling}throw Error(Xe(188))}if(r.return!==n.return)r=s,n=o;else{for(var i=!1,a=s.child;a;){if(a===r){i=!0,r=s,n=o;break}if(a===n){i=!0,n=s,r=o;break}a=a.sibling}if(!i){for(a=o.child;a;){if(a===r){i=!0,r=o,n=s;break}if(a===n){i=!0,n=o,r=s;break}a=a.sibling}if(!i)throw Error(Xe(189))}}if(r.alternate!==n)throw Error(Xe(190))}if(r.tag!==3)throw Error(Xe(188));return r.stateNode.current===r?e:t}function xI(e){return e=fB(e),e!==null?MI(e):null}function MI(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=MI(e);if(t!==null)return t;e=e.sibling}return null}var TI=Es.unstable_scheduleCallback,RP=Es.unstable_cancelCallback,pB=Es.unstable_shouldYield,mB=Es.unstable_requestPaint,tn=Es.unstable_now,gB=Es.unstable_getCurrentPriorityLevel,r0=Es.unstable_ImmediatePriority,EI=Es.unstable_UserBlockingPriority,fp=Es.unstable_NormalPriority,_B=Es.unstable_LowPriority,PI=Es.unstable_IdlePriority,tm=null,Bo=null;function yB(e){if(Bo&&typeof Bo.onCommitFiberRoot=="function")try{Bo.onCommitFiberRoot(tm,e,void 0,(e.current.flags&128)===128)}catch{}}var wo=Math.clz32?Math.clz32:bB,vB=Math.log,wB=Math.LN2;function bB(e){return e>>>=0,e===0?32:31-(vB(e)/wB|0)|0}var Xh=64,Jh=4194304;function Bc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pp(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,i=r&268435455;if(i!==0){var a=i&~s;a!==0?n=Bc(a):(o&=i,o!==0&&(n=Bc(o)))}else i=r&~s,i!==0?n=Bc(i):o!==0&&(n=Bc(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-wo(t),s=1<<r,n|=e[r],t&=~s;return n}function xB(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function MB(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-wo(o),a=1<<i,l=s[i];l===-1?(!(a&r)||a&n)&&(s[i]=xB(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}function yv(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function SI(){var e=Xh;return Xh<<=1,!(Xh&4194240)&&(Xh=64),e}function d_(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function jd(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-wo(t),e[t]=r}function TB(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-wo(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function n0(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-wo(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var dr=0;function CI(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var kI,s0,$I,AI,II,vv=!1,Yh=[],Hi=null,Ki=null,qi=null,cd=new Map,dd=new Map,Fi=[],EB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function LP(e,t){switch(e){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":Ki=null;break;case"mouseover":case"mouseout":qi=null;break;case"pointerover":case"pointerout":cd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dd.delete(t.pointerId)}}function bc(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=Bd(t),t!==null&&s0(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function PB(e,t,r,n,s){switch(t){case"focusin":return Hi=bc(Hi,e,t,r,n,s),!0;case"dragenter":return Ki=bc(Ki,e,t,r,n,s),!0;case"mouseover":return qi=bc(qi,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return cd.set(o,bc(cd.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,dd.set(o,bc(dd.get(o)||null,e,t,r,n,s)),!0}return!1}function OI(e){var t=Va(e.target);if(t!==null){var r=fl(t);if(r!==null){if(t=r.tag,t===13){if(t=bI(r),t!==null){e.blockedOn=t,II(e.priority,function(){$I(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Gf(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=wv(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);pv=n,r.target.dispatchEvent(n),pv=null}else return t=Bd(r),t!==null&&s0(t),e.blockedOn=r,!1;t.shift()}return!0}function NP(e,t,r){Gf(e)&&r.delete(t)}function SB(){vv=!1,Hi!==null&&Gf(Hi)&&(Hi=null),Ki!==null&&Gf(Ki)&&(Ki=null),qi!==null&&Gf(qi)&&(qi=null),cd.forEach(NP),dd.forEach(NP)}function xc(e,t){e.blockedOn===t&&(e.blockedOn=null,vv||(vv=!0,Es.unstable_scheduleCallback(Es.unstable_NormalPriority,SB)))}function hd(e){function t(s){return xc(s,e)}if(0<Yh.length){xc(Yh[0],e);for(var r=1;r<Yh.length;r++){var n=Yh[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Hi!==null&&xc(Hi,e),Ki!==null&&xc(Ki,e),qi!==null&&xc(qi,e),cd.forEach(t),dd.forEach(t),r=0;r<Fi.length;r++)n=Fi[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Fi.length&&(r=Fi[0],r.blockedOn===null);)OI(r),r.blockedOn===null&&Fi.shift()}var cu=gi.ReactCurrentBatchConfig,mp=!0;function CB(e,t,r,n){var s=dr,o=cu.transition;cu.transition=null;try{dr=1,o0(e,t,r,n)}finally{dr=s,cu.transition=o}}function kB(e,t,r,n){var s=dr,o=cu.transition;cu.transition=null;try{dr=4,o0(e,t,r,n)}finally{dr=s,cu.transition=o}}function o0(e,t,r,n){if(mp){var s=wv(e,t,r,n);if(s===null)b_(e,t,n,gp,r),LP(e,n);else if(PB(s,e,t,r,n))n.stopPropagation();else if(LP(e,n),t&4&&-1<EB.indexOf(e)){for(;s!==null;){var o=Bd(s);if(o!==null&&kI(o),o=wv(e,t,r,n),o===null&&b_(e,t,n,gp,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else b_(e,t,n,null,r)}}var gp=null;function wv(e,t,r,n){if(gp=null,e=t0(n),e=Va(e),e!==null)if(t=fl(e),t===null)e=null;else if(r=t.tag,r===13){if(e=bI(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return gp=e,null}function DI(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gB()){case r0:return 1;case EI:return 4;case fp:case _B:return 16;case PI:return 536870912;default:return 16}default:return 16}}var Vi=null,i0=null,Hf=null;function FI(){if(Hf)return Hf;var e,t=i0,r=t.length,n,s="value"in Vi?Vi.value:Vi.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var i=r-e;for(n=1;n<=i&&t[r-n]===s[o-n];n++);return Hf=s.slice(e,1<n?1-n:void 0)}function Kf(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Zh(){return!0}function jP(){return!1}function Ss(e){function t(r,n,s,o,i){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Zh:jP,this.isPropagationStopped=jP,this}return Wr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Zh)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Zh)},persist:function(){},isPersistent:Zh}),t}var ju={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},a0=Ss(ju),zd=Wr({},ju,{view:0,detail:0}),$B=Ss(zd),h_,f_,Mc,rm=Wr({},zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:l0,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Mc&&(Mc&&e.type==="mousemove"?(h_=e.screenX-Mc.screenX,f_=e.screenY-Mc.screenY):f_=h_=0,Mc=e),h_)},movementY:function(e){return"movementY"in e?e.movementY:f_}}),zP=Ss(rm),AB=Wr({},rm,{dataTransfer:0}),IB=Ss(AB),OB=Wr({},zd,{relatedTarget:0}),p_=Ss(OB),DB=Wr({},ju,{animationName:0,elapsedTime:0,pseudoElement:0}),FB=Ss(DB),RB=Wr({},ju,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),LB=Ss(RB),NB=Wr({},ju,{data:0}),BP=Ss(NB),jB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UB(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=BB[e])?!!t[e]:!1}function l0(){return UB}var VB=Wr({},zd,{key:function(e){if(e.key){var t=jB[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Kf(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?zB[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:l0,charCode:function(e){return e.type==="keypress"?Kf(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Kf(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),WB=Ss(VB),GB=Wr({},rm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),UP=Ss(GB),HB=Wr({},zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:l0}),KB=Ss(HB),qB=Wr({},ju,{propertyName:0,elapsedTime:0,pseudoElement:0}),QB=Ss(qB),XB=Wr({},rm,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),JB=Ss(XB),YB=[9,13,27,32],u0=ui&&"CompositionEvent"in window,Xc=null;ui&&"documentMode"in document&&(Xc=document.documentMode);var ZB=ui&&"TextEvent"in window&&!Xc,RI=ui&&(!u0||Xc&&8<Xc&&11>=Xc),VP=" ",WP=!1;function LI(e,t){switch(e){case"keyup":return YB.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function NI(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ql=!1;function e4(e,t){switch(e){case"compositionend":return NI(t);case"keypress":return t.which!==32?null:(WP=!0,VP);case"textInput":return e=t.data,e===VP&&WP?null:e;default:return null}}function t4(e,t){if(Ql)return e==="compositionend"||!u0&&LI(e,t)?(e=FI(),Hf=i0=Vi=null,Ql=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return RI&&t.locale!=="ko"?null:t.data;default:return null}}var r4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function GP(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!r4[e.type]:t==="textarea"}function jI(e,t,r,n){gI(n),t=_p(t,"onChange"),0<t.length&&(r=new a0("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Jc=null,fd=null;function n4(e){XI(e,0)}function nm(e){var t=Yl(e);if(uI(t))return e}function s4(e,t){if(e==="change")return t}var zI=!1;if(ui){var m_;if(ui){var g_="oninput"in document;if(!g_){var HP=document.createElement("div");HP.setAttribute("oninput","return;"),g_=typeof HP.oninput=="function"}m_=g_}else m_=!1;zI=m_&&(!document.documentMode||9<document.documentMode)}function KP(){Jc&&(Jc.detachEvent("onpropertychange",BI),fd=Jc=null)}function BI(e){if(e.propertyName==="value"&&nm(fd)){var t=[];jI(t,fd,e,t0(e)),wI(n4,t)}}function o4(e,t,r){e==="focusin"?(KP(),Jc=t,fd=r,Jc.attachEvent("onpropertychange",BI)):e==="focusout"&&KP()}function i4(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return nm(fd)}function a4(e,t){if(e==="click")return nm(t)}function l4(e,t){if(e==="input"||e==="change")return nm(t)}function u4(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Mo=typeof Object.is=="function"?Object.is:u4;function pd(e,t){if(Mo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!rv.call(t,s)||!Mo(e[s],t[s]))return!1}return!0}function qP(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function QP(e,t){var r=qP(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qP(r)}}function UI(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?UI(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function VI(){for(var e=window,t=cp();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=cp(e.document)}return t}function c0(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function c4(e){var t=VI(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&UI(r.ownerDocument.documentElement,r)){if(n!==null&&c0(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=QP(r,o);var i=QP(r,n);s&&i&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var d4=ui&&"documentMode"in document&&11>=document.documentMode,Xl=null,bv=null,Yc=null,xv=!1;function XP(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;xv||Xl==null||Xl!==cp(n)||(n=Xl,"selectionStart"in n&&c0(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Yc&&pd(Yc,n)||(Yc=n,n=_p(bv,"onSelect"),0<n.length&&(t=new a0("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Xl)))}function ef(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Jl={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},__={},WI={};ui&&(WI=document.createElement("div").style,"AnimationEvent"in window||(delete Jl.animationend.animation,delete Jl.animationiteration.animation,delete Jl.animationstart.animation),"TransitionEvent"in window||delete Jl.transitionend.transition);function sm(e){if(__[e])return __[e];if(!Jl[e])return e;var t=Jl[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in WI)return __[e]=t[r];return e}var GI=sm("animationend"),HI=sm("animationiteration"),KI=sm("animationstart"),qI=sm("transitionend"),QI=new Map,JP="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function oa(e,t){QI.set(e,t),hl(t,[e])}for(var y_=0;y_<JP.length;y_++){var v_=JP[y_],h4=v_.toLowerCase(),f4=v_[0].toUpperCase()+v_.slice(1);oa(h4,"on"+f4)}oa(GI,"onAnimationEnd");oa(HI,"onAnimationIteration");oa(KI,"onAnimationStart");oa("dblclick","onDoubleClick");oa("focusin","onFocus");oa("focusout","onBlur");oa(qI,"onTransitionEnd");Pu("onMouseEnter",["mouseout","mouseover"]);Pu("onMouseLeave",["mouseout","mouseover"]);Pu("onPointerEnter",["pointerout","pointerover"]);Pu("onPointerLeave",["pointerout","pointerover"]);hl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hl("onBeforeInput",["compositionend","keypress","textInput","paste"]);hl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),p4=new Set("cancel close invalid load scroll toggle".split(" ").concat(Uc));function YP(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,hB(n,t,void 0,e),e.currentTarget=null}function XI(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var a=n[i],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&s.isPropagationStopped())break e;YP(s,a,u),o=l}else for(i=0;i<n.length;i++){if(a=n[i],l=a.instance,u=a.currentTarget,a=a.listener,l!==o&&s.isPropagationStopped())break e;YP(s,a,u),o=l}}}if(hp)throw e=_v,hp=!1,_v=null,e}function Cr(e,t){var r=t[Sv];r===void 0&&(r=t[Sv]=new Set);var n=e+"__bubble";r.has(n)||(JI(t,e,2,!1),r.add(n))}function w_(e,t,r){var n=0;t&&(n|=4),JI(r,e,n,t)}var tf="_reactListening"+Math.random().toString(36).slice(2);function md(e){if(!e[tf]){e[tf]=!0,sI.forEach(function(r){r!=="selectionchange"&&(p4.has(r)||w_(r,!1,e),w_(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[tf]||(t[tf]=!0,w_("selectionchange",!1,t))}}function JI(e,t,r,n){switch(DI(t)){case 1:var s=CB;break;case 4:s=kB;break;default:s=o0}r=s.bind(null,t,r,e),s=void 0,!gv||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function b_(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var a=n.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(i===4)for(i=n.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;i=i.return}for(;a!==null;){if(i=Va(a),i===null)return;if(l=i.tag,l===5||l===6){n=o=i;continue e}a=a.parentNode}}n=n.return}wI(function(){var u=o,h=t0(r),c=[];e:{var d=QI.get(e);if(d!==void 0){var f=a0,p=e;switch(e){case"keypress":if(Kf(r)===0)break e;case"keydown":case"keyup":f=WB;break;case"focusin":p="focus",f=p_;break;case"focusout":p="blur",f=p_;break;case"beforeblur":case"afterblur":f=p_;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=zP;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=IB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=KB;break;case GI:case HI:case KI:f=FB;break;case qI:f=QB;break;case"scroll":f=$B;break;case"wheel":f=JB;break;case"copy":case"cut":case"paste":f=LB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=UP}var m=(t&4)!==0,b=!m&&e==="scroll",g=m?d!==null?d+"Capture":null:d;m=[];for(var _=u,y;_!==null;){y=_;var v=y.stateNode;if(y.tag===5&&v!==null&&(y=v,g!==null&&(v=ud(_,g),v!=null&&m.push(gd(_,v,y)))),b)break;_=_.return}0<m.length&&(d=new f(d,p,null,r,h),c.push({event:d,listeners:m}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",d&&r!==pv&&(p=r.relatedTarget||r.fromElement)&&(Va(p)||p[ci]))break e;if((f||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=r.relatedTarget||r.toElement,f=u,p=p?Va(p):null,p!==null&&(b=fl(p),p!==b||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=zP,v="onMouseLeave",g="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(m=UP,v="onPointerLeave",g="onPointerEnter",_="pointer"),b=f==null?d:Yl(f),y=p==null?d:Yl(p),d=new m(v,_+"leave",f,r,h),d.target=b,d.relatedTarget=y,v=null,Va(h)===u&&(m=new m(g,_+"enter",p,r,h),m.target=y,m.relatedTarget=b,v=m),b=v,f&&p)t:{for(m=f,g=p,_=0,y=m;y;y=Il(y))_++;for(y=0,v=g;v;v=Il(v))y++;for(;0<_-y;)m=Il(m),_--;for(;0<y-_;)g=Il(g),y--;for(;_--;){if(m===g||g!==null&&m===g.alternate)break t;m=Il(m),g=Il(g)}m=null}else m=null;f!==null&&ZP(c,d,f,m,!1),p!==null&&b!==null&&ZP(c,b,p,m,!0)}}e:{if(d=u?Yl(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var M=s4;else if(GP(d))if(zI)M=l4;else{M=i4;var E=o4}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(M=a4);if(M&&(M=M(e,u))){jI(c,M,r,h);break e}E&&E(e,d,u),e==="focusout"&&(E=d._wrapperState)&&E.controlled&&d.type==="number"&&uv(d,"number",d.value)}switch(E=u?Yl(u):window,e){case"focusin":(GP(E)||E.contentEditable==="true")&&(Xl=E,bv=u,Yc=null);break;case"focusout":Yc=bv=Xl=null;break;case"mousedown":xv=!0;break;case"contextmenu":case"mouseup":case"dragend":xv=!1,XP(c,r,h);break;case"selectionchange":if(d4)break;case"keydown":case"keyup":XP(c,r,h)}var T;if(u0)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Ql?LI(e,r)&&(S="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(S="onCompositionStart");S&&(RI&&r.locale!=="ko"&&(Ql||S!=="onCompositionStart"?S==="onCompositionEnd"&&Ql&&(T=FI()):(Vi=h,i0="value"in Vi?Vi.value:Vi.textContent,Ql=!0)),E=_p(u,S),0<E.length&&(S=new BP(S,e,null,r,h),c.push({event:S,listeners:E}),T?S.data=T:(T=NI(r),T!==null&&(S.data=T)))),(T=ZB?e4(e,r):t4(e,r))&&(u=_p(u,"onBeforeInput"),0<u.length&&(h=new BP("onBeforeInput","beforeinput",null,r,h),c.push({event:h,listeners:u}),h.data=T))}XI(c,t)})}function gd(e,t,r){return{instance:e,listener:t,currentTarget:r}}function _p(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=ud(e,r),o!=null&&n.unshift(gd(e,o,s)),o=ud(e,t),o!=null&&n.push(gd(e,o,s))),e=e.return}return n}function Il(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ZP(e,t,r,n,s){for(var o=t._reactName,i=[];r!==null&&r!==n;){var a=r,l=a.alternate,u=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&u!==null&&(a=u,s?(l=ud(r,o),l!=null&&i.unshift(gd(r,l,a))):s||(l=ud(r,o),l!=null&&i.push(gd(r,l,a)))),r=r.return}i.length!==0&&e.push({event:t,listeners:i})}var m4=/\r\n?/g,g4=/\u0000|\uFFFD/g;function eS(e){return(typeof e=="string"?e:""+e).replace(m4,`
`).replace(g4,"")}function rf(e,t,r){if(t=eS(t),eS(e)!==t&&r)throw Error(Xe(425))}function yp(){}var Mv=null,Tv=null;function Ev(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Pv=typeof setTimeout=="function"?setTimeout:void 0,_4=typeof clearTimeout=="function"?clearTimeout:void 0,tS=typeof Promise=="function"?Promise:void 0,y4=typeof queueMicrotask=="function"?queueMicrotask:typeof tS<"u"?function(e){return tS.resolve(null).then(e).catch(v4)}:Pv;function v4(e){setTimeout(function(){throw e})}function x_(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),hd(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);hd(t)}function Qi(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function rS(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var zu=Math.random().toString(36).slice(2),jo="__reactFiber$"+zu,_d="__reactProps$"+zu,ci="__reactContainer$"+zu,Sv="__reactEvents$"+zu,w4="__reactListeners$"+zu,b4="__reactHandles$"+zu;function Va(e){var t=e[jo];if(t)return t;for(var r=e.parentNode;r;){if(t=r[ci]||r[jo]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=rS(e);e!==null;){if(r=e[jo])return r;e=rS(e)}return t}e=r,r=e.parentNode}return null}function Bd(e){return e=e[jo]||e[ci],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Yl(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Xe(33))}function om(e){return e[_d]||null}var Cv=[],Zl=-1;function ia(e){return{current:e}}function kr(e){0>Zl||(e.current=Cv[Zl],Cv[Zl]=null,Zl--)}function Tr(e,t){Zl++,Cv[Zl]=e.current,e.current=t}var ta={},Un=ia(ta),as=ia(!1),rl=ta;function Su(e,t){var r=e.type.contextTypes;if(!r)return ta;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function ls(e){return e=e.childContextTypes,e!=null}function vp(){kr(as),kr(Un)}function nS(e,t,r){if(Un.current!==ta)throw Error(Xe(168));Tr(Un,t),Tr(as,r)}function YI(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(Xe(108,oB(e)||"Unknown",s));return Wr({},r,n)}function wp(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ta,rl=Un.current,Tr(Un,e),Tr(as,as.current),!0}function sS(e,t,r){var n=e.stateNode;if(!n)throw Error(Xe(169));r?(e=YI(e,t,rl),n.__reactInternalMemoizedMergedChildContext=e,kr(as),kr(Un),Tr(Un,e)):kr(as),Tr(as,r)}var ni=null,im=!1,M_=!1;function ZI(e){ni===null?ni=[e]:ni.push(e)}function x4(e){im=!0,ZI(e)}function aa(){if(!M_&&ni!==null){M_=!0;var e=0,t=dr;try{var r=ni;for(dr=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}ni=null,im=!1}catch(s){throw ni!==null&&(ni=ni.slice(e+1)),TI(r0,aa),s}finally{dr=t,M_=!1}}return null}var eu=[],tu=0,bp=null,xp=0,zs=[],Bs=0,nl=null,ii=1,ai="";function Da(e,t){eu[tu++]=xp,eu[tu++]=bp,bp=e,xp=t}function eO(e,t,r){zs[Bs++]=ii,zs[Bs++]=ai,zs[Bs++]=nl,nl=e;var n=ii;e=ai;var s=32-wo(n)-1;n&=~(1<<s),r+=1;var o=32-wo(t)+s;if(30<o){var i=s-s%5;o=(n&(1<<i)-1).toString(32),n>>=i,s-=i,ii=1<<32-wo(t)+s|r<<s|n,ai=o+e}else ii=1<<o|r<<s|n,ai=e}function d0(e){e.return!==null&&(Da(e,1),eO(e,1,0))}function h0(e){for(;e===bp;)bp=eu[--tu],eu[tu]=null,xp=eu[--tu],eu[tu]=null;for(;e===nl;)nl=zs[--Bs],zs[Bs]=null,ai=zs[--Bs],zs[Bs]=null,ii=zs[--Bs],zs[Bs]=null}var xs=null,bs=null,Or=!1,_o=null;function tO(e,t){var r=Ws(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function oS(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,xs=e,bs=Qi(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,xs=e,bs=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=nl!==null?{id:ii,overflow:ai}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Ws(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,xs=e,bs=null,!0):!1;default:return!1}}function kv(e){return(e.mode&1)!==0&&(e.flags&128)===0}function $v(e){if(Or){var t=bs;if(t){var r=t;if(!oS(e,t)){if(kv(e))throw Error(Xe(418));t=Qi(r.nextSibling);var n=xs;t&&oS(e,t)?tO(n,r):(e.flags=e.flags&-4097|2,Or=!1,xs=e)}}else{if(kv(e))throw Error(Xe(418));e.flags=e.flags&-4097|2,Or=!1,xs=e}}}function iS(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xs=e}function nf(e){if(e!==xs)return!1;if(!Or)return iS(e),Or=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ev(e.type,e.memoizedProps)),t&&(t=bs)){if(kv(e))throw rO(),Error(Xe(418));for(;t;)tO(e,t),t=Qi(t.nextSibling)}if(iS(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Xe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){bs=Qi(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}bs=null}}else bs=xs?Qi(e.stateNode.nextSibling):null;return!0}function rO(){for(var e=bs;e;)e=Qi(e.nextSibling)}function Cu(){bs=xs=null,Or=!1}function f0(e){_o===null?_o=[e]:_o.push(e)}var M4=gi.ReactCurrentBatchConfig;function Tc(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Xe(309));var n=r.stateNode}if(!n)throw Error(Xe(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var a=s.refs;i===null?delete a[o]:a[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(Xe(284));if(!r._owner)throw Error(Xe(290,e))}return e}function sf(e,t){throw e=Object.prototype.toString.call(t),Error(Xe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function aS(e){var t=e._init;return t(e._payload)}function nO(e){function t(g,_){if(e){var y=g.deletions;y===null?(g.deletions=[_],g.flags|=16):y.push(_)}}function r(g,_){if(!e)return null;for(;_!==null;)t(g,_),_=_.sibling;return null}function n(g,_){for(g=new Map;_!==null;)_.key!==null?g.set(_.key,_):g.set(_.index,_),_=_.sibling;return g}function s(g,_){return g=Zi(g,_),g.index=0,g.sibling=null,g}function o(g,_,y){return g.index=y,e?(y=g.alternate,y!==null?(y=y.index,y<_?(g.flags|=2,_):y):(g.flags|=2,_)):(g.flags|=1048576,_)}function i(g){return e&&g.alternate===null&&(g.flags|=2),g}function a(g,_,y,v){return _===null||_.tag!==6?(_=$_(y,g.mode,v),_.return=g,_):(_=s(_,y),_.return=g,_)}function l(g,_,y,v){var M=y.type;return M===ql?h(g,_,y.props.children,v,y.key):_!==null&&(_.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Oi&&aS(M)===_.type)?(v=s(_,y.props),v.ref=Tc(g,_,y),v.return=g,v):(v=ep(y.type,y.key,y.props,null,g.mode,v),v.ref=Tc(g,_,y),v.return=g,v)}function u(g,_,y,v){return _===null||_.tag!==4||_.stateNode.containerInfo!==y.containerInfo||_.stateNode.implementation!==y.implementation?(_=A_(y,g.mode,v),_.return=g,_):(_=s(_,y.children||[]),_.return=g,_)}function h(g,_,y,v,M){return _===null||_.tag!==7?(_=tl(y,g.mode,v,M),_.return=g,_):(_=s(_,y),_.return=g,_)}function c(g,_,y){if(typeof _=="string"&&_!==""||typeof _=="number")return _=$_(""+_,g.mode,y),_.return=g,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Kh:return y=ep(_.type,_.key,_.props,null,g.mode,y),y.ref=Tc(g,null,_),y.return=g,y;case Kl:return _=A_(_,g.mode,y),_.return=g,_;case Oi:var v=_._init;return c(g,v(_._payload),y)}if(zc(_)||vc(_))return _=tl(_,g.mode,y,null),_.return=g,_;sf(g,_)}return null}function d(g,_,y,v){var M=_!==null?_.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return M!==null?null:a(g,_,""+y,v);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Kh:return y.key===M?l(g,_,y,v):null;case Kl:return y.key===M?u(g,_,y,v):null;case Oi:return M=y._init,d(g,_,M(y._payload),v)}if(zc(y)||vc(y))return M!==null?null:h(g,_,y,v,null);sf(g,y)}return null}function f(g,_,y,v,M){if(typeof v=="string"&&v!==""||typeof v=="number")return g=g.get(y)||null,a(_,g,""+v,M);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Kh:return g=g.get(v.key===null?y:v.key)||null,l(_,g,v,M);case Kl:return g=g.get(v.key===null?y:v.key)||null,u(_,g,v,M);case Oi:var E=v._init;return f(g,_,y,E(v._payload),M)}if(zc(v)||vc(v))return g=g.get(y)||null,h(_,g,v,M,null);sf(_,v)}return null}function p(g,_,y,v){for(var M=null,E=null,T=_,S=_=0,A=null;T!==null&&S<y.length;S++){T.index>S?(A=T,T=null):A=T.sibling;var I=d(g,T,y[S],v);if(I===null){T===null&&(T=A);break}e&&T&&I.alternate===null&&t(g,T),_=o(I,_,S),E===null?M=I:E.sibling=I,E=I,T=A}if(S===y.length)return r(g,T),Or&&Da(g,S),M;if(T===null){for(;S<y.length;S++)T=c(g,y[S],v),T!==null&&(_=o(T,_,S),E===null?M=T:E.sibling=T,E=T);return Or&&Da(g,S),M}for(T=n(g,T);S<y.length;S++)A=f(T,g,S,y[S],v),A!==null&&(e&&A.alternate!==null&&T.delete(A.key===null?S:A.key),_=o(A,_,S),E===null?M=A:E.sibling=A,E=A);return e&&T.forEach(function(V){return t(g,V)}),Or&&Da(g,S),M}function m(g,_,y,v){var M=vc(y);if(typeof M!="function")throw Error(Xe(150));if(y=M.call(y),y==null)throw Error(Xe(151));for(var E=M=null,T=_,S=_=0,A=null,I=y.next();T!==null&&!I.done;S++,I=y.next()){T.index>S?(A=T,T=null):A=T.sibling;var V=d(g,T,I.value,v);if(V===null){T===null&&(T=A);break}e&&T&&V.alternate===null&&t(g,T),_=o(V,_,S),E===null?M=V:E.sibling=V,E=V,T=A}if(I.done)return r(g,T),Or&&Da(g,S),M;if(T===null){for(;!I.done;S++,I=y.next())I=c(g,I.value,v),I!==null&&(_=o(I,_,S),E===null?M=I:E.sibling=I,E=I);return Or&&Da(g,S),M}for(T=n(g,T);!I.done;S++,I=y.next())I=f(T,g,S,I.value,v),I!==null&&(e&&I.alternate!==null&&T.delete(I.key===null?S:I.key),_=o(I,_,S),E===null?M=I:E.sibling=I,E=I);return e&&T.forEach(function(N){return t(g,N)}),Or&&Da(g,S),M}function b(g,_,y,v){if(typeof y=="object"&&y!==null&&y.type===ql&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Kh:e:{for(var M=y.key,E=_;E!==null;){if(E.key===M){if(M=y.type,M===ql){if(E.tag===7){r(g,E.sibling),_=s(E,y.props.children),_.return=g,g=_;break e}}else if(E.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Oi&&aS(M)===E.type){r(g,E.sibling),_=s(E,y.props),_.ref=Tc(g,E,y),_.return=g,g=_;break e}r(g,E);break}else t(g,E);E=E.sibling}y.type===ql?(_=tl(y.props.children,g.mode,v,y.key),_.return=g,g=_):(v=ep(y.type,y.key,y.props,null,g.mode,v),v.ref=Tc(g,_,y),v.return=g,g=v)}return i(g);case Kl:e:{for(E=y.key;_!==null;){if(_.key===E)if(_.tag===4&&_.stateNode.containerInfo===y.containerInfo&&_.stateNode.implementation===y.implementation){r(g,_.sibling),_=s(_,y.children||[]),_.return=g,g=_;break e}else{r(g,_);break}else t(g,_);_=_.sibling}_=A_(y,g.mode,v),_.return=g,g=_}return i(g);case Oi:return E=y._init,b(g,_,E(y._payload),v)}if(zc(y))return p(g,_,y,v);if(vc(y))return m(g,_,y,v);sf(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,_!==null&&_.tag===6?(r(g,_.sibling),_=s(_,y),_.return=g,g=_):(r(g,_),_=$_(y,g.mode,v),_.return=g,g=_),i(g)):r(g,_)}return b}var ku=nO(!0),sO=nO(!1),Mp=ia(null),Tp=null,ru=null,p0=null;function m0(){p0=ru=Tp=null}function g0(e){var t=Mp.current;kr(Mp),e._currentValue=t}function Av(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function du(e,t){Tp=e,p0=ru=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(is=!0),e.firstContext=null)}function Ks(e){var t=e._currentValue;if(p0!==e)if(e={context:e,memoizedValue:t,next:null},ru===null){if(Tp===null)throw Error(Xe(308));ru=e,Tp.dependencies={lanes:0,firstContext:e}}else ru=ru.next=e;return t}var Wa=null;function _0(e){Wa===null?Wa=[e]:Wa.push(e)}function oO(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,_0(t)):(r.next=s.next,s.next=r),t.interleaved=r,di(e,n)}function di(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Di=!1;function y0(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iO(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function li(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Xi(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,sr&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,di(e,r)}return s=n.interleaved,s===null?(t.next=t,_0(n)):(t.next=s.next,s.next=t),n.interleaved=t,di(e,r)}function qf(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,n0(e,r)}}function lS(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=i:o=o.next=i,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Ep(e,t,r,n){var s=e.updateQueue;Di=!1;var o=s.firstBaseUpdate,i=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,i===null?o=u:i.next=u,i=l;var h=e.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==i&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(o!==null){var c=s.baseState;i=0,h=u=l=null,a=o;do{var d=a.lane,f=a.eventTime;if((n&d)===d){h!==null&&(h=h.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(d=t,f=r,m.tag){case 1:if(p=m.payload,typeof p=="function"){c=p.call(f,c,d);break e}c=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,c,d):p,d==null)break e;c=Wr({},c,d);break e;case 2:Di=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,d=s.effects,d===null?s.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=f,l=c):h=h.next=f,i|=d;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;d=a,a=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(h===null&&(l=c),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,t=s.shared.interleaved,t!==null){s=t;do i|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);ol|=i,e.lanes=i,e.memoizedState=c}}function uS(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Xe(191,s));s.call(n)}}}var Ud={},Uo=ia(Ud),yd=ia(Ud),vd=ia(Ud);function Ga(e){if(e===Ud)throw Error(Xe(174));return e}function v0(e,t){switch(Tr(vd,t),Tr(yd,e),Tr(Uo,Ud),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dv(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dv(t,e)}kr(Uo),Tr(Uo,t)}function $u(){kr(Uo),kr(yd),kr(vd)}function aO(e){Ga(vd.current);var t=Ga(Uo.current),r=dv(t,e.type);t!==r&&(Tr(yd,e),Tr(Uo,r))}function w0(e){yd.current===e&&(kr(Uo),kr(yd))}var Ur=ia(0);function Pp(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var T_=[];function b0(){for(var e=0;e<T_.length;e++)T_[e]._workInProgressVersionPrimary=null;T_.length=0}var Qf=gi.ReactCurrentDispatcher,E_=gi.ReactCurrentBatchConfig,sl=0,Vr=null,_n=null,Tn=null,Sp=!1,Zc=!1,wd=0,T4=0;function Ln(){throw Error(Xe(321))}function x0(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Mo(e[r],t[r]))return!1;return!0}function M0(e,t,r,n,s,o){if(sl=o,Vr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qf.current=e===null||e.memoizedState===null?C4:k4,e=r(n,s),Zc){o=0;do{if(Zc=!1,wd=0,25<=o)throw Error(Xe(301));o+=1,Tn=_n=null,t.updateQueue=null,Qf.current=$4,e=r(n,s)}while(Zc)}if(Qf.current=Cp,t=_n!==null&&_n.next!==null,sl=0,Tn=_n=Vr=null,Sp=!1,t)throw Error(Xe(300));return e}function T0(){var e=wd!==0;return wd=0,e}function Fo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tn===null?Vr.memoizedState=Tn=e:Tn=Tn.next=e,Tn}function qs(){if(_n===null){var e=Vr.alternate;e=e!==null?e.memoizedState:null}else e=_n.next;var t=Tn===null?Vr.memoizedState:Tn.next;if(t!==null)Tn=t,_n=e;else{if(e===null)throw Error(Xe(310));_n=e,e={memoizedState:_n.memoizedState,baseState:_n.baseState,baseQueue:_n.baseQueue,queue:_n.queue,next:null},Tn===null?Vr.memoizedState=Tn=e:Tn=Tn.next=e}return Tn}function bd(e,t){return typeof t=="function"?t(e):t}function P_(e){var t=qs(),r=t.queue;if(r===null)throw Error(Xe(311));r.lastRenderedReducer=e;var n=_n,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var i=s.next;s.next=o.next,o.next=i}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var a=i=null,l=null,u=o;do{var h=u.lane;if((sl&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var c={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=c,i=n):l=l.next=c,Vr.lanes|=h,ol|=h}u=u.next}while(u!==null&&u!==o);l===null?i=n:l.next=a,Mo(n,t.memoizedState)||(is=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,Vr.lanes|=o,ol|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function S_(e){var t=qs(),r=t.queue;if(r===null)throw Error(Xe(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var i=s=s.next;do o=e(o,i.action),i=i.next;while(i!==s);Mo(o,t.memoizedState)||(is=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function lO(){}function uO(e,t){var r=Vr,n=qs(),s=t(),o=!Mo(n.memoizedState,s);if(o&&(n.memoizedState=s,is=!0),n=n.queue,E0(hO.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||Tn!==null&&Tn.memoizedState.tag&1){if(r.flags|=2048,xd(9,dO.bind(null,r,n,s,t),void 0,null),En===null)throw Error(Xe(349));sl&30||cO(r,t,s)}return s}function cO(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Vr.updateQueue,t===null?(t={lastEffect:null,stores:null},Vr.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function dO(e,t,r,n){t.value=r,t.getSnapshot=n,fO(t)&&pO(e)}function hO(e,t,r){return r(function(){fO(t)&&pO(e)})}function fO(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Mo(e,r)}catch{return!0}}function pO(e){var t=di(e,1);t!==null&&bo(t,e,1,-1)}function cS(e){var t=Fo();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bd,lastRenderedState:e},t.queue=e,e=e.dispatch=S4.bind(null,Vr,e),[t.memoizedState,e]}function xd(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Vr.updateQueue,t===null?(t={lastEffect:null,stores:null},Vr.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function mO(){return qs().memoizedState}function Xf(e,t,r,n){var s=Fo();Vr.flags|=e,s.memoizedState=xd(1|t,r,void 0,n===void 0?null:n)}function am(e,t,r,n){var s=qs();n=n===void 0?null:n;var o=void 0;if(_n!==null){var i=_n.memoizedState;if(o=i.destroy,n!==null&&x0(n,i.deps)){s.memoizedState=xd(t,r,o,n);return}}Vr.flags|=e,s.memoizedState=xd(1|t,r,o,n)}function dS(e,t){return Xf(8390656,8,e,t)}function E0(e,t){return am(2048,8,e,t)}function gO(e,t){return am(4,2,e,t)}function _O(e,t){return am(4,4,e,t)}function yO(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function vO(e,t,r){return r=r!=null?r.concat([e]):null,am(4,4,yO.bind(null,t,e),r)}function P0(){}function wO(e,t){var r=qs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&x0(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function bO(e,t){var r=qs();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&x0(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function xO(e,t,r){return sl&21?(Mo(r,t)||(r=SI(),Vr.lanes|=r,ol|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,is=!0),e.memoizedState=r)}function E4(e,t){var r=dr;dr=r!==0&&4>r?r:4,e(!0);var n=E_.transition;E_.transition={};try{e(!1),t()}finally{dr=r,E_.transition=n}}function MO(){return qs().memoizedState}function P4(e,t,r){var n=Yi(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},TO(e))EO(t,r);else if(r=oO(e,t,r,n),r!==null){var s=Jn();bo(r,e,n,s),PO(r,t,n)}}function S4(e,t,r){var n=Yi(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(TO(e))EO(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,a=o(i,r);if(s.hasEagerState=!0,s.eagerState=a,Mo(a,i)){var l=t.interleaved;l===null?(s.next=s,_0(t)):(s.next=l.next,l.next=s),t.interleaved=s;return}}catch{}finally{}r=oO(e,t,s,n),r!==null&&(s=Jn(),bo(r,e,n,s),PO(r,t,n))}}function TO(e){var t=e.alternate;return e===Vr||t!==null&&t===Vr}function EO(e,t){Zc=Sp=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function PO(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,n0(e,r)}}var Cp={readContext:Ks,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useInsertionEffect:Ln,useLayoutEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useMutableSource:Ln,useSyncExternalStore:Ln,useId:Ln,unstable_isNewReconciler:!1},C4={readContext:Ks,useCallback:function(e,t){return Fo().memoizedState=[e,t===void 0?null:t],e},useContext:Ks,useEffect:dS,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Xf(4194308,4,yO.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Xf(4194308,4,e,t)},useInsertionEffect:function(e,t){return Xf(4,2,e,t)},useMemo:function(e,t){var r=Fo();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Fo();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=P4.bind(null,Vr,e),[n.memoizedState,e]},useRef:function(e){var t=Fo();return e={current:e},t.memoizedState=e},useState:cS,useDebugValue:P0,useDeferredValue:function(e){return Fo().memoizedState=e},useTransition:function(){var e=cS(!1),t=e[0];return e=E4.bind(null,e[1]),Fo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Vr,s=Fo();if(Or){if(r===void 0)throw Error(Xe(407));r=r()}else{if(r=t(),En===null)throw Error(Xe(349));sl&30||cO(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,dS(hO.bind(null,n,o,e),[e]),n.flags|=2048,xd(9,dO.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=Fo(),t=En.identifierPrefix;if(Or){var r=ai,n=ii;r=(n&~(1<<32-wo(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=wd++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=T4++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},k4={readContext:Ks,useCallback:wO,useContext:Ks,useEffect:E0,useImperativeHandle:vO,useInsertionEffect:gO,useLayoutEffect:_O,useMemo:bO,useReducer:P_,useRef:mO,useState:function(){return P_(bd)},useDebugValue:P0,useDeferredValue:function(e){var t=qs();return xO(t,_n.memoizedState,e)},useTransition:function(){var e=P_(bd)[0],t=qs().memoizedState;return[e,t]},useMutableSource:lO,useSyncExternalStore:uO,useId:MO,unstable_isNewReconciler:!1},$4={readContext:Ks,useCallback:wO,useContext:Ks,useEffect:E0,useImperativeHandle:vO,useInsertionEffect:gO,useLayoutEffect:_O,useMemo:bO,useReducer:S_,useRef:mO,useState:function(){return S_(bd)},useDebugValue:P0,useDeferredValue:function(e){var t=qs();return _n===null?t.memoizedState=e:xO(t,_n.memoizedState,e)},useTransition:function(){var e=S_(bd)[0],t=qs().memoizedState;return[e,t]},useMutableSource:lO,useSyncExternalStore:uO,useId:MO,unstable_isNewReconciler:!1};function uo(e,t){if(e&&e.defaultProps){t=Wr({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Iv(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Wr({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var lm={isMounted:function(e){return(e=e._reactInternals)?fl(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Jn(),s=Yi(e),o=li(n,s);o.payload=t,r!=null&&(o.callback=r),t=Xi(e,o,s),t!==null&&(bo(t,e,s,n),qf(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Jn(),s=Yi(e),o=li(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Xi(e,o,s),t!==null&&(bo(t,e,s,n),qf(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Jn(),n=Yi(e),s=li(r,n);s.tag=2,t!=null&&(s.callback=t),t=Xi(e,s,n),t!==null&&(bo(t,e,n,r),qf(t,e,n))}};function hS(e,t,r,n,s,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!pd(r,n)||!pd(s,o):!0}function SO(e,t,r){var n=!1,s=ta,o=t.contextType;return typeof o=="object"&&o!==null?o=Ks(o):(s=ls(t)?rl:Un.current,n=t.contextTypes,o=(n=n!=null)?Su(e,s):ta),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=lm,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function fS(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&lm.enqueueReplaceState(t,t.state,null)}function Ov(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},y0(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=Ks(o):(o=ls(t)?rl:Un.current,s.context=Su(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Iv(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&lm.enqueueReplaceState(s,s.state,null),Ep(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function Au(e,t){try{var r="",n=t;do r+=sB(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function C_(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Dv(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var A4=typeof WeakMap=="function"?WeakMap:Map;function CO(e,t,r){r=li(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){$p||($p=!0,Wv=n),Dv(e,t)},r}function kO(e,t,r){r=li(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){Dv(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){Dv(e,t),typeof n!="function"&&(Ji===null?Ji=new Set([this]):Ji.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),r}function pS(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new A4;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=G4.bind(null,e,t,r),t.then(e,e))}function mS(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function gS(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=li(-1,1),t.tag=2,Xi(r,t,1))),r.lanes|=1),e)}var I4=gi.ReactCurrentOwner,is=!1;function qn(e,t,r,n){t.child=e===null?sO(t,null,r,n):ku(t,e.child,r,n)}function _S(e,t,r,n,s){r=r.render;var o=t.ref;return du(t,s),n=M0(e,t,r,n,o,s),r=T0(),e!==null&&!is?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,hi(e,t,s)):(Or&&r&&d0(t),t.flags|=1,qn(e,t,n,s),t.child)}function yS(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!D0(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,$O(e,t,o,n,s)):(e=ep(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var i=o.memoizedProps;if(r=r.compare,r=r!==null?r:pd,r(i,n)&&e.ref===t.ref)return hi(e,t,s)}return t.flags|=1,e=Zi(o,n),e.ref=t.ref,e.return=t,t.child=e}function $O(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(pd(o,n)&&e.ref===t.ref)if(is=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&(is=!0);else return t.lanes=e.lanes,hi(e,t,s)}return Fv(e,t,r,n,s)}function AO(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(su,gs),gs|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tr(su,gs),gs|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,Tr(su,gs),gs|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,Tr(su,gs),gs|=n;return qn(e,t,s,r),t.child}function IO(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Fv(e,t,r,n,s){var o=ls(r)?rl:Un.current;return o=Su(t,o),du(t,s),r=M0(e,t,r,n,o,s),n=T0(),e!==null&&!is?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,hi(e,t,s)):(Or&&n&&d0(t),t.flags|=1,qn(e,t,r,s),t.child)}function vS(e,t,r,n,s){if(ls(r)){var o=!0;wp(t)}else o=!1;if(du(t,s),t.stateNode===null)Jf(e,t),SO(t,r,n),Ov(t,r,n,s),n=!0;else if(e===null){var i=t.stateNode,a=t.memoizedProps;i.props=a;var l=i.context,u=r.contextType;typeof u=="object"&&u!==null?u=Ks(u):(u=ls(r)?rl:Un.current,u=Su(t,u));var h=r.getDerivedStateFromProps,c=typeof h=="function"||typeof i.getSnapshotBeforeUpdate=="function";c||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==n||l!==u)&&fS(t,i,n,u),Di=!1;var d=t.memoizedState;i.state=d,Ep(t,n,i,s),l=t.memoizedState,a!==n||d!==l||as.current||Di?(typeof h=="function"&&(Iv(t,r,h,n),l=t.memoizedState),(a=Di||hS(t,r,a,n,d,l,u))?(c||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),i.props=n,i.state=l,i.context=u,n=a):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,iO(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:uo(t.type,a),i.props=u,c=t.pendingProps,d=i.context,l=r.contextType,typeof l=="object"&&l!==null?l=Ks(l):(l=ls(r)?rl:Un.current,l=Su(t,l));var f=r.getDerivedStateFromProps;(h=typeof f=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==c||d!==l)&&fS(t,i,n,l),Di=!1,d=t.memoizedState,i.state=d,Ep(t,n,i,s);var p=t.memoizedState;a!==c||d!==p||as.current||Di?(typeof f=="function"&&(Iv(t,r,f,n),p=t.memoizedState),(u=Di||hS(t,r,u,n,d,p,l)||!1)?(h||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,p,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,p,l)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),i.props=n,i.state=p,i.context=l,n=u):(typeof i.componentDidUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return Rv(e,t,r,n,o,s)}function Rv(e,t,r,n,s,o){IO(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return s&&sS(t,r,!1),hi(e,t,o);n=t.stateNode,I4.current=t;var a=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=ku(t,e.child,null,o),t.child=ku(t,null,a,o)):qn(e,t,a,o),t.memoizedState=n.state,s&&sS(t,r,!0),t.child}function OO(e){var t=e.stateNode;t.pendingContext?nS(e,t.pendingContext,t.pendingContext!==t.context):t.context&&nS(e,t.context,!1),v0(e,t.containerInfo)}function wS(e,t,r,n,s){return Cu(),f0(s),t.flags|=256,qn(e,t,r,n),t.child}var Lv={dehydrated:null,treeContext:null,retryLane:0};function Nv(e){return{baseLanes:e,cachePool:null,transitions:null}}function DO(e,t,r){var n=t.pendingProps,s=Ur.current,o=!1,i=(t.flags&128)!==0,a;if((a=i)||(a=e!==null&&e.memoizedState===null?!1:(s&2)!==0),a?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),Tr(Ur,s&1),e===null)return $v(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=dm(i,n,0,null),e=tl(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Nv(r),t.memoizedState=Lv,e):S0(t,i));if(s=e.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return O4(e,t,i,n,a,s,r);if(o){o=n.fallback,i=t.mode,s=e.child,a=s.sibling;var l={mode:"hidden",children:n.children};return!(i&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=Zi(s,l),n.subtreeFlags=s.subtreeFlags&14680064),a!==null?o=Zi(a,o):(o=tl(o,i,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?Nv(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~r,t.memoizedState=Lv,n}return o=e.child,e=o.sibling,n=Zi(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function S0(e,t){return t=dm({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function of(e,t,r,n){return n!==null&&f0(n),ku(t,e.child,null,r),e=S0(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function O4(e,t,r,n,s,o,i){if(r)return t.flags&256?(t.flags&=-257,n=C_(Error(Xe(422))),of(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=dm({mode:"visible",children:n.children},s,0,null),o=tl(o,s,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&ku(t,e.child,null,i),t.child.memoizedState=Nv(i),t.memoizedState=Lv,o);if(!(t.mode&1))return of(e,t,i,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var a=n.dgst;return n=a,o=Error(Xe(419)),n=C_(o,n,void 0),of(e,t,i,n)}if(a=(i&e.childLanes)!==0,is||a){if(n=En,n!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|i)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,di(e,s),bo(n,e,s,-1))}return O0(),n=C_(Error(Xe(421))),of(e,t,i,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=H4.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,bs=Qi(s.nextSibling),xs=t,Or=!0,_o=null,e!==null&&(zs[Bs++]=ii,zs[Bs++]=ai,zs[Bs++]=nl,ii=e.id,ai=e.overflow,nl=t),t=S0(t,n.children),t.flags|=4096,t)}function bS(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Av(e.return,t,r)}function k_(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function FO(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(qn(e,t,n.children,r),n=Ur.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&bS(e,r,t);else if(e.tag===19)bS(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Tr(Ur,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&Pp(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),k_(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&Pp(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}k_(t,!0,r,null,o);break;case"together":k_(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jf(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function hi(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ol|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Xe(153));if(t.child!==null){for(e=t.child,r=Zi(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Zi(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function D4(e,t,r){switch(t.tag){case 3:OO(t),Cu();break;case 5:aO(t);break;case 1:ls(t.type)&&wp(t);break;case 4:v0(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;Tr(Mp,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Tr(Ur,Ur.current&1),t.flags|=128,null):r&t.child.childLanes?DO(e,t,r):(Tr(Ur,Ur.current&1),e=hi(e,t,r),e!==null?e.sibling:null);Tr(Ur,Ur.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return FO(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Tr(Ur,Ur.current),n)break;return null;case 22:case 23:return t.lanes=0,AO(e,t,r)}return hi(e,t,r)}var RO,jv,LO,NO;RO=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};jv=function(){};LO=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Ga(Uo.current);var o=null;switch(r){case"input":s=av(e,s),n=av(e,n),o=[];break;case"select":s=Wr({},s,{value:void 0}),n=Wr({},n,{value:void 0}),o=[];break;case"textarea":s=cv(e,s),n=cv(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=yp)}hv(r,n);var i;r=null;for(u in s)if(!n.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(i in a)a.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ad.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in n){var l=n[u];if(a=s!=null?s[u]:void 0,n.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(r||(r={}),r[i]=l[i])}else r||(o||(o=[]),o.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ad.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Cr("scroll",e),o||a===l||(o=[])):(o=o||[]).push(u,l))}r&&(o=o||[]).push("style",r);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};NO=function(e,t,r,n){r!==n&&(t.flags|=4)};function Ec(e,t){if(!Or)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Nn(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function F4(e,t,r){var n=t.pendingProps;switch(h0(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(t),null;case 1:return ls(t.type)&&vp(),Nn(t),null;case 3:return n=t.stateNode,$u(),kr(as),kr(Un),b0(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(nf(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,_o!==null&&(Kv(_o),_o=null))),jv(e,t),Nn(t),null;case 5:w0(t);var s=Ga(vd.current);if(r=t.type,e!==null&&t.stateNode!=null)LO(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Xe(166));return Nn(t),null}if(e=Ga(Uo.current),nf(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[jo]=t,n[_d]=o,e=(t.mode&1)!==0,r){case"dialog":Cr("cancel",n),Cr("close",n);break;case"iframe":case"object":case"embed":Cr("load",n);break;case"video":case"audio":for(s=0;s<Uc.length;s++)Cr(Uc[s],n);break;case"source":Cr("error",n);break;case"img":case"image":case"link":Cr("error",n),Cr("load",n);break;case"details":Cr("toggle",n);break;case"input":$P(n,o),Cr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Cr("invalid",n);break;case"textarea":IP(n,o),Cr("invalid",n)}hv(r,o),s=null;for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="children"?typeof a=="string"?n.textContent!==a&&(o.suppressHydrationWarning!==!0&&rf(n.textContent,a,e),s=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&rf(n.textContent,a,e),s=["children",""+a]):ad.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&Cr("scroll",n)}switch(r){case"input":qh(n),AP(n,o,!0);break;case"textarea":qh(n),OP(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=yp)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=hI(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(r,{is:n.is}):(e=i.createElement(r),r==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,r),e[jo]=t,e[_d]=n,RO(e,t,!1,!1),t.stateNode=e;e:{switch(i=fv(r,n),r){case"dialog":Cr("cancel",e),Cr("close",e),s=n;break;case"iframe":case"object":case"embed":Cr("load",e),s=n;break;case"video":case"audio":for(s=0;s<Uc.length;s++)Cr(Uc[s],e);s=n;break;case"source":Cr("error",e),s=n;break;case"img":case"image":case"link":Cr("error",e),Cr("load",e),s=n;break;case"details":Cr("toggle",e),s=n;break;case"input":$P(e,n),s=av(e,n),Cr("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=Wr({},n,{value:void 0}),Cr("invalid",e);break;case"textarea":IP(e,n),s=cv(e,n),Cr("invalid",e);break;default:s=n}hv(r,s),a=s;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?mI(e,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&fI(e,l)):o==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&ld(e,l):typeof l=="number"&&ld(e,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ad.hasOwnProperty(o)?l!=null&&o==="onScroll"&&Cr("scroll",e):l!=null&&Jw(e,o,l,i))}switch(r){case"input":qh(e),AP(e,n,!1);break;case"textarea":qh(e),OP(e);break;case"option":n.value!=null&&e.setAttribute("value",""+ea(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?au(e,!!n.multiple,o,!1):n.defaultValue!=null&&au(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=yp)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Nn(t),null;case 6:if(e&&t.stateNode!=null)NO(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Xe(166));if(r=Ga(vd.current),Ga(Uo.current),nf(t)){if(n=t.stateNode,r=t.memoizedProps,n[jo]=t,(o=n.nodeValue!==r)&&(e=xs,e!==null))switch(e.tag){case 3:rf(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&rf(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[jo]=t,t.stateNode=n}return Nn(t),null;case 13:if(kr(Ur),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Or&&bs!==null&&t.mode&1&&!(t.flags&128))rO(),Cu(),t.flags|=98560,o=!1;else if(o=nf(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(Xe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Xe(317));o[jo]=t}else Cu(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Nn(t),o=!1}else _o!==null&&(Kv(_o),_o=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Ur.current&1?yn===0&&(yn=3):O0())),t.updateQueue!==null&&(t.flags|=4),Nn(t),null);case 4:return $u(),jv(e,t),e===null&&md(t.stateNode.containerInfo),Nn(t),null;case 10:return g0(t.type._context),Nn(t),null;case 17:return ls(t.type)&&vp(),Nn(t),null;case 19:if(kr(Ur),o=t.memoizedState,o===null)return Nn(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)Ec(o,!1);else{if(yn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=Pp(e),i!==null){for(t.flags|=128,Ec(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Tr(Ur,Ur.current&1|2),t.child}e=e.sibling}o.tail!==null&&tn()>Iu&&(t.flags|=128,n=!0,Ec(o,!1),t.lanes=4194304)}else{if(!n)if(e=Pp(i),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Ec(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!Or)return Nn(t),null}else 2*tn()-o.renderingStartTime>Iu&&r!==1073741824&&(t.flags|=128,n=!0,Ec(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(r=o.last,r!==null?r.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=tn(),t.sibling=null,r=Ur.current,Tr(Ur,n?r&1|2:r&1),t):(Nn(t),null);case 22:case 23:return I0(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?gs&1073741824&&(Nn(t),t.subtreeFlags&6&&(t.flags|=8192)):Nn(t),null;case 24:return null;case 25:return null}throw Error(Xe(156,t.tag))}function R4(e,t){switch(h0(t),t.tag){case 1:return ls(t.type)&&vp(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return $u(),kr(as),kr(Un),b0(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return w0(t),null;case 13:if(kr(Ur),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Xe(340));Cu()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return kr(Ur),null;case 4:return $u(),null;case 10:return g0(t.type._context),null;case 22:case 23:return I0(),null;case 24:return null;default:return null}}var af=!1,Bn=!1,L4=typeof WeakSet=="function"?WeakSet:Set,pt=null;function nu(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Jr(e,t,n)}else r.current=null}function zv(e,t,r){try{r()}catch(n){Jr(e,t,n)}}var xS=!1;function N4(e,t){if(Mv=mp,e=VI(),c0(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var i=0,a=-1,l=-1,u=0,h=0,c=e,d=null;t:for(;;){for(var f;c!==r||s!==0&&c.nodeType!==3||(a=i+s),c!==o||n!==0&&c.nodeType!==3||(l=i+n),c.nodeType===3&&(i+=c.nodeValue.length),(f=c.firstChild)!==null;)d=c,c=f;for(;;){if(c===e)break t;if(d===r&&++u===s&&(a=i),d===o&&++h===n&&(l=i),(f=c.nextSibling)!==null)break;c=d,d=c.parentNode}c=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(Tv={focusedElem:e,selectionRange:r},mp=!1,pt=t;pt!==null;)if(t=pt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,pt=e;else for(;pt!==null;){t=pt;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,b=p.memoizedState,g=t.stateNode,_=g.getSnapshotBeforeUpdate(t.elementType===t.type?m:uo(t.type,m),b);g.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(v){Jr(t,t.return,v)}if(e=t.sibling,e!==null){e.return=t.return,pt=e;break}pt=t.return}return p=xS,xS=!1,p}function ed(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&zv(t,r,o)}s=s.next}while(s!==n)}}function um(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Bv(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function jO(e){var t=e.alternate;t!==null&&(e.alternate=null,jO(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[jo],delete t[_d],delete t[Sv],delete t[w4],delete t[b4])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function zO(e){return e.tag===5||e.tag===3||e.tag===4}function MS(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||zO(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Uv(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=yp));else if(n!==4&&(e=e.child,e!==null))for(Uv(e,t,r),e=e.sibling;e!==null;)Uv(e,t,r),e=e.sibling}function Vv(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(Vv(e,t,r),e=e.sibling;e!==null;)Vv(e,t,r),e=e.sibling}var kn=null,mo=!1;function Ti(e,t,r){for(r=r.child;r!==null;)BO(e,t,r),r=r.sibling}function BO(e,t,r){if(Bo&&typeof Bo.onCommitFiberUnmount=="function")try{Bo.onCommitFiberUnmount(tm,r)}catch{}switch(r.tag){case 5:Bn||nu(r,t);case 6:var n=kn,s=mo;kn=null,Ti(e,t,r),kn=n,mo=s,kn!==null&&(mo?(e=kn,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):kn.removeChild(r.stateNode));break;case 18:kn!==null&&(mo?(e=kn,r=r.stateNode,e.nodeType===8?x_(e.parentNode,r):e.nodeType===1&&x_(e,r),hd(e)):x_(kn,r.stateNode));break;case 4:n=kn,s=mo,kn=r.stateNode.containerInfo,mo=!0,Ti(e,t,r),kn=n,mo=s;break;case 0:case 11:case 14:case 15:if(!Bn&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&zv(r,t,i),s=s.next}while(s!==n)}Ti(e,t,r);break;case 1:if(!Bn&&(nu(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Jr(r,t,a)}Ti(e,t,r);break;case 21:Ti(e,t,r);break;case 22:r.mode&1?(Bn=(n=Bn)||r.memoizedState!==null,Ti(e,t,r),Bn=n):Ti(e,t,r);break;default:Ti(e,t,r)}}function TS(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new L4),t.forEach(function(n){var s=K4.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function to(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,i=t,a=i;e:for(;a!==null;){switch(a.tag){case 5:kn=a.stateNode,mo=!1;break e;case 3:kn=a.stateNode.containerInfo,mo=!0;break e;case 4:kn=a.stateNode.containerInfo,mo=!0;break e}a=a.return}if(kn===null)throw Error(Xe(160));BO(o,i,s),kn=null,mo=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Jr(s,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)UO(t,e),t=t.sibling}function UO(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(to(t,e),Oo(e),n&4){try{ed(3,e,e.return),um(3,e)}catch(m){Jr(e,e.return,m)}try{ed(5,e,e.return)}catch(m){Jr(e,e.return,m)}}break;case 1:to(t,e),Oo(e),n&512&&r!==null&&nu(r,r.return);break;case 5:if(to(t,e),Oo(e),n&512&&r!==null&&nu(r,r.return),e.flags&32){var s=e.stateNode;try{ld(s,"")}catch(m){Jr(e,e.return,m)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,i=r!==null?r.memoizedProps:o,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&cI(s,o),fv(a,i);var u=fv(a,o);for(i=0;i<l.length;i+=2){var h=l[i],c=l[i+1];h==="style"?mI(s,c):h==="dangerouslySetInnerHTML"?fI(s,c):h==="children"?ld(s,c):Jw(s,h,c,u)}switch(a){case"input":lv(s,o);break;case"textarea":dI(s,o);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?au(s,!!o.multiple,f,!1):d!==!!o.multiple&&(o.defaultValue!=null?au(s,!!o.multiple,o.defaultValue,!0):au(s,!!o.multiple,o.multiple?[]:"",!1))}s[_d]=o}catch(m){Jr(e,e.return,m)}}break;case 6:if(to(t,e),Oo(e),n&4){if(e.stateNode===null)throw Error(Xe(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(m){Jr(e,e.return,m)}}break;case 3:if(to(t,e),Oo(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{hd(t.containerInfo)}catch(m){Jr(e,e.return,m)}break;case 4:to(t,e),Oo(e);break;case 13:to(t,e),Oo(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||($0=tn())),n&4&&TS(e);break;case 22:if(h=r!==null&&r.memoizedState!==null,e.mode&1?(Bn=(u=Bn)||h,to(t,e),Bn=u):to(t,e),Oo(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!h&&e.mode&1)for(pt=e,h=e.child;h!==null;){for(c=pt=h;pt!==null;){switch(d=pt,f=d.child,d.tag){case 0:case 11:case 14:case 15:ed(4,d,d.return);break;case 1:nu(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){n=d,r=d.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){Jr(n,r,m)}}break;case 5:nu(d,d.return);break;case 22:if(d.memoizedState!==null){PS(c);continue}}f!==null?(f.return=d,pt=f):PS(c)}h=h.sibling}e:for(h=null,c=e;;){if(c.tag===5){if(h===null){h=c;try{s=c.stateNode,u?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=c.stateNode,l=c.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=pI("display",i))}catch(m){Jr(e,e.return,m)}}}else if(c.tag===6){if(h===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(m){Jr(e,e.return,m)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;h===c&&(h=null),c=c.return}h===c&&(h=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:to(t,e),Oo(e),n&4&&TS(e);break;case 21:break;default:to(t,e),Oo(e)}}function Oo(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(zO(r)){var n=r;break e}r=r.return}throw Error(Xe(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(ld(s,""),n.flags&=-33);var o=MS(e);Vv(e,o,s);break;case 3:case 4:var i=n.stateNode.containerInfo,a=MS(e);Uv(e,a,i);break;default:throw Error(Xe(161))}}catch(l){Jr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function j4(e,t,r){pt=e,VO(e)}function VO(e,t,r){for(var n=(e.mode&1)!==0;pt!==null;){var s=pt,o=s.child;if(s.tag===22&&n){var i=s.memoizedState!==null||af;if(!i){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Bn;a=af;var u=Bn;if(af=i,(Bn=l)&&!u)for(pt=s;pt!==null;)i=pt,l=i.child,i.tag===22&&i.memoizedState!==null?SS(s):l!==null?(l.return=i,pt=l):SS(s);for(;o!==null;)pt=o,VO(o),o=o.sibling;pt=s,af=a,Bn=u}ES(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,pt=o):ES(e)}}function ES(e){for(;pt!==null;){var t=pt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Bn||um(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Bn)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:uo(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&uS(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}uS(t,i,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var c=h.dehydrated;c!==null&&hd(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}Bn||t.flags&512&&Bv(t)}catch(d){Jr(t,t.return,d)}}if(t===e){pt=null;break}if(r=t.sibling,r!==null){r.return=t.return,pt=r;break}pt=t.return}}function PS(e){for(;pt!==null;){var t=pt;if(t===e){pt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,pt=r;break}pt=t.return}}function SS(e){for(;pt!==null;){var t=pt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{um(4,t)}catch(l){Jr(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(l){Jr(t,s,l)}}var o=t.return;try{Bv(t)}catch(l){Jr(t,o,l)}break;case 5:var i=t.return;try{Bv(t)}catch(l){Jr(t,i,l)}}}catch(l){Jr(t,t.return,l)}if(t===e){pt=null;break}var a=t.sibling;if(a!==null){a.return=t.return,pt=a;break}pt=t.return}}var z4=Math.ceil,kp=gi.ReactCurrentDispatcher,C0=gi.ReactCurrentOwner,Gs=gi.ReactCurrentBatchConfig,sr=0,En=null,dn=null,$n=0,gs=0,su=ia(0),yn=0,Md=null,ol=0,cm=0,k0=0,td=null,os=null,$0=0,Iu=1/0,ti=null,$p=!1,Wv=null,Ji=null,lf=!1,Wi=null,Ap=0,rd=0,Gv=null,Yf=-1,Zf=0;function Jn(){return sr&6?tn():Yf!==-1?Yf:Yf=tn()}function Yi(e){return e.mode&1?sr&2&&$n!==0?$n&-$n:M4.transition!==null?(Zf===0&&(Zf=SI()),Zf):(e=dr,e!==0||(e=window.event,e=e===void 0?16:DI(e.type)),e):1}function bo(e,t,r,n){if(50<rd)throw rd=0,Gv=null,Error(Xe(185));jd(e,r,n),(!(sr&2)||e!==En)&&(e===En&&(!(sr&2)&&(cm|=r),yn===4&&Ri(e,$n)),us(e,n),r===1&&sr===0&&!(t.mode&1)&&(Iu=tn()+500,im&&aa()))}function us(e,t){var r=e.callbackNode;MB(e,t);var n=pp(e,e===En?$n:0);if(n===0)r!==null&&RP(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&RP(r),t===1)e.tag===0?x4(CS.bind(null,e)):ZI(CS.bind(null,e)),y4(function(){!(sr&6)&&aa()}),r=null;else{switch(CI(n)){case 1:r=r0;break;case 4:r=EI;break;case 16:r=fp;break;case 536870912:r=PI;break;default:r=fp}r=JO(r,WO.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function WO(e,t){if(Yf=-1,Zf=0,sr&6)throw Error(Xe(327));var r=e.callbackNode;if(hu()&&e.callbackNode!==r)return null;var n=pp(e,e===En?$n:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=Ip(e,n);else{t=n;var s=sr;sr|=2;var o=HO();(En!==e||$n!==t)&&(ti=null,Iu=tn()+500,el(e,t));do try{V4();break}catch(a){GO(e,a)}while(!0);m0(),kp.current=o,sr=s,dn!==null?t=0:(En=null,$n=0,t=yn)}if(t!==0){if(t===2&&(s=yv(e),s!==0&&(n=s,t=Hv(e,s))),t===1)throw r=Md,el(e,0),Ri(e,n),us(e,tn()),r;if(t===6)Ri(e,n);else{if(s=e.current.alternate,!(n&30)&&!B4(s)&&(t=Ip(e,n),t===2&&(o=yv(e),o!==0&&(n=o,t=Hv(e,o))),t===1))throw r=Md,el(e,0),Ri(e,n),us(e,tn()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(Xe(345));case 2:Fa(e,os,ti);break;case 3:if(Ri(e,n),(n&130023424)===n&&(t=$0+500-tn(),10<t)){if(pp(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){Jn(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=Pv(Fa.bind(null,e,os,ti),t);break}Fa(e,os,ti);break;case 4:if(Ri(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var i=31-wo(n);o=1<<i,i=t[i],i>s&&(s=i),n&=~o}if(n=s,n=tn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*z4(n/1960))-n,10<n){e.timeoutHandle=Pv(Fa.bind(null,e,os,ti),n);break}Fa(e,os,ti);break;case 5:Fa(e,os,ti);break;default:throw Error(Xe(329))}}}return us(e,tn()),e.callbackNode===r?WO.bind(null,e):null}function Hv(e,t){var r=td;return e.current.memoizedState.isDehydrated&&(el(e,t).flags|=256),e=Ip(e,t),e!==2&&(t=os,os=r,t!==null&&Kv(t)),e}function Kv(e){os===null?os=e:os.push.apply(os,e)}function B4(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!Mo(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ri(e,t){for(t&=~k0,t&=~cm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-wo(t),n=1<<r;e[r]=-1,t&=~n}}function CS(e){if(sr&6)throw Error(Xe(327));hu();var t=pp(e,0);if(!(t&1))return us(e,tn()),null;var r=Ip(e,t);if(e.tag!==0&&r===2){var n=yv(e);n!==0&&(t=n,r=Hv(e,n))}if(r===1)throw r=Md,el(e,0),Ri(e,t),us(e,tn()),r;if(r===6)throw Error(Xe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Fa(e,os,ti),us(e,tn()),null}function A0(e,t){var r=sr;sr|=1;try{return e(t)}finally{sr=r,sr===0&&(Iu=tn()+500,im&&aa())}}function il(e){Wi!==null&&Wi.tag===0&&!(sr&6)&&hu();var t=sr;sr|=1;var r=Gs.transition,n=dr;try{if(Gs.transition=null,dr=1,e)return e()}finally{dr=n,Gs.transition=r,sr=t,!(sr&6)&&aa()}}function I0(){gs=su.current,kr(su)}function el(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,_4(r)),dn!==null)for(r=dn.return;r!==null;){var n=r;switch(h0(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&vp();break;case 3:$u(),kr(as),kr(Un),b0();break;case 5:w0(n);break;case 4:$u();break;case 13:kr(Ur);break;case 19:kr(Ur);break;case 10:g0(n.type._context);break;case 22:case 23:I0()}r=r.return}if(En=e,dn=e=Zi(e.current,null),$n=gs=t,yn=0,Md=null,k0=cm=ol=0,os=td=null,Wa!==null){for(t=0;t<Wa.length;t++)if(r=Wa[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var i=o.next;o.next=s,n.next=i}r.pending=n}Wa=null}return e}function GO(e,t){do{var r=dn;try{if(m0(),Qf.current=Cp,Sp){for(var n=Vr.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Sp=!1}if(sl=0,Tn=_n=Vr=null,Zc=!1,wd=0,C0.current=null,r===null||r.return===null){yn=1,Md=t,dn=null;break}e:{var o=e,i=r.return,a=r,l=t;if(t=$n,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,c=h.tag;if(!(h.mode&1)&&(c===0||c===11||c===15)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=mS(i);if(f!==null){f.flags&=-257,gS(f,i,a,o,t),f.mode&1&&pS(o,u,t),t=f,l=u;var p=t.updateQueue;if(p===null){var m=new Set;m.add(l),t.updateQueue=m}else p.add(l);break e}else{if(!(t&1)){pS(o,u,t),O0();break e}l=Error(Xe(426))}}else if(Or&&a.mode&1){var b=mS(i);if(b!==null){!(b.flags&65536)&&(b.flags|=256),gS(b,i,a,o,t),f0(Au(l,a));break e}}o=l=Au(l,a),yn!==4&&(yn=2),td===null?td=[o]:td.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=CO(o,l,t);lS(o,g);break e;case 1:a=l;var _=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof _.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ji===null||!Ji.has(y)))){o.flags|=65536,t&=-t,o.lanes|=t;var v=kO(o,a,t);lS(o,v);break e}}o=o.return}while(o!==null)}qO(r)}catch(M){t=M,dn===r&&r!==null&&(dn=r=r.return);continue}break}while(!0)}function HO(){var e=kp.current;return kp.current=Cp,e===null?Cp:e}function O0(){(yn===0||yn===3||yn===2)&&(yn=4),En===null||!(ol&268435455)&&!(cm&268435455)||Ri(En,$n)}function Ip(e,t){var r=sr;sr|=2;var n=HO();(En!==e||$n!==t)&&(ti=null,el(e,t));do try{U4();break}catch(s){GO(e,s)}while(!0);if(m0(),sr=r,kp.current=n,dn!==null)throw Error(Xe(261));return En=null,$n=0,yn}function U4(){for(;dn!==null;)KO(dn)}function V4(){for(;dn!==null&&!pB();)KO(dn)}function KO(e){var t=XO(e.alternate,e,gs);e.memoizedProps=e.pendingProps,t===null?qO(e):dn=t,C0.current=null}function qO(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=R4(r,t),r!==null){r.flags&=32767,dn=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{yn=6,dn=null;return}}else if(r=F4(r,t,gs),r!==null){dn=r;return}if(t=t.sibling,t!==null){dn=t;return}dn=t=e}while(t!==null);yn===0&&(yn=5)}function Fa(e,t,r){var n=dr,s=Gs.transition;try{Gs.transition=null,dr=1,W4(e,t,r,n)}finally{Gs.transition=s,dr=n}return null}function W4(e,t,r,n){do hu();while(Wi!==null);if(sr&6)throw Error(Xe(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Xe(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(TB(e,o),e===En&&(dn=En=null,$n=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||lf||(lf=!0,JO(fp,function(){return hu(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Gs.transition,Gs.transition=null;var i=dr;dr=1;var a=sr;sr|=4,C0.current=null,N4(e,r),UO(r,e),c4(Tv),mp=!!Mv,Tv=Mv=null,e.current=r,j4(r),mB(),sr=a,dr=i,Gs.transition=o}else e.current=r;if(lf&&(lf=!1,Wi=e,Ap=s),o=e.pendingLanes,o===0&&(Ji=null),yB(r.stateNode),us(e,tn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if($p)throw $p=!1,e=Wv,Wv=null,e;return Ap&1&&e.tag!==0&&hu(),o=e.pendingLanes,o&1?e===Gv?rd++:(rd=0,Gv=e):rd=0,aa(),null}function hu(){if(Wi!==null){var e=CI(Ap),t=Gs.transition,r=dr;try{if(Gs.transition=null,dr=16>e?16:e,Wi===null)var n=!1;else{if(e=Wi,Wi=null,Ap=0,sr&6)throw Error(Xe(331));var s=sr;for(sr|=4,pt=e.current;pt!==null;){var o=pt,i=o.child;if(pt.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(pt=u;pt!==null;){var h=pt;switch(h.tag){case 0:case 11:case 15:ed(8,h,o)}var c=h.child;if(c!==null)c.return=h,pt=c;else for(;pt!==null;){h=pt;var d=h.sibling,f=h.return;if(jO(h),h===u){pt=null;break}if(d!==null){d.return=f,pt=d;break}pt=f}}}var p=o.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var b=m.sibling;m.sibling=null,m=b}while(m!==null)}}pt=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,pt=i;else e:for(;pt!==null;){if(o=pt,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ed(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,pt=g;break e}pt=o.return}}var _=e.current;for(pt=_;pt!==null;){i=pt;var y=i.child;if(i.subtreeFlags&2064&&y!==null)y.return=i,pt=y;else e:for(i=_;pt!==null;){if(a=pt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:um(9,a)}}catch(M){Jr(a,a.return,M)}if(a===i){pt=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,pt=v;break e}pt=a.return}}if(sr=s,aa(),Bo&&typeof Bo.onPostCommitFiberRoot=="function")try{Bo.onPostCommitFiberRoot(tm,e)}catch{}n=!0}return n}finally{dr=r,Gs.transition=t}}return!1}function kS(e,t,r){t=Au(r,t),t=CO(e,t,1),e=Xi(e,t,1),t=Jn(),e!==null&&(jd(e,1,t),us(e,t))}function Jr(e,t,r){if(e.tag===3)kS(e,e,r);else for(;t!==null;){if(t.tag===3){kS(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ji===null||!Ji.has(n))){e=Au(r,e),e=kO(t,e,1),t=Xi(t,e,1),e=Jn(),t!==null&&(jd(t,1,e),us(t,e));break}}t=t.return}}function G4(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Jn(),e.pingedLanes|=e.suspendedLanes&r,En===e&&($n&r)===r&&(yn===4||yn===3&&($n&130023424)===$n&&500>tn()-$0?el(e,0):k0|=r),us(e,t)}function QO(e,t){t===0&&(e.mode&1?(t=Jh,Jh<<=1,!(Jh&130023424)&&(Jh=4194304)):t=1);var r=Jn();e=di(e,t),e!==null&&(jd(e,t,r),us(e,r))}function H4(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),QO(e,r)}function K4(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Xe(314))}n!==null&&n.delete(t),QO(e,r)}var XO;XO=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||as.current)is=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return is=!1,D4(e,t,r);is=!!(e.flags&131072)}else is=!1,Or&&t.flags&1048576&&eO(t,xp,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Jf(e,t),e=t.pendingProps;var s=Su(t,Un.current);du(t,r),s=M0(null,t,n,e,s,r);var o=T0();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ls(n)?(o=!0,wp(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,y0(t),s.updater=lm,t.stateNode=s,s._reactInternals=t,Ov(t,n,e,r),t=Rv(null,t,n,!0,o,r)):(t.tag=0,Or&&o&&d0(t),qn(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Jf(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=Q4(n),e=uo(n,e),s){case 0:t=Fv(null,t,n,e,r);break e;case 1:t=vS(null,t,n,e,r);break e;case 11:t=_S(null,t,n,e,r);break e;case 14:t=yS(null,t,n,uo(n.type,e),r);break e}throw Error(Xe(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:uo(n,s),Fv(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:uo(n,s),vS(e,t,n,s,r);case 3:e:{if(OO(t),e===null)throw Error(Xe(387));n=t.pendingProps,o=t.memoizedState,s=o.element,iO(e,t),Ep(t,n,null,r);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=Au(Error(Xe(423)),t),t=wS(e,t,n,r,s);break e}else if(n!==s){s=Au(Error(Xe(424)),t),t=wS(e,t,n,r,s);break e}else for(bs=Qi(t.stateNode.containerInfo.firstChild),xs=t,Or=!0,_o=null,r=sO(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Cu(),n===s){t=hi(e,t,r);break e}qn(e,t,n,r)}t=t.child}return t;case 5:return aO(t),e===null&&$v(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,i=s.children,Ev(n,s)?i=null:o!==null&&Ev(n,o)&&(t.flags|=32),IO(e,t),qn(e,t,i,r),t.child;case 6:return e===null&&$v(t),null;case 13:return DO(e,t,r);case 4:return v0(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=ku(t,null,n,r):qn(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:uo(n,s),_S(e,t,n,s,r);case 7:return qn(e,t,t.pendingProps,r),t.child;case 8:return qn(e,t,t.pendingProps.children,r),t.child;case 12:return qn(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,i=s.value,Tr(Mp,n._currentValue),n._currentValue=i,o!==null)if(Mo(o.value,i)){if(o.children===s.children&&!as.current){t=hi(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var a=o.dependencies;if(a!==null){i=o.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(o.tag===1){l=li(-1,r&-r),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}o.lanes|=r,l=o.alternate,l!==null&&(l.lanes|=r),Av(o.return,r,t),a.lanes|=r;break}l=l.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(Xe(341));i.lanes|=r,a=i.alternate,a!==null&&(a.lanes|=r),Av(i,r,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}qn(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,du(t,r),s=Ks(s),n=n(s),t.flags|=1,qn(e,t,n,r),t.child;case 14:return n=t.type,s=uo(n,t.pendingProps),s=uo(n.type,s),yS(e,t,n,s,r);case 15:return $O(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:uo(n,s),Jf(e,t),t.tag=1,ls(n)?(e=!0,wp(t)):e=!1,du(t,r),SO(t,n,s),Ov(t,n,s,r),Rv(null,t,n,!0,e,r);case 19:return FO(e,t,r);case 22:return AO(e,t,r)}throw Error(Xe(156,t.tag))};function JO(e,t){return TI(e,t)}function q4(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ws(e,t,r,n){return new q4(e,t,r,n)}function D0(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Q4(e){if(typeof e=="function")return D0(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Zw)return 11;if(e===e0)return 14}return 2}function Zi(e,t){var r=e.alternate;return r===null?(r=Ws(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function ep(e,t,r,n,s,o){var i=2;if(n=e,typeof e=="function")D0(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case ql:return tl(r.children,s,o,t);case Yw:i=8,s|=8;break;case nv:return e=Ws(12,r,t,s|2),e.elementType=nv,e.lanes=o,e;case sv:return e=Ws(13,r,t,s),e.elementType=sv,e.lanes=o,e;case ov:return e=Ws(19,r,t,s),e.elementType=ov,e.lanes=o,e;case aI:return dm(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case oI:i=10;break e;case iI:i=9;break e;case Zw:i=11;break e;case e0:i=14;break e;case Oi:i=16,n=null;break e}throw Error(Xe(130,e==null?e:typeof e,""))}return t=Ws(i,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function tl(e,t,r,n){return e=Ws(7,e,n,t),e.lanes=r,e}function dm(e,t,r,n){return e=Ws(22,e,n,t),e.elementType=aI,e.lanes=r,e.stateNode={isHidden:!1},e}function $_(e,t,r){return e=Ws(6,e,null,t),e.lanes=r,e}function A_(e,t,r){return t=Ws(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function X4(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=d_(0),this.expirationTimes=d_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=d_(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function F0(e,t,r,n,s,o,i,a,l){return e=new X4(e,t,r,a,l),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Ws(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},y0(o),e}function J4(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Kl,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function YO(e){if(!e)return ta;e=e._reactInternals;e:{if(fl(e)!==e||e.tag!==1)throw Error(Xe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ls(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Xe(171))}if(e.tag===1){var r=e.type;if(ls(r))return YI(e,r,t)}return t}function ZO(e,t,r,n,s,o,i,a,l){return e=F0(r,n,!0,e,s,o,i,a,l),e.context=YO(null),r=e.current,n=Jn(),s=Yi(r),o=li(n,s),o.callback=t??null,Xi(r,o,s),e.current.lanes=s,jd(e,s,n),us(e,n),e}function hm(e,t,r,n){var s=t.current,o=Jn(),i=Yi(s);return r=YO(r),t.context===null?t.context=r:t.pendingContext=r,t=li(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Xi(s,t,i),e!==null&&(bo(e,s,i,o),qf(e,s,i)),i}function Op(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $S(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function R0(e,t){$S(e,t),(e=e.alternate)&&$S(e,t)}function Y4(){return null}var eD=typeof reportError=="function"?reportError:function(e){console.error(e)};function L0(e){this._internalRoot=e}fm.prototype.render=L0.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Xe(409));hm(e,t,null,null)};fm.prototype.unmount=L0.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;il(function(){hm(null,e,null,null)}),t[ci]=null}};function fm(e){this._internalRoot=e}fm.prototype.unstable_scheduleHydration=function(e){if(e){var t=AI();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Fi.length&&t!==0&&t<Fi[r].priority;r++);Fi.splice(r,0,e),r===0&&OI(e)}};function N0(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function pm(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function AS(){}function Z4(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var u=Op(i);o.call(u)}}var i=ZO(t,n,e,0,null,!1,!1,"",AS);return e._reactRootContainer=i,e[ci]=i.current,md(e.nodeType===8?e.parentNode:e),il(),i}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var a=n;n=function(){var u=Op(l);a.call(u)}}var l=F0(e,0,!1,null,null,!1,!1,"",AS);return e._reactRootContainer=l,e[ci]=l.current,md(e.nodeType===8?e.parentNode:e),il(function(){hm(t,l,r,n)}),l}function mm(e,t,r,n,s){var o=r._reactRootContainer;if(o){var i=o;if(typeof s=="function"){var a=s;s=function(){var l=Op(i);a.call(l)}}hm(t,i,e,s)}else i=Z4(r,t,e,s,n);return Op(i)}kI=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Bc(t.pendingLanes);r!==0&&(n0(t,r|1),us(t,tn()),!(sr&6)&&(Iu=tn()+500,aa()))}break;case 13:il(function(){var n=di(e,1);if(n!==null){var s=Jn();bo(n,e,1,s)}}),R0(e,1)}};s0=function(e){if(e.tag===13){var t=di(e,134217728);if(t!==null){var r=Jn();bo(t,e,134217728,r)}R0(e,134217728)}};$I=function(e){if(e.tag===13){var t=Yi(e),r=di(e,t);if(r!==null){var n=Jn();bo(r,e,t,n)}R0(e,t)}};AI=function(){return dr};II=function(e,t){var r=dr;try{return dr=e,t()}finally{dr=r}};mv=function(e,t,r){switch(t){case"input":if(lv(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=om(n);if(!s)throw Error(Xe(90));uI(n),lv(n,s)}}}break;case"textarea":dI(e,r);break;case"select":t=r.value,t!=null&&au(e,!!r.multiple,t,!1)}};yI=A0;vI=il;var eU={usingClientEntryPoint:!1,Events:[Bd,Yl,om,gI,_I,A0]},Pc={findFiberByHostInstance:Va,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tU={bundleType:Pc.bundleType,version:Pc.version,rendererPackageName:Pc.rendererPackageName,rendererConfig:Pc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gi.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=xI(e),e===null?null:e.stateNode},findFiberByHostInstance:Pc.findFiberByHostInstance||Y4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uf.isDisabled&&uf.supportsFiber)try{tm=uf.inject(tU),Bo=uf}catch{}}Ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eU;Ps.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!N0(t))throw Error(Xe(200));return J4(e,t,null,r)};Ps.createRoot=function(e,t){if(!N0(e))throw Error(Xe(299));var r=!1,n="",s=eD;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=F0(e,1,!1,null,null,r,!1,n,s),e[ci]=t.current,md(e.nodeType===8?e.parentNode:e),new L0(t)};Ps.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Xe(188)):(e=Object.keys(e).join(","),Error(Xe(268,e)));return e=xI(t),e=e===null?null:e.stateNode,e};Ps.flushSync=function(e){return il(e)};Ps.hydrate=function(e,t,r){if(!pm(t))throw Error(Xe(200));return mm(null,e,t,!0,r)};Ps.hydrateRoot=function(e,t,r){if(!N0(e))throw Error(Xe(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",i=eD;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),t=ZO(t,null,e,1,r??null,s,!1,o,i),e[ci]=t.current,md(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new fm(t)};Ps.render=function(e,t,r){if(!pm(t))throw Error(Xe(200));return mm(null,e,t,!1,r)};Ps.unmountComponentAtNode=function(e){if(!pm(e))throw Error(Xe(40));return e._reactRootContainer?(il(function(){mm(null,null,e,!1,function(){e._reactRootContainer=null,e[ci]=null})}),!0):!1};Ps.unstable_batchedUpdates=A0;Ps.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!pm(r))throw Error(Xe(200));if(e==null||e._reactInternals===void 0)throw Error(Xe(38));return mm(e,t,r,!1,n)};Ps.version="18.3.1-next-f1338f8080-20240426";function tD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tD)}catch(e){console.error(e)}}tD(),tI.exports=Ps;var Vd=tI.exports;const rD=VA(Vd);var nD,IS=Vd;nD=IS.createRoot,IS.hydrateRoot;const rU=1,nU=1e6;let I_=0;function sU(){return I_=(I_+1)%Number.MAX_SAFE_INTEGER,I_.toString()}const O_=new Map,OS=e=>{if(O_.has(e))return;const t=setTimeout(()=>{O_.delete(e),nd({type:"REMOVE_TOAST",toastId:e})},nU);O_.set(e,t)},oU=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,rU)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?OS(r):e.toasts.forEach(n=>{OS(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},tp=[];let rp={toasts:[]};function nd(e){rp=oU(rp,e),tp.forEach(t=>{t(rp)})}function iU({...e}){const t=sU(),r=s=>nd({type:"UPDATE_TOAST",toast:{...s,id:t}}),n=()=>nd({type:"DISMISS_TOAST",toastId:t});return nd({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:s=>{s||n()}}}),{id:t,dismiss:n,update:r}}function Wd(){const[e,t]=Q.useState(rp);return Q.useEffect(()=>(tp.push(t),()=>{const r=tp.indexOf(t);r>-1&&tp.splice(r,1)}),[e]),{...e,toast:iU,dismiss:r=>nd({type:"DISMISS_TOAST",toastId:r})}}function Dr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e==null||e(s),r===!1||!s.defaultPrevented)return t==null?void 0:t(s)}}function DS(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function sD(...e){return t=>{let r=!1;const n=e.map(s=>{const o=DS(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():DS(e[s],null)}}}}function Yn(...e){return Q.useCallback(sD(...e),e)}function aU(e,t){const r=Q.createContext(t),n=o=>{const{children:i,...a}=o,l=Q.useMemo(()=>a,Object.values(a));return J.jsx(r.Provider,{value:l,children:i})};n.displayName=e+"Provider";function s(o){const i=Q.useContext(r);if(i)return i;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function Gd(e,t=[]){let r=[];function n(o,i){const a=Q.createContext(i),l=r.length;r=[...r,i];const u=c=>{var g;const{scope:d,children:f,...p}=c,m=((g=d==null?void 0:d[e])==null?void 0:g[l])||a,b=Q.useMemo(()=>p,Object.values(p));return J.jsx(m.Provider,{value:b,children:f})};u.displayName=o+"Provider";function h(c,d){var m;const f=((m=d==null?void 0:d[e])==null?void 0:m[l])||a,p=Q.useContext(f);if(p)return p;if(i!==void 0)return i;throw new Error(`\`${c}\` must be used within \`${o}\``)}return[u,h]}const s=()=>{const o=r.map(i=>Q.createContext(i));return function(a){const l=(a==null?void 0:a[e])||o;return Q.useMemo(()=>({[`__scope${e}`]:{...a,[e]:l}}),[a,l])}};return s.scopeName=e,[n,lU(s,...t)]}function lU(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((a,{useScope:l,scopeName:u})=>{const c=l(o)[`__scope${u}`];return{...a,...c}},{});return Q.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}function Td(e){const t=cU(e),r=Q.forwardRef((n,s)=>{const{children:o,...i}=n,a=Q.Children.toArray(o),l=a.find(hU);if(l){const u=l.props.children,h=a.map(c=>c===l?Q.Children.count(u)>1?Q.Children.only(null):Q.isValidElement(u)?u.props.children:null:c);return J.jsx(t,{...i,ref:s,children:Q.isValidElement(u)?Q.cloneElement(u,void 0,h):null})}return J.jsx(t,{...i,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var uU=Td("Slot");function cU(e){const t=Q.forwardRef((r,n)=>{const{children:s,...o}=r;if(Q.isValidElement(s)){const i=pU(s),a=fU(o,s.props);return s.type!==Q.Fragment&&(a.ref=n?sD(n,i):i),Q.cloneElement(s,a)}return Q.Children.count(s)>1?Q.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var oD=Symbol("radix.slottable");function dU(e){const t=({children:r})=>J.jsx(J.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=oD,t}function hU(e){return Q.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===oD}function fU(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...a)=>{const l=o(...a);return s(...a),l}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function pU(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function mU(e){const t=e+"CollectionProvider",[r,n]=Gd(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),i=m=>{const{scope:b,children:g}=m,_=rt.useRef(null),y=rt.useRef(new Map).current;return J.jsx(s,{scope:b,itemMap:y,collectionRef:_,children:g})};i.displayName=t;const a=e+"CollectionSlot",l=Td(a),u=rt.forwardRef((m,b)=>{const{scope:g,children:_}=m,y=o(a,g),v=Yn(b,y.collectionRef);return J.jsx(l,{ref:v,children:_})});u.displayName=a;const h=e+"CollectionItemSlot",c="data-radix-collection-item",d=Td(h),f=rt.forwardRef((m,b)=>{const{scope:g,children:_,...y}=m,v=rt.useRef(null),M=Yn(b,v),E=o(h,g);return rt.useEffect(()=>(E.itemMap.set(v,{ref:v,...y}),()=>void E.itemMap.delete(v))),J.jsx(d,{[c]:"",ref:M,children:_})});f.displayName=h;function p(m){const b=o(e+"CollectionConsumer",m);return rt.useCallback(()=>{const _=b.collectionRef.current;if(!_)return[];const y=Array.from(_.querySelectorAll(`[${c}]`));return Array.from(b.itemMap.values()).sort((E,T)=>y.indexOf(E.ref.current)-y.indexOf(T.ref.current))},[b.collectionRef,b.itemMap])}return[{Provider:i,Slot:u,ItemSlot:f},p,n]}var gU=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hn=gU.reduce((e,t)=>{const r=Td(`Primitive.${t}`),n=Q.forwardRef((s,o)=>{const{asChild:i,...a}=s,l=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),J.jsx(l,{...a,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function iD(e,t){e&&Vd.flushSync(()=>e.dispatchEvent(t))}function Wo(e){const t=Q.useRef(e);return Q.useEffect(()=>{t.current=e}),Q.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function _U(e,t=globalThis==null?void 0:globalThis.document){const r=Wo(e);Q.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var yU="DismissableLayer",qv="dismissableLayer.update",vU="dismissableLayer.pointerDownOutside",wU="dismissableLayer.focusOutside",FS,aD=Q.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gm=Q.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:a,...l}=e,u=Q.useContext(aD),[h,c]=Q.useState(null),d=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=Q.useState({}),p=Yn(t,T=>c(T)),m=Array.from(u.layers),[b]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),g=m.indexOf(b),_=h?m.indexOf(h):-1,y=u.layersWithOutsidePointerEventsDisabled.size>0,v=_>=g,M=xU(T=>{const S=T.target,A=[...u.branches].some(I=>I.contains(S));!v||A||(s==null||s(T),i==null||i(T),T.defaultPrevented||a==null||a())},d),E=MU(T=>{const S=T.target;[...u.branches].some(I=>I.contains(S))||(o==null||o(T),i==null||i(T),T.defaultPrevented||a==null||a())},d);return _U(T=>{_===u.layers.size-1&&(n==null||n(T),!T.defaultPrevented&&a&&(T.preventDefault(),a()))},d),Q.useEffect(()=>{if(h)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(FS=d.body.style.pointerEvents,d.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),RS(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(d.body.style.pointerEvents=FS)}},[h,d,r,u]),Q.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),RS())},[h,u]),Q.useEffect(()=>{const T=()=>f({});return document.addEventListener(qv,T),()=>document.removeEventListener(qv,T)},[]),J.jsx(hn.div,{...l,ref:p,style:{pointerEvents:y?v?"auto":"none":void 0,...e.style},onFocusCapture:Dr(e.onFocusCapture,E.onFocusCapture),onBlurCapture:Dr(e.onBlurCapture,E.onBlurCapture),onPointerDownCapture:Dr(e.onPointerDownCapture,M.onPointerDownCapture)})});gm.displayName=yU;var bU="DismissableLayerBranch",lD=Q.forwardRef((e,t)=>{const r=Q.useContext(aD),n=Q.useRef(null),s=Yn(t,n);return Q.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),J.jsx(hn.div,{...e,ref:s})});lD.displayName=bU;function xU(e,t=globalThis==null?void 0:globalThis.document){const r=Wo(e),n=Q.useRef(!1),s=Q.useRef(()=>{});return Q.useEffect(()=>{const o=a=>{if(a.target&&!n.current){let l=function(){uD(vU,r,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=l,t.addEventListener("click",s.current,{once:!0})):l()}else t.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function MU(e,t=globalThis==null?void 0:globalThis.document){const r=Wo(e),n=Q.useRef(!1);return Q.useEffect(()=>{const s=o=>{o.target&&!n.current&&uD(wU,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function RS(){const e=new CustomEvent(qv);document.dispatchEvent(e)}function uD(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?iD(s,o):s.dispatchEvent(o)}var TU=gm,EU=lD,fi=globalThis!=null&&globalThis.document?Q.useLayoutEffect:()=>{},PU="Portal",j0=Q.forwardRef((e,t)=>{var a;const{container:r,...n}=e,[s,o]=Q.useState(!1);fi(()=>o(!0),[]);const i=r||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?rD.createPortal(J.jsx(hn.div,{...n,ref:t}),i):null});j0.displayName=PU;function SU(e,t){return Q.useReducer((r,n)=>t[r][n]??r,e)}var Bu=e=>{const{present:t,children:r}=e,n=CU(t),s=typeof r=="function"?r({present:n.isPresent}):Q.Children.only(r),o=Yn(n.ref,kU(s));return typeof r=="function"||n.isPresent?Q.cloneElement(s,{ref:o}):null};Bu.displayName="Presence";function CU(e){const[t,r]=Q.useState(),n=Q.useRef(null),s=Q.useRef(e),o=Q.useRef("none"),i=e?"mounted":"unmounted",[a,l]=SU(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Q.useEffect(()=>{const u=cf(n.current);o.current=a==="mounted"?u:"none"},[a]),fi(()=>{const u=n.current,h=s.current;if(h!==e){const d=o.current,f=cf(u);e?l("MOUNT"):f==="none"||(u==null?void 0:u.display)==="none"?l("UNMOUNT"):l(h&&d!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,l]),fi(()=>{if(t){let u;const h=t.ownerDocument.defaultView??window,c=f=>{const m=cf(n.current).includes(f.animationName);if(f.target===t&&m&&(l("ANIMATION_END"),!s.current)){const b=t.style.animationFillMode;t.style.animationFillMode="forwards",u=h.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=b)})}},d=f=>{f.target===t&&(o.current=cf(n.current))};return t.addEventListener("animationstart",d),t.addEventListener("animationcancel",c),t.addEventListener("animationend",c),()=>{h.clearTimeout(u),t.removeEventListener("animationstart",d),t.removeEventListener("animationcancel",c),t.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:Q.useCallback(u=>{n.current=u?getComputedStyle(u):null,r(u)},[])}}function cf(e){return(e==null?void 0:e.animationName)||"none"}function kU(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var $U=qw[" useInsertionEffect ".trim().toString()]||fi;function cD({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,i]=AU({defaultProp:t,onChange:r}),a=e!==void 0,l=a?e:s;{const h=Q.useRef(e!==void 0);Q.useEffect(()=>{const c=h.current;c!==a&&console.warn(`${n} is changing from ${c?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=a},[a,n])}const u=Q.useCallback(h=>{var c;if(a){const d=IU(h)?h(e):h;d!==e&&((c=i.current)==null||c.call(i,d))}else o(h)},[a,e,o,i]);return[l,u]}function AU({defaultProp:e,onChange:t}){const[r,n]=Q.useState(e),s=Q.useRef(r),o=Q.useRef(t);return $U(()=>{o.current=t},[t]),Q.useEffect(()=>{var i;s.current!==r&&((i=o.current)==null||i.call(o,r),s.current=r)},[r,s]),[r,n,o]}function IU(e){return typeof e=="function"}var OU=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),DU="VisuallyHidden",_m=Q.forwardRef((e,t)=>J.jsx(hn.span,{...e,ref:t,style:{...OU,...e.style}}));_m.displayName=DU;var FU=_m,z0="ToastProvider",[B0,RU,LU]=mU("Toast"),[dD,C7]=Gd("Toast",[LU]),[NU,ym]=dD(z0),hD=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=e,[a,l]=Q.useState(null),[u,h]=Q.useState(0),c=Q.useRef(!1),d=Q.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${z0}\`. Expected non-empty \`string\`.`),J.jsx(B0.Provider,{scope:t,children:J.jsx(NU,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:u,viewport:a,onViewportChange:l,onToastAdd:Q.useCallback(()=>h(f=>f+1),[]),onToastRemove:Q.useCallback(()=>h(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:c,isClosePausedRef:d,children:i})})};hD.displayName=z0;var fD="ToastViewport",jU=["F8"],Qv="toast.viewportPause",Xv="toast.viewportResume",pD=Q.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=jU,label:s="Notifications ({hotkey})",...o}=e,i=ym(fD,r),a=RU(r),l=Q.useRef(null),u=Q.useRef(null),h=Q.useRef(null),c=Q.useRef(null),d=Yn(t,c,i.onViewportChange),f=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=i.toastCount>0;Q.useEffect(()=>{const b=g=>{var y;n.length!==0&&n.every(v=>g[v]||g.code===v)&&((y=c.current)==null||y.focus())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[n]),Q.useEffect(()=>{const b=l.current,g=c.current;if(p&&b&&g){const _=()=>{if(!i.isClosePausedRef.current){const E=new CustomEvent(Qv);g.dispatchEvent(E),i.isClosePausedRef.current=!0}},y=()=>{if(i.isClosePausedRef.current){const E=new CustomEvent(Xv);g.dispatchEvent(E),i.isClosePausedRef.current=!1}},v=E=>{!b.contains(E.relatedTarget)&&y()},M=()=>{b.contains(document.activeElement)||y()};return b.addEventListener("focusin",_),b.addEventListener("focusout",v),b.addEventListener("pointermove",_),b.addEventListener("pointerleave",M),window.addEventListener("blur",_),window.addEventListener("focus",y),()=>{b.removeEventListener("focusin",_),b.removeEventListener("focusout",v),b.removeEventListener("pointermove",_),b.removeEventListener("pointerleave",M),window.removeEventListener("blur",_),window.removeEventListener("focus",y)}}},[p,i.isClosePausedRef]);const m=Q.useCallback(({tabbingDirection:b})=>{const _=a().map(y=>{const v=y.ref.current,M=[v,...YU(v)];return b==="forwards"?M:M.reverse()});return(b==="forwards"?_.reverse():_).flat()},[a]);return Q.useEffect(()=>{const b=c.current;if(b){const g=_=>{var M,E,T;const y=_.altKey||_.ctrlKey||_.metaKey;if(_.key==="Tab"&&!y){const S=document.activeElement,A=_.shiftKey;if(_.target===b&&A){(M=u.current)==null||M.focus();return}const N=m({tabbingDirection:A?"backwards":"forwards"}),z=N.findIndex(q=>q===S);D_(N.slice(z+1))?_.preventDefault():A?(E=u.current)==null||E.focus():(T=h.current)==null||T.focus()}};return b.addEventListener("keydown",g),()=>b.removeEventListener("keydown",g)}},[a,m]),J.jsxs(EU,{ref:l,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&J.jsx(Jv,{ref:u,onFocusFromOutsideViewport:()=>{const b=m({tabbingDirection:"forwards"});D_(b)}}),J.jsx(B0.Slot,{scope:r,children:J.jsx(hn.ol,{tabIndex:-1,...o,ref:d})}),p&&J.jsx(Jv,{ref:h,onFocusFromOutsideViewport:()=>{const b=m({tabbingDirection:"backwards"});D_(b)}})]})});pD.displayName=fD;var mD="ToastFocusProxy",Jv=Q.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=ym(mD,r);return J.jsx(_m,{"aria-hidden":!0,tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:i=>{var u;const a=i.relatedTarget;!((u=o.viewport)!=null&&u.contains(a))&&n()}})});Jv.displayName=mD;var Hd="Toast",zU="toast.swipeStart",BU="toast.swipeMove",UU="toast.swipeCancel",VU="toast.swipeEnd",gD=Q.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...i}=e,[a,l]=cD({prop:n,defaultProp:s??!0,onChange:o,caller:Hd});return J.jsx(Bu,{present:r||a,children:J.jsx(HU,{open:a,...i,ref:t,onClose:()=>l(!1),onPause:Wo(e.onPause),onResume:Wo(e.onResume),onSwipeStart:Dr(e.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Dr(e.onSwipeMove,u=>{const{x:h,y:c}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${c}px`)}),onSwipeCancel:Dr(e.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Dr(e.onSwipeEnd,u=>{const{x:h,y:c}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${c}px`),l(!1)})})})});gD.displayName=Hd;var[WU,GU]=dD(Hd,{onClose(){}}),HU=Q.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:a,onPause:l,onResume:u,onSwipeStart:h,onSwipeMove:c,onSwipeCancel:d,onSwipeEnd:f,...p}=e,m=ym(Hd,r),[b,g]=Q.useState(null),_=Yn(t,q=>g(q)),y=Q.useRef(null),v=Q.useRef(null),M=s||m.duration,E=Q.useRef(0),T=Q.useRef(M),S=Q.useRef(0),{onToastAdd:A,onToastRemove:I}=m,V=Wo(()=>{var G;(b==null?void 0:b.contains(document.activeElement))&&((G=m.viewport)==null||G.focus()),i()}),N=Q.useCallback(q=>{!q||q===1/0||(window.clearTimeout(S.current),E.current=new Date().getTime(),S.current=window.setTimeout(V,q))},[V]);Q.useEffect(()=>{const q=m.viewport;if(q){const G=()=>{N(T.current),u==null||u()},ee=()=>{const Y=new Date().getTime()-E.current;T.current=T.current-Y,window.clearTimeout(S.current),l==null||l()};return q.addEventListener(Qv,ee),q.addEventListener(Xv,G),()=>{q.removeEventListener(Qv,ee),q.removeEventListener(Xv,G)}}},[m.viewport,M,l,u,N]),Q.useEffect(()=>{o&&!m.isClosePausedRef.current&&N(M)},[o,M,m.isClosePausedRef,N]),Q.useEffect(()=>(A(),()=>I()),[A,I]);const z=Q.useMemo(()=>b?MD(b):null,[b]);return m.viewport?J.jsxs(J.Fragment,{children:[z&&J.jsx(KU,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:z}),J.jsx(WU,{scope:r,onClose:V,children:Vd.createPortal(J.jsx(B0.ItemSlot,{scope:r,children:J.jsx(TU,{asChild:!0,onEscapeKeyDown:Dr(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||V(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:J.jsx(hn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection,...p,ref:_,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Dr(e.onKeyDown,q=>{q.key==="Escape"&&(a==null||a(q.nativeEvent),q.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,V()))}),onPointerDown:Dr(e.onPointerDown,q=>{q.button===0&&(y.current={x:q.clientX,y:q.clientY})}),onPointerMove:Dr(e.onPointerMove,q=>{if(!y.current)return;const G=q.clientX-y.current.x,ee=q.clientY-y.current.y,Y=!!v.current,W=["left","right"].includes(m.swipeDirection),te=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,le=W?te(0,G):0,oe=W?0:te(0,ee),U=q.pointerType==="touch"?10:2,R={x:le,y:oe},X={originalEvent:q,delta:R};Y?(v.current=R,df(BU,c,X,{discrete:!1})):LS(R,m.swipeDirection,U)?(v.current=R,df(zU,h,X,{discrete:!1}),q.target.setPointerCapture(q.pointerId)):(Math.abs(G)>U||Math.abs(ee)>U)&&(y.current=null)}),onPointerUp:Dr(e.onPointerUp,q=>{const G=v.current,ee=q.target;if(ee.hasPointerCapture(q.pointerId)&&ee.releasePointerCapture(q.pointerId),v.current=null,y.current=null,G){const Y=q.currentTarget,W={originalEvent:q,delta:G};LS(G,m.swipeDirection,m.swipeThreshold)?df(VU,f,W,{discrete:!0}):df(UU,d,W,{discrete:!0}),Y.addEventListener("click",te=>te.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),KU=e=>{const{__scopeToast:t,children:r,...n}=e,s=ym(Hd,t),[o,i]=Q.useState(!1),[a,l]=Q.useState(!1);return XU(()=>i(!0)),Q.useEffect(()=>{const u=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(u)},[]),a?null:J.jsx(j0,{asChild:!0,children:J.jsx(_m,{...n,children:o&&J.jsxs(J.Fragment,{children:[s.label," ",r]})})})},qU="ToastTitle",_D=Q.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return J.jsx(hn.div,{...n,ref:t})});_D.displayName=qU;var QU="ToastDescription",yD=Q.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return J.jsx(hn.div,{...n,ref:t})});yD.displayName=QU;var vD="ToastAction",wD=Q.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?J.jsx(xD,{altText:r,asChild:!0,children:J.jsx(U0,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${vD}\`. Expected non-empty \`string\`.`),null)});wD.displayName=vD;var bD="ToastClose",U0=Q.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=GU(bD,r);return J.jsx(xD,{asChild:!0,children:J.jsx(hn.button,{type:"button",...n,ref:t,onClick:Dr(e.onClick,s.onClose)})})});U0.displayName=bD;var xD=Q.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return J.jsx(hn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function MD(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),JU(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=n.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...MD(n))}}),t}function df(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?iD(s,o):s.dispatchEvent(o)}var LS=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function XU(e=()=>{}){const t=Wo(e);fi(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function JU(e){return e.nodeType===e.ELEMENT_NODE}function YU(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function D_(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var ZU=hD,TD=pD,ED=gD,PD=_D,SD=yD,CD=wD,kD=U0;function $D(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=$D(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function AD(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=$D(e))&&(n&&(n+=" "),n+=t);return n}const NS=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,jS=AD,V0=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return jS(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:s,defaultVariants:o}=t,i=Object.keys(s).map(u=>{const h=r==null?void 0:r[u],c=o==null?void 0:o[u];if(h===null)return null;const d=NS(h)||NS(c);return s[u][d]}),a=r&&Object.entries(r).reduce((u,h)=>{let[c,d]=h;return d===void 0||(u[c]=d),u},{}),l=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((u,h)=>{let{class:c,className:d,...f}=h;return Object.entries(f).every(p=>{let[m,b]=p;return Array.isArray(b)?b.includes({...o,...a}[m]):{...o,...a}[m]===b})?[...u,c,d]:u},[]);return jS(e,i,l,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eV=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ID=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var tV={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rV=Q.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:i,...a},l)=>Q.createElement("svg",{ref:l,...tV,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:ID("lucide",s),...a},[...i.map(([u,h])=>Q.createElement(u,h)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=(e,t)=>{const r=Q.forwardRef(({className:n,...s},o)=>Q.createElement(rV,{ref:o,iconNode:t,className:ID(`lucide-${eV(e)}`,n),...s}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yv=vr("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nV=vr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sV=vr("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oV=vr("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iV=vr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aV=vr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lV=vr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uV=vr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OD=vr("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cV=vr("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dV=vr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hV=vr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fV=vr("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"4oyue0"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pV=vr("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mV=vr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gV=vr("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _V=vr("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yV=vr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vV=vr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wV=vr("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bV=vr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xV=vr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DD=vr("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MV=vr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TV=vr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FD=vr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EV=vr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),W0="-",PV=e=>{const t=CV(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:i=>{const a=i.split(W0);return a[0]===""&&a.length!==1&&a.shift(),RD(a,t)||SV(i)},getConflictingClassGroupIds:(i,a)=>{const l=r[i]||[];return a&&n[i]?[...l,...n[i]]:l}}},RD=(e,t)=>{var i;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),s=n?RD(e.slice(1),n):void 0;if(s)return s;if(t.validators.length===0)return;const o=e.join(W0);return(i=t.validators.find(({validator:a})=>a(o)))==null?void 0:i.classGroupId},zS=/^\[(.+)\]$/,SV=e=>{if(zS.test(e)){const t=zS.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},CV=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return $V(Object.entries(e.classGroups),r).forEach(([o,i])=>{Zv(i,n,o,t)}),n},Zv=(e,t,r,n)=>{e.forEach(s=>{if(typeof s=="string"){const o=s===""?t:BS(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(kV(s)){Zv(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(([o,i])=>{Zv(i,BS(t,o),r,n)})})},BS=(e,t)=>{let r=e;return t.split(W0).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},kV=e=>e.isThemeGetter,$V=(e,t)=>t?e.map(([r,n])=>{const s=n.map(o=>typeof o=="string"?t+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,a])=>[t+i,a])):o);return[r,s]}):e,AV=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const s=(o,i)=>{r.set(o,i),t++,t>e&&(t=0,n=r,r=new Map)};return{get(o){let i=r.get(o);if(i!==void 0)return i;if((i=n.get(o))!==void 0)return s(o,i),i},set(o,i){r.has(o)?r.set(o,i):s(o,i)}}},LD="!",IV=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,s=t[0],o=t.length,i=a=>{const l=[];let u=0,h=0,c;for(let b=0;b<a.length;b++){let g=a[b];if(u===0){if(g===s&&(n||a.slice(b,b+o)===t)){l.push(a.slice(h,b)),h=b+o;continue}if(g==="/"){c=b;continue}}g==="["?u++:g==="]"&&u--}const d=l.length===0?a:a.substring(h),f=d.startsWith(LD),p=f?d.substring(1):d,m=c&&c>h?c-h:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:m}};return r?a=>r({className:a,parseClassName:i}):i},OV=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},DV=e=>({cache:AV(e.cacheSize),parseClassName:IV(e),...PV(e)}),FV=/\s+/,RV=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:s}=t,o=[],i=e.trim().split(FV);let a="";for(let l=i.length-1;l>=0;l-=1){const u=i[l],{modifiers:h,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:f}=r(u);let p=!!f,m=n(p?d.substring(0,f):d);if(!m){if(!p){a=u+(a.length>0?" "+a:a);continue}if(m=n(d),!m){a=u+(a.length>0?" "+a:a);continue}p=!1}const b=OV(h).join(":"),g=c?b+LD:b,_=g+m;if(o.includes(_))continue;o.push(_);const y=s(m,p);for(let v=0;v<y.length;++v){const M=y[v];o.push(g+M)}a=u+(a.length>0?" "+a:a)}return a};function LV(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=ND(t))&&(n&&(n+=" "),n+=r);return n}const ND=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=ND(e[n]))&&(r&&(r+=" "),r+=t);return r};function NV(e,...t){let r,n,s,o=i;function i(l){const u=t.reduce((h,c)=>c(h),e());return r=DV(u),n=r.cache.get,s=r.cache.set,o=a,a(l)}function a(l){const u=n(l);if(u)return u;const h=RV(l,r);return s(l,h),h}return function(){return o(LV.apply(null,arguments))}}const Sr=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},jD=/^\[(?:([a-z-]+):)?(.+)\]$/i,jV=/^\d+\/\d+$/,zV=new Set(["px","full","screen"]),BV=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,UV=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,VV=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,WV=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,GV=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Jo=e=>fu(e)||zV.has(e)||jV.test(e),Ei=e=>Uu(e,"length",ZV),fu=e=>!!e&&!Number.isNaN(Number(e)),F_=e=>Uu(e,"number",fu),Sc=e=>!!e&&Number.isInteger(Number(e)),HV=e=>e.endsWith("%")&&fu(e.slice(0,-1)),Gt=e=>jD.test(e),Pi=e=>BV.test(e),KV=new Set(["length","size","percentage"]),qV=e=>Uu(e,KV,zD),QV=e=>Uu(e,"position",zD),XV=new Set(["image","url"]),JV=e=>Uu(e,XV,tW),YV=e=>Uu(e,"",eW),Cc=()=>!0,Uu=(e,t,r)=>{const n=jD.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},ZV=e=>UV.test(e)&&!VV.test(e),zD=()=>!1,eW=e=>WV.test(e),tW=e=>GV.test(e),rW=()=>{const e=Sr("colors"),t=Sr("spacing"),r=Sr("blur"),n=Sr("brightness"),s=Sr("borderColor"),o=Sr("borderRadius"),i=Sr("borderSpacing"),a=Sr("borderWidth"),l=Sr("contrast"),u=Sr("grayscale"),h=Sr("hueRotate"),c=Sr("invert"),d=Sr("gap"),f=Sr("gradientColorStops"),p=Sr("gradientColorStopPositions"),m=Sr("inset"),b=Sr("margin"),g=Sr("opacity"),_=Sr("padding"),y=Sr("saturate"),v=Sr("scale"),M=Sr("sepia"),E=Sr("skew"),T=Sr("space"),S=Sr("translate"),A=()=>["auto","contain","none"],I=()=>["auto","hidden","clip","visible","scroll"],V=()=>["auto",Gt,t],N=()=>[Gt,t],z=()=>["",Jo,Ei],q=()=>["auto",fu,Gt],G=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ee=()=>["solid","dashed","dotted","double","none"],Y=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],W=()=>["start","end","center","between","around","evenly","stretch"],te=()=>["","0",Gt],le=()=>["auto","avoid","all","avoid-page","page","left","right","column"],oe=()=>[fu,Gt];return{cacheSize:500,separator:":",theme:{colors:[Cc],spacing:[Jo,Ei],blur:["none","",Pi,Gt],brightness:oe(),borderColor:[e],borderRadius:["none","","full",Pi,Gt],borderSpacing:N(),borderWidth:z(),contrast:oe(),grayscale:te(),hueRotate:oe(),invert:te(),gap:N(),gradientColorStops:[e],gradientColorStopPositions:[HV,Ei],inset:V(),margin:V(),opacity:oe(),padding:N(),saturate:oe(),scale:oe(),sepia:te(),skew:oe(),space:N(),translate:N()},classGroups:{aspect:[{aspect:["auto","square","video",Gt]}],container:["container"],columns:[{columns:[Pi]}],"break-after":[{"break-after":le()}],"break-before":[{"break-before":le()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...G(),Gt]}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:A()}],"overscroll-x":[{"overscroll-x":A()}],"overscroll-y":[{"overscroll-y":A()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Sc,Gt]}],basis:[{basis:V()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Gt]}],grow:[{grow:te()}],shrink:[{shrink:te()}],order:[{order:["first","last","none",Sc,Gt]}],"grid-cols":[{"grid-cols":[Cc]}],"col-start-end":[{col:["auto",{span:["full",Sc,Gt]},Gt]}],"col-start":[{"col-start":q()}],"col-end":[{"col-end":q()}],"grid-rows":[{"grid-rows":[Cc]}],"row-start-end":[{row:["auto",{span:[Sc,Gt]},Gt]}],"row-start":[{"row-start":q()}],"row-end":[{"row-end":q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Gt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Gt]}],gap:[{gap:[d]}],"gap-x":[{"gap-x":[d]}],"gap-y":[{"gap-y":[d]}],"justify-content":[{justify:["normal",...W()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...W(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...W(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_]}],px:[{px:[_]}],py:[{py:[_]}],ps:[{ps:[_]}],pe:[{pe:[_]}],pt:[{pt:[_]}],pr:[{pr:[_]}],pb:[{pb:[_]}],pl:[{pl:[_]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Gt,t]}],"min-w":[{"min-w":[Gt,t,"min","max","fit"]}],"max-w":[{"max-w":[Gt,t,"none","full","min","max","fit","prose",{screen:[Pi]},Pi]}],h:[{h:[Gt,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Gt,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Gt,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Gt,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Pi,Ei]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",F_]}],"font-family":[{font:[Cc]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Gt]}],"line-clamp":[{"line-clamp":["none",fu,F_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Jo,Gt]}],"list-image":[{"list-image":["none",Gt]}],"list-style-type":[{list:["none","disc","decimal",Gt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ee(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Jo,Ei]}],"underline-offset":[{"underline-offset":["auto",Jo,Gt]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:N()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Gt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Gt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...G(),QV]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",qV]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},JV]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:[...ee(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:ee()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...ee()]}],"outline-offset":[{"outline-offset":[Jo,Gt]}],"outline-w":[{outline:[Jo,Ei]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:z()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[Jo,Ei]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Pi,YV]}],"shadow-color":[{shadow:[Cc]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":[...Y(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Y()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Pi,Gt]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[c]}],saturate:[{saturate:[y]}],sepia:[{sepia:[M]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[c]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[M]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Gt]}],duration:[{duration:oe()}],ease:[{ease:["linear","in","out","in-out",Gt]}],delay:[{delay:oe()}],animate:[{animate:["none","spin","ping","pulse","bounce",Gt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[v]}],"scale-x":[{"scale-x":[v]}],"scale-y":[{"scale-y":[v]}],rotate:[{rotate:[Sc,Gt]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Gt]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Gt]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":N()}],"scroll-mx":[{"scroll-mx":N()}],"scroll-my":[{"scroll-my":N()}],"scroll-ms":[{"scroll-ms":N()}],"scroll-me":[{"scroll-me":N()}],"scroll-mt":[{"scroll-mt":N()}],"scroll-mr":[{"scroll-mr":N()}],"scroll-mb":[{"scroll-mb":N()}],"scroll-ml":[{"scroll-ml":N()}],"scroll-p":[{"scroll-p":N()}],"scroll-px":[{"scroll-px":N()}],"scroll-py":[{"scroll-py":N()}],"scroll-ps":[{"scroll-ps":N()}],"scroll-pe":[{"scroll-pe":N()}],"scroll-pt":[{"scroll-pt":N()}],"scroll-pr":[{"scroll-pr":N()}],"scroll-pb":[{"scroll-pb":N()}],"scroll-pl":[{"scroll-pl":N()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Gt]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Jo,Ei,F_]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},nW=NV(rW);function ts(...e){return nW(AD(e))}const sW=ZU,BD=Q.forwardRef(({className:e,...t},r)=>J.jsx(TD,{ref:r,className:ts("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));BD.displayName=TD.displayName;const oW=V0("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),UD=Q.forwardRef(({className:e,variant:t,...r},n)=>J.jsx(ED,{ref:n,className:ts(oW({variant:t}),e),...r}));UD.displayName=ED.displayName;const iW=Q.forwardRef(({className:e,...t},r)=>J.jsx(CD,{ref:r,className:ts("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));iW.displayName=CD.displayName;const VD=Q.forwardRef(({className:e,...t},r)=>J.jsx(kD,{ref:r,className:ts("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:J.jsx(FD,{className:"h-4 w-4"})}));VD.displayName=kD.displayName;const WD=Q.forwardRef(({className:e,...t},r)=>J.jsx(PD,{ref:r,className:ts("text-sm font-semibold",e),...t}));WD.displayName=PD.displayName;const GD=Q.forwardRef(({className:e,...t},r)=>J.jsx(SD,{ref:r,className:ts("text-sm opacity-90",e),...t}));GD.displayName=SD.displayName;function aW(){const{toasts:e}=Wd();return J.jsxs(sW,{children:[e.map(function({id:t,title:r,description:n,action:s,...o}){return J.jsxs(UD,{...o,children:[J.jsxs("div",{className:"grid gap-1",children:[r&&J.jsx(WD,{children:r}),n&&J.jsx(GD,{children:n})]}),s,J.jsx(VD,{})]},t)}),J.jsx(BD,{})]})}var US=["light","dark"],lW="(prefers-color-scheme: dark)",uW=Q.createContext(void 0),cW={setTheme:e=>{},themes:[]},dW=()=>{var e;return(e=Q.useContext(uW))!=null?e:cW};Q.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:s,defaultTheme:o,value:i,attrs:a,nonce:l})=>{let u=o==="system",h=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(p=>`'${p}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,c=s?US.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(p,m=!1,b=!0)=>{let g=i?i[p]:p,_=m?p+"|| ''":`'${g}'`,y="";return s&&b&&!m&&US.includes(p)&&(y+=`d.style.colorScheme = '${p}';`),r==="class"?m||g?y+=`c.add(${_})`:y+="null":g&&(y+=`d[s](n,${_})`),y},f=e?`!function(){${h}${d(e)}}()`:n?`!function(){try{${h}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${u})){var t='${lW}',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${i?`var x=${JSON.stringify(i)};`:""}${d(i?"x[e]":"e",!0)}}${u?"":"else{"+d(o,!1,!1)+"}"}${c}}catch(e){}}()`:`!function(){try{${h}var e=localStorage.getItem('${t}');if(e){${i?`var x=${JSON.stringify(i)};`:""}${d(i?"x[e]":"e",!0)}}else{${d(o,!1,!1)};}${c}}catch(t){}}();`;return Q.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var hW=e=>{switch(e){case"success":return mW;case"info":return _W;case"warning":return gW;case"error":return yW;default:return null}},fW=Array(12).fill(0),pW=({visible:e,className:t})=>rt.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},rt.createElement("div",{className:"sonner-spinner"},fW.map((r,n)=>rt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),mW=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),gW=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),_W=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),yW=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},rt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),vW=rt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},rt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),rt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),wW=()=>{let[e,t]=rt.useState(document.hidden);return rt.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},ew=1,bW=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let r=this.subscribers.indexOf(t);this.subscribers.splice(r,1)}),this.publish=t=>{this.subscribers.forEach(r=>r(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var r;let{message:n,...s}=t,o=typeof(t==null?void 0:t.id)=="number"||((r=t.id)==null?void 0:r.length)>0?t.id:ew++,i=this.toasts.find(l=>l.id===o),a=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),i?this.toasts=this.toasts.map(l=>l.id===o?(this.publish({...l,...t,id:o,title:n}),{...l,...t,id:o,dismissible:a,title:n}):l):this.addToast({title:n,...s,dismissible:a,id:o}),o},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(r=>{this.subscribers.forEach(n=>n({id:r.id,dismiss:!0}))}),this.subscribers.forEach(r=>r({id:t,dismiss:!0})),t),this.message=(t,r)=>this.create({...r,message:t}),this.error=(t,r)=>this.create({...r,message:t,type:"error"}),this.success=(t,r)=>this.create({...r,type:"success",message:t}),this.info=(t,r)=>this.create({...r,type:"info",message:t}),this.warning=(t,r)=>this.create({...r,type:"warning",message:t}),this.loading=(t,r)=>this.create({...r,type:"loading",message:t}),this.promise=(t,r)=>{if(!r)return;let n;r.loading!==void 0&&(n=this.create({...r,promise:t,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));let s=t instanceof Promise?t:t(),o=n!==void 0,i,a=s.then(async u=>{if(i=["resolve",u],rt.isValidElement(u))o=!1,this.create({id:n,type:"default",message:u});else if(MW(u)&&!u.ok){o=!1;let h=typeof r.error=="function"?await r.error(`HTTP error! status: ${u.status}`):r.error,c=typeof r.description=="function"?await r.description(`HTTP error! status: ${u.status}`):r.description;this.create({id:n,type:"error",message:h,description:c})}else if(r.success!==void 0){o=!1;let h=typeof r.success=="function"?await r.success(u):r.success,c=typeof r.description=="function"?await r.description(u):r.description;this.create({id:n,type:"success",message:h,description:c})}}).catch(async u=>{if(i=["reject",u],r.error!==void 0){o=!1;let h=typeof r.error=="function"?await r.error(u):r.error,c=typeof r.description=="function"?await r.description(u):r.description;this.create({id:n,type:"error",message:h,description:c})}}).finally(()=>{var u;o&&(this.dismiss(n),n=void 0),(u=r.finally)==null||u.call(r)}),l=()=>new Promise((u,h)=>a.then(()=>i[0]==="reject"?h(i[1]):u(i[1])).catch(h));return typeof n!="string"&&typeof n!="number"?{unwrap:l}:Object.assign(n,{unwrap:l})},this.custom=(t,r)=>{let n=(r==null?void 0:r.id)||ew++;return this.create({jsx:t(n),id:n,...r}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},ss=new bW,xW=(e,t)=>{let r=(t==null?void 0:t.id)||ew++;return ss.addToast({title:e,...t,id:r}),r},MW=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",TW=xW,EW=()=>ss.toasts,PW=()=>ss.getActiveToasts();Object.assign(TW,{success:ss.success,info:ss.info,warning:ss.warning,error:ss.error,custom:ss.custom,message:ss.message,promise:ss.promise,dismiss:ss.dismiss,loading:ss.loading},{getHistory:EW,getToasts:PW});function SW(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}SW(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function hf(e){return e.label!==void 0}var CW=3,kW="32px",$W="16px",VS=4e3,AW=356,IW=14,OW=20,DW=200;function ro(...e){return e.filter(Boolean).join(" ")}function FW(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var RW=e=>{var t,r,n,s,o,i,a,l,u,h,c;let{invert:d,toast:f,unstyled:p,interacting:m,setHeights:b,visibleToasts:g,heights:_,index:y,toasts:v,expanded:M,removeToast:E,defaultRichColors:T,closeButton:S,style:A,cancelButtonStyle:I,actionButtonStyle:V,className:N="",descriptionClassName:z="",duration:q,position:G,gap:ee,loadingIcon:Y,expandByDefault:W,classNames:te,icons:le,closeButtonAriaLabel:oe="Close toast",pauseWhenPageIsHidden:U}=e,[R,X]=rt.useState(null),[ce,ne]=rt.useState(null),[we,De]=rt.useState(!1),[Be,$e]=rt.useState(!1),[se,F]=rt.useState(!1),[pe,Ee]=rt.useState(!1),[Me,Pe]=rt.useState(!1),[ye,ke]=rt.useState(0),[be,Oe]=rt.useState(0),je=rt.useRef(f.duration||q||VS),Je=rt.useRef(null),Te=rt.useRef(null),ot=y===0,Ze=y+1<=g,it=f.type,nt=f.dismissible!==!1,Ne=f.className||"",qe=f.descriptionClassName||"",Mt=rt.useMemo(()=>_.findIndex(Ge=>Ge.toastId===f.id)||0,[_,f.id]),bt=rt.useMemo(()=>{var Ge;return(Ge=f.closeButton)!=null?Ge:S},[f.closeButton,S]),jt=rt.useMemo(()=>f.duration||q||VS,[f.duration,q]),yt=rt.useRef(0),pr=rt.useRef(0),Hr=rt.useRef(0),Rr=rt.useRef(null),[wn,mr]=G.split("-"),Kr=rt.useMemo(()=>_.reduce((Ge,Ht,ct)=>ct>=Mt?Ge:Ge+Ht.height,0),[_,Mt]),Qs=wW(),ko=f.invert||d,Cs=it==="loading";pr.current=rt.useMemo(()=>Mt*ee+Kr,[Mt,Kr]),rt.useEffect(()=>{je.current=jt},[jt]),rt.useEffect(()=>{De(!0)},[]),rt.useEffect(()=>{let Ge=Te.current;if(Ge){let Ht=Ge.getBoundingClientRect().height;return Oe(Ht),b(ct=>[{toastId:f.id,height:Ht,position:f.position},...ct]),()=>b(ct=>ct.filter(Wt=>Wt.toastId!==f.id))}},[b,f.id]),rt.useLayoutEffect(()=>{if(!we)return;let Ge=Te.current,Ht=Ge.style.height;Ge.style.height="auto";let ct=Ge.getBoundingClientRect().height;Ge.style.height=Ht,Oe(ct),b(Wt=>Wt.find($=>$.toastId===f.id)?Wt.map($=>$.toastId===f.id?{...$,height:ct}:$):[{toastId:f.id,height:ct,position:f.position},...Wt])},[we,f.title,f.description,b,f.id]);let Yr=rt.useCallback(()=>{$e(!0),ke(pr.current),b(Ge=>Ge.filter(Ht=>Ht.toastId!==f.id)),setTimeout(()=>{E(f)},DW)},[f,E,b,pr]);rt.useEffect(()=>{if(f.promise&&it==="loading"||f.duration===1/0||f.type==="loading")return;let Ge;return M||m||U&&Qs?(()=>{if(Hr.current<yt.current){let Ht=new Date().getTime()-yt.current;je.current=je.current-Ht}Hr.current=new Date().getTime()})():je.current!==1/0&&(yt.current=new Date().getTime(),Ge=setTimeout(()=>{var Ht;(Ht=f.onAutoClose)==null||Ht.call(f,f),Yr()},je.current)),()=>clearTimeout(Ge)},[M,m,f,it,U,Qs,Yr]),rt.useEffect(()=>{f.delete&&Yr()},[Yr,f.delete]);function Xs(){var Ge,Ht,ct;return le!=null&&le.loading?rt.createElement("div",{className:ro(te==null?void 0:te.loader,(Ge=f==null?void 0:f.classNames)==null?void 0:Ge.loader,"sonner-loader"),"data-visible":it==="loading"},le.loading):Y?rt.createElement("div",{className:ro(te==null?void 0:te.loader,(Ht=f==null?void 0:f.classNames)==null?void 0:Ht.loader,"sonner-loader"),"data-visible":it==="loading"},Y):rt.createElement(pW,{className:ro(te==null?void 0:te.loader,(ct=f==null?void 0:f.classNames)==null?void 0:ct.loader),visible:it==="loading"})}return rt.createElement("li",{tabIndex:0,ref:Te,className:ro(N,Ne,te==null?void 0:te.toast,(t=f==null?void 0:f.classNames)==null?void 0:t.toast,te==null?void 0:te.default,te==null?void 0:te[it],(r=f==null?void 0:f.classNames)==null?void 0:r[it]),"data-sonner-toast":"","data-rich-colors":(n=f.richColors)!=null?n:T,"data-styled":!(f.jsx||f.unstyled||p),"data-mounted":we,"data-promise":!!f.promise,"data-swiped":Me,"data-removed":Be,"data-visible":Ze,"data-y-position":wn,"data-x-position":mr,"data-index":y,"data-front":ot,"data-swiping":se,"data-dismissible":nt,"data-type":it,"data-invert":ko,"data-swipe-out":pe,"data-swipe-direction":ce,"data-expanded":!!(M||W&&we),style:{"--index":y,"--toasts-before":y,"--z-index":v.length-y,"--offset":`${Be?ye:pr.current}px`,"--initial-height":W?"auto":`${be}px`,...A,...f.style},onDragEnd:()=>{F(!1),X(null),Rr.current=null},onPointerDown:Ge=>{Cs||!nt||(Je.current=new Date,ke(pr.current),Ge.target.setPointerCapture(Ge.pointerId),Ge.target.tagName!=="BUTTON"&&(F(!0),Rr.current={x:Ge.clientX,y:Ge.clientY}))},onPointerUp:()=>{var Ge,Ht,ct,Wt;if(pe||!nt)return;Rr.current=null;let $=Number(((Ge=Te.current)==null?void 0:Ge.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),re=Number(((Ht=Te.current)==null?void 0:Ht.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),B=new Date().getTime()-((ct=Je.current)==null?void 0:ct.getTime()),Z=R==="x"?$:re,ue=Math.abs(Z)/B;if(Math.abs(Z)>=OW||ue>.11){ke(pr.current),(Wt=f.onDismiss)==null||Wt.call(f,f),ne(R==="x"?$>0?"right":"left":re>0?"down":"up"),Yr(),Ee(!0),Pe(!1);return}F(!1),X(null)},onPointerMove:Ge=>{var Ht,ct,Wt,$;if(!Rr.current||!nt||((Ht=window.getSelection())==null?void 0:Ht.toString().length)>0)return;let re=Ge.clientY-Rr.current.y,B=Ge.clientX-Rr.current.x,Z=(ct=e.swipeDirections)!=null?ct:FW(G);!R&&(Math.abs(B)>1||Math.abs(re)>1)&&X(Math.abs(B)>Math.abs(re)?"x":"y");let ue={x:0,y:0};R==="y"?(Z.includes("top")||Z.includes("bottom"))&&(Z.includes("top")&&re<0||Z.includes("bottom")&&re>0)&&(ue.y=re):R==="x"&&(Z.includes("left")||Z.includes("right"))&&(Z.includes("left")&&B<0||Z.includes("right")&&B>0)&&(ue.x=B),(Math.abs(ue.x)>0||Math.abs(ue.y)>0)&&Pe(!0),(Wt=Te.current)==null||Wt.style.setProperty("--swipe-amount-x",`${ue.x}px`),($=Te.current)==null||$.style.setProperty("--swipe-amount-y",`${ue.y}px`)}},bt&&!f.jsx?rt.createElement("button",{"aria-label":oe,"data-disabled":Cs,"data-close-button":!0,onClick:Cs||!nt?()=>{}:()=>{var Ge;Yr(),(Ge=f.onDismiss)==null||Ge.call(f,f)},className:ro(te==null?void 0:te.closeButton,(s=f==null?void 0:f.classNames)==null?void 0:s.closeButton)},(o=le==null?void 0:le.close)!=null?o:vW):null,f.jsx||Q.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:rt.createElement(rt.Fragment,null,it||f.icon||f.promise?rt.createElement("div",{"data-icon":"",className:ro(te==null?void 0:te.icon,(i=f==null?void 0:f.classNames)==null?void 0:i.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||Xs():null,f.type!=="loading"?f.icon||(le==null?void 0:le[it])||hW(it):null):null,rt.createElement("div",{"data-content":"",className:ro(te==null?void 0:te.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},rt.createElement("div",{"data-title":"",className:ro(te==null?void 0:te.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?rt.createElement("div",{"data-description":"",className:ro(z,qe,te==null?void 0:te.description,(u=f==null?void 0:f.classNames)==null?void 0:u.description)},typeof f.description=="function"?f.description():f.description):null),Q.isValidElement(f.cancel)?f.cancel:f.cancel&&hf(f.cancel)?rt.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||I,onClick:Ge=>{var Ht,ct;hf(f.cancel)&&nt&&((ct=(Ht=f.cancel).onClick)==null||ct.call(Ht,Ge),Yr())},className:ro(te==null?void 0:te.cancelButton,(h=f==null?void 0:f.classNames)==null?void 0:h.cancelButton)},f.cancel.label):null,Q.isValidElement(f.action)?f.action:f.action&&hf(f.action)?rt.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||V,onClick:Ge=>{var Ht,ct;hf(f.action)&&((ct=(Ht=f.action).onClick)==null||ct.call(Ht,Ge),!Ge.defaultPrevented&&Yr())},className:ro(te==null?void 0:te.actionButton,(c=f==null?void 0:f.classNames)==null?void 0:c.actionButton)},f.action.label):null))};function WS(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function LW(e,t){let r={};return[e,t].forEach((n,s)=>{let o=s===1,i=o?"--mobile-offset":"--offset",a=o?$W:kW;function l(u){["top","right","bottom","left"].forEach(h=>{r[`${i}-${h}`]=typeof u=="number"?`${u}px`:u})}typeof n=="number"||typeof n=="string"?l(n):typeof n=="object"?["top","right","bottom","left"].forEach(u=>{n[u]===void 0?r[`${i}-${u}`]=a:r[`${i}-${u}`]=typeof n[u]=="number"?`${n[u]}px`:n[u]}):l(a)}),r}var NW=Q.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:o,closeButton:i,className:a,offset:l,mobileOffset:u,theme:h="light",richColors:c,duration:d,style:f,visibleToasts:p=CW,toastOptions:m,dir:b=WS(),gap:g=IW,loadingIcon:_,icons:y,containerAriaLabel:v="Notifications",pauseWhenPageIsHidden:M}=e,[E,T]=rt.useState([]),S=rt.useMemo(()=>Array.from(new Set([n].concat(E.filter(U=>U.position).map(U=>U.position)))),[E,n]),[A,I]=rt.useState([]),[V,N]=rt.useState(!1),[z,q]=rt.useState(!1),[G,ee]=rt.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Y=rt.useRef(null),W=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),te=rt.useRef(null),le=rt.useRef(!1),oe=rt.useCallback(U=>{T(R=>{var X;return(X=R.find(ce=>ce.id===U.id))!=null&&X.delete||ss.dismiss(U.id),R.filter(({id:ce})=>ce!==U.id)})},[]);return rt.useEffect(()=>ss.subscribe(U=>{if(U.dismiss){T(R=>R.map(X=>X.id===U.id?{...X,delete:!0}:X));return}setTimeout(()=>{rD.flushSync(()=>{T(R=>{let X=R.findIndex(ce=>ce.id===U.id);return X!==-1?[...R.slice(0,X),{...R[X],...U},...R.slice(X+1)]:[U,...R]})})})}),[]),rt.useEffect(()=>{if(h!=="system"){ee(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ee("dark"):ee("light")),typeof window>"u")return;let U=window.matchMedia("(prefers-color-scheme: dark)");try{U.addEventListener("change",({matches:R})=>{ee(R?"dark":"light")})}catch{U.addListener(({matches:X})=>{try{ee(X?"dark":"light")}catch(ce){console.error(ce)}})}},[h]),rt.useEffect(()=>{E.length<=1&&N(!1)},[E]),rt.useEffect(()=>{let U=R=>{var X,ce;s.every(ne=>R[ne]||R.code===ne)&&(N(!0),(X=Y.current)==null||X.focus()),R.code==="Escape"&&(document.activeElement===Y.current||(ce=Y.current)!=null&&ce.contains(document.activeElement))&&N(!1)};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[s]),rt.useEffect(()=>{if(Y.current)return()=>{te.current&&(te.current.focus({preventScroll:!0}),te.current=null,le.current=!1)}},[Y.current]),rt.createElement("section",{ref:t,"aria-label":`${v} ${W}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((U,R)=>{var X;let[ce,ne]=U.split("-");return E.length?rt.createElement("ol",{key:U,dir:b==="auto"?WS():b,tabIndex:-1,ref:Y,className:a,"data-sonner-toaster":!0,"data-theme":G,"data-y-position":ce,"data-lifted":V&&E.length>1&&!o,"data-x-position":ne,style:{"--front-toast-height":`${((X=A[0])==null?void 0:X.height)||0}px`,"--width":`${AW}px`,"--gap":`${g}px`,...f,...LW(l,u)},onBlur:we=>{le.current&&!we.currentTarget.contains(we.relatedTarget)&&(le.current=!1,te.current&&(te.current.focus({preventScroll:!0}),te.current=null))},onFocus:we=>{we.target instanceof HTMLElement&&we.target.dataset.dismissible==="false"||le.current||(le.current=!0,te.current=we.relatedTarget)},onMouseEnter:()=>N(!0),onMouseMove:()=>N(!0),onMouseLeave:()=>{z||N(!1)},onDragEnd:()=>N(!1),onPointerDown:we=>{we.target instanceof HTMLElement&&we.target.dataset.dismissible==="false"||q(!0)},onPointerUp:()=>q(!1)},E.filter(we=>!we.position&&R===0||we.position===U).map((we,De)=>{var Be,$e;return rt.createElement(RW,{key:we.id,icons:y,index:De,toast:we,defaultRichColors:c,duration:(Be=m==null?void 0:m.duration)!=null?Be:d,className:m==null?void 0:m.className,descriptionClassName:m==null?void 0:m.descriptionClassName,invert:r,visibleToasts:p,closeButton:($e=m==null?void 0:m.closeButton)!=null?$e:i,interacting:z,position:U,style:m==null?void 0:m.style,unstyled:m==null?void 0:m.unstyled,classNames:m==null?void 0:m.classNames,cancelButtonStyle:m==null?void 0:m.cancelButtonStyle,actionButtonStyle:m==null?void 0:m.actionButtonStyle,removeToast:oe,toasts:E.filter(se=>se.position==we.position),heights:A.filter(se=>se.position==we.position),setHeights:I,expandByDefault:o,gap:g,loadingIcon:_,expanded:V,pauseWhenPageIsHidden:M,swipeDirections:e.swipeDirections})})):null}))});const jW=({...e})=>{const{theme:t="system"}=dW();return J.jsx(NW,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var zW=qw[" useId ".trim().toString()]||(()=>{}),BW=0;function R_(e){const[t,r]=Q.useState(zW());return fi(()=>{e||r(n=>n??String(BW++))},[e]),e||(t?`radix-${t}`:"")}const UW=["top","right","bottom","left"],ra=Math.min,_s=Math.max,Dp=Math.round,ff=Math.floor,Vo=e=>({x:e,y:e}),VW={left:"right",right:"left",bottom:"top",top:"bottom"},WW={start:"end",end:"start"};function tw(e,t,r){return _s(e,ra(t,r))}function pi(e,t){return typeof e=="function"?e(t):e}function mi(e){return e.split("-")[0]}function Vu(e){return e.split("-")[1]}function G0(e){return e==="x"?"y":"x"}function H0(e){return e==="y"?"height":"width"}const GW=new Set(["top","bottom"]);function zo(e){return GW.has(mi(e))?"y":"x"}function K0(e){return G0(zo(e))}function HW(e,t,r){r===void 0&&(r=!1);const n=Vu(e),s=K0(e),o=H0(s);let i=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(i=Fp(i)),[i,Fp(i)]}function KW(e){const t=Fp(e);return[rw(e),t,rw(t)]}function rw(e){return e.replace(/start|end/g,t=>WW[t])}const GS=["left","right"],HS=["right","left"],qW=["top","bottom"],QW=["bottom","top"];function XW(e,t,r){switch(e){case"top":case"bottom":return r?t?HS:GS:t?GS:HS;case"left":case"right":return t?qW:QW;default:return[]}}function JW(e,t,r,n){const s=Vu(e);let o=XW(mi(e),r==="start",n);return s&&(o=o.map(i=>i+"-"+s),t&&(o=o.concat(o.map(rw)))),o}function Fp(e){return e.replace(/left|right|bottom|top/g,t=>VW[t])}function YW(e){return{top:0,right:0,bottom:0,left:0,...e}}function HD(e){return typeof e!="number"?YW(e):{top:e,right:e,bottom:e,left:e}}function Rp(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function KS(e,t,r){let{reference:n,floating:s}=e;const o=zo(t),i=K0(t),a=H0(i),l=mi(t),u=o==="y",h=n.x+n.width/2-s.width/2,c=n.y+n.height/2-s.height/2,d=n[a]/2-s[a]/2;let f;switch(l){case"top":f={x:h,y:n.y-s.height};break;case"bottom":f={x:h,y:n.y+n.height};break;case"right":f={x:n.x+n.width,y:c};break;case"left":f={x:n.x-s.width,y:c};break;default:f={x:n.x,y:n.y}}switch(Vu(t)){case"start":f[i]-=d*(r&&u?-1:1);break;case"end":f[i]+=d*(r&&u?-1:1);break}return f}const ZW=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:i}=r,a=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(t));let u=await i.getElementRects({reference:e,floating:t,strategy:s}),{x:h,y:c}=KS(u,n,l),d=n,f={},p=0;for(let m=0;m<a.length;m++){const{name:b,fn:g}=a[m],{x:_,y,data:v,reset:M}=await g({x:h,y:c,initialPlacement:n,placement:d,strategy:s,middlewareData:f,rects:u,platform:i,elements:{reference:e,floating:t}});h=_??h,c=y??c,f={...f,[b]:{...f[b],...v}},M&&p<=50&&(p++,typeof M=="object"&&(M.placement&&(d=M.placement),M.rects&&(u=M.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:s}):M.rects),{x:h,y:c}=KS(u,d,l)),m=-1)}return{x:h,y:c,placement:d,strategy:s,middlewareData:f}};async function Ed(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:i,elements:a,strategy:l}=e,{boundary:u="clippingAncestors",rootBoundary:h="viewport",elementContext:c="floating",altBoundary:d=!1,padding:f=0}=pi(t,e),p=HD(f),b=a[d?c==="floating"?"reference":"floating":c],g=Rp(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(b)))==null||r?b:b.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:u,rootBoundary:h,strategy:l})),_=c==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,y=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),v=await(o.isElement==null?void 0:o.isElement(y))?await(o.getScale==null?void 0:o.getScale(y))||{x:1,y:1}:{x:1,y:1},M=Rp(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:y,strategy:l}):_);return{top:(g.top-M.top+p.top)/v.y,bottom:(M.bottom-g.bottom+p.bottom)/v.y,left:(g.left-M.left+p.left)/v.x,right:(M.right-g.right+p.right)/v.x}}const e5=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:i,elements:a,middlewareData:l}=t,{element:u,padding:h=0}=pi(e,t)||{};if(u==null)return{};const c=HD(h),d={x:r,y:n},f=K0(s),p=H0(f),m=await i.getDimensions(u),b=f==="y",g=b?"top":"left",_=b?"bottom":"right",y=b?"clientHeight":"clientWidth",v=o.reference[p]+o.reference[f]-d[f]-o.floating[p],M=d[f]-o.reference[f],E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(u));let T=E?E[y]:0;(!T||!await(i.isElement==null?void 0:i.isElement(E)))&&(T=a.floating[y]||o.floating[p]);const S=v/2-M/2,A=T/2-m[p]/2-1,I=ra(c[g],A),V=ra(c[_],A),N=I,z=T-m[p]-V,q=T/2-m[p]/2+S,G=tw(N,q,z),ee=!l.arrow&&Vu(s)!=null&&q!==G&&o.reference[p]/2-(q<N?I:V)-m[p]/2<0,Y=ee?q<N?q-N:q-z:0;return{[f]:d[f]+Y,data:{[f]:G,centerOffset:q-G-Y,...ee&&{alignmentOffset:Y}},reset:ee}}}),t5=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:i,initialPlacement:a,platform:l,elements:u}=t,{mainAxis:h=!0,crossAxis:c=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...b}=pi(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const g=mi(s),_=zo(a),y=mi(a)===a,v=await(l.isRTL==null?void 0:l.isRTL(u.floating)),M=d||(y||!m?[Fp(a)]:KW(a)),E=p!=="none";!d&&E&&M.push(...JW(a,m,p,v));const T=[a,...M],S=await Ed(t,b),A=[];let I=((n=o.flip)==null?void 0:n.overflows)||[];if(h&&A.push(S[g]),c){const q=HW(s,i,v);A.push(S[q[0]],S[q[1]])}if(I=[...I,{placement:s,overflows:A}],!A.every(q=>q<=0)){var V,N;const q=(((V=o.flip)==null?void 0:V.index)||0)+1,G=T[q];if(G&&(!(c==="alignment"?_!==zo(G):!1)||I.every(W=>W.overflows[0]>0&&zo(W.placement)===_)))return{data:{index:q,overflows:I},reset:{placement:G}};let ee=(N=I.filter(Y=>Y.overflows[0]<=0).sort((Y,W)=>Y.overflows[1]-W.overflows[1])[0])==null?void 0:N.placement;if(!ee)switch(f){case"bestFit":{var z;const Y=(z=I.filter(W=>{if(E){const te=zo(W.placement);return te===_||te==="y"}return!0}).map(W=>[W.placement,W.overflows.filter(te=>te>0).reduce((te,le)=>te+le,0)]).sort((W,te)=>W[1]-te[1])[0])==null?void 0:z[0];Y&&(ee=Y);break}case"initialPlacement":ee=a;break}if(s!==ee)return{reset:{placement:ee}}}return{}}}};function qS(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function QS(e){return UW.some(t=>e[t]>=0)}const r5=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=pi(e,t);switch(n){case"referenceHidden":{const o=await Ed(t,{...s,elementContext:"reference"}),i=qS(o,r.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:QS(i)}}}case"escaped":{const o=await Ed(t,{...s,altBoundary:!0}),i=qS(o,r.floating);return{data:{escapedOffsets:i,escaped:QS(i)}}}default:return{}}}}},KD=new Set(["left","top"]);async function n5(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=mi(r),a=Vu(r),l=zo(r)==="y",u=KD.has(i)?-1:1,h=o&&l?-1:1,c=pi(t,e);let{mainAxis:d,crossAxis:f,alignmentAxis:p}=typeof c=="number"?{mainAxis:c,crossAxis:0,alignmentAxis:null}:{mainAxis:c.mainAxis||0,crossAxis:c.crossAxis||0,alignmentAxis:c.alignmentAxis};return a&&typeof p=="number"&&(f=a==="end"?p*-1:p),l?{x:f*h,y:d*u}:{x:d*u,y:f*h}}const s5=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:i,middlewareData:a}=t,l=await n5(t,e);return i===((r=a.offset)==null?void 0:r.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:o+l.y,data:{...l,placement:i}}}}},o5=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:i=!1,limiter:a={fn:b=>{let{x:g,y:_}=b;return{x:g,y:_}}},...l}=pi(e,t),u={x:r,y:n},h=await Ed(t,l),c=zo(mi(s)),d=G0(c);let f=u[d],p=u[c];if(o){const b=d==="y"?"top":"left",g=d==="y"?"bottom":"right",_=f+h[b],y=f-h[g];f=tw(_,f,y)}if(i){const b=c==="y"?"top":"left",g=c==="y"?"bottom":"right",_=p+h[b],y=p-h[g];p=tw(_,p,y)}const m=a.fn({...t,[d]:f,[c]:p});return{...m,data:{x:m.x-r,y:m.y-n,enabled:{[d]:o,[c]:i}}}}}},i5=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:i}=t,{offset:a=0,mainAxis:l=!0,crossAxis:u=!0}=pi(e,t),h={x:r,y:n},c=zo(s),d=G0(c);let f=h[d],p=h[c];const m=pi(a,t),b=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const y=d==="y"?"height":"width",v=o.reference[d]-o.floating[y]+b.mainAxis,M=o.reference[d]+o.reference[y]-b.mainAxis;f<v?f=v:f>M&&(f=M)}if(u){var g,_;const y=d==="y"?"width":"height",v=KD.has(mi(s)),M=o.reference[c]-o.floating[y]+(v&&((g=i.offset)==null?void 0:g[c])||0)+(v?0:b.crossAxis),E=o.reference[c]+o.reference[y]+(v?0:((_=i.offset)==null?void 0:_[c])||0)-(v?b.crossAxis:0);p<M?p=M:p>E&&(p=E)}return{[d]:f,[c]:p}}}},a5=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:i,elements:a}=t,{apply:l=()=>{},...u}=pi(e,t),h=await Ed(t,u),c=mi(s),d=Vu(s),f=zo(s)==="y",{width:p,height:m}=o.floating;let b,g;c==="top"||c==="bottom"?(b=c,g=d===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(g=c,b=d==="end"?"top":"bottom");const _=m-h.top-h.bottom,y=p-h.left-h.right,v=ra(m-h[b],_),M=ra(p-h[g],y),E=!t.middlewareData.shift;let T=v,S=M;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(S=y),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(T=_),E&&!d){const I=_s(h.left,0),V=_s(h.right,0),N=_s(h.top,0),z=_s(h.bottom,0);f?S=p-2*(I!==0||V!==0?I+V:_s(h.left,h.right)):T=m-2*(N!==0||z!==0?N+z:_s(h.top,h.bottom))}await l({...t,availableWidth:S,availableHeight:T});const A=await i.getDimensions(a.floating);return p!==A.width||m!==A.height?{reset:{rects:!0}}:{}}}};function vm(){return typeof window<"u"}function Wu(e){return qD(e)?(e.nodeName||"").toLowerCase():"#document"}function Ms(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ho(e){var t;return(t=(qD(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function qD(e){return vm()?e instanceof Node||e instanceof Ms(e).Node:!1}function To(e){return vm()?e instanceof Element||e instanceof Ms(e).Element:!1}function Go(e){return vm()?e instanceof HTMLElement||e instanceof Ms(e).HTMLElement:!1}function XS(e){return!vm()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ms(e).ShadowRoot}const l5=new Set(["inline","contents"]);function Kd(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=Eo(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!l5.has(s)}const u5=new Set(["table","td","th"]);function c5(e){return u5.has(Wu(e))}const d5=[":popover-open",":modal"];function wm(e){return d5.some(t=>{try{return e.matches(t)}catch{return!1}})}const h5=["transform","translate","scale","rotate","perspective"],f5=["transform","translate","scale","rotate","perspective","filter"],p5=["paint","layout","strict","content"];function q0(e){const t=Q0(),r=To(e)?Eo(e):e;return h5.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||f5.some(n=>(r.willChange||"").includes(n))||p5.some(n=>(r.contain||"").includes(n))}function m5(e){let t=na(e);for(;Go(t)&&!Ou(t);){if(q0(t))return t;if(wm(t))return null;t=na(t)}return null}function Q0(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const g5=new Set(["html","body","#document"]);function Ou(e){return g5.has(Wu(e))}function Eo(e){return Ms(e).getComputedStyle(e)}function bm(e){return To(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function na(e){if(Wu(e)==="html")return e;const t=e.assignedSlot||e.parentNode||XS(e)&&e.host||Ho(e);return XS(t)?t.host:t}function QD(e){const t=na(e);return Ou(t)?e.ownerDocument?e.ownerDocument.body:e.body:Go(t)&&Kd(t)?t:QD(t)}function Pd(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=QD(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),i=Ms(s);if(o){const a=nw(i);return t.concat(i,i.visualViewport||[],Kd(s)?s:[],a&&r?Pd(a):[])}return t.concat(s,Pd(s,[],r))}function nw(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function XD(e){const t=Eo(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Go(e),o=s?e.offsetWidth:r,i=s?e.offsetHeight:n,a=Dp(r)!==o||Dp(n)!==i;return a&&(r=o,n=i),{width:r,height:n,$:a}}function X0(e){return To(e)?e:e.contextElement}function pu(e){const t=X0(e);if(!Go(t))return Vo(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=XD(t);let i=(o?Dp(r.width):r.width)/n,a=(o?Dp(r.height):r.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const _5=Vo(0);function JD(e){const t=Ms(e);return!Q0()||!t.visualViewport?_5:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function y5(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Ms(e)?!1:t}function al(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=X0(e);let i=Vo(1);t&&(n?To(n)&&(i=pu(n)):i=pu(e));const a=y5(o,r,n)?JD(o):Vo(0);let l=(s.left+a.x)/i.x,u=(s.top+a.y)/i.y,h=s.width/i.x,c=s.height/i.y;if(o){const d=Ms(o),f=n&&To(n)?Ms(n):n;let p=d,m=nw(p);for(;m&&n&&f!==p;){const b=pu(m),g=m.getBoundingClientRect(),_=Eo(m),y=g.left+(m.clientLeft+parseFloat(_.paddingLeft))*b.x,v=g.top+(m.clientTop+parseFloat(_.paddingTop))*b.y;l*=b.x,u*=b.y,h*=b.x,c*=b.y,l+=y,u+=v,p=Ms(m),m=nw(p)}}return Rp({width:h,height:c,x:l,y:u})}function J0(e,t){const r=bm(e).scrollLeft;return t?t.left+r:al(Ho(e)).left+r}function YD(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:J0(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function v5(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",i=Ho(n),a=t?wm(t.floating):!1;if(n===i||a&&o)return r;let l={scrollLeft:0,scrollTop:0},u=Vo(1);const h=Vo(0),c=Go(n);if((c||!c&&!o)&&((Wu(n)!=="body"||Kd(i))&&(l=bm(n)),Go(n))){const f=al(n);u=pu(n),h.x=f.x+n.clientLeft,h.y=f.y+n.clientTop}const d=i&&!c&&!o?YD(i,l,!0):Vo(0);return{width:r.width*u.x,height:r.height*u.y,x:r.x*u.x-l.scrollLeft*u.x+h.x+d.x,y:r.y*u.y-l.scrollTop*u.y+h.y+d.y}}function w5(e){return Array.from(e.getClientRects())}function b5(e){const t=Ho(e),r=bm(e),n=e.ownerDocument.body,s=_s(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=_s(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let i=-r.scrollLeft+J0(e);const a=-r.scrollTop;return Eo(n).direction==="rtl"&&(i+=_s(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:i,y:a}}function x5(e,t){const r=Ms(e),n=Ho(e),s=r.visualViewport;let o=n.clientWidth,i=n.clientHeight,a=0,l=0;if(s){o=s.width,i=s.height;const u=Q0();(!u||u&&t==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:o,height:i,x:a,y:l}}const M5=new Set(["absolute","fixed"]);function T5(e,t){const r=al(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Go(e)?pu(e):Vo(1),i=e.clientWidth*o.x,a=e.clientHeight*o.y,l=s*o.x,u=n*o.y;return{width:i,height:a,x:l,y:u}}function JS(e,t,r){let n;if(t==="viewport")n=x5(e,r);else if(t==="document")n=b5(Ho(e));else if(To(t))n=T5(t,r);else{const s=JD(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return Rp(n)}function ZD(e,t){const r=na(e);return r===t||!To(r)||Ou(r)?!1:Eo(r).position==="fixed"||ZD(r,t)}function E5(e,t){const r=t.get(e);if(r)return r;let n=Pd(e,[],!1).filter(a=>To(a)&&Wu(a)!=="body"),s=null;const o=Eo(e).position==="fixed";let i=o?na(e):e;for(;To(i)&&!Ou(i);){const a=Eo(i),l=q0(i);!l&&a.position==="fixed"&&(s=null),(o?!l&&!s:!l&&a.position==="static"&&!!s&&M5.has(s.position)||Kd(i)&&!l&&ZD(e,i))?n=n.filter(h=>h!==i):s=a,i=na(i)}return t.set(e,n),n}function P5(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const i=[...r==="clippingAncestors"?wm(t)?[]:E5(t,this._c):[].concat(r),n],a=i[0],l=i.reduce((u,h)=>{const c=JS(t,h,s);return u.top=_s(c.top,u.top),u.right=ra(c.right,u.right),u.bottom=ra(c.bottom,u.bottom),u.left=_s(c.left,u.left),u},JS(t,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function S5(e){const{width:t,height:r}=XD(e);return{width:t,height:r}}function C5(e,t,r){const n=Go(t),s=Ho(t),o=r==="fixed",i=al(e,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=Vo(0);function u(){l.x=J0(s)}if(n||!n&&!o)if((Wu(t)!=="body"||Kd(s))&&(a=bm(t)),n){const f=al(t,!0,o,t);l.x=f.x+t.clientLeft,l.y=f.y+t.clientTop}else s&&u();o&&!n&&s&&u();const h=s&&!n&&!o?YD(s,a):Vo(0),c=i.left+a.scrollLeft-l.x-h.x,d=i.top+a.scrollTop-l.y-h.y;return{x:c,y:d,width:i.width,height:i.height}}function L_(e){return Eo(e).position==="static"}function YS(e,t){if(!Go(e)||Eo(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Ho(e)===r&&(r=r.ownerDocument.body),r}function eF(e,t){const r=Ms(e);if(wm(e))return r;if(!Go(e)){let s=na(e);for(;s&&!Ou(s);){if(To(s)&&!L_(s))return s;s=na(s)}return r}let n=YS(e,t);for(;n&&c5(n)&&L_(n);)n=YS(n,t);return n&&Ou(n)&&L_(n)&&!q0(n)?r:n||m5(e)||r}const k5=async function(e){const t=this.getOffsetParent||eF,r=this.getDimensions,n=await r(e.floating);return{reference:C5(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function $5(e){return Eo(e).direction==="rtl"}const A5={convertOffsetParentRelativeRectToViewportRelativeRect:v5,getDocumentElement:Ho,getClippingRect:P5,getOffsetParent:eF,getElementRects:k5,getClientRects:w5,getDimensions:S5,getScale:pu,isElement:To,isRTL:$5};function tF(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function I5(e,t){let r=null,n;const s=Ho(e);function o(){var a;clearTimeout(n),(a=r)==null||a.disconnect(),r=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const u=e.getBoundingClientRect(),{left:h,top:c,width:d,height:f}=u;if(a||t(),!d||!f)return;const p=ff(c),m=ff(s.clientWidth-(h+d)),b=ff(s.clientHeight-(c+f)),g=ff(h),y={rootMargin:-p+"px "+-m+"px "+-b+"px "+-g+"px",threshold:_s(0,ra(1,l))||1};let v=!0;function M(E){const T=E[0].intersectionRatio;if(T!==l){if(!v)return i();T?i(!1,T):n=setTimeout(()=>{i(!1,1e-7)},1e3)}T===1&&!tF(u,e.getBoundingClientRect())&&i(),v=!1}try{r=new IntersectionObserver(M,{...y,root:s.ownerDocument})}catch{r=new IntersectionObserver(M,y)}r.observe(e)}return i(!0),o}function O5(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,u=X0(e),h=s||o?[...u?Pd(u):[],...Pd(t)]:[];h.forEach(g=>{s&&g.addEventListener("scroll",r,{passive:!0}),o&&g.addEventListener("resize",r)});const c=u&&a?I5(u,r):null;let d=-1,f=null;i&&(f=new ResizeObserver(g=>{let[_]=g;_&&_.target===u&&f&&(f.unobserve(t),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var y;(y=f)==null||y.observe(t)})),r()}),u&&!l&&f.observe(u),f.observe(t));let p,m=l?al(e):null;l&&b();function b(){const g=al(e);m&&!tF(m,g)&&r(),m=g,p=requestAnimationFrame(b)}return r(),()=>{var g;h.forEach(_=>{s&&_.removeEventListener("scroll",r),o&&_.removeEventListener("resize",r)}),c==null||c(),(g=f)==null||g.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const D5=s5,F5=o5,R5=t5,L5=a5,N5=r5,ZS=e5,j5=i5,z5=(e,t,r)=>{const n=new Map,s={platform:A5,...r},o={...s.platform,_c:n};return ZW(e,t,{...s,platform:o})};var B5=typeof document<"u",U5=function(){},np=B5?Q.useLayoutEffect:U5;function Lp(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!Lp(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!Lp(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function rF(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function eC(e,t){const r=rF(e);return Math.round(t*r)/r}function N_(e){const t=Q.useRef(e);return np(()=>{t.current=e}),t}function V5(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:i}={},transform:a=!0,whileElementsMounted:l,open:u}=e,[h,c]=Q.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[d,f]=Q.useState(n);Lp(d,n)||f(n);const[p,m]=Q.useState(null),[b,g]=Q.useState(null),_=Q.useCallback(W=>{W!==E.current&&(E.current=W,m(W))},[]),y=Q.useCallback(W=>{W!==T.current&&(T.current=W,g(W))},[]),v=o||p,M=i||b,E=Q.useRef(null),T=Q.useRef(null),S=Q.useRef(h),A=l!=null,I=N_(l),V=N_(s),N=N_(u),z=Q.useCallback(()=>{if(!E.current||!T.current)return;const W={placement:t,strategy:r,middleware:d};V.current&&(W.platform=V.current),z5(E.current,T.current,W).then(te=>{const le={...te,isPositioned:N.current!==!1};q.current&&!Lp(S.current,le)&&(S.current=le,Vd.flushSync(()=>{c(le)}))})},[d,t,r,V,N]);np(()=>{u===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,c(W=>({...W,isPositioned:!1})))},[u]);const q=Q.useRef(!1);np(()=>(q.current=!0,()=>{q.current=!1}),[]),np(()=>{if(v&&(E.current=v),M&&(T.current=M),v&&M){if(I.current)return I.current(v,M,z);z()}},[v,M,z,I,A]);const G=Q.useMemo(()=>({reference:E,floating:T,setReference:_,setFloating:y}),[_,y]),ee=Q.useMemo(()=>({reference:v,floating:M}),[v,M]),Y=Q.useMemo(()=>{const W={position:r,left:0,top:0};if(!ee.floating)return W;const te=eC(ee.floating,h.x),le=eC(ee.floating,h.y);return a?{...W,transform:"translate("+te+"px, "+le+"px)",...rF(ee.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:te,top:le}},[r,a,ee.floating,h.x,h.y]);return Q.useMemo(()=>({...h,update:z,refs:G,elements:ee,floatingStyles:Y}),[h,z,G,ee,Y])}const W5=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?ZS({element:n.current,padding:s}).fn(r):{}:n?ZS({element:n,padding:s}).fn(r):{}}}},G5=(e,t)=>({...D5(e),options:[e,t]}),H5=(e,t)=>({...F5(e),options:[e,t]}),K5=(e,t)=>({...j5(e),options:[e,t]}),q5=(e,t)=>({...R5(e),options:[e,t]}),Q5=(e,t)=>({...L5(e),options:[e,t]}),X5=(e,t)=>({...N5(e),options:[e,t]}),J5=(e,t)=>({...W5(e),options:[e,t]});var Y5="Arrow",nF=Q.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return J.jsx(hn.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:J.jsx("polygon",{points:"0,0 30,0 15,10"})})});nF.displayName=Y5;var Z5=nF;function e8(e){const[t,r]=Q.useState(void 0);return fi(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,a;if("borderBoxSize"in o){const l=o.borderBoxSize,u=Array.isArray(l)?l[0]:l;i=u.inlineSize,a=u.blockSize}else i=e.offsetWidth,a=e.offsetHeight;r({width:i,height:a})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var sF="Popper",[oF,iF]=Gd(sF),[$7,aF]=oF(sF),lF="PopperAnchor",uF=Q.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=aF(lF,r),i=Q.useRef(null),a=Yn(t,i);return Q.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:J.jsx(hn.div,{...s,ref:a})});uF.displayName=lF;var Y0="PopperContent",[t8,r8]=oF(Y0),cF=Q.forwardRef((e,t)=>{var we,De,Be,$e,se,F;const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:c="partial",hideWhenDetached:d=!1,updatePositionStrategy:f="optimized",onPlaced:p,...m}=e,b=aF(Y0,r),[g,_]=Q.useState(null),y=Yn(t,pe=>_(pe)),[v,M]=Q.useState(null),E=e8(v),T=(E==null?void 0:E.width)??0,S=(E==null?void 0:E.height)??0,A=n+(o!=="center"?"-"+o:""),I=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},V=Array.isArray(u)?u:[u],N=V.length>0,z={padding:I,boundary:V.filter(s8),altBoundary:N},{refs:q,floatingStyles:G,placement:ee,isPositioned:Y,middlewareData:W}=V5({strategy:"fixed",placement:A,whileElementsMounted:(...pe)=>O5(...pe,{animationFrame:f==="always"}),elements:{reference:b.anchor},middleware:[G5({mainAxis:s+S,alignmentAxis:i}),l&&H5({mainAxis:!0,crossAxis:!1,limiter:c==="partial"?K5():void 0,...z}),l&&q5({...z}),Q5({...z,apply:({elements:pe,rects:Ee,availableWidth:Me,availableHeight:Pe})=>{const{width:ye,height:ke}=Ee.reference,be=pe.floating.style;be.setProperty("--radix-popper-available-width",`${Me}px`),be.setProperty("--radix-popper-available-height",`${Pe}px`),be.setProperty("--radix-popper-anchor-width",`${ye}px`),be.setProperty("--radix-popper-anchor-height",`${ke}px`)}}),v&&J5({element:v,padding:a}),o8({arrowWidth:T,arrowHeight:S}),d&&X5({strategy:"referenceHidden",...z})]}),[te,le]=fF(ee),oe=Wo(p);fi(()=>{Y&&(oe==null||oe())},[Y,oe]);const U=(we=W.arrow)==null?void 0:we.x,R=(De=W.arrow)==null?void 0:De.y,X=((Be=W.arrow)==null?void 0:Be.centerOffset)!==0,[ce,ne]=Q.useState();return fi(()=>{g&&ne(window.getComputedStyle(g).zIndex)},[g]),J.jsx("div",{ref:q.setFloating,"data-radix-popper-content-wrapper":"",style:{...G,transform:Y?G.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ce,"--radix-popper-transform-origin":[($e=W.transformOrigin)==null?void 0:$e.x,(se=W.transformOrigin)==null?void 0:se.y].join(" "),...((F=W.hide)==null?void 0:F.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:J.jsx(t8,{scope:r,placedSide:te,onArrowChange:M,arrowX:U,arrowY:R,shouldHideArrow:X,children:J.jsx(hn.div,{"data-side":te,"data-align":le,...m,ref:y,style:{...m.style,animation:Y?void 0:"none"}})})})});cF.displayName=Y0;var dF="PopperArrow",n8={top:"bottom",right:"left",bottom:"top",left:"right"},hF=Q.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=r8(dF,n),i=n8[o.placedSide];return J.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:J.jsx(Z5,{...s,ref:r,style:{...s.style,display:"block"}})})});hF.displayName=dF;function s8(e){return e!==null}var o8=e=>({name:"transformOrigin",options:e,fn(t){var b,g,_;const{placement:r,rects:n,middlewareData:s}=t,i=((b=s.arrow)==null?void 0:b.centerOffset)!==0,a=i?0:e.arrowWidth,l=i?0:e.arrowHeight,[u,h]=fF(r),c={start:"0%",center:"50%",end:"100%"}[h],d=(((g=s.arrow)==null?void 0:g.x)??0)+a/2,f=(((_=s.arrow)==null?void 0:_.y)??0)+l/2;let p="",m="";return u==="bottom"?(p=i?c:`${d}px`,m=`${-l}px`):u==="top"?(p=i?c:`${d}px`,m=`${n.floating.height+l}px`):u==="right"?(p=`${-l}px`,m=i?c:`${f}px`):u==="left"&&(p=`${n.floating.width+l}px`,m=i?c:`${f}px`),{data:{x:p,y:m}}}});function fF(e){const[t,r="center"]=e.split("-");return[t,r]}var i8=uF,a8=cF,l8=hF,[xm,A7]=Gd("Tooltip",[iF]),Z0=iF(),pF="TooltipProvider",u8=700,tC="tooltip.open",[c8,mF]=xm(pF),gF=e=>{const{__scopeTooltip:t,delayDuration:r=u8,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:o}=e,i=Q.useRef(!0),a=Q.useRef(!1),l=Q.useRef(0);return Q.useEffect(()=>{const u=l.current;return()=>window.clearTimeout(u)},[]),J.jsx(c8,{scope:t,isOpenDelayedRef:i,delayDuration:r,onOpen:Q.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:Q.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,n)},[n]),isPointerInTransitRef:a,onPointerInTransitChange:Q.useCallback(u=>{a.current=u},[]),disableHoverableContent:s,children:o})};gF.displayName=pF;var _F="Tooltip",[I7,Mm]=xm(_F),sw="TooltipTrigger",d8=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=Mm(sw,r),o=mF(sw,r),i=Z0(r),a=Q.useRef(null),l=Yn(t,a,s.onTriggerChange),u=Q.useRef(!1),h=Q.useRef(!1),c=Q.useCallback(()=>u.current=!1,[]);return Q.useEffect(()=>()=>document.removeEventListener("pointerup",c),[c]),J.jsx(i8,{asChild:!0,...i,children:J.jsx(hn.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:l,onPointerMove:Dr(e.onPointerMove,d=>{d.pointerType!=="touch"&&!h.current&&!o.isPointerInTransitRef.current&&(s.onTriggerEnter(),h.current=!0)}),onPointerLeave:Dr(e.onPointerLeave,()=>{s.onTriggerLeave(),h.current=!1}),onPointerDown:Dr(e.onPointerDown,()=>{s.open&&s.onClose(),u.current=!0,document.addEventListener("pointerup",c,{once:!0})}),onFocus:Dr(e.onFocus,()=>{u.current||s.onOpen()}),onBlur:Dr(e.onBlur,s.onClose),onClick:Dr(e.onClick,s.onClose)})})});d8.displayName=sw;var h8="TooltipPortal",[O7,f8]=xm(h8,{forceMount:void 0}),Du="TooltipContent",yF=Q.forwardRef((e,t)=>{const r=f8(Du,e.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...o}=e,i=Mm(Du,e.__scopeTooltip);return J.jsx(Bu,{present:n||i.open,children:i.disableHoverableContent?J.jsx(vF,{side:s,...o,ref:t}):J.jsx(p8,{side:s,...o,ref:t})})}),p8=Q.forwardRef((e,t)=>{const r=Mm(Du,e.__scopeTooltip),n=mF(Du,e.__scopeTooltip),s=Q.useRef(null),o=Yn(t,s),[i,a]=Q.useState(null),{trigger:l,onClose:u}=r,h=s.current,{onPointerInTransitChange:c}=n,d=Q.useCallback(()=>{a(null),c(!1)},[c]),f=Q.useCallback((p,m)=>{const b=p.currentTarget,g={x:p.clientX,y:p.clientY},_=v8(g,b.getBoundingClientRect()),y=w8(g,_),v=b8(m.getBoundingClientRect()),M=M8([...y,...v]);a(M),c(!0)},[c]);return Q.useEffect(()=>()=>d(),[d]),Q.useEffect(()=>{if(l&&h){const p=b=>f(b,h),m=b=>f(b,l);return l.addEventListener("pointerleave",p),h.addEventListener("pointerleave",m),()=>{l.removeEventListener("pointerleave",p),h.removeEventListener("pointerleave",m)}}},[l,h,f,d]),Q.useEffect(()=>{if(i){const p=m=>{const b=m.target,g={x:m.clientX,y:m.clientY},_=(l==null?void 0:l.contains(b))||(h==null?void 0:h.contains(b)),y=!x8(g,i);_?d():y&&(d(),u())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,h,i,u,d]),J.jsx(vF,{...e,ref:o})}),[m8,g8]=xm(_F,{isInside:!1}),_8=dU("TooltipContent"),vF=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:o,onPointerDownOutside:i,...a}=e,l=Mm(Du,r),u=Z0(r),{onClose:h}=l;return Q.useEffect(()=>(document.addEventListener(tC,h),()=>document.removeEventListener(tC,h)),[h]),Q.useEffect(()=>{if(l.trigger){const c=d=>{const f=d.target;f!=null&&f.contains(l.trigger)&&h()};return window.addEventListener("scroll",c,{capture:!0}),()=>window.removeEventListener("scroll",c,{capture:!0})}},[l.trigger,h]),J.jsx(gm,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:c=>c.preventDefault(),onDismiss:h,children:J.jsxs(a8,{"data-state":l.stateAttribute,...u,...a,ref:t,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[J.jsx(_8,{children:n}),J.jsx(m8,{scope:r,isInside:!0,children:J.jsx(FU,{id:l.contentId,role:"tooltip",children:s||n})})]})})});yF.displayName=Du;var wF="TooltipArrow",y8=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=Z0(r);return g8(wF,r).isInside?null:J.jsx(l8,{...s,...n,ref:t})});y8.displayName=wF;function v8(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),o=Math.abs(t.left-e.x);switch(Math.min(r,n,s,o)){case o:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function w8(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function b8(e){const{top:t,right:r,bottom:n,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:n},{x:s,y:n}]}function x8(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const a=t[o],l=t[i],u=a.x,h=a.y,c=l.x,d=l.y;h>n!=d>n&&r<(c-u)*(n-h)/(d-h)+u&&(s=!s)}return s}function M8(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),T8(t)}function T8(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const s=e[n];for(;t.length>=2;){const o=t[t.length-1],i=t[t.length-2];if((o.x-i.x)*(s.y-i.y)>=(o.y-i.y)*(s.x-i.x))t.pop();else break}t.push(s)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const s=e[n];for(;r.length>=2;){const o=r[r.length-1],i=r[r.length-2];if((o.x-i.x)*(s.y-i.y)>=(o.y-i.y)*(s.x-i.x))r.pop();else break}r.push(s)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var E8=gF,bF=yF;const P8=E8,S8=Q.forwardRef(({className:e,sideOffset:t=4,...r},n)=>J.jsx(bF,{ref:n,sideOffset:t,className:ts("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));S8.displayName=bF.displayName;var Tm=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Em=typeof window>"u"||"Deno"in globalThis;function co(){}function C8(e,t){return typeof e=="function"?e(t):e}function k8(e){return typeof e=="number"&&e>=0&&e!==1/0}function $8(e,t){return Math.max(e+(t||0)-Date.now(),0)}function ow(e,t){return typeof e=="function"?e(t):e}function A8(e,t){return typeof e=="function"?e(t):e}function rC(e,t){const{type:r="all",exact:n,fetchStatus:s,predicate:o,queryKey:i,stale:a}=e;if(i){if(n){if(t.queryHash!==eb(i,t.options))return!1}else if(!Cd(t.queryKey,i))return!1}if(r!=="all"){const l=t.isActive();if(r==="active"&&!l||r==="inactive"&&l)return!1}return!(typeof a=="boolean"&&t.isStale()!==a||s&&s!==t.state.fetchStatus||o&&!o(t))}function nC(e,t){const{exact:r,status:n,predicate:s,mutationKey:o}=e;if(o){if(!t.options.mutationKey)return!1;if(r){if(Sd(t.options.mutationKey)!==Sd(o))return!1}else if(!Cd(t.options.mutationKey,o))return!1}return!(n&&t.state.status!==n||s&&!s(t))}function eb(e,t){return((t==null?void 0:t.queryKeyHashFn)||Sd)(e)}function Sd(e){return JSON.stringify(e,(t,r)=>iw(r)?Object.keys(r).sort().reduce((n,s)=>(n[s]=r[s],n),{}):r)}function Cd(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>Cd(e[r],t[r])):!1}function xF(e,t){if(e===t)return e;const r=sC(e)&&sC(t);if(r||iw(e)&&iw(t)){const n=r?e:Object.keys(e),s=n.length,o=r?t:Object.keys(t),i=o.length,a=r?[]:{},l=new Set(n);let u=0;for(let h=0;h<i;h++){const c=r?h:o[h];(!r&&l.has(c)||r)&&e[c]===void 0&&t[c]===void 0?(a[c]=void 0,u++):(a[c]=xF(e[c],t[c]),a[c]===e[c]&&e[c]!==void 0&&u++)}return s===i&&u===s?e:a}return t}function sC(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function iw(e){if(!oC(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!oC(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function oC(e){return Object.prototype.toString.call(e)==="[object Object]"}function I8(e){return new Promise(t=>{setTimeout(t,e)})}function O8(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?xF(e,t):t}function D8(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function F8(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var tb=Symbol();function MF(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===tb?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var qa,Ni,yu,DA,R8=(DA=class extends Tm{constructor(){super();ir(this,qa);ir(this,Ni);ir(this,yu);Ut(this,yu,t=>{if(!Em&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Le(this,Ni)||this.setEventListener(Le(this,yu))}onUnsubscribe(){var t;this.hasListeners()||((t=Le(this,Ni))==null||t.call(this),Ut(this,Ni,void 0))}setEventListener(t){var r;Ut(this,yu,t),(r=Le(this,Ni))==null||r.call(this),Ut(this,Ni,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){Le(this,qa)!==t&&(Ut(this,qa,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Le(this,qa)=="boolean"?Le(this,qa):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},qa=new WeakMap,Ni=new WeakMap,yu=new WeakMap,DA),TF=new R8,vu,ji,wu,FA,L8=(FA=class extends Tm{constructor(){super();ir(this,vu,!0);ir(this,ji);ir(this,wu);Ut(this,wu,t=>{if(!Em&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){Le(this,ji)||this.setEventListener(Le(this,wu))}onUnsubscribe(){var t;this.hasListeners()||((t=Le(this,ji))==null||t.call(this),Ut(this,ji,void 0))}setEventListener(t){var r;Ut(this,wu,t),(r=Le(this,ji))==null||r.call(this),Ut(this,ji,t(this.setOnline.bind(this)))}setOnline(t){Le(this,vu)!==t&&(Ut(this,vu,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return Le(this,vu)}},vu=new WeakMap,ji=new WeakMap,wu=new WeakMap,FA),Np=new L8;function N8(){let e,t;const r=new Promise((s,o)=>{e=s,t=o});r.status="pending",r.catch(()=>{});function n(s){Object.assign(r,s),delete r.resolve,delete r.reject}return r.resolve=s=>{n({status:"fulfilled",value:s}),e(s)},r.reject=s=>{n({status:"rejected",reason:s}),t(s)},r}function j8(e){return Math.min(1e3*2**e,3e4)}function EF(e){return(e??"online")==="online"?Np.isOnline():!0}var PF=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function j_(e){return e instanceof PF}function SF(e){let t=!1,r=0,n=!1,s;const o=N8(),i=m=>{var b;n||(d(new PF(m)),(b=e.abort)==null||b.call(e))},a=()=>{t=!0},l=()=>{t=!1},u=()=>TF.isFocused()&&(e.networkMode==="always"||Np.isOnline())&&e.canRun(),h=()=>EF(e.networkMode)&&e.canRun(),c=m=>{var b;n||(n=!0,(b=e.onSuccess)==null||b.call(e,m),s==null||s(),o.resolve(m))},d=m=>{var b;n||(n=!0,(b=e.onError)==null||b.call(e,m),s==null||s(),o.reject(m))},f=()=>new Promise(m=>{var b;s=g=>{(n||u())&&m(g)},(b=e.onPause)==null||b.call(e)}).then(()=>{var m;s=void 0,n||(m=e.onContinue)==null||m.call(e)}),p=()=>{if(n)return;let m;const b=r===0?e.initialPromise:void 0;try{m=b??e.fn()}catch(g){m=Promise.reject(g)}Promise.resolve(m).then(c).catch(g=>{var E;if(n)return;const _=e.retry??(Em?0:3),y=e.retryDelay??j8,v=typeof y=="function"?y(r,g):y,M=_===!0||typeof _=="number"&&r<_||typeof _=="function"&&_(r,g);if(t||!M){d(g);return}r++,(E=e.onFail)==null||E.call(e,r,g),I8(v).then(()=>u()?void 0:f()).then(()=>{t?d(g):p()})})};return{promise:o,cancel:i,continue:()=>(s==null||s(),o),cancelRetry:a,continueRetry:l,canStart:h,start:()=>(h()?p():f().then(p),o)}}var z8=e=>setTimeout(e,0);function B8(){let e=[],t=0,r=a=>{a()},n=a=>{a()},s=z8;const o=a=>{t?e.push(a):s(()=>{r(a)})},i=()=>{const a=e;e=[],a.length&&s(()=>{n(()=>{a.forEach(l=>{r(l)})})})};return{batch:a=>{let l;t++;try{l=a()}finally{t--,t||i()}return l},batchCalls:a=>(...l)=>{o(()=>{a(...l)})},schedule:o,setNotifyFunction:a=>{r=a},setBatchNotifyFunction:a=>{n=a},setScheduler:a=>{s=a}}}var Qn=B8(),Qa,RA,CF=(RA=class{constructor(){ir(this,Qa)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),k8(this.gcTime)&&Ut(this,Qa,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Em?1/0:5*60*1e3))}clearGcTimeout(){Le(this,Qa)&&(clearTimeout(Le(this,Qa)),Ut(this,Qa,void 0))}},Qa=new WeakMap,RA),bu,Xa,js,Ja,jn,Rd,Ya,fo,ei,LA,U8=(LA=class extends CF{constructor(t){super();ir(this,fo);ir(this,bu);ir(this,Xa);ir(this,js);ir(this,Ja);ir(this,jn);ir(this,Rd);ir(this,Ya);Ut(this,Ya,!1),Ut(this,Rd,t.defaultOptions),this.setOptions(t.options),this.observers=[],Ut(this,Ja,t.client),Ut(this,js,Le(this,Ja).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Ut(this,bu,W8(this.options)),this.state=t.state??Le(this,bu),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Le(this,jn))==null?void 0:t.promise}setOptions(t){this.options={...Le(this,Rd),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Le(this,js).remove(this)}setData(t,r){const n=O8(this.state.data,t,this.options);return Rn(this,fo,ei).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Rn(this,fo,ei).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,s;const r=(n=Le(this,jn))==null?void 0:n.promise;return(s=Le(this,jn))==null||s.cancel(t),r?r.then(co).catch(co):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Le(this,bu))}isActive(){return this.observers.some(t=>A8(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===tb||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ow(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!$8(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Le(this,jn))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Le(this,jn))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Le(this,js).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Le(this,jn)&&(Le(this,Ya)?Le(this,jn).cancel({revert:!0}):Le(this,jn).cancelRetry()),this.scheduleGc()),Le(this,js).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Rn(this,fo,ei).call(this,{type:"invalidate"})}fetch(t,r){var u,h,c;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Le(this,jn))return Le(this,jn).continueRetry(),Le(this,jn).promise}if(t&&this.setOptions(t),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const n=new AbortController,s=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(Ut(this,Ya,!0),n.signal)})},o=()=>{const d=MF(this.options,r),p=(()=>{const m={client:Le(this,Ja),queryKey:this.queryKey,meta:this.meta};return s(m),m})();return Ut(this,Ya,!1),this.options.persister?this.options.persister(d,p,this):d(p)},a=(()=>{const d={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:Le(this,Ja),state:this.state,fetchFn:o};return s(d),d})();(u=this.options.behavior)==null||u.onFetch(a,this),Ut(this,Xa,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=a.fetchOptions)==null?void 0:h.meta))&&Rn(this,fo,ei).call(this,{type:"fetch",meta:(c=a.fetchOptions)==null?void 0:c.meta});const l=d=>{var f,p,m,b;j_(d)&&d.silent||Rn(this,fo,ei).call(this,{type:"error",error:d}),j_(d)||((p=(f=Le(this,js).config).onError)==null||p.call(f,d,this),(b=(m=Le(this,js).config).onSettled)==null||b.call(m,this.state.data,d,this)),this.scheduleGc()};return Ut(this,jn,SF({initialPromise:r==null?void 0:r.initialPromise,fn:a.fetchFn,abort:n.abort.bind(n),onSuccess:d=>{var f,p,m,b;if(d===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(g){l(g);return}(p=(f=Le(this,js).config).onSuccess)==null||p.call(f,d,this),(b=(m=Le(this,js).config).onSettled)==null||b.call(m,d,this.state.error,this),this.scheduleGc()},onError:l,onFail:(d,f)=>{Rn(this,fo,ei).call(this,{type:"failed",failureCount:d,error:f})},onPause:()=>{Rn(this,fo,ei).call(this,{type:"pause"})},onContinue:()=>{Rn(this,fo,ei).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),Le(this,jn).start()}},bu=new WeakMap,Xa=new WeakMap,js=new WeakMap,Ja=new WeakMap,jn=new WeakMap,Rd=new WeakMap,Ya=new WeakMap,fo=new WeakSet,ei=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...V8(n.data,this.options),fetchMeta:t.meta??null};case"success":return Ut(this,Xa,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=t.error;return j_(s)&&s.revert&&Le(this,Xa)?{...Le(this,Xa),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),Qn.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),Le(this,js).notify({query:this,type:"updated",action:t})})},LA);function V8(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:EF(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function W8(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Ro,NA,G8=(NA=class extends Tm{constructor(t={}){super();ir(this,Ro);this.config=t,Ut(this,Ro,new Map)}build(t,r,n){const s=r.queryKey,o=r.queryHash??eb(s,r);let i=this.get(o);return i||(i=new U8({client:t,queryKey:s,queryHash:o,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(s)}),this.add(i)),i}add(t){Le(this,Ro).has(t.queryHash)||(Le(this,Ro).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Le(this,Ro).get(t.queryHash);r&&(t.destroy(),r===t&&Le(this,Ro).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Qn.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Le(this,Ro).get(t)}getAll(){return[...Le(this,Ro).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>rC(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>rC(t,n)):r}notify(t){Qn.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Qn.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Qn.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Ro=new WeakMap,NA),Lo,Kn,Za,No,Ai,jA,H8=(jA=class extends CF{constructor(t){super();ir(this,No);ir(this,Lo);ir(this,Kn);ir(this,Za);this.mutationId=t.mutationId,Ut(this,Kn,t.mutationCache),Ut(this,Lo,[]),this.state=t.state||K8(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Le(this,Lo).includes(t)||(Le(this,Lo).push(t),this.clearGcTimeout(),Le(this,Kn).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Ut(this,Lo,Le(this,Lo).filter(r=>r!==t)),this.scheduleGc(),Le(this,Kn).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Le(this,Lo).length||(this.state.status==="pending"?this.scheduleGc():Le(this,Kn).remove(this))}continue(){var t;return((t=Le(this,Za))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,i,a,l,u,h,c,d,f,p,m,b,g,_,y,v,M,E,T,S;const r=()=>{Rn(this,No,Ai).call(this,{type:"continue"})};Ut(this,Za,SF({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(A,I)=>{Rn(this,No,Ai).call(this,{type:"failed",failureCount:A,error:I})},onPause:()=>{Rn(this,No,Ai).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Le(this,Kn).canRun(this)}));const n=this.state.status==="pending",s=!Le(this,Za).canStart();try{if(n)r();else{Rn(this,No,Ai).call(this,{type:"pending",variables:t,isPaused:s}),await((i=(o=Le(this,Kn).config).onMutate)==null?void 0:i.call(o,t,this));const I=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,t));I!==this.state.context&&Rn(this,No,Ai).call(this,{type:"pending",context:I,variables:t,isPaused:s})}const A=await Le(this,Za).start();return await((h=(u=Le(this,Kn).config).onSuccess)==null?void 0:h.call(u,A,t,this.state.context,this)),await((d=(c=this.options).onSuccess)==null?void 0:d.call(c,A,t,this.state.context)),await((p=(f=Le(this,Kn).config).onSettled)==null?void 0:p.call(f,A,null,this.state.variables,this.state.context,this)),await((b=(m=this.options).onSettled)==null?void 0:b.call(m,A,null,t,this.state.context)),Rn(this,No,Ai).call(this,{type:"success",data:A}),A}catch(A){try{throw await((_=(g=Le(this,Kn).config).onError)==null?void 0:_.call(g,A,t,this.state.context,this)),await((v=(y=this.options).onError)==null?void 0:v.call(y,A,t,this.state.context)),await((E=(M=Le(this,Kn).config).onSettled)==null?void 0:E.call(M,void 0,A,this.state.variables,this.state.context,this)),await((S=(T=this.options).onSettled)==null?void 0:S.call(T,void 0,A,t,this.state.context)),A}finally{Rn(this,No,Ai).call(this,{type:"error",error:A})}}finally{Le(this,Kn).runNext(this)}}},Lo=new WeakMap,Kn=new WeakMap,Za=new WeakMap,No=new WeakSet,Ai=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Qn.batch(()=>{Le(this,Lo).forEach(n=>{n.onMutationUpdate(t)}),Le(this,Kn).notify({mutation:this,type:"updated",action:t})})},jA);function K8(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var si,po,Ld,zA,q8=(zA=class extends Tm{constructor(t={}){super();ir(this,si);ir(this,po);ir(this,Ld);this.config=t,Ut(this,si,new Set),Ut(this,po,new Map),Ut(this,Ld,0)}build(t,r,n){const s=new H8({mutationCache:this,mutationId:++Gh(this,Ld)._,options:t.defaultMutationOptions(r),state:n});return this.add(s),s}add(t){Le(this,si).add(t);const r=pf(t);if(typeof r=="string"){const n=Le(this,po).get(r);n?n.push(t):Le(this,po).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Le(this,si).delete(t)){const r=pf(t);if(typeof r=="string"){const n=Le(this,po).get(r);if(n)if(n.length>1){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}else n[0]===t&&Le(this,po).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=pf(t);if(typeof r=="string"){const n=Le(this,po).get(r),s=n==null?void 0:n.find(o=>o.state.status==="pending");return!s||s===t}else return!0}runNext(t){var n;const r=pf(t);if(typeof r=="string"){const s=(n=Le(this,po).get(r))==null?void 0:n.find(o=>o!==t&&o.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Qn.batch(()=>{Le(this,si).forEach(t=>{this.notify({type:"removed",mutation:t})}),Le(this,si).clear(),Le(this,po).clear()})}getAll(){return Array.from(Le(this,si))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>nC(r,n))}findAll(t={}){return this.getAll().filter(r=>nC(t,r))}notify(t){Qn.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Qn.batch(()=>Promise.all(t.map(r=>r.continue().catch(co))))}},si=new WeakMap,po=new WeakMap,Ld=new WeakMap,zA);function pf(e){var t;return(t=e.options.scope)==null?void 0:t.id}function iC(e){return{onFetch:(t,r)=>{var h,c,d,f,p;const n=t.options,s=(d=(c=(h=t.fetchOptions)==null?void 0:h.meta)==null?void 0:c.fetchMore)==null?void 0:d.direction,o=((f=t.state.data)==null?void 0:f.pages)||[],i=((p=t.state.data)==null?void 0:p.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const u=async()=>{let m=!1;const b=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(t.signal.aborted?m=!0:t.signal.addEventListener("abort",()=>{m=!0}),t.signal)})},g=MF(t.options,t.fetchOptions),_=async(y,v,M)=>{if(m)return Promise.reject();if(v==null&&y.pages.length)return Promise.resolve(y);const T=(()=>{const V={client:t.client,queryKey:t.queryKey,pageParam:v,direction:M?"backward":"forward",meta:t.options.meta};return b(V),V})(),S=await g(T),{maxPages:A}=t.options,I=M?F8:D8;return{pages:I(y.pages,S,A),pageParams:I(y.pageParams,v,A)}};if(s&&o.length){const y=s==="backward",v=y?Q8:aC,M={pages:o,pageParams:i},E=v(n,M);a=await _(M,E,y)}else{const y=e??o.length;do{const v=l===0?i[0]??n.initialPageParam:aC(n,a);if(l>0&&v==null)break;a=await _(a,v),l++}while(l<y)}return a};t.options.persister?t.fetchFn=()=>{var m,b;return(b=(m=t.options).persister)==null?void 0:b.call(m,u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=u}}}function aC(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Q8(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var Xr,zi,Bi,xu,Mu,Ui,Tu,Eu,BA,X8=(BA=class{constructor(e={}){ir(this,Xr);ir(this,zi);ir(this,Bi);ir(this,xu);ir(this,Mu);ir(this,Ui);ir(this,Tu);ir(this,Eu);Ut(this,Xr,e.queryCache||new G8),Ut(this,zi,e.mutationCache||new q8),Ut(this,Bi,e.defaultOptions||{}),Ut(this,xu,new Map),Ut(this,Mu,new Map),Ut(this,Ui,0)}mount(){Gh(this,Ui)._++,Le(this,Ui)===1&&(Ut(this,Tu,TF.subscribe(async e=>{e&&(await this.resumePausedMutations(),Le(this,Xr).onFocus())})),Ut(this,Eu,Np.subscribe(async e=>{e&&(await this.resumePausedMutations(),Le(this,Xr).onOnline())})))}unmount(){var e,t;Gh(this,Ui)._--,Le(this,Ui)===0&&((e=Le(this,Tu))==null||e.call(this),Ut(this,Tu,void 0),(t=Le(this,Eu))==null||t.call(this),Ut(this,Eu,void 0))}isFetching(e){return Le(this,Xr).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Le(this,zi).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Le(this,Xr).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Le(this,Xr).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(ow(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Le(this,Xr).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),s=Le(this,Xr).get(n.queryHash),o=s==null?void 0:s.state.data,i=C8(t,o);if(i!==void 0)return Le(this,Xr).build(this,n).setData(i,{...r,manual:!0})}setQueriesData(e,t,r){return Qn.batch(()=>Le(this,Xr).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Le(this,Xr).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Le(this,Xr);Qn.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Le(this,Xr);return Qn.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=Qn.batch(()=>Le(this,Xr).findAll(e).map(s=>s.cancel(r)));return Promise.all(n).then(co).catch(co)}invalidateQueries(e,t={}){return Qn.batch(()=>(Le(this,Xr).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=Qn.batch(()=>Le(this,Xr).findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,r);return r.throwOnError||(o=o.catch(co)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(co)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Le(this,Xr).build(this,t);return r.isStaleByTime(ow(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(co).catch(co)}fetchInfiniteQuery(e){return e.behavior=iC(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(co).catch(co)}ensureInfiniteQueryData(e){return e.behavior=iC(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Np.isOnline()?Le(this,zi).resumePausedMutations():Promise.resolve()}getQueryCache(){return Le(this,Xr)}getMutationCache(){return Le(this,zi)}getDefaultOptions(){return Le(this,Bi)}setDefaultOptions(e){Ut(this,Bi,e)}setQueryDefaults(e,t){Le(this,xu).set(Sd(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Le(this,xu).values()],r={};return t.forEach(n=>{Cd(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Le(this,Mu).set(Sd(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Le(this,Mu).values()],r={};return t.forEach(n=>{Cd(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Le(this,Bi).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=eb(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===tb&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Le(this,Bi).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Le(this,Xr).clear(),Le(this,zi).clear()}},Xr=new WeakMap,zi=new WeakMap,Bi=new WeakMap,xu=new WeakMap,Mu=new WeakMap,Ui=new WeakMap,Tu=new WeakMap,Eu=new WeakMap,BA),J8=Q.createContext(void 0),Y8=({client:e,children:t})=>(Q.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),J.jsx(J8.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jp(){return jp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jp.apply(this,arguments)}var Gi;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Gi||(Gi={}));const lC="popstate";function Z8(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:i,hash:a}=n.location;return aw("",{pathname:o,search:i,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:$F(s)}return tG(t,r,null,e)}function cs(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function kF(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function eG(){return Math.random().toString(36).substr(2,8)}function uC(e,t){return{usr:e.state,key:e.key,idx:t}}function aw(e,t,r,n){return r===void 0&&(r=null),jp({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Pm(t):t,{state:r,key:t&&t.key||n||eG()})}function $F(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Pm(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function tG(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,i=s.history,a=Gi.Pop,l=null,u=h();u==null&&(u=0,i.replaceState(jp({},i.state,{idx:u}),""));function h(){return(i.state||{idx:null}).idx}function c(){a=Gi.Pop;let b=h(),g=b==null?null:b-u;u=b,l&&l({action:a,location:m.location,delta:g})}function d(b,g){a=Gi.Push;let _=aw(m.location,b,g);u=h()+1;let y=uC(_,u),v=m.createHref(_);try{i.pushState(y,"",v)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(v)}o&&l&&l({action:a,location:m.location,delta:1})}function f(b,g){a=Gi.Replace;let _=aw(m.location,b,g);u=h();let y=uC(_,u),v=m.createHref(_);i.replaceState(y,"",v),o&&l&&l({action:a,location:m.location,delta:0})}function p(b){let g=s.location.origin!=="null"?s.location.origin:s.location.href,_=typeof b=="string"?b:$F(b);return _=_.replace(/ $/,"%20"),cs(g,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,g)}let m={get action(){return a},get location(){return e(s,i)},listen(b){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(lC,c),l=b,()=>{s.removeEventListener(lC,c),l=null}},createHref(b){return t(s,b)},createURL:p,encodeLocation(b){let g=p(b);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:d,replace:f,go(b){return i.go(b)}};return m}var cC;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(cC||(cC={}));function rG(e,t,r){return r===void 0&&(r="/"),nG(e,t,r,!1)}function nG(e,t,r,n){let s=typeof t=="string"?Pm(t):t,o=OF(s.pathname||"/",r);if(o==null)return null;let i=AF(e);sG(i);let a=null;for(let l=0;a==null&&l<i.length;++l){let u=mG(o);a=fG(i[l],u,n)}return a}function AF(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,i,a)=>{let l={relativePath:a===void 0?o.path||"":a,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(cs(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(n.length));let u=mu([n,l.relativePath]),h=r.concat(l);o.children&&o.children.length>0&&(cs(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),AF(o.children,t,h,u)),!(o.path==null&&!o.index)&&t.push({path:u,score:dG(u,o.index),routesMeta:h})};return e.forEach((o,i)=>{var a;if(o.path===""||!((a=o.path)!=null&&a.includes("?")))s(o,i);else for(let l of IF(o.path))s(o,i,l)}),t}function IF(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let i=IF(n.join("/")),a=[];return a.push(...i.map(l=>l===""?o:[o,l].join("/"))),s&&a.push(...i),a.map(l=>e.startsWith("/")&&l===""?"/":l)}function sG(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:hG(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const oG=/^:[\w-]+$/,iG=3,aG=2,lG=1,uG=10,cG=-2,dC=e=>e==="*";function dG(e,t){let r=e.split("/"),n=r.length;return r.some(dC)&&(n+=cG),t&&(n+=aG),r.filter(s=>!dC(s)).reduce((s,o)=>s+(oG.test(o)?iG:o===""?lG:uG),n)}function hG(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function fG(e,t,r){let{routesMeta:n}=e,s={},o="/",i=[];for(let a=0;a<n.length;++a){let l=n[a],u=a===n.length-1,h=o==="/"?t:t.slice(o.length)||"/",c=hC({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},h),d=l.route;if(!c&&u&&r&&!n[n.length-1].route.index&&(c=hC({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!c)return null;Object.assign(s,c.params),i.push({params:s,pathname:mu([o,c.pathname]),pathnameBase:gG(mu([o,c.pathnameBase])),route:d}),c.pathnameBase!=="/"&&(o=mu([o,c.pathnameBase]))}return i}function hC(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=pG(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],i=o.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:n.reduce((u,h,c)=>{let{paramName:d,isOptional:f}=h;if(d==="*"){let m=a[c]||"";i=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const p=a[c];return f&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:i,pattern:e}}function pG(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),kF(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function mG(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return kF(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function OF(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}const mu=e=>e.join("/").replace(/\/\/+/g,"/"),gG=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function _G(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const DF=["post","put","patch","delete"];new Set(DF);const yG=["get",...DF];new Set(yG);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zp(){return zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zp.apply(this,arguments)}const vG=Q.createContext(null),wG=Q.createContext(null),FF=Q.createContext(null),Sm=Q.createContext(null),Cm=Q.createContext({outlet:null,matches:[],isDataRoute:!1}),RF=Q.createContext(null);function rb(){return Q.useContext(Sm)!=null}function LF(){return rb()||cs(!1),Q.useContext(Sm).location}function bG(e,t){return xG(e,t)}function xG(e,t,r,n){rb()||cs(!1);let{navigator:s}=Q.useContext(FF),{matches:o}=Q.useContext(Cm),i=o[o.length-1],a=i?i.params:{};i&&i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let u=LF(),h;if(t){var c;let b=typeof t=="string"?Pm(t):t;l==="/"||(c=b.pathname)!=null&&c.startsWith(l)||cs(!1),h=b}else h=u;let d=h.pathname||"/",f=d;if(l!=="/"){let b=l.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(b.length).join("/")}let p=rG(e,{pathname:f}),m=SG(p&&p.map(b=>Object.assign({},b,{params:Object.assign({},a,b.params),pathname:mu([l,s.encodeLocation?s.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?l:mu([l,s.encodeLocation?s.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),o,r,n);return t&&m?Q.createElement(Sm.Provider,{value:{location:zp({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Gi.Pop}},m):m}function MG(){let e=AG(),t=_G(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},t),r?Q.createElement("pre",{style:s},r):null,null)}const TG=Q.createElement(MG,null);class EG extends Q.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?Q.createElement(Cm.Provider,{value:this.props.routeContext},Q.createElement(RF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function PG(e){let{routeContext:t,match:r,children:n}=e,s=Q.useContext(vG);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),Q.createElement(Cm.Provider,{value:t},n)}function SG(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let i=e,a=(s=r)==null?void 0:s.errors;if(a!=null){let h=i.findIndex(c=>c.route.id&&(a==null?void 0:a[c.route.id])!==void 0);h>=0||cs(!1),i=i.slice(0,Math.min(i.length,h+1))}let l=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let h=0;h<i.length;h++){let c=i[h];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(u=h),c.route.id){let{loaderData:d,errors:f}=r,p=c.route.loader&&d[c.route.id]===void 0&&(!f||f[c.route.id]===void 0);if(c.route.lazy||p){l=!0,u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}return i.reduceRight((h,c,d)=>{let f,p=!1,m=null,b=null;r&&(f=a&&c.route.id?a[c.route.id]:void 0,m=c.route.errorElement||TG,l&&(u<0&&d===0?(p=!0,b=null):u===d&&(p=!0,b=c.route.hydrateFallbackElement||null)));let g=t.concat(i.slice(0,d+1)),_=()=>{let y;return f?y=m:p?y=b:c.route.Component?y=Q.createElement(c.route.Component,null):c.route.element?y=c.route.element:y=h,Q.createElement(PG,{match:c,routeContext:{outlet:h,matches:g,isDataRoute:r!=null},children:y})};return r&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?Q.createElement(EG,{location:r.location,revalidation:r.revalidation,component:m,error:f,children:_(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):_()},null)}var lw=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(lw||{});function CG(e){let t=Q.useContext(wG);return t||cs(!1),t}function kG(e){let t=Q.useContext(Cm);return t||cs(!1),t}function $G(e){let t=kG(),r=t.matches[t.matches.length-1];return r.route.id||cs(!1),r.route.id}function AG(){var e;let t=Q.useContext(RF),r=CG(lw.UseRouteError),n=$G(lw.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function IG(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function uw(e){cs(!1)}function OG(e){let{basename:t="/",children:r=null,location:n,navigationType:s=Gi.Pop,navigator:o,static:i=!1,future:a}=e;rb()&&cs(!1);let l=t.replace(/^\/*/,"/"),u=Q.useMemo(()=>({basename:l,navigator:o,static:i,future:zp({v7_relativeSplatPath:!1},a)}),[l,a,o,i]);typeof n=="string"&&(n=Pm(n));let{pathname:h="/",search:c="",hash:d="",state:f=null,key:p="default"}=n,m=Q.useMemo(()=>{let b=OF(h,l);return b==null?null:{location:{pathname:b,search:c,hash:d,state:f,key:p},navigationType:s}},[l,h,c,d,f,p,s]);return m==null?null:Q.createElement(FF.Provider,{value:u},Q.createElement(Sm.Provider,{children:r,value:m}))}function DG(e){let{children:t,location:r}=e;return bG(cw(t),r)}new Promise(()=>{});function cw(e,t){t===void 0&&(t=[]);let r=[];return Q.Children.forEach(e,(n,s)=>{if(!Q.isValidElement(n))return;let o=[...t,s];if(n.type===Q.Fragment){r.push.apply(r,cw(n.props.children,o));return}n.type!==uw&&cs(!1),!n.props.index||!n.props.children||cs(!1);let i={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(i.children=cw(n.props.children,o)),r.push(i)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const FG="6";try{window.__reactRouterVersion=FG}catch{}const RG="startTransition",fC=qw[RG];function LG(e){let{basename:t,children:r,future:n,window:s}=e,o=Q.useRef();o.current==null&&(o.current=Z8({window:s,v5Compat:!0}));let i=o.current,[a,l]=Q.useState({action:i.action,location:i.location}),{v7_startTransition:u}=n||{},h=Q.useCallback(c=>{u&&fC?fC(()=>l(c)):l(c)},[l,u]);return Q.useLayoutEffect(()=>i.listen(h),[i,h]),Q.useEffect(()=>IG(n),[n]),Q.createElement(OG,{basename:t,children:r,location:a.location,navigationType:a.action,navigator:i,future:n})}var pC;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(pC||(pC={}));var mC;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(mC||(mC={}));const NG=V0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Bp=Q.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const i=n?uU:"button";return J.jsx(i,{className:ts(NG({variant:t,size:r,className:e})),ref:o,...s})});Bp.displayName="Button";const NF=Q.forwardRef(({className:e,type:t,...r},n)=>J.jsx("input",{type:t,className:ts("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));NF.displayName="Input";var dw=function(e,t){return dw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},dw(e,t)};function jF(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");dw(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Us=function(){return Us=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Us.apply(this,arguments)};function la(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function zF(e,t,r,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function BF(e,t){return function(r,n){t(r,n,e)}}function UF(e,t,r,n,s,o){function i(g){if(g!==void 0&&typeof g!="function")throw new TypeError("Function expected");return g}for(var a=n.kind,l=a==="getter"?"get":a==="setter"?"set":"value",u=!t&&e?n.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),c,d=!1,f=r.length-1;f>=0;f--){var p={};for(var m in n)p[m]=m==="access"?{}:n[m];for(var m in n.access)p.access[m]=n.access[m];p.addInitializer=function(g){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(g||null))};var b=(0,r[f])(a==="accessor"?{get:h.get,set:h.set}:h[l],p);if(a==="accessor"){if(b===void 0)continue;if(b===null||typeof b!="object")throw new TypeError("Object expected");(c=i(b.get))&&(h.get=c),(c=i(b.set))&&(h.set=c),(c=i(b.init))&&s.unshift(c)}else(c=i(b))&&(a==="field"?s.unshift(c):h[l]=c)}u&&Object.defineProperty(u,n.name,h),d=!0}function VF(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function WF(e){return typeof e=="symbol"?e:"".concat(e)}function GF(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function HF(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function _t(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function a(h){try{u(n.next(h))}catch(c){i(c)}}function l(h){try{u(n.throw(h))}catch(c){i(c)}}function u(h){h.done?o(h.value):s(h.value).then(a,l)}u((n=n.apply(e,t||[])).next())})}function KF(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(r=0)),r;)try{if(n=1,s&&(o=u[0]&2?s.return:u[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,u[1])).done)return o;switch(s=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,s=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(h){u=[6,h],s=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var km=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function qF(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&km(t,e,r)}function Up(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function nb(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,o=[],i;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return o}function QF(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(nb(arguments[t]));return e}function XF(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],i=0,a=o.length;i<a;i++,s++)n[s]=o[i];return n}function sb(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function Fu(e){return this instanceof Fu?(this.v=e,this):new Fu(e)}function JF(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",i),s[Symbol.asyncIterator]=function(){return this},s;function i(f){return function(p){return Promise.resolve(p).then(f,c)}}function a(f,p){n[f]&&(s[f]=function(m){return new Promise(function(b,g){o.push([f,m,b,g])>1||l(f,m)})},p&&(s[f]=p(s[f])))}function l(f,p){try{u(n[f](p))}catch(m){d(o[0][3],m)}}function u(f){f.value instanceof Fu?Promise.resolve(f.value.v).then(h,c):d(o[0][2],f)}function h(f){l("next",f)}function c(f){l("throw",f)}function d(f,p){f(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function YF(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,o){t[s]=e[s]?function(i){return(r=!r)?{value:Fu(e[s](i)),done:!1}:o?o(i):i}:o}}function ZF(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Up=="function"?Up(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(i){return new Promise(function(a,l){i=e[o](i),s(a,l,i.done,i.value)})}}function s(o,i,a,l){Promise.resolve(l).then(function(u){o({value:u,done:a})},i)}}function eR(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var jG=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},hw=function(e){return hw=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},hw(e)};function tR(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=hw(e),n=0;n<r.length;n++)r[n]!=="default"&&km(t,e,r[n]);return jG(t,e),t}function rR(e){return e&&e.__esModule?e:{default:e}}function nR(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function sR(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}function oR(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function iR(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(o){return Promise.reject(o)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var zG=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function aR(e){function t(o){e.error=e.hasError?new zG(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function s(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(s,function(i){return t(i),s()})}else n|=1}catch(i){t(i)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return s()}function lR(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,o,i){return n?t?".jsx":".js":s&&(!o||!i)?r:s+o+"."+i.toLowerCase()+"js"}):e}const BG={__extends:jF,__assign:Us,__rest:la,__decorate:zF,__param:BF,__esDecorate:UF,__runInitializers:VF,__propKey:WF,__setFunctionName:GF,__metadata:HF,__awaiter:_t,__generator:KF,__createBinding:km,__exportStar:qF,__values:Up,__read:nb,__spread:QF,__spreadArrays:XF,__spreadArray:sb,__await:Fu,__asyncGenerator:JF,__asyncDelegator:YF,__asyncValues:ZF,__makeTemplateObject:eR,__importStar:tR,__importDefault:rR,__classPrivateFieldGet:nR,__classPrivateFieldSet:sR,__classPrivateFieldIn:oR,__addDisposableResource:iR,__disposeResources:aR,__rewriteRelativeImportExtension:lR},UG=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:iR,get __assign(){return Us},__asyncDelegator:YF,__asyncGenerator:JF,__asyncValues:ZF,__await:Fu,__awaiter:_t,__classPrivateFieldGet:nR,__classPrivateFieldIn:oR,__classPrivateFieldSet:sR,__createBinding:km,__decorate:zF,__disposeResources:aR,__esDecorate:UF,__exportStar:qF,__extends:jF,__generator:KF,__importDefault:rR,__importStar:tR,__makeTemplateObject:eR,__metadata:HF,__param:BF,__propKey:WF,__read:nb,__rest:la,__rewriteRelativeImportExtension:lR,__runInitializers:VF,__setFunctionName:GF,__spread:QF,__spreadArray:sb,__spreadArrays:XF,__values:Up,default:BG},Symbol.toStringTag,{value:"Module"})),VG=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class ob extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class WG extends ob{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class gC extends ob{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class _C extends ob{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var fw;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(fw||(fw={}));class GG{constructor(t,{headers:r={},customFetch:n,region:s=fw.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=VG(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return _t(this,arguments,void 0,function*(r,n={}){var s;let o,i;try{const{headers:a,method:l,body:u,signal:h,timeout:c}=n;let d={},{region:f}=n;f||(f=this.region);const p=new URL(`${this.url}/${r}`);f&&f!=="any"&&(d["x-region"]=f,p.searchParams.set("forceFunctionRegion",f));let m;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",m=u):typeof u=="string"?(d["Content-Type"]="text/plain",m=u):typeof FormData<"u"&&u instanceof FormData?m=u:(d["Content-Type"]="application/json",m=JSON.stringify(u)):m=u;let b=h;c&&(i=new AbortController,o=setTimeout(()=>i.abort(),c),h?(b=i.signal,h.addEventListener("abort",()=>i.abort())):b=i.signal);const g=yield this.fetch(p.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:m,signal:b}).catch(M=>{throw new WG(M)}),_=g.headers.get("x-relay-error");if(_&&_==="true")throw new gC(g);if(!g.ok)throw new _C(g);let y=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return y==="application/json"?v=yield g.json():y==="application/octet-stream"||y==="application/pdf"?v=yield g.blob():y==="text/event-stream"?v=g:y==="multipart/form-data"?v=yield g.formData():v=yield g.text(),{data:v,error:null,response:g}}catch(a){return{data:null,error:a,response:a instanceof _C||a instanceof gC?a.context:void 0}}finally{o&&clearTimeout(o)}})}}var Xn={};const Gu=$z(UG);var mf={},gf={},_f={},yf={},vf={},wf={},yC;function uR(){if(yC)return wf;yC=1,Object.defineProperty(wf,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return wf.default=e,wf}var vC;function cR(){if(vC)return vf;vC=1,Object.defineProperty(vf,"__esModule",{value:!0});const t=Gu.__importDefault(uR());class r{constructor(s){var o,i;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(i=s.isMaybeSingle)!==null&&i!==void 0?i:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let a=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,c,d;let f=null,p=null,m=null,b=l.status,g=l.statusText;if(l.ok){if(this.method!=="HEAD"){const M=await l.text();M===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?p=M:p=JSON.parse(M))}const y=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),v=(c=l.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");y&&v&&v.length>1&&(m=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(f={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,m=null,b=406,g="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const y=await l.text();try{f=JSON.parse(y),Array.isArray(f)&&l.status===404&&(p=[],f=null,b=200,g="OK")}catch{l.status===404&&y===""?(b=204,g="No Content"):f={message:y}}if(f&&this.isMaybeSingle&&(!((d=f==null?void 0:f.details)===null||d===void 0)&&d.includes("0 rows"))&&(f=null,b=200,g="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:p,count:m,status:b,statusText:g}});return this.shouldThrowOnError||(a=a.catch(l=>{var u,h,c,d,f,p;let m="";const b=l==null?void 0:l.cause;if(b){const g=(u=b==null?void 0:b.message)!==null&&u!==void 0?u:"",_=(h=b==null?void 0:b.code)!==null&&h!==void 0?h:"";m=`${(c=l==null?void 0:l.name)!==null&&c!==void 0?c:"FetchError"}: ${l==null?void 0:l.message}`,m+=`

Caused by: ${(d=b==null?void 0:b.name)!==null&&d!==void 0?d:"Error"}: ${g}`,_&&(m+=` (${_})`),b!=null&&b.stack&&(m+=`
${b.stack}`)}else m=(f=l==null?void 0:l.stack)!==null&&f!==void 0?f:"";return{error:{message:`${(p=l==null?void 0:l.name)!==null&&p!==void 0?p:"FetchError"}: ${l==null?void 0:l.message}`,details:m,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),a.then(s,o)}returns(){return this}overrideTypes(){return this}}return vf.default=r,vf}var wC;function dR(){if(wC)return yf;wC=1,Object.defineProperty(yf,"__esModule",{value:!0});const t=Gu.__importDefault(cR());class r extends t.default{select(s){let o=!1;const i=(s??"*").split("").map(a=>/\s/.test(a)&&!o?"":(a==='"'&&(o=!o),a)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:o=!0,nullsFirst:i,foreignTable:a,referencedTable:l=a}={}){const u=l?`${l}.order`:"order",h=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${h?`${h},`:""}${s}.${o?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:o,referencedTable:i=o}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,o,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(u,`${o-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:o=!1,settings:i=!1,buffers:a=!1,wal:l=!1,format:u="text"}={}){var h;const c=[s?"analyze":null,o?"verbose":null,i?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),d=(h=this.headers.get("Accept"))!==null&&h!==void 0?h:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${d}"; options=${c};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return yf.default=r,yf}var bC;function ib(){if(bC)return _f;bC=1,Object.defineProperty(_f,"__esModule",{value:!0});const t=Gu.__importDefault(dR()),r=new RegExp("[,()]");class n extends t.default{eq(o,i){return this.url.searchParams.append(o,`eq.${i}`),this}neq(o,i){return this.url.searchParams.append(o,`neq.${i}`),this}gt(o,i){return this.url.searchParams.append(o,`gt.${i}`),this}gte(o,i){return this.url.searchParams.append(o,`gte.${i}`),this}lt(o,i){return this.url.searchParams.append(o,`lt.${i}`),this}lte(o,i){return this.url.searchParams.append(o,`lte.${i}`),this}like(o,i){return this.url.searchParams.append(o,`like.${i}`),this}likeAllOf(o,i){return this.url.searchParams.append(o,`like(all).{${i.join(",")}}`),this}likeAnyOf(o,i){return this.url.searchParams.append(o,`like(any).{${i.join(",")}}`),this}ilike(o,i){return this.url.searchParams.append(o,`ilike.${i}`),this}ilikeAllOf(o,i){return this.url.searchParams.append(o,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(o,i){return this.url.searchParams.append(o,`ilike(any).{${i.join(",")}}`),this}regexMatch(o,i){return this.url.searchParams.append(o,`match.${i}`),this}regexIMatch(o,i){return this.url.searchParams.append(o,`imatch.${i}`),this}is(o,i){return this.url.searchParams.append(o,`is.${i}`),this}isDistinct(o,i){return this.url.searchParams.append(o,`isdistinct.${i}`),this}in(o,i){const a=Array.from(new Set(i)).map(l=>typeof l=="string"&&r.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(o,`in.(${a})`),this}contains(o,i){return typeof i=="string"?this.url.searchParams.append(o,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(o,`cs.{${i.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(i)}`),this}containedBy(o,i){return typeof i=="string"?this.url.searchParams.append(o,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(o,`cd.{${i.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(i)}`),this}rangeGt(o,i){return this.url.searchParams.append(o,`sr.${i}`),this}rangeGte(o,i){return this.url.searchParams.append(o,`nxl.${i}`),this}rangeLt(o,i){return this.url.searchParams.append(o,`sl.${i}`),this}rangeLte(o,i){return this.url.searchParams.append(o,`nxr.${i}`),this}rangeAdjacent(o,i){return this.url.searchParams.append(o,`adj.${i}`),this}overlaps(o,i){return typeof i=="string"?this.url.searchParams.append(o,`ov.${i}`):this.url.searchParams.append(o,`ov.{${i.join(",")}}`),this}textSearch(o,i,{config:a,type:l}={}){let u="";l==="plain"?u="pl":l==="phrase"?u="ph":l==="websearch"&&(u="w");const h=a===void 0?"":`(${a})`;return this.url.searchParams.append(o,`${u}fts${h}.${i}`),this}match(o){return Object.entries(o).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(o,i,a){return this.url.searchParams.append(o,`not.${i}.${a}`),this}or(o,{foreignTable:i,referencedTable:a=i}={}){const l=a?`${a}.or`:"or";return this.url.searchParams.append(l,`(${o})`),this}filter(o,i,a){return this.url.searchParams.append(o,`${i}.${a}`),this}}return _f.default=n,_f}var xC;function hR(){if(xC)return gf;xC=1,Object.defineProperty(gf,"__esModule",{value:!0});const t=Gu.__importDefault(ib());class r{constructor(s,{headers:o={},schema:i,fetch:a}){this.url=s,this.headers=new Headers(o),this.schema=i,this.fetch=a}select(s,o){const{head:i=!1,count:a}=o??{},l=i?"HEAD":"GET";let u=!1;const h=(s??"*").split("").map(c=>/\s/.test(c)&&!u?"":(c==='"'&&(u=!u),c)).join("");return this.url.searchParams.set("select",h),a&&this.headers.append("Prefer",`count=${a}`),new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:o,defaultToNull:i=!0}={}){var a;const l="POST";if(o&&this.headers.append("Prefer",`count=${o}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const u=s.reduce((h,c)=>h.concat(Object.keys(c)),[]);if(u.length>0){const h=[...new Set(u)].map(c=>`"${c}"`);this.url.searchParams.set("columns",h.join(","))}}return new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(s,{onConflict:o,ignoreDuplicates:i=!1,count:a,defaultToNull:l=!0}={}){var u;const h="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(c.length>0){const d=[...new Set(c)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new t.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(s,{count:o}={}){var i;const a="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:s}={}){var o;const i="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return gf.default=r,gf}var MC;function HG(){if(MC)return mf;MC=1,Object.defineProperty(mf,"__esModule",{value:!0});const e=Gu,t=e.__importDefault(hR()),r=e.__importDefault(ib());class n{constructor(o,{headers:i={},schema:a,fetch:l}={}){this.url=o,this.headers=new Headers(i),this.schemaName=a,this.fetch=l}from(o){if(!o||typeof o!="string"||o.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const i=new URL(`${this.url}/${o}`);return new t.default(i,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,i={},{head:a=!1,get:l=!1,count:u}={}){var h;let c;const d=new URL(`${this.url}/rpc/${o}`);let f;a||l?(c=a?"HEAD":"GET",Object.entries(i).filter(([m,b])=>b!==void 0).map(([m,b])=>[m,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([m,b])=>{d.searchParams.append(m,b)})):(c="POST",f=i);const p=new Headers(this.headers);return u&&p.set("Prefer",`count=${u}`),new r.default({method:c,url:d,headers:p,schema:this.schemaName,body:f,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return mf.default=n,mf}Object.defineProperty(Xn,"__esModule",{value:!0});var fR=Xn.PostgrestError=MR=Xn.PostgrestBuilder=bR=Xn.PostgrestTransformBuilder=vR=Xn.PostgrestFilterBuilder=_R=Xn.PostgrestQueryBuilder=mR=Xn.PostgrestClient=void 0;const Hu=Gu,pR=Hu.__importDefault(HG());var mR=Xn.PostgrestClient=pR.default;const gR=Hu.__importDefault(hR());var _R=Xn.PostgrestQueryBuilder=gR.default;const yR=Hu.__importDefault(ib());var vR=Xn.PostgrestFilterBuilder=yR.default;const wR=Hu.__importDefault(dR());var bR=Xn.PostgrestTransformBuilder=wR.default;const xR=Hu.__importDefault(cR());var MR=Xn.PostgrestBuilder=xR.default;const TR=Hu.__importDefault(uR());fR=Xn.PostgrestError=TR.default;var ER=Xn.default={PostgrestClient:pR.default,PostgrestQueryBuilder:gR.default,PostgrestFilterBuilder:yR.default,PostgrestTransformBuilder:wR.default,PostgrestBuilder:xR.default,PostgrestError:TR.default};const KG=UA({__proto__:null,get PostgrestBuilder(){return MR},get PostgrestClient(){return mR},get PostgrestError(){return fR},get PostgrestFilterBuilder(){return vR},get PostgrestQueryBuilder(){return _R},get PostgrestTransformBuilder(){return bR},default:ER},[Xn]),{PostgrestClient:qG,PostgrestQueryBuilder:D7,PostgrestFilterBuilder:F7,PostgrestTransformBuilder:R7,PostgrestBuilder:L7,PostgrestError:N7}=ER||KG;class QG{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const XG="2.86.0",JG=`realtime-js/${XG}`,PR="1.0.0",YG="2.0.0",TC=PR,pw=1e4,ZG=1e3,e6=100;var Na;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Na||(Na={}));var gn;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(gn||(gn={}));var go;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(go||(go={}));var mw;(function(e){e.websocket="websocket"})(mw||(mw={}));var ja;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(ja||(ja={}));class t6{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n;const s=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(t){var r,n;const s=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},i=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,i)}_encodeUserBroadcastPush(t,r,n){var s,o;const i=t.topic,a=(s=t.ref)!==null&&s!==void 0?s:"",l=(o=t.join_ref)!==null&&o!==void 0?o:"",u=t.payload.event,h=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},c=Object.keys(h).length===0?"":JSON.stringify(h);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`metadata length ${c.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+i.length+u.length+c.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let p=new DataView(f),m=0;p.setUint8(m++,this.KINDS.userBroadcastPush),p.setUint8(m++,l.length),p.setUint8(m++,a.length),p.setUint8(m++,i.length),p.setUint8(m++,u.length),p.setUint8(m++,c.length),p.setUint8(m++,r),Array.from(l,g=>p.setUint8(m++,g.charCodeAt(0))),Array.from(a,g=>p.setUint8(m++,g.charCodeAt(0))),Array.from(i,g=>p.setUint8(m++,g.charCodeAt(0))),Array.from(u,g=>p.setUint8(m++,g.charCodeAt(0))),Array.from(c,g=>p.setUint8(m++,g.charCodeAt(0)));var b=new Uint8Array(f.byteLength+n.byteLength);return b.set(new Uint8Array(f),0),b.set(new Uint8Array(n),f.byteLength),b.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[s,o,i,a,l]=n;return r({join_ref:s,ref:o,topic:i,event:a,payload:l})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2),i=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const u=n.decode(t.slice(l,l+s));l=l+s;const h=n.decode(t.slice(l,l+o));l=l+o;const c=n.decode(t.slice(l,l+i));l=l+i;const d=t.slice(l,t.byteLength),f=a===this.JSON_ENCODING?JSON.parse(n.decode(d)):d,p={type:this.BROADCAST_EVENT,event:h,payload:f};return i>0&&(p.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(t,r){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([n])=>r.includes(n)))}}class SR{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Mr;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Mr||(Mr={}));const EC=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,i)=>(o[i]=r6(i,e,t,s),o),{}):{}},r6=(e,t,r,n)=>{const s=t.find(a=>a.name===e),o=s==null?void 0:s.type,i=r[e];return o&&!n.includes(o)?CR(o,i):gw(i)},CR=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return i6(t,r)}switch(e){case Mr.bool:return n6(t);case Mr.float4:case Mr.float8:case Mr.int2:case Mr.int4:case Mr.int8:case Mr.numeric:case Mr.oid:return s6(t);case Mr.json:case Mr.jsonb:return o6(t);case Mr.timestamp:return a6(t);case Mr.abstime:case Mr.date:case Mr.daterange:case Mr.int4range:case Mr.int8range:case Mr.money:case Mr.reltime:case Mr.text:case Mr.time:case Mr.timestamptz:case Mr.timetz:case Mr.tsrange:case Mr.tstzrange:return gw(t);default:return gw(t)}},gw=e=>e,n6=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},s6=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},o6=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},i6=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,r);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(a=>CR(t,a))}return e},a6=e=>typeof e=="string"?e.replace(" ","T"):e,kR=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class z_{constructor(t,r,n={},s=pw){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var PC;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(PC||(PC={}));class sd{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=sd.syncState(this.state,s,o,i),this.pendingDiffs.forEach(l=>{this.state=sd.syncDiff(this.state,l,o,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=sd.syncDiff(this.state,s,o,i),a())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),i=this.transformState(r),a={},l={};return this.map(o,(u,h)=>{i[u]||(l[u]=h)}),this.map(i,(u,h)=>{const c=o[u];if(c){const d=h.map(b=>b.presence_ref),f=c.map(b=>b.presence_ref),p=h.filter(b=>f.indexOf(b.presence_ref)<0),m=c.filter(b=>d.indexOf(b.presence_ref)<0);p.length>0&&(a[u]=p),m.length>0&&(l[u]=m)}else a[u]=h}),this.syncDiff(o,{joins:a,leaves:l},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:i}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(a,l)=>{var u;const h=(u=t[a])!==null&&u!==void 0?u:[];if(t[a]=this.cloneDeep(l),h.length>0){const c=t[a].map(f=>f.presence_ref),d=h.filter(f=>c.indexOf(f.presence_ref)<0);t[a].unshift(...d)}n(a,h,l)}),this.map(i,(a,l)=>{let u=t[a];if(!u)return;const h=l.map(c=>c.presence_ref);u=u.filter(c=>h.indexOf(c.presence_ref)<0),t[a]=u,s(a,u,l),u.length===0&&delete t[a]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var SC;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(SC||(SC={}));var od;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(od||(od={}));var ri;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(ri||(ri={}));class ab{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=gn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new z_(this,go.join,this.params,this.timeout),this.rejoinTimer=new SR(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=gn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=gn.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=gn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(go.reply,{},(i,a)=>{this._trigger(this._replyEventName(a),i)}),this.presence=new sd(this),this.broadcastEndpointURL=kR(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==gn.closed){const{config:{broadcast:i,presence:a,private:l}}=this.params,u=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&s!==void 0?s:[],h=!!this.bindings[od.PRESENCE]&&this.bindings[od.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,c={},d={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:h}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(f=>t==null?void 0:t(ri.CHANNEL_ERROR,f)),this._onClose(()=>t==null?void 0:t(ri.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket.setAuth(),f===void 0){t==null||t(ri.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,b=(p=m==null?void 0:m.length)!==null&&p!==void 0?p:0,g=[];for(let _=0;_<b;_++){const y=m[_],{filter:{event:v,schema:M,table:E,filter:T}}=y,S=f&&f[_];if(S&&S.event===v&&S.schema===M&&S.table===E&&S.filter===T)g.push(Object.assign(Object.assign({},y),{id:S.id}));else{this.unsubscribe(),this.state=gn.errored,t==null||t(ri.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,t&&t(ri.SUBSCRIBED);return}}).receive("error",f=>{this.state=gn.errored,t==null||t(ri.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(ri.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===gn.joined&&t===od.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var s;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const i={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:i}=t,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,a,l;const u=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),u.receive("ok",()=>o("ok")),u.receive("error",()=>o("error")),u.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=gn.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(go.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new z_(this,go.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=gn.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),i}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new z_(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>e6){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const i=t.toLocaleLowerCase(),{close:a,error:l,leave:u,join:h}=go;if(n&&[a,l,u,h].indexOf(i)>=0&&n!==this._joinRef())return;let d=this._onMessage(i,r,n);if(r&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,m,b;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((b=(m=f.filter)===null||m===void 0?void 0:m.event)===null||b===void 0?void 0:b.toLocaleLowerCase())===i}).map(f=>f.callback(d,n)):(o=this.bindings[i])===null||o===void 0||o.filter(f=>{var p,m,b,g,_,y;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const v=f.id,M=(p=f.filter)===null||p===void 0?void 0:p.event;return v&&((m=r.ids)===null||m===void 0?void 0:m.includes(v))&&(M==="*"||(M==null?void 0:M.toLocaleLowerCase())===((b=r.data)===null||b===void 0?void 0:b.type.toLocaleLowerCase()))}else{const v=(_=(g=f==null?void 0:f.filter)===null||g===void 0?void 0:g.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return v==="*"||v===((y=r==null?void 0:r.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:m,table:b,commit_timestamp:g,type:_,errors:y}=p;d=Object.assign(Object.assign({},{schema:m,table:b,commit_timestamp:g,eventType:_,new:{},old:{},errors:y}),this._getPayloadRecords(p))}f.callback(d,n)})}_isClosed(){return this.state===gn.closed}_isJoined(){return this.state===gn.joined}_isJoining(){return this.state===gn.joining}_isLeaving(){return this.state===gn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&ab.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(go.close,{},t)}_onError(t){this._on(go.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=gn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=EC(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=EC(t.columns,t.old_record)),r}}const B_=()=>{},bf={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},l6=[1e3,2e3,5e3,1e4],u6=1e4,c6=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class d6{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pw,this.transport=null,this.heartbeatIntervalMs=bf.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=B_,this.ref=0,this.reconnectTimer=null,this.vsn=TC,this.logger=B_,this.conn=null,this.sendBuffer=[],this.serializer=new t6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...o)=>s(...o):(...o)=>fetch(...o),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${mw.websocket}`,this.httpEndpoint=kR(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=QG.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Na.connecting:return ja.Connecting;case Na.open:return ja.Open;case Na.closing:return ja.Closing;default:return ja.Closed}}isConnected(){return this.connectionState()===ja.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new ab(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,i=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(ZG,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},bf.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:i}=r,a=i?`(${i})`:"",l=o.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),o),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(s,o,i)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Na.open||this.conn.readyState===Na.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(go.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([c6],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:JG};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(go.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new SR(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},bf.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,i,a,l,u,h,c,d,f;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:pw,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:bf.HEARTBEAT_INTERVAL,this.worker=(o=t==null?void 0:t.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t==null?void 0:t.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(a=t==null?void 0:t.heartbeatCallback)!==null&&a!==void 0?a:B_,this.vsn=(l=t==null?void 0:t.vsn)!==null&&l!==void 0?l:TC,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=t==null?void 0:t.reconnectAfterMs)!==null&&u!==void 0?u:p=>l6[p-1]||u6,this.vsn){case PR:this.encode=(h=t==null?void 0:t.encode)!==null&&h!==void 0?h:(p,m)=>m(JSON.stringify(p)),this.decode=(c=t==null?void 0:t.decode)!==null&&c!==void 0?c:(p,m)=>m(JSON.parse(p));break;case YG:this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=t==null?void 0:t.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class $m extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Br(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class h6 extends $m{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class _w extends $m{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const lb=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),f6=()=>Response,yw=e=>{if(Array.isArray(e))return e.map(r=>yw(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=yw(n)}),t},p6=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},m6=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e),U_=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},g6=(e,t,r)=>_t(void 0,void 0,void 0,function*(){const n=yield f6();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(s=>{const o=e.status||500,i=(s==null?void 0:s.statusCode)||o+"";t(new h6(U_(s),o,i))}).catch(s=>{t(new _w(U_(s),s))}):t(new _w(U_(e),e))}),_6=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?s:(p6(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,t!=null&&t.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function qd(e,t,r,n,s,o){return _t(this,void 0,void 0,function*(){return new Promise((i,a)=>{e(r,_6(t,n,s,o)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>g6(l,a,n))})})}function kd(e,t,r,n){return _t(this,void 0,void 0,function*(){return qd(e,"GET",t,r,n)})}function ho(e,t,r,n,s){return _t(this,void 0,void 0,function*(){return qd(e,"POST",t,n,s,r)})}function vw(e,t,r,n,s){return _t(this,void 0,void 0,function*(){return qd(e,"PUT",t,n,s,r)})}function y6(e,t,r,n){return _t(this,void 0,void 0,function*(){return qd(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function ub(e,t,r,n,s){return _t(this,void 0,void 0,function*(){return qd(e,"DELETE",t,n,s,r)})}class v6{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return _t(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Br(t))return{data:null,error:t};throw t}})}}var $R;class w6{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[$R]="BlobDownloadBuilder",this.promise=null}asStream(){return new v6(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return _t(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Br(t))return{data:null,error:t};throw t}})}}$R=Symbol.toStringTag;const b6={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},CC={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class x6{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=lb(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return _t(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},CC),s);let a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.has("cacheControl")||o.append("cacheControl",i.cacheControl),l&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(l))):(o=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!i.duplex&&(i.duplex="half")),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const u=this._removeEmptyFolders(r),h=this._getFinalPath(u),c=yield(t=="PUT"?vw:ho)(this.fetch,`${this.url}/object/${h}`,o,Object.assign({headers:a},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{data:{path:u,id:c.Id,fullPath:c.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Br(o))return{data:null,error:o};throw o}})}upload(t,r,n){return _t(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return _t(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",r);try{let l;const u=Object.assign({upsert:CC.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",u.cacheControl)):(l=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const c=yield vw(this.fetch,a.toString(),l,{headers:h});return{data:{path:o,fullPath:c.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Br(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(t,r){return _t(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const o=yield ho(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+o.url),a=i.searchParams.get("token");if(!a)throw new $m("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:a},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Br(n))return{data:null,error:n};throw n}})}update(t,r,n){return _t(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return _t(this,void 0,void 0,function*(){try{return{data:yield ho(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}copy(t,r,n){return _t(this,void 0,void 0,function*(){try{return{data:{path:(yield ho(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return _t(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield ho(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return _t(this,void 0,void 0,function*(){try{const s=yield ho(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),i=o?`?${o}`:"",a=this._getFinalPath(t),l=()=>kd(this.fetch,`${this.url}/${s}/${a}${i}`,{headers:this.headers,noResolveJson:!0});return new w6(l,this.shouldThrowOnError)}info(t){return _t(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield kd(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:yw(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Br(n))return{data:null,error:n};throw n}})}exists(t){return _t(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield y6(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Br(n)&&n instanceof _w){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const a=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});l!==""&&s.push(l);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${u}`)}}}remove(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ub(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}list(t,r,n){return _t(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},b6),r),{prefix:t||""});return{data:yield ho(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}listV2(t,r){return _t(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield ho(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Br(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const AR="2.86.0",IR={"X-Client-Info":`storage-js/${AR}`};class M6{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},IR),r),this.fetch=lb(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return _t(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield kd(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}getBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield kd(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}createBucket(t){return _t(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield ho(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Br(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return _t(this,void 0,void 0,function*(){try{return{data:yield vw(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Br(n))return{data:null,error:n};throw n}})}emptyBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ho(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}deleteBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ub(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}var $d=class extends Error{constructor(e,t){var r;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((r=t.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function T6(e,t,r){const n=new URL(t,e);if(r)for(const[s,o]of Object.entries(r))o!==void 0&&n.searchParams.set(s,o);return n.toString()}async function E6(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function P6(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:o,headers:i}){const a=T6(e.baseUrl,n,s),l=await E6(e.auth),u=await t(a,{method:r,headers:{...o?{"Content-Type":"application/json"}:{},...l,...i},body:o?JSON.stringify(o):void 0}),h=await u.text(),c=(u.headers.get("content-type")||"").includes("application/json"),d=c&&h?JSON.parse(h):h;if(!u.ok){const f=c?d:void 0,p=f==null?void 0:f.error;throw new $d((p==null?void 0:p.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:p==null?void 0:p.type,icebergCode:p==null?void 0:p.code,details:f})}return{status:u.status,headers:u.headers,data:d}}}}function xf(e){return e.join("")}var S6=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:xf(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${xf(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${xf(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${xf(e.namespace)}`}),!0}catch(t){if(t instanceof $d&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(r){if(r instanceof $d&&r.status===409)return;throw r}}};function Ol(e){return e.join("")}var C6=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ol(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(r){if(r instanceof $d&&r.status===404)return!1;throw r}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof $d&&r.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},k6=class{constructor(e){var n;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=P6({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(n=e.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new S6(this.client,t),this.tableOps=new C6(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}};class $6{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},IR),r),this.fetch=lb(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ho(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}listBuckets(t){return _t(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield kd(this.fetch,s,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}deleteBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ub(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Br(r))return{data:null,error:r};throw r}})}from(t){if(!m6(t))throw new $m("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");return new k6({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:()=>_t(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch})}}const cb={"X-Client-Info":`storage-js/${AR}`,"Content-Type":"application/json"};class OR extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function vs(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class V_ extends OR{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class A6 extends OR{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var kC;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(kC||(kC={}));const db=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),I6=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},$C=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),O6=(e,t,r)=>_t(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const s=e.status||500,o=e;if(typeof o.json=="function")o.json().then(i=>{const a=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||s+"";t(new V_($C(i),s,a))}).catch(()=>{const i=s+"",a=o.statusText||`HTTP ${s} error`;t(new V_(a,s,i))});else{const i=s+"",a=o.statusText||`HTTP ${s} error`;t(new V_(a,s,i))}}else t(new A6($C(e),e))}),D6=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(I6(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),r)):s};function F6(e,t,r,n,s,o){return _t(this,void 0,void 0,function*(){return new Promise((i,a)=>{e(r,D6(t,n,s,o)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>i(l)).catch(l=>O6(l,a,n))})})}function ws(e,t,r,n,s){return _t(this,void 0,void 0,function*(){return F6(e,"POST",t,n,s,r)})}class R6{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cb),r),this.fetch=db(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return _t(this,void 0,void 0,function*(){try{return{data:(yield ws(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}getIndex(t,r){return _t(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vs(n))return{data:null,error:n};throw n}})}listIndexes(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return _t(this,void 0,void 0,function*(){try{return{data:(yield ws(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vs(n))return{data:null,error:n};throw n}})}}class L6{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cb),r),this.fetch=db(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return _t(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield ws(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}getVectors(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}listVectors(t){return _t(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield ws(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}queryVectors(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}deleteVectors(t){return _t(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield ws(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}}class N6{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cb),r),this.fetch=db(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:(yield ws(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}getBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:yield ws(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}listBuckets(){return _t(this,arguments,void 0,function*(t={}){try{return{data:yield ws(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}deleteBucket(t){return _t(this,void 0,void 0,function*(){try{return{data:(yield ws(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vs(r))return{data:null,error:r};throw r}})}}class j6 extends N6{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new z6(this.url,this.headers,t,this.fetch)}createBucket(t){const r=Object.create(null,{createBucket:{get:()=>super.createBucket}});return _t(this,void 0,void 0,function*(){return r.createBucket.call(this,t)})}getBucket(t){const r=Object.create(null,{getBucket:{get:()=>super.getBucket}});return _t(this,void 0,void 0,function*(){return r.getBucket.call(this,t)})}listBuckets(){const t=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return _t(this,arguments,void 0,function*(r={}){return t.listBuckets.call(this,r)})}deleteBucket(t){const r=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return _t(this,void 0,void 0,function*(){return r.deleteBucket.call(this,t)})}}class z6 extends R6{constructor(t,r,n,s){super(t,r,s),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return _t(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return _t(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return _t(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return _t(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new B6(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class B6 extends L6{constructor(t,r,n,s,o){super(t,r,o),this.vectorBucketName=n,this.indexName=s}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return _t(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return _t(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return _t(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return _t(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return _t(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class U6 extends M6{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new x6(this.url,this.headers,t,this.fetch)}get vectors(){return new j6(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $6(this.url+"/iceberg",this.headers,this.fetch)}}const V6="2.86.0";let Vc="";typeof Deno<"u"?Vc="deno":typeof document<"u"?Vc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Vc="react-native":Vc="node";const W6={"X-Client-Info":`supabase-js-${Vc}/${V6}`},G6={headers:W6},H6={schema:"public"},K6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},q6={},Q6=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),X6=()=>Headers,J6=(e,t,r)=>{const n=Q6(r),s=X6();return async(o,i)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:e;let u=new s(i==null?void 0:i.headers);return u.has("apikey")||u.set("apikey",e),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),n(o,Object.assign(Object.assign({},i),{headers:u}))}};function Y6(e){return e.endsWith("/")?e:e+"/"}function Z6(e,t){var r,n;const{db:s,auth:o,realtime:i,global:a}=e,{db:l,auth:u,realtime:h,global:c}=t,d={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},u),o),realtime:Object.assign(Object.assign({},h),i),storage:{},global:Object.assign(Object.assign(Object.assign({},c),a),{headers:Object.assign(Object.assign({},(r=c==null?void 0:c.headers)!==null&&r!==void 0?r:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}function eH(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Y6(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const DR="2.86.0",Vl=30*1e3,ww=3,W_=ww*Vl,tH="http://localhost:9999",rH="supabase.auth.token",nH={"X-Client-Info":`gotrue-js/${DR}`},bw="X-Supabase-Api-Version",FR={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sH=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,oH=10*60*1e3;class Ad extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Pt(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class iH extends Ad{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function aH(e){return Pt(e)&&e.name==="AuthApiError"}class za extends Ad{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class ua extends Ad{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class ps extends ua{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function lH(e){return Pt(e)&&e.name==="AuthSessionMissingError"}class Dl extends ua{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mf extends ua{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Tf extends ua{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function uH(e){return Pt(e)&&e.name==="AuthImplicitGrantRedirectError"}class AC extends ua{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xw extends ua{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function G_(e){return Pt(e)&&e.name==="AuthRetryableFetchError"}class IC extends ua{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class Mw extends ua{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Vp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),OC=`
\r=`.split(""),cH=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<OC.length;t+=1)e[OC[t].charCodeAt(0)]=-2;for(let t=0;t<Vp.length;t+=1)e[Vp[t].charCodeAt(0)]=t;return e})();function DC(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(Vp[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(Vp[n]),t.queuedBits-=6}}function RR(e,t,r){const n=cH[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function FC(e){const t=[],r=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{fH(i,n,r)};for(let i=0;i<e.length;i+=1)RR(e.charCodeAt(i),s,o);return t.join("")}function dH(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function hH(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}dH(n,t)}}function fH(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function gu(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)RR(e.charCodeAt(s),r,n);return new Uint8Array(t)}function pH(e){const t=[];return hH(e,r=>t.push(r)),new Uint8Array(t)}function Ha(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>DC(s,r,n)),DC(null,r,n),t.join("")}function mH(e){return Math.round(Date.now()/1e3)+e}function gH(){return Symbol("auth-callback")}const Cn=()=>typeof window<"u"&&typeof document<"u",Ca={tested:!1,writable:!1},LR=()=>{if(!Cn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ca.tested)return Ca.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ca.tested=!0,Ca.writable=!0}catch{Ca.tested=!0,Ca.writable=!1}return Ca.writable};function _H(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const NR=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),yH=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Wl=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},ka=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Si=async(e,t)=>{await e.removeItem(t)};class Am{constructor(){this.promise=new Am.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}Am.promiseConstructor=Promise;function H_(e){const t=e.split(".");if(t.length!==3)throw new Mw("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!sH.test(t[n]))throw new Mw("JWT not in base64url format");return{header:JSON.parse(FC(t[0])),payload:JSON.parse(FC(t[1])),signature:gu(t[2]),raw:{header:t[0],payload:t[1]}}}async function vH(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function wH(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){s(i);return}}})()})}function bH(e){return("0"+e.toString(16)).substr(-2)}function xH(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,bH).join("")}async function MH(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function TH(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await MH(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Fl(e,t,r=!1){const n=xH();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Wl(e,`${t}-code-verifier`,s);const o=await TH(n);return[o,n===o?"plain":"s256"]}const EH=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function PH(e){const t=e.headers.get(bw);if(!t||!t.match(EH))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function SH(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function CH(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const kH=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Rl(e){if(!kH.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function K_(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function $H(e,t){return new Proxy(e,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const o=n.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,s)}})}function RC(e){return JSON.parse(JSON.stringify(e))}const Ra=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),AH=[502,503,504];async function LC(e){var t;if(!yH(e))throw new xw(Ra(e),0);if(AH.includes(e.status))throw new xw(Ra(e),e.status);let r;try{r=await e.json()}catch(o){throw new za(Ra(o),o)}let n;const s=PH(e);if(s&&s.getTime()>=FR["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new IC(Ra(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new ps}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new IC(Ra(r),e.status,r.weak_password.reasons);throw new iH(Ra(r),e.status||500,n)}const IH=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function It(e,t,r,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[bw]||(o[bw]=FR["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await OH(e,t,r+a,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function OH(e,t,r,n,s,o){const i=IH(t,n,s,o);let a;try{a=await e(r,Object.assign({},i))}catch(l){throw console.error(l),new xw(Ra(l),0)}if(a.ok||await LC(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await LC(l)}}function lo(e){var t;let r=null;RH(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=mH(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function NC(e){const t=lo(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Li(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function DH(e){return{data:e,error:null}}function FH(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,i=la(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function jC(e){return e}function RH(e){return e.access_token&&e.refresh_token&&e.expires_in}const q_=["global","local","others"];class LH{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=NR(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=q_[0]){if(q_.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${q_.join(", ")}`);try{return await It(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Pt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await It(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Li})}catch(n){if(Pt(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=la(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await It(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:FH,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(Pt(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await It(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Li})}catch(r){if(Pt(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,i,a,l;try{const u={nextPage:null,lastPage:0,total:0},h=await It(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:jC});if(h.error)throw h.error;const c=await h.json(),d=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(p.split(";")[1].split("=")[1]);u[`${b}Page`]=m}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},c),u),error:null}}catch(u){if(Pt(u))return{data:{users:[]},error:u};throw u}}async getUserById(t){Rl(t);try{return await It(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Li})}catch(r){if(Pt(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Rl(t);try{return await It(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Li})}catch(n){if(Pt(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Rl(t);try{return await It(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Li})}catch(n){if(Pt(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Rl(t.userId);try{const{data:r,error:n}=await It(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(Pt(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Rl(t.userId),Rl(t.id);try{return{data:await It(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,i,a,l;try{const u={nextPage:null,lastPage:0,total:0},h=await It(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:jC});if(h.error)throw h.error;const c=await h.json(),d=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),b=JSON.parse(p.split(";")[1].split("=")[1]);u[`${b}Page`]=m}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},c),u),error:null}}catch(u){if(Pt(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(t){try{return await It(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Pt(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await It(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Pt(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await It(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Pt(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await It(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Pt(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await It(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Pt(r))return{data:null,error:r};throw r}}}function zC(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Ll={debug:!!(globalThis&&LR()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class jR extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class NH extends jR{}async function jH(e,t,r){Ll.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Ll.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Ll.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Ll.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw Ll.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new NH(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Ll.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function zH(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function zR(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function BH(e){return parseInt(e,16)}function UH(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function VH(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:i,notBefore:a,requestId:l,resources:u,scheme:h,uri:c,version:d}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!c)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const f=zR(e.address),p=h?`${h}://${n}`:n,m=e.statement?`${e.statement}
`:"",b=`${p} wants you to sign in with your Ethereum account:
${f}

${m}`;let g=`URI: ${c}
Version: ${d}
Chain ID: ${r}${i?`
Nonce: ${i}`:""}
Issued At: ${o.toISOString()}`;if(s&&(g+=`
Expiration Time: ${s.toISOString()}`),a&&(g+=`
Not Before: ${a.toISOString()}`),l&&(g+=`
Request ID: ${l}`),u){let _=`
Resources:`;for(const y of u){if(!y||typeof y!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${y}`);_+=`
- ${y}`}g+=_}return`${b}
${g}`}class cn extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class Wp extends cn{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function WH({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new cn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new cn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new cn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new cn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new cn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new cn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new cn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new cn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const i=window.location.hostname;if(BR(i)){if(o.rp.id!==i)return new cn({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new cn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new cn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new cn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new cn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function GH({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new cn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new cn({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(BR(n)){if(r.rpId!==n)return new cn({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new cn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new cn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new cn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class HH{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const KH=new HH;function qH(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=la(e,["challenge","user","excludeCredentials"]),o=gu(t).buffer,i=Object.assign(Object.assign({},r),{id:gu(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:o,user:i});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const u=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:gu(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function QH(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=la(e,["challenge","allowCredentials"]),s=gu(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let i=0;i<r.length;i++){const a=r[i];o.allowCredentials[i]=Object.assign(Object.assign({},a),{id:gu(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return o}function XH(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Ha(new Uint8Array(e.response.attestationObject)),clientDataJSON:Ha(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function JH(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Ha(new Uint8Array(s.authenticatorData)),clientDataJSON:Ha(new Uint8Array(s.clientDataJSON)),signature:Ha(new Uint8Array(s.signature)),userHandle:s.userHandle?Ha(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function BR(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function BC(){var e,t;return!!(Cn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function YH(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Wp("Browser returned unexpected credential type",t)}:{data:null,error:new Wp("Empty credential response",t)}}catch(t){return{data:null,error:WH({error:t,options:e})}}}async function ZH(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Wp("Browser returned unexpected credential type",t)}:{data:null,error:new Wp("Empty credential response",t)}}catch(t){return{data:null,error:GH({error:t,options:e})}}}const eK={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},tK={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Gp(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const i=s[o];if(i!==void 0)if(Array.isArray(i))n[o]=i;else if(r(i))n[o]=i;else if(t(i)){const a=n[o];t(a)?n[o]=Gp(a,i):n[o]=Gp(i)}else n[o]=i}return n}function rK(e,t){return Gp(eK,e,t||{})}function nK(e,t){return Gp(tK,e,t||{})}class sK{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:i,error:a}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!i)return{data:null,error:a};const l=s??KH.createNewAbortSignal();if(i.webauthn.type==="create"){const{user:u}=i.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${n}`),u.displayName||(u.displayName=u.name)}switch(i.webauthn.type){case"create":{const u=rK(i.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:h,error:c}=await YH({publicKey:u,signal:l});return h?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:h}},error:null}:{data:null,error:c}}case"request":{const u=nK(i.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:h,error:c}=await ZH(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:u,signal:l}));return h?{data:{factorId:t,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:h}},error:null}:{data:null,error:c}}}}catch(i){return Pt(i)?{data:null,error:i}:{data:null,error:new za("Unexpected error in challenge",i)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new Ad("rpId is required for WebAuthn authentication")};try{if(!BC())return{data:null,error:new za("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!i)return{data:null,error:a};const{webauthn:l}=i;return this._verify({factorId:t,challengeId:i.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:n,credential_response:l.credential_response}})}catch(i){return Pt(i)?{data:null,error:i}:{data:null,error:new za("Unexpected error in authenticate",i)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new Ad("rpId is required for WebAuthn registration")};try{if(!BC())return{data:null,error:new za("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this._enroll({friendlyName:t});if(!i)return await this.client.mfa.listFactors().then(h=>{var c;return(c=h.data)===null||c===void 0?void 0:c.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===t&&d.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return l?this._verify({factorId:i.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(i){return Pt(i)?{data:null,error:i}:{data:null,error:new za("Unexpected error in register",i)}}}}zH();const oK={url:tH,storageKey:rH,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nH,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function UC(e,t,r){return await r()}const Nl={};class Id{get jwks(){var t,r;return(r=(t=Nl[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Nl[this.storageKey]=Object.assign(Object.assign({},Nl[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Nl[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Nl[this.storageKey]=Object.assign(Object.assign({},Nl[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},oK),t);if(this.storageKey=o.storageKey,this.instanceID=(r=Id.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Id.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Cn()){const i=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(i),this.logDebugMessages&&console.trace(i)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new LH({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=NR(o.fetch),this.lock=o.lock||UC,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:Cn()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=jH:this.lock=UC,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new sK(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:LR()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=zC(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=zC(this.memoryStorage)),Cn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${DR}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(Cn()&&(r=_H(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),Cn()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),uH(o)){const l=(t=o.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Pt(r)?this._returnResult({error:r}):this._returnResult({error:new za("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await It(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:lo}),{data:i,error:a}=o;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const l=i.session,u=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(o){if(Pt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:h,password:c,options:d}=t;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Fl(this.storage,this.storageKey)),o=await It(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:h,password:c,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:lo})}else if("phone"in t){const{phone:h,password:c,options:d}=t;o=await It(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:c,data:(n=d==null?void 0:d.data)!==null&&n!==void 0?n:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:lo})}else throw new Mf("You must provide either an email or phone number and a password");const{data:i,error:a}=o;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const l=i.session,u=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(o){if(Pt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:i,options:a}=t;r=await It(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:NC})}else if("phone"in t){const{phone:o,password:i,options:a}=t;r=await It(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:NC})}else throw new Mf("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const o=new Dl;return this._returnResult({data:{user:null,session:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(Pt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,i,a,l,u,h,c,d;let f,p;if("message"in t)f=t.message,p=t.signature;else{const{chain:m,wallet:b,statement:g,options:_}=t;let y;if(Cn())if(typeof b=="object")y=b;else{const A=window;if("ethereum"in A&&typeof A.ethereum=="object"&&"request"in A.ethereum&&typeof A.ethereum.request=="function")y=A.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=b}const v=new URL((r=_==null?void 0:_.url)!==null&&r!==void 0?r:window.location.href),M=await y.request({method:"eth_requestAccounts"}).then(A=>A).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const E=zR(M[0]);let T=(n=_==null?void 0:_.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!T){const A=await y.request({method:"eth_chainId"});T=BH(A)}const S={domain:v.host,address:E,statement:g,uri:v.href,version:"1",chainId:T,nonce:(s=_==null?void 0:_.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(i=(o=_==null?void 0:_.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(a=_==null?void 0:_.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=_==null?void 0:_.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=_==null?void 0:_.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(h=_==null?void 0:_.signInWithEthereum)===null||h===void 0?void 0:h.resources};f=VH(S),p=await y.request({method:"personal_sign",params:[UH(f),E]})}try{const{data:m,error:b}=await It(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},!((c=t.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:(d=t.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:lo});if(b)throw b;if(!m||!m.session||!m.user){const g=new Dl;return this._returnResult({data:{user:null,session:null},error:g})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:b})}catch(m){if(Pt(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signInWithSolana(t){var r,n,s,o,i,a,l,u,h,c,d,f;let p,m;if("message"in t)p=t.message,m=t.signature;else{const{chain:b,wallet:g,statement:_,options:y}=t;let v;if(Cn())if(typeof g=="object")v=g;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))v=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=g}const M=new URL((r=y==null?void 0:y.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in v&&v.signIn){const E=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),_?{statement:_}:null));let T;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")T=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)T=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)p=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),m=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${M.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(s=(n=y==null?void 0:y.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((u=y==null?void 0:y.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((c=(h=y==null?void 0:y.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||c===void 0)&&c.length?["Resources",...y.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const E=await v.signMessage(new TextEncoder().encode(p),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=E}}try{const{data:b,error:g}=await It(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Ha(m)},!((d=t.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:lo});if(g)throw g;if(!b||!b.session||!b.user){const _=new Dl;return this._returnResult({data:{user:null,session:null},error:_})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:g})}catch(b){if(Pt(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async _exchangeCodeForSession(t){const r=await ka(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:i}=await It(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:lo});if(await Si(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!o||!o.session||!o.user){const a=new Dl;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(Pt(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:i}=t,a=await It(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:lo}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const h=new Dl;return this._returnResult({data:{user:null,session:null},error:h})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(r){if(Pt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,s,o,i;try{if("email"in t){const{email:a,options:l}=t;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await Fl(this.storage,this.storageKey));const{error:c}=await It(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}if("phone"in t){const{phone:a,options:l}=t,{data:u,error:h}=await It(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h})}throw new Mf("You must provide either an email or phone number.")}catch(a){if(Pt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await It(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:lo});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,u=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(Pt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,n,s,o,i;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Fl(this.storage,this.storageKey));const u=await It(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:DH});return!((o=u.data)===null||o===void 0)&&o.url&&Cn()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(Pt(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new ps;const{error:s}=await It(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(Pt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:i}=await It(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:i,error:a}=await It(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:a})}throw new Mf("You must provide either an email or phone number and a type")}catch(r){if(Pt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await ka(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<W_:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await ka(this.userStorage,this.storageKey+"-user");i!=null&&i.user?t.user=i.user:t.user=K_()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const i={value:this.suppressGetSessionWarning};t.user=$H(t.user,i),i.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await It(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Li}):await this._useSession(async r=>{var n,s,o;const{data:i,error:a}=r;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ps}:await It(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Li})})}catch(r){if(Pt(r))return lH(r)&&(await this._removeSession(),await Si(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new ps;const i=s.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Fl(this.storage,this.storageKey));const{data:u,error:h}=await It(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Li});if(h)throw h;return i.user=u.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(n){if(Pt(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new ps;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:i}=H_(t.access_token);if(i.exp&&(n=i.exp,s=n<=r),s){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)throw l;o={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(r){if(Pt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:i,error:a}=r;if(a)throw a;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new ps;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(Pt(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!Cn())throw new Tf("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Tf(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new AC("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Tf("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new AC("No code detected.");const{data:_,error:y}=await this._exchangeCodeForSession(t.code);if(y)throw y;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:a,expires_at:l,token_type:u}=t;if(!o||!a||!i||!u)throw new Tf("No session defined in URL");const h=Math.round(Date.now()/1e3),c=parseInt(a);let d=h+c;l&&(d=parseInt(l));const f=d-h;f*1e3<=Vl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${c}s`);const p=d-c;h-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,h):h-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,h);const{data:m,error:b}=await this._getUser(o);if(b)throw b;const g={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:c,expires_at:d,refresh_token:i,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:t.type},error:null})}catch(n){if(Pt(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await ka(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({error:o});const i=(n=s.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,t);if(a&&!(aH(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await Si(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=gH(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:i}=r;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Fl(this.storage,this.storageKey,!0));try{return await It(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(Pt(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var i,a,l,u,h;const{data:c,error:d}=o;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await It(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(u=c.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return Cn()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Pt(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:i,provider:a,token:l,access_token:u,nonce:h}=t,c=await It(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o==null?void 0:o.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:u,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:lo}),{data:d,error:f}=c;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new Dl}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(s){if(Pt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)throw i;return await It(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await wH(async s=>(s>0&&await vH(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await It(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:lo})),(s,o)=>{const i=200*Math.pow(2,s);return o&&G_(o)&&Date.now()+i-n<Vl})}catch(n){if(this._debug(r,"error",n),Pt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),Cn()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await ka(this.storage,this.storageKey);if(s&&this.userStorage){let i=await ka(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:s.user},await Wl(this.userStorage,this.storageKey+"-user",i)),s.user=(t=i==null?void 0:i.user)!==null&&t!==void 0?t:K_()}else if(s&&!s.user&&!s.user){const i=await ka(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(s.user=i.user,await Si(this.storage,this.storageKey+"-user"),await Wl(this.storage,this.storageKey,s)):s.user=K_()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<W_;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${W_}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),G_(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:a}=await this._getUser(s.access_token);!a&&(i!=null&&i.user)?(s.user=i.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new ps;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Am;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new ps;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={data:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(s,"error",o),Pt(o)){const i={data:null,error:o};return G_(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,r)}catch(l){o.push(l)}});if(await Promise.all(i),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Wl(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=RC(s);await Wl(this.storage,this.storageKey,o)}else{const s=RC(r);await Wl(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Si(this.storage,this.storageKey),await Si(this.storage,this.storageKey+"-code-verifier"),await Si(this.storage,this.storageKey+"-user"),this.userStorage&&await Si(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Cn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Vl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/Vl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Vl}ms, refresh threshold is ${ww} ticks`),s<=ww&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof jR)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Cn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await Fl(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?this._returnResult({data:null,error:o}):await It(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:i}=r;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:u}=await It(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return u?this._returnResult({data:null,error:u}):(t.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const i=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?XH(t.webauthn.credential_response):JH(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await It(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:i,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const i=await It(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(i.error)return i;const{data:a}=i;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:qH(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:QH(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=H_(n.access_token);let i=null;o.aal&&(i=o.aal);let a=i;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const u=o.amr||[];return{data:{currentLevel:i,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await It(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new ps})})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new ps});const i=await It(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return i.data&&i.data.redirect_url&&Cn()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(n){if(Pt(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new ps});const i=await It(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return i.data&&i.data.redirect_url&&Cn()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(n){if(Pt(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await It(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new ps})})}catch(t){if(Pt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?(await It(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ps})})}catch(r){if(Pt(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(a=>a.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===t),n&&this.jwks_cached_at+oH>s)return n;const{data:o,error:i}=await It(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(a=>a.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:f,error:p}=await this.getSession();if(p||!f.session)return this._returnResult({data:null,error:p});n=f.session.access_token}const{header:s,payload:o,signature:i,raw:{header:a,payload:l}}=H_(n);r!=null&&r.allowExpired||SH(o.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!u){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:o,header:s,signature:i},error:null}}const h=CH(s.alg),c=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,c,i,pH(`${a}.${l}`)))throw new Mw("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(n){if(Pt(n))return this._returnResult({data:null,error:n});throw n}}}Id.nextInstanceID={};const iK=Id;class aK extends iK{constructor(t){super(t)}}class lK{constructor(t,r,n){var s,o,i;this.supabaseUrl=t,this.supabaseKey=r;const a=eH(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,u={db:H6,realtime:q6,auth:Object.assign(Object.assign({},K6),{storageKey:l}),global:G6},h=Z6(n??{},u);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(c,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=h.auth)!==null&&i!==void 0?i:{},this.headers,h.global.fetch),this.fetch=J6(r,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(c=>this.realtime.setAuth(c)).catch(c=>console.warn("Failed to set initial Realtime auth token:",c)),this.rest=new qG(new URL("rest/v1",a).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new U6(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new GG(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:i,flowType:a,lock:l,debug:u,throwOnError:h},c,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new aK({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),c),storageKey:i,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:a,lock:l,debug:u,throwOnError:h,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new d6(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const uK=(e,t,r)=>new lK(e,t,r);function cK(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}cK()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const dK=void 0,hK=void 0,fK=uK(dK,hK,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),pK=()=>{const[e,t]=Q.useState(!1),[r,n]=Q.useState(""),[s,o]=Q.useState(null),{toast:i}=Wd(),a=Q.useCallback(async()=>{try{const u=await navigator.mediaDevices.getUserMedia({audio:!0}),h=new MediaRecorder(u),c=[];h.ondataavailable=d=>{c.push(d.data)},h.onstop=async()=>{const d=new Blob(c,{type:"audio/webm"}),f=new FileReader;f.onloadend=async()=>{const p=f.result.split(",")[1];try{const{data:m,error:b}=await fK.functions.invoke("voice-transcribe",{body:{audio:p}});if(b)throw b;n(m.text),i({title:"Voice Recognized",description:m.text})}catch(m){console.error("Transcription error:",m),i({title:"Transcription Failed",description:"Could not process voice input",variant:"destructive"})}},f.readAsDataURL(d)},h.start(),o(h),t(!0),n("Listening...")}catch(u){console.error("Error accessing microphone:",u),i({title:"Microphone Access Denied",description:"Please allow microphone access to use voice commands",variant:"destructive"})}},[i]),l=Q.useCallback(()=>{s&&s.state!=="inactive"&&(s.stop(),s.stream.getTracks().forEach(u=>u.stop()),t(!1))},[s]);return{isListening:e,transcript:r,startListening:a,stopListening:l}},UR=()=>{const[e,t]=Q.useState(!1),{toast:r}=Wd();return{processCommand:async(s,o,i)=>{t(!0);try{console.log("Sending command to AEOS Orchestrator:",{command:s,division:o,context:i}),await new Promise(u=>setTimeout(u,1e3));let a=null;const l=s.toLowerCase();return l.includes("planetary")||l.includes("venus")?a={response:`PLANETARY MONITORING REPORT:
 VENUS: Atmospheric pressure nominal. Probe V-9 active.
 MARS: Terraforming sim running. Colony Alpha supports life.
 JUPITER: Storm tracking on Great Red Spot. Radiation levels high.
 MOON: Lunar Gateway operational. Helium-3 mining optimized.`,division:"EID - Earth Intelligence",tool_usage:[{tool:"Deep Space Relay",input:"Solar System Scan",output:"Data Received"}],collaboration_log:["Aggregating data from deployed AI probes."],sentiment:"neutral",cost_incurred:.05,timestamp:new Date().toISOString()}:l.includes("weather")?a={response:`GLOBAL WEATHER MATRIX:
 NORTH AMERICA: Polar Vortex stabilizing. Temp -5C.
 APAC: Monsoon season early warning. Rainfall +20%.
 EMEA: Heatwave detected in Southern Sector. Grid load 95%.
 LATAM: Amazon humidity levels optimal for regeneration.`,division:"EID",tool_usage:[{tool:"Global Atmos Scan",input:"Multi-Region",output:"Map Generated"}],collaboration_log:[],sentiment:"neutral",cost_incurred:.02,timestamp:new Date().toISOString()}:l.includes("satellite")||l.includes("uplink")?a={response:`SATELLITE CONSTELLATION STATUS:
 SAT-1 (Optics): 100% Uptime. Resolution 50cm.
 SAT-2 (Radar): Tracking maritime logistics in Pacific.
 SAT-3 (Comms): Relaying secure Masumi Block data.
 SAT-4 (Infrared): Wildfire detection active in Sector 4.`,division:"EID",tool_usage:[{tool:"Orbital Feed",input:"Constellation Link",output:"Connected"}],collaboration_log:[],sentiment:"neutral",cost_incurred:.04,timestamp:new Date().toISOString()}:l.includes("disaster")?a={response:`DISASTER FORECAST SYSTEM:
 FLOOD: Critical Risk in Delta Region. Probability 89%.
 FIRE: High Risk in California Sector. Drone Swarm deployed.
 QUAKE: Minor tremors detected in Ring of Fire. Mag 2.3.
 STORM: Category 1 Cyclone forming in Atlantic.`,division:"EID",tool_usage:[{tool:"Risk Prediction Model",input:"Seismic Sensors",output:"Alert"}],collaboration_log:["Triggering Drone Swarm for aerial survey."],sentiment:"serious",cost_incurred:.02,timestamp:new Date().toISOString()}:l.includes("marketing")?a={response:`MARKETING OPERATIONS CENTER:
 EMAIL: Open rate 24%. A/B test 'Subject Line B' winning.
 SOCIAL: Viral trend detected on Twitter. Auto-replying.
 SEO: Ranking #1 for 'AI OS'. Traffic +15% WoW.
 ADS: CPA reduced by 12% via autonomous bid optimization.`,division:"ENID",tool_usage:[{tool:"Campaign Manager",input:"Multi-Channel",output:"Active"}],collaboration_log:[],sentiment:"positive",cost_incurred:.015,timestamp:new Date().toISOString()}:l.includes("workflow")?a={response:`WORKFLOW AUTOMATION METRICS:
 HR: Onboarding time reduced from 5 days to 4 hours.
 PROCUREMENT: Supplier invoices auto-paid via smart contract.
 IT: 45 support tickets resolved by Level 1 AI Agent.
 SALES: CRM updated with 200 new leads from web scraper.`,division:"ENID",tool_usage:[{tool:"Process Miner",input:"Corporate Logs",output:"Optimized"}],collaboration_log:[],sentiment:"positive",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("compliance")||l.includes("kyc")?a={response:`COMPLIANCE & IDENTITY SHIELD:
 KYC: User ID verified against Interpol database.
 AML: No suspicious transaction patterns detected.
 GDPR: Data privacy request processed automatically.
 SANCTIONS: Wallet address clean across 15 jurisdictions.`,division:"ENID",tool_usage:[{tool:"RegTech Scanner",input:"Global Database",output:"Verified"}],collaboration_log:[],sentiment:"secure",cost_incurred:.02,timestamp:new Date().toISOString()}:l.includes("audit")?a={response:`SMART AUDIT LOGS:
 TX-882: Treasury payout confirmed. Block #99281.
 AUTH: Admin login via DID at 14:02 UTC.
 DATA: EID accessed sensitive satellite feed. Authorized.
 CONFIG: Policy update deployed to ENID-Core.`,division:"ENID",tool_usage:[{tool:"Ledger Verifier",input:"Cardano Chain",output:"Synced"}],collaboration_log:[],sentiment:"secure",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("yield")?a={response:`YIELD FARMING OPPORTUNITIES:
 ADA/MIN: 12.5% APY. Low impermanent loss risk.
 ADA/AGIX: 8.2% APY. High volume pool.
 STABLE/ADA: 4.5% APY. Safe haven allocation.
 LENDING: Supply rate 3.1% on Liqwid Protocol.`,division:"DTAD",tool_usage:[{tool:"Liquidity Scanner",input:"DEX Aggregator",output:"Found"}],collaboration_log:[],sentiment:"positive",cost_incurred:.03,timestamp:new Date().toISOString()}:l.includes("treasury")?a={response:`TREASURY ALLOCATION:
 NATIVE (ADA): 60% - Staked for network security.
 STABLES: 25% - Dry powder for dips.
 GOVERNANCE: 10% - Voting power in partner DAOs.
 RWA: 5% - Tokenized real estate bonds.`,division:"DTAD",tool_usage:[{tool:"Asset Manager",input:"DAO Vault",output:"Balanced"}],collaboration_log:[],sentiment:"neutral",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("risk")?a={response:`RISK ASSESSMENT PROFILE:
 CREDIT SCORE: 850 (Excellent). Eligible for under-collateral loans.
 VOLATILITY: Portfolio Beta 0.85 (Lower than market).
 LIQUIDATION: Health factor 2.4. Safe from margin calls.
 DIVERSIFICATION: High. Exposure to 12 asset classes.`,division:"DTAD",tool_usage:[{tool:"Credit Engine",input:"Wallet Graph",output:"Scored"}],collaboration_log:[],sentiment:"positive",cost_incurred:.02,timestamp:new Date().toISOString()}:l.includes("pay")||l.includes("instant")?a={response:`PAYMENT ACTIVITY LOG:
 SENT: 50 ADA to User-Alice (Settled < 1s).
 RECEIVED: 200 DJED from Merchant-Bob.
 SUBSCRIPTION: Paid 5 ADA for Oracle Feed (Auto-renew).
 PENDING: Multisig approval needed for 10k ADA transfer.`,division:"DTAD",tool_usage:[{tool:"Payment Rail",input:"Hydra Head",output:"Settled"}],collaboration_log:[],sentiment:"neutral",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("support")?a={response:`ACTIVE SUPPORT SESSIONS:
 USER-1: Requesting API key reset. Handling...
 USER-2: Asking about staking APY. Answered.
 USER-3: Reporting bug in mobile UI. Logged.
 SYSTEM: All agents operating at 99.9% uptime.`,division:"HID",tool_usage:[{tool:"Chat Engine",input:"Queue",output:"Active"}],collaboration_log:[],sentiment:"positive",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("personal")?a={response:`USER PERSONALIZATION PROFILE:
 PREFERENCE: Dark Mode, High Density Data.
 INTERESTS: DeFi, Space Tech, Governance.
 ACTIVITY: High frequency trader (Asia Timezone).
 SUGGESTION: Enable 'Pro Mode' for advanced charts.`,division:"HID",tool_usage:[{tool:"User Graph",input:"Behavior",output:"Mapped"}],collaboration_log:[],sentiment:"neutral",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("ticket")||l.includes("resolve")?a={response:`TICKET RESOLUTION STATS:
 OPEN: 3 (Low Priority).
 RESOLVED: 142 today (Auto-closed by AI).
 ESCALATED: 0 requiring human intervention.
 CSAT SCORE: 4.8/5.0 based on recent feedback.`,division:"HID",tool_usage:[{tool:"Ticket Master",input:"CRM",output:"Updated"}],collaboration_log:[],sentiment:"positive",cost_incurred:.01,timestamp:new Date().toISOString()}:l.includes("voice")?a={response:`VOICE INTERFACE METRICS:
 ACCURACY: 98.2% Word Error Rate.
 LANGUAGE: English (US) detected. Dialect: West Coast.
 SENTIMENT: Calm/Professional tone analyzed.
 SECURITY: Voiceprint matches User-Admin-01.`,division:"HID",tool_usage:[{tool:"Voice Biometrics",input:"Audio Stream",output:"Secure"}],collaboration_log:[],sentiment:"secure",cost_incurred:.01,timestamp:new Date().toISOString()}:a={response:`AEOS Core processing: "${s}". Routing to ${o||"appropriate division"}.`,division:o||"AEOS Core",tool_usage:[],collaboration_log:[],sentiment:"neutral",cost_incurred:0,timestamp:new Date().toISOString()},console.log("AEOS response:",a),a}catch(a){return console.error("Error processing command:",a),r({title:"Processing Failed",description:a.message||"Failed to process command",variant:"destructive"}),null}finally{t(!1)}},isProcessing:e}},sp=new Map,La=[],mK=(e,t,r)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){const n=sp.get(e);if(n===void 0)sp.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){const s=La.indexOf(e);s!==-1&&La.splice(s,1);for(let o=0;o<La.length;o++)if(sp.get(La[o]).priority<=r){La.splice(o,0,e);return}La.push(e)}return}throw new TypeError("not a valid backend")},gK=async e=>{const t=sp.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{const r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(n){return r||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},_K=async e=>{const t=e.executionProviders||[],r=t.map(l=>typeof l=="string"?l:l.name),n=r.length===0?La:r;let s;const o=[],i=new Set;for(const l of n){const u=await gK(l);typeof u=="string"?o.push({name:l,err:u}):(s||(s=u),s===u&&i.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${o.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(const{name:l,err:u}of o)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);const a=t.filter(l=>i.has(typeof l=="string"?l:l.name));return[s,new Proxy(e,{get:(l,u)=>u==="executionProviders"?a:Reflect.get(l,u)})]},yK="1.21.0";let VC="warning";const xo={wasm:{},webgl:{},webgpu:{},versions:{common:yK},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);VC=e}},get logLevel(){return VC}};Object.defineProperty(xo,"logLevel",{enumerable:!0});const vK=xo,wK=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];const n=r.getContext("2d");if(n!=null){let s,o;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[3]):(s=e.dims[3],o=e.dims[2]);const i=(t==null?void 0:t.format)!==void 0?t.format:"RGB",a=t==null?void 0:t.norm;let l,u;a===void 0||a.mean===void 0?l=[255,255,255,255]:typeof a.mean=="number"?l=[a.mean,a.mean,a.mean,a.mean]:(l=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(l[3]=a.mean[3])),a===void 0||a.bias===void 0?u=[0,0,0,0]:typeof a.bias=="number"?u=[a.bias,a.bias,a.bias,a.bias]:(u=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(u[3]=a.bias[3]));const h=o*s;let c=0,d=h,f=h*2,p=-1;i==="RGBA"?(c=0,d=h,f=h*2,p=h*3):i==="RGB"?(c=0,d=h,f=h*2):i==="RBG"&&(c=0,f=h,d=h*2);for(let m=0;m<o;m++)for(let b=0;b<s;b++){const g=(e.data[c++]-u[0])*l[0],_=(e.data[d++]-u[1])*l[1],y=(e.data[f++]-u[2])*l[2],v=p===-1?255:(e.data[p++]-u[3])*l[3];n.fillStyle="rgba("+g+","+_+","+y+","+v+")",n.fillRect(b,m,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},bK=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let s,o,i;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[1],i=e.dims[3]):(s=e.dims[3],o=e.dims[2],i=e.dims[1]);const a=t!==void 0&&t.format!==void 0?t.format:"RGB",l=t==null?void 0:t.norm;let u,h;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?h=[0,0,0,0]:typeof l.bias=="number"?h=[l.bias,l.bias,l.bias,l.bias]:(h=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(h[3]=l.bias[3]));const c=o*s;if(t!==void 0&&(t.format!==void 0&&i===4&&t.format!=="RGBA"||i===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const d=4;let f=0,p=1,m=2,b=3,g=0,_=c,y=c*2,v=-1;a==="RGBA"?(g=0,_=c,y=c*2,v=c*3):a==="RGB"?(g=0,_=c,y=c*2):a==="RBG"&&(g=0,y=c,_=c*2),n=r.createImageData(s,o);for(let M=0;M<o*s;f+=d,p+=d,m+=d,b+=d,M++)n.data[f]=(e.data[g++]-h[0])*u[0],n.data[p]=(e.data[_++]-h[1])*u[1],n.data[m]=(e.data[y++]-h[2])*u[2],n.data[b]=v===-1?255:(e.data[v++]-h[3])*u[3]}else throw new Error("Can not access image data");return n},Q_=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=t,s=t.norm??{mean:255,bias:0};let o,i;typeof s.mean=="number"?o=[s.mean,s.mean,s.mean,s.mean]:o=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?i=[s.bias,s.bias,s.bias,s.bias]:i=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];const a=t.format!==void 0?t.format:"RGBA",l=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",u=r*n,h=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3);let c=4,d=0,f=1,p=2,m=3,b=0,g=u,_=u*2,y=-1;a==="RGB"&&(c=3,d=0,f=1,p=2,m=-1),l==="RGBA"?y=u*3:l==="RBG"?(b=0,_=u,g=u*2):l==="BGR"&&(_=0,g=u,b=u*2);for(let M=0;M<u;M++,d+=c,p+=c,f+=c,m+=c)h[b++]=(e[d]+i[0])/o[0],h[g++]=(e[f]+i[1])/o[1],h[_++]=(e[p]+i[2])/o[2],y!==-1&&m!==-1&&(h[y++]=(e[m]+i[3])/o[3]);return l==="RGBA"?new Vs("float32",h,[1,4,r,n]):new Vs("float32",h,[1,3,r,n])},xK=async(e,t)=>{const r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,s=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string";let i,a=t??{};const l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=h=>typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(r){const h=l();h.width=e.width,h.height=e.height;const c=u(h);if(c!=null){let d=e.height,f=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(d=t.resizedHeight,f=t.resizedWidth),t!==void 0){if(a=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=d,a.width=f}else a.tensorFormat="RGBA",a.height=d,a.width=f;c.drawImage(e,0,0),i=c.getImageData(0,0,f,d).data}else throw new Error("Can not access image data")}else if(n){let h,c;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(h=t.resizedHeight,c=t.resizedWidth):(h=e.height,c=e.width),t!==void 0&&(a=t),a.format="RGBA",a.height=h,a.width=c,t!==void 0){const d=l();d.width=c,d.height=h;const f=u(d);if(f!=null)f.putImageData(e,0,0),i=f.getImageData(0,0,c,h).data;else throw new Error("Can not access image data")}else i=e.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");const h=l();h.width=e.width,h.height=e.height;const c=u(h);if(c!=null){const d=e.height,f=e.width;return c.drawImage(e,0,0,f,d),i=c.getImageData(0,0,f,d).data,a.height=d,a.width=f,Q_(i,a)}else throw new Error("Can not access image data")}else{if(o)return new Promise((h,c)=>{const d=l(),f=u(d);if(!e||!f)return c();const p=new Image;p.crossOrigin="Anonymous",p.src=e,p.onload=()=>{d.width=p.width,d.height=p.height,f.drawImage(p,0,0,d.width,d.height);const m=f.getImageData(0,0,d.width,d.height);a.height=d.height,a.width=d.width,h(Q_(m.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(i!==void 0)return Q_(i,a);throw new Error("Input data provided is not supported - aborted tensor creation")},MK=(e,t)=>{const{width:r,height:n,download:s,dispose:o}=t,i=[1,n,r,4];return new Vs({location:"texture",type:"float32",texture:e,dims:i,download:s,dispose:o})},TK=(e,t)=>{const{dataType:r,dims:n,download:s,dispose:o}=t;return new Vs({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:s,dispose:o})},EK=(e,t)=>{const{dataType:r,dims:n,download:s,dispose:o}=t;return new Vs({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:s,dispose:o})},PK=(e,t,r)=>new Vs({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]}),ou=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),op=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let WC=!1;const SK=()=>{if(!WC){WC=!0;const e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(ou.set("int64",BigInt64Array),op.set(BigInt64Array,"int64")),t&&(ou.set("uint64",BigUint64Array),op.set(BigUint64Array,"uint64")),n?(ou.set("float16",r),op.set(r,"float16")):ou.set("float16",Uint16Array)}},CK=e=>{let t=1;for(let r=0;r<e.length;r++){const n=e[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},kK=(e,t)=>{switch(e.location){case"cpu":return new Vs(e.type,e.data,t);case"cpu-pinned":return new Vs({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Vs({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Vs({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Vs({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}};let Vs=class{constructor(t,r,n){SK();let s,o;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,s=t.type,o=t.dims,t.location){case"cpu-pinned":{const a=ou.get(s);if(!a)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(t.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=t.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,l;if(typeof t=="string")if(s=t,l=n,t==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");a=r}else{const u=ou.get(t);if(u===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(r)){if(t==="float16"&&u===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${u.name} as data.`);t==="uint64"||t==="int64"?a=u.from(r,BigInt):a=u.from(r)}else if(r instanceof u)a=r;else if(r instanceof Uint8ClampedArray)if(t==="uint8")a=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&r instanceof Uint16Array&&u!==Uint16Array)a=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${s} tensor's data must be type of ${u}`)}else if(l=r,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const u=typeof t[0];if(u==="string")s="string",a=t;else if(u==="boolean")s="bool",a=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${u}.`)}else if(t instanceof Uint8ClampedArray)s="uint8",a=Uint8Array.from(t);else{const u=op.get(t.constructor);if(u===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);s=u,a=t}if(l===void 0)l=[a.length];else if(!Array.isArray(l))throw new TypeError("A tensor's dims must be a number array");o=l,this.cpuData=a,this.dataLocation="cpu"}const i=CK(o);if(this.cpuData&&i!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(i/2)===this.cpuData.length))throw new Error(`Tensor's size(${i}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=o,this.size=i}static async fromImage(t,r){return xK(t,r)}static fromTexture(t,r){return MK(t,r)}static fromGpuBuffer(t,r){return TK(t,r)}static fromMLTensor(t,r){return EK(t,r)}static fromPinnedBuffer(t,r,n){return PK(t,r,n)}toDataURL(t){return wK(this,t)}toImageData(t){return bK(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,t&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return kK(this,t)}};const Gl=Vs,VR=(e,t)=>{(typeof xo.trace>"u"?!xo.wasm.trace:!xo.trace)||console.timeStamp(`${e}::ORT::${t}`)},WR=(e,t)=>{var s;const r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[];let n=!1;for(let o=0;o<r.length;o++){if(n&&!r[o].includes("TRACE_FUNC")){let i=`FUNC_${e}::${r[o].trim().split(" ")[1]}`;t&&(i+=`::${t}`),VR("CPU",i);return}r[o].includes("TRACE_FUNC")&&(n=!0)}},Tw=e=>{(typeof xo.trace>"u"?!xo.wasm.trace:!xo.trace)||WR("BEGIN",e)},Ew=e=>{(typeof xo.trace>"u"?!xo.wasm.trace:!xo.trace)||WR("END",e)};let $K=class GR{constructor(t){this.handler=t}async run(t,r,n){Tw();const s={};let o={};if(typeof t!="object"||t===null||t instanceof Gl||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let i=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof Gl)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");i=!1;for(const u of r){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);s[u]=null}if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let u=!1;const h=Object.getOwnPropertyNames(r);for(const c of this.outputNames)if(h.indexOf(c)!==-1){const d=r[c];(d===null||d instanceof Gl)&&(u=!0,i=!1,s[c]=d)}if(u){if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else o=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const u of this.inputNames)if(typeof t[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(i)for(const u of this.outputNames)s[u]=null;const a=await this.handler.run(t,s,o),l={};for(const u in a)if(Object.hasOwnProperty.call(a,u)){const h=a[u];h instanceof Gl?l[u]=h:l[u]=new Gl(h.type,h.data,h.dims)}return Ew(),l}async release(){return this.handler.dispose()}static async create(t,r,n,s){Tw();let o,i={};if(typeof t=="string"){if(o=t,typeof r=="object"&&r!==null)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof r=="object"&&r!==null)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){const h=t;let c=0,d=t.byteLength;if(typeof r=="object"&&r!==null)i=r;else if(typeof r=="number"){if(c=r,!Number.isSafeInteger(c))throw new RangeError("'byteOffset' must be an integer.");if(c<0||c>=h.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${h.byteLength}).`);if(d=t.byteLength-c,typeof n=="number"){if(d=n,!Number.isSafeInteger(d))throw new RangeError("'byteLength' must be an integer.");if(d<=0||c+d>h.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${h.byteLength-c}].`);if(typeof s=="object"&&s!==null)i=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(h,c,d)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[a,l]=await _K(i),u=await a.createInferenceSessionHandler(o,l);return Ew(),new GR(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const AK=$K,IK=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:AK,TRACE:VR,TRACE_FUNC_BEGIN:Tw,TRACE_FUNC_END:Ew,Tensor:Gl,env:vK,registerBackend:mK},Symbol.toStringTag,{value:"Module"}));/*!
 * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var hb=Object.defineProperty,OK=Object.getOwnPropertyDescriptor,DK=Object.getOwnPropertyNames,FK=Object.prototype.hasOwnProperty,RK=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Ke=(e,t)=>()=>(e&&(t=e(e=0)),t),Ku=(e,t)=>{for(var r in t)hb(e,r,{get:t[r],enumerable:!0})},LK=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of DK(t))!FK.call(e,s)&&s!==r&&hb(e,s,{get:()=>t[s],enumerable:!(n=OK(t,s))||n.enumerable});return e},Od=e=>LK(hb({},"__esModule",{value:!0}),e),kc,Ci,Ka,GC,HR,KR=Ke(()=>{kc=new Map,Ci=[],Ka=(e,t,r)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let n=kc.get(e);if(n===void 0)kc.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){let s=Ci.indexOf(e);s!==-1&&Ci.splice(s,1);for(let o=0;o<Ci.length;o++)if(kc.get(Ci[o]).priority<=r){Ci.splice(o,0,e);return}Ci.push(e)}return}throw new TypeError("not a valid backend")},GC=async e=>{let t=kc.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(n){return r||(t.error=`${n}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},HR=async e=>{let t=e.executionProviders||[],r=t.map(l=>typeof l=="string"?l:l.name),n=r.length===0?Ci:r,s,o=[],i=new Set;for(let l of n){let u=await GC(l);typeof u=="string"?o.push({name:l,err:u}):(s||(s=u),s===u&&i.add(l))}if(!s)throw new Error(`no available backend found. ERR: ${o.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:u}of o)r.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);let a=t.filter(l=>i.has(typeof l=="string"?l:l.name));return[s,new Proxy(e,{get:(l,u)=>u==="executionProviders"?a:Reflect.get(l,u)})]}}),NK=Ke(()=>{KR()}),qR,jK=Ke(()=>{qR="1.22.0-dev.20250409-89f8206ba4"}),X_,Ns,QR=Ke(()=>{jK(),X_="warning",Ns={wasm:{},webgl:{},webgpu:{},versions:{common:qR},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);X_=e}},get logLevel(){return X_}},Object.defineProperty(Ns,"logLevel",{enumerable:!0})}),yr,zK=Ke(()=>{QR(),yr=Ns}),XR,JR,BK=Ke(()=>{XR=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(n!=null){let s,o;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[3]):(s=e.dims[3],o=e.dims[2]);let i=(t==null?void 0:t.format)!==void 0?t.format:"RGB",a=t==null?void 0:t.norm,l,u;a===void 0||a.mean===void 0?l=[255,255,255,255]:typeof a.mean=="number"?l=[a.mean,a.mean,a.mean,a.mean]:(l=[a.mean[0],a.mean[1],a.mean[2],0],a.mean[3]!==void 0&&(l[3]=a.mean[3])),a===void 0||a.bias===void 0?u=[0,0,0,0]:typeof a.bias=="number"?u=[a.bias,a.bias,a.bias,a.bias]:(u=[a.bias[0],a.bias[1],a.bias[2],0],a.bias[3]!==void 0&&(u[3]=a.bias[3]));let h=o*s,c=0,d=h,f=h*2,p=-1;i==="RGBA"?(c=0,d=h,f=h*2,p=h*3):i==="RGB"?(c=0,d=h,f=h*2):i==="RBG"&&(c=0,f=h,d=h*2);for(let m=0;m<o;m++)for(let b=0;b<s;b++){let g=(e.data[c++]-u[0])*l[0],_=(e.data[d++]-u[1])*l[1],y=(e.data[f++]-u[2])*l[2],v=p===-1?255:(e.data[p++]-u[3])*l[3];n.fillStyle="rgba("+g+","+_+","+y+","+v+")",n.fillRect(b,m,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},JR=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(r!=null){let s,o,i;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[1],i=e.dims[3]):(s=e.dims[3],o=e.dims[2],i=e.dims[1]);let a=t!==void 0&&t.format!==void 0?t.format:"RGB",l=t==null?void 0:t.norm,u,h;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?h=[0,0,0,0]:typeof l.bias=="number"?h=[l.bias,l.bias,l.bias,l.bias]:(h=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(h[3]=l.bias[3]));let c=o*s;if(t!==void 0&&(t.format!==void 0&&i===4&&t.format!=="RGBA"||i===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let d=4,f=0,p=1,m=2,b=3,g=0,_=c,y=c*2,v=-1;a==="RGBA"?(g=0,_=c,y=c*2,v=c*3):a==="RGB"?(g=0,_=c,y=c*2):a==="RBG"&&(g=0,y=c,_=c*2),n=r.createImageData(s,o);for(let M=0;M<o*s;f+=d,p+=d,m+=d,b+=d,M++)n.data[f]=(e.data[g++]-h[0])*u[0],n.data[p]=(e.data[_++]-h[1])*u[1],n.data[m]=(e.data[y++]-h[2])*u[2],n.data[b]=v===-1?255:(e.data[v++]-h[3])*u[3]}else throw new Error("Can not access image data");return n}}),Ef,YR,ZR,eL,tL,rL,UK=Ke(()=>{fb(),Ef=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:r,width:n}=t,s=t.norm??{mean:255,bias:0},o,i;typeof s.mean=="number"?o=[s.mean,s.mean,s.mean,s.mean]:o=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?i=[s.bias,s.bias,s.bias,s.bias]:i=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let a=t.format!==void 0?t.format:"RGBA",l=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",u=r*n,h=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3),c=4,d=0,f=1,p=2,m=3,b=0,g=u,_=u*2,y=-1;a==="RGB"&&(c=3,d=0,f=1,p=2,m=-1),l==="RGBA"?y=u*3:l==="RBG"?(b=0,_=u,g=u*2):l==="BGR"&&(_=0,g=u,b=u*2);for(let v=0;v<u;v++,d+=c,p+=c,f+=c,m+=c)h[b++]=(e[d]+i[0])/o[0],h[g++]=(e[f]+i[1])/o[1],h[_++]=(e[p]+i[2])/o[2],y!==-1&&m!==-1&&(h[y++]=(e[m]+i[3])/o[3]);return l==="RGBA"?new ys("float32",h,[1,4,r,n]):new ys("float32",h,[1,3,r,n])},YR=async(e,t)=>{let r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,n=typeof ImageData<"u"&&e instanceof ImageData,s=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",i,a=t??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=h=>typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(r){let h=l();h.width=e.width,h.height=e.height;let c=u(h);if(c!=null){let d=e.height,f=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(d=t.resizedHeight,f=t.resizedWidth),t!==void 0){if(a=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");a.tensorFormat="RGBA",a.height=d,a.width=f}else a.tensorFormat="RGBA",a.height=d,a.width=f;c.drawImage(e,0,0),i=c.getImageData(0,0,f,d).data}else throw new Error("Can not access image data")}else if(n){let h,c;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(h=t.resizedHeight,c=t.resizedWidth):(h=e.height,c=e.width),t!==void 0&&(a=t),a.format="RGBA",a.height=h,a.width=c,t!==void 0){let d=l();d.width=c,d.height=h;let f=u(d);if(f!=null)f.putImageData(e,0,0),i=f.getImageData(0,0,c,h).data;else throw new Error("Can not access image data")}else i=e.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let h=l();h.width=e.width,h.height=e.height;let c=u(h);if(c!=null){let d=e.height,f=e.width;return c.drawImage(e,0,0,f,d),i=c.getImageData(0,0,f,d).data,a.height=d,a.width=f,Ef(i,a)}else throw new Error("Can not access image data")}else{if(o)return new Promise((h,c)=>{let d=l(),f=u(d);if(!e||!f)return c();let p=new Image;p.crossOrigin="Anonymous",p.src=e,p.onload=()=>{d.width=p.width,d.height=p.height,f.drawImage(p,0,0,d.width,d.height);let m=f.getImageData(0,0,d.width,d.height);a.height=d.height,a.width=d.width,h(Ef(m.data,a))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(i!==void 0)return Ef(i,a);throw new Error("Input data provided is not supported - aborted tensor creation")},ZR=(e,t)=>{let{width:r,height:n,download:s,dispose:o}=t,i=[1,n,r,4];return new ys({location:"texture",type:"float32",texture:e,dims:i,download:s,dispose:o})},eL=(e,t)=>{let{dataType:r,dims:n,download:s,dispose:o}=t;return new ys({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:s,dispose:o})},tL=(e,t)=>{let{dataType:r,dims:n,download:s,dispose:o}=t;return new ys({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:s,dispose:o})},rL=(e,t,r)=>new ys({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),Ba,Wc,J_,nL,VK=Ke(()=>{Ba=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Wc=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),J_=!1,nL=()=>{if(!J_){J_=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(Ba.set("int64",BigInt64Array),Wc.set(BigInt64Array,"int64")),t&&(Ba.set("uint64",BigUint64Array),Wc.set(BigUint64Array,"uint64")),n?(Ba.set("float16",r),Wc.set(r,"float16")):Ba.set("float16",Uint16Array)}}}),sL,oL,WK=Ke(()=>{fb(),sL=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},oL=(e,t)=>{switch(e.location){case"cpu":return new ys(e.type,e.data,t);case"cpu-pinned":return new ys({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new ys({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new ys({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new ys({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),ys,fb=Ke(()=>{BK(),UK(),VK(),WK(),ys=class{constructor(e,t,r){nL();let n,s;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,n=e.type,s=e.dims,e.location){case"cpu-pinned":{let i=Ba.get(n);if(!i)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof i))throw new TypeError(`buffer should be of type ${i.name}`);this.cpuData=e.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let i,a;if(typeof e=="string")if(n=e,a=r,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");i=t}else{let l=Ba.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&l===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${l.name} as data.`);e==="uint64"||e==="int64"?i=l.from(t,BigInt):i=l.from(t)}else if(t instanceof l)i=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")i=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&l!==Uint16Array)i=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${n} tensor's data must be type of ${l}`)}else if(a=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof e[0];if(l==="string")n="string",i=e;else if(l==="boolean")n="bool",i=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(e instanceof Uint8ClampedArray)n="uint8",i=Uint8Array.from(e);else{let l=Wc.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=l,i=e}if(a===void 0)a=[i.length];else if(!Array.isArray(a))throw new TypeError("A tensor's dims must be a number array");s=a,this.cpuData=i,this.dataLocation="cpu"}let o=sL(s);if(this.cpuData&&o!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=s,this.size=o}static async fromImage(e,t){return YR(e,t)}static fromTexture(e,t){return ZR(e,t)}static fromGpuBuffer(e,t){return eL(e,t)}static fromMLTensor(e,t){return tL(e,t)}static fromPinnedBuffer(e,t,r){return rL(e,t,r)}toDataURL(e){return XR(this,e)}toImageData(e){return JR(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return oL(this,e)}}}),vo,iL=Ke(()=>{fb(),vo=ys}),Dd,Y_,Po,Hs,aL=Ke(()=>{QR(),Dd=(e,t)=>{(typeof Ns.trace>"u"?!Ns.wasm.trace:!Ns.trace)||console.timeStamp(`${e}::ORT::${t}`)},Y_=(e,t)=>{var s;let r=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[],n=!1;for(let o=0;o<r.length;o++){if(n&&!r[o].includes("TRACE_FUNC")){let i=`FUNC_${e}::${r[o].trim().split(" ")[1]}`;t&&(i+=`::${t}`),Dd("CPU",i);return}r[o].includes("TRACE_FUNC")&&(n=!0)}},Po=e=>{(typeof Ns.trace>"u"?!Ns.wasm.trace:!Ns.trace)||Y_("BEGIN",e)},Hs=e=>{(typeof Ns.trace>"u"?!Ns.wasm.trace:!Ns.trace)||Y_("END",e)}}),lL,GK=Ke(()=>{KR(),iL(),aL(),lL=class uL{constructor(t){this.handler=t}async run(t,r,n){Po();let s={},o={};if(typeof t!="object"||t===null||t instanceof vo||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let i=!0;if(typeof r=="object"){if(r===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof vo)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(r.length===0)throw new TypeError("'fetches' cannot be an empty array.");i=!1;for(let u of r){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);s[u]=null}if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let u=!1,h=Object.getOwnPropertyNames(r);for(let c of this.outputNames)if(h.indexOf(c)!==-1){let d=r[c];(d===null||d instanceof vo)&&(u=!0,i=!1,s[c]=d)}if(u){if(typeof n=="object"&&n!==null)o=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else o=r}}else if(typeof r<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let u of this.inputNames)if(typeof t[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(i)for(let u of this.outputNames)s[u]=null;let a=await this.handler.run(t,s,o),l={};for(let u in a)if(Object.hasOwnProperty.call(a,u)){let h=a[u];h instanceof vo?l[u]=h:l[u]=new vo(h.type,h.data,h.dims)}return Hs(),l}async release(){return this.handler.dispose()}static async create(t,r,n,s){Po();let o,i={};if(typeof t=="string"){if(o=t,typeof r=="object"&&r!==null)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof r=="object"&&r!==null)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let h=t,c=0,d=t.byteLength;if(typeof r=="object"&&r!==null)i=r;else if(typeof r=="number"){if(c=r,!Number.isSafeInteger(c))throw new RangeError("'byteOffset' must be an integer.");if(c<0||c>=h.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${h.byteLength}).`);if(d=t.byteLength-c,typeof n=="number"){if(d=n,!Number.isSafeInteger(d))throw new RangeError("'byteLength' must be an integer.");if(d<=0||c+d>h.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${h.byteLength-c}].`);if(typeof s=="object"&&s!==null)i=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(h,c,d)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[a,l]=await HR(i),u=await a.createInferenceSessionHandler(o,l);return Hs(),new uL(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),pb,HK=Ke(()=>{GK(),pb=lL}),KK=Ke(()=>{}),qK=Ke(()=>{}),QK=Ke(()=>{}),XK=Ke(()=>{}),cL={};Ku(cL,{InferenceSession:()=>pb,TRACE:()=>Dd,TRACE_FUNC_BEGIN:()=>Po,TRACE_FUNC_END:()=>Hs,Tensor:()=>vo,env:()=>yr,registerBackend:()=>Ka});var So=Ke(()=>{NK(),zK(),HK(),iL(),KK(),qK(),aL(),QK(),XK()}),mb=Ke(()=>{}),dL={};Ku(dL,{default:()=>hL});var Z_,ey,hL,JK=Ke(()=>{var e;_j(),pl(),gb(),Z_="ort-wasm-proxy-worker",ey=((e=globalThis.self)==null?void 0:e.name)===Z_,ey&&(self.onmessage=t=>{let{type:r,in:n}=t.data;try{switch(r){case"init-wasm":_b(n.wasm).then(()=>{Fb(n).then(()=>{postMessage({type:r})},s=>{postMessage({type:r,err:s})})},s=>{postMessage({type:r,err:s})});break;case"init-ep":{let{epName:s,env:o}=n;Rb(o,s).then(()=>{postMessage({type:r})},i=>{postMessage({type:r,err:i})});break}case"copy-from":{let{buffer:s}=n,o=Yp(s);postMessage({type:r,out:o});break}case"create":{let{model:s,options:o}=n;Lb(s,o).then(i=>{postMessage({type:r,out:i})},i=>{postMessage({type:r,err:i})});break}case"release":Nb(n),postMessage({type:r});break;case"run":{let{sessionId:s,inputIndices:o,inputs:i,outputIndices:a,options:l}=n;jb(s,o,i,a,new Array(a.length).fill(null),l).then(u=>{u.some(h=>h[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:u},Bb([...i,...u]))},u=>{postMessage({type:r,err:u})});break}case"end-profiling":zb(n),postMessage({type:r});break;default:}}catch(s){postMessage({type:r,err:s})}}),hL=ey?null:t=>new Worker(t??ms,{type:"module",name:Z_})}),fL={};Ku(fL,{default:()=>pL});var ty,ry,pL,HC,YK=Ke(()=>{var e,t;ry=(ty=import.meta.url,async function(r={}){var mc;var n,s,o=r,i=new Promise((w,C)=>{n=w,s=C}),a=typeof window=="object",l=typeof WorkerGlobalScope<"u",u=l&&((mc=self.name)==null?void 0:mc.startsWith("em-pthread"));o.mountExternalData=(w,C)=>{w.startsWith("./")&&(w=w.substring(2)),(o.Eb||(o.Eb=new Map)).set(w,C)},o.unmountExternalData=()=>{delete o.Eb};var h=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let c=w=>async(...C)=>{var D;try{if(o.Fb)throw Error("Session already started");let j=o.Fb={dc:C[0],errors:[]},K=await w(...C);if(o.Fb!==j)throw Error("Session mismatch");(D=o.Jb)==null||D.flush();let fe=j.errors;if(0<fe.length){let Ae=await Promise.all(fe);if(Ae=Ae.filter(Ue=>Ue),0<Ae.length)throw Error(Ae.join(`
`))}return K}finally{o.Fb=null}};o.jsepInit=(w,C)=>{if(w==="webgpu"){[o.Jb,o.Ub,o.Yb,o.Kb,o.Xb,o.jb,o.Zb,o.ac,o.Vb,o.Wb,o.$b]=C;let D=o.Jb;o.jsepRegisterBuffer=(j,K,fe,Ae)=>D.registerBuffer(j,K,fe,Ae),o.jsepGetBuffer=j=>D.getBuffer(j),o.jsepCreateDownloader=(j,K,fe)=>D.createDownloader(j,K,fe),o.jsepOnCreateSession=j=>{D.onCreateSession(j)},o.jsepOnReleaseSession=j=>{D.onReleaseSession(j)},o.jsepOnRunStart=j=>D.onRunStart(j),o.bc=(j,K)=>{D.upload(j,K)}}else if(w==="webnn"){let D=C[0];[o.nc,o.Nb,o.webnnEnsureTensor,o.Ob,o.webnnDownloadTensor]=C.slice(1),o.webnnReleaseTensorId=o.Nb,o.webnnUploadTensor=o.Ob,o.webnnOnRunStart=j=>D.onRunStart(j),o.webnnOnRunEnd=D.onRunEnd.bind(D),o.webnnRegisterMLContext=(j,K)=>{D.registerMLContext(j,K)},o.webnnOnReleaseSession=j=>{D.onReleaseSession(j)},o.webnnCreateMLTensorDownloader=(j,K)=>D.createMLTensorDownloader(j,K),o.webnnRegisterMLTensor=(j,K,fe,Ae)=>D.registerMLTensor(j,K,fe,Ae),o.webnnCreateMLContext=j=>D.createMLContext(j),o.webnnRegisterMLConstant=(j,K,fe,Ae,Ue,et)=>D.registerMLConstant(j,K,fe,Ae,Ue,o.Eb,et),o.webnnRegisterGraphInput=D.registerGraphInput.bind(D),o.webnnIsGraphInput=D.isGraphInput.bind(D),o.webnnCreateTemporaryTensor=D.createTemporaryTensor.bind(D),o.webnnIsInt64Supported=D.isInt64Supported.bind(D)}};let d=()=>{let w=(C,D,j)=>(...K)=>{let fe=Pr,Ae=D==null?void 0:D();K=C(...K);let Ue=D==null?void 0:D();return Ae!==Ue&&(C=Ue,j(Ae),D=j=null),Pr!=fe?new Promise((et,ht)=>{bn={resolve:et,reject:ht}}):K};(()=>{for(let C of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])o[C]=w(o[C],()=>o[C],D=>o[C]=D)})(),c!==void 0&&(o._OrtRun=c(o._OrtRun),o._OrtRunWithBinding=c(o._OrtRunWithBinding)),d=void 0};o.asyncInit=()=>{d==null||d()};var f,p,m=Object.assign({},o),b=(w,C)=>{throw C},g="";(a||l)&&(l?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),ty&&(g=ty),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(p=w=>{var C=new XMLHttpRequest;return C.open("GET",w,!1),C.responseType="arraybuffer",C.send(null),new Uint8Array(C.response)}),f=async w=>{if(oe(w))return new Promise((D,j)=>{var K=new XMLHttpRequest;K.open("GET",w,!0),K.responseType="arraybuffer",K.onload=()=>{K.status==200||K.status==0&&K.response?D(K.response):j(K.status)},K.onerror=j,K.send(null)});var C=await fetch(w,{credentials:"same-origin"});if(C.ok)return C.arrayBuffer();throw Error(C.status+" : "+C.url)});var _=console.log.bind(console),y=console.error.bind(console),v=_,M=y;Object.assign(o,m),m=null;var E,T,S,A,I,V,N,z,q,G,ee,Y,W,te=o.wasmBinary,le=!1,oe=w=>w.startsWith("file://");function U(){return E.buffer!=A.buffer&&F(),A}function R(){return E.buffer!=A.buffer&&F(),I}function X(){return E.buffer!=A.buffer&&F(),V}function ce(){return E.buffer!=A.buffer&&F(),N}function ne(){return E.buffer!=A.buffer&&F(),z}function we(){return E.buffer!=A.buffer&&F(),q}function De(){return E.buffer!=A.buffer&&F(),G}function Be(){return E.buffer!=A.buffer&&F(),W}if(u){let w=function(C){try{var D=C.data,j=D.Bb;if(j==="load"){let K=[];self.onmessage=fe=>K.push(fe),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let fe of K)w(fe);self.onmessage=w};for(let fe of D.Rb)o[fe]&&!o[fe].proxy||(o[fe]=(...Ae)=>{postMessage({Bb:"callHandler",Qb:fe,args:Ae})},fe=="print"&&(v=o[fe]),fe=="printErr"&&(M=o[fe]));E=D.kc,F(),$e(D.lc)}else if(j==="run"){Qs(D.Ab),ba(D.Ab,0,0,1,0,0),wn(),he(D.Ab),se||(ac(),se=!0);try{ko(D.fc,D.Hb)}catch(K){if(K!="unwind")throw K}}else D.target!=="setimmediate"&&(j==="checkMailbox"?se&&me():j&&(M(`worker: received unknown command ${j}`),M(D)))}catch(K){throw lc(),K}};var $e,se=!1;M=function(...C){C=C.join(" "),console.error(C)},self.alert=function(...C){postMessage({Bb:"alert",text:C.join(" "),ic:wi()})},self.onunhandledrejection=C=>{throw C.reason||C},self.onmessage=w}function F(){var w=E.buffer;o.HEAP8=A=new Int8Array(w),o.HEAP16=V=new Int16Array(w),o.HEAPU8=I=new Uint8Array(w),o.HEAPU16=N=new Uint16Array(w),o.HEAP32=z=new Int32Array(w),o.HEAPU32=q=new Uint32Array(w),o.HEAPF32=G=new Float32Array(w),o.HEAPF64=W=new Float64Array(w),o.HEAP64=ee=new BigInt64Array(w),o.HEAPU64=Y=new BigUint64Array(w)}function pe(){u?startWorker(o):vt.Ca()}u||(E=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),F());var Ee,Me=0,Pe=null;function ye(){if(--Me==0&&Pe){var w=Pe;Pe=null,w()}}function ke(w){throw M(w="Aborted("+w+")"),le=!0,w=new WebAssembly.RuntimeError(w+". Build with -sASSERTIONS for more info."),s(w),w}function be(){return{a:{L:Je,Aa:je,b:Yr,$:Ge,A:$,pa:re,X:ue,Z:xe,qa:Re,na:dt,ga:Ct,ma:Tt,J:Ot,Y:lt,V:Kt,oa:ur,W:In,va:Zr,E:Ao,Q:As,O:On,D:We,u:ut,r:cr,P:qo,z:ge,R:O,ja:H,T:Ie,aa:st,M:Ye,F:at,ia:he,sa:$t,t:Ar,Ba:ar,w:xn,o:sn,l:Qr,c:Is,n:Rs,j:Xd,v:Jd,p:yi,f:Yd,s:Zd,m:eh,e:th,k:rh,i:vi,g:nh,d:sh,da:oh,ea:ih,fa:ah,ba:yl,ca:Ju,N:vl,xa:Dm,ua:Yu,h:ch,C:dh,G:hh,ta:uh,x:fh,ra:ph,U:mh,q:lh,y:gh,K:_h,S:Zu,za:yh,ya:ec,ka:tc,la:wh,_:bt,B:rc,I:xl,ha:nc,H:sc,a:E,wa:qe}}}var Oe={829644:(w,C,D,j,K)=>{if(o===void 0||!o.Eb)return 1;if((w=Wt(Number(w>>>0))).startsWith("./")&&(w=w.substring(2)),!(w=o.Eb.get(w)))return 2;if(C=Number(C>>>0),D=Number(D>>>0),j=Number(j>>>0),C+D>w.byteLength)return 3;try{let fe=w.subarray(C,C+D);switch(K){case 0:R().set(fe,j>>>0);break;case 1:o.mc?o.mc(j,fe):o.bc(j,fe);break;default:return 4}return 0}catch{return 4}},830468:(w,C,D)=>{o.Ob(w,R().subarray(C>>>0,C+D>>>0))},830532:()=>o.nc(),830574:w=>{o.Nb(w)},830611:()=>{o.Vb()},830642:()=>{o.Wb()},830671:()=>{o.$b()},830696:w=>o.Ub(w),830729:w=>o.Yb(w),830761:(w,C,D)=>{o.Kb(Number(w),Number(C),Number(D),!0)},830824:(w,C,D)=>{o.Kb(Number(w),Number(C),Number(D))},830881:()=>typeof wasmOffsetConverter<"u",830938:w=>{o.jb("Abs",w,void 0)},830989:w=>{o.jb("Neg",w,void 0)},831040:w=>{o.jb("Floor",w,void 0)},831093:w=>{o.jb("Ceil",w,void 0)},831145:w=>{o.jb("Reciprocal",w,void 0)},831203:w=>{o.jb("Sqrt",w,void 0)},831255:w=>{o.jb("Exp",w,void 0)},831306:w=>{o.jb("Erf",w,void 0)},831357:w=>{o.jb("Sigmoid",w,void 0)},831412:(w,C,D)=>{o.jb("HardSigmoid",w,{alpha:C,beta:D})},831491:w=>{o.jb("Log",w,void 0)},831542:w=>{o.jb("Sin",w,void 0)},831593:w=>{o.jb("Cos",w,void 0)},831644:w=>{o.jb("Tan",w,void 0)},831695:w=>{o.jb("Asin",w,void 0)},831747:w=>{o.jb("Acos",w,void 0)},831799:w=>{o.jb("Atan",w,void 0)},831851:w=>{o.jb("Sinh",w,void 0)},831903:w=>{o.jb("Cosh",w,void 0)},831955:w=>{o.jb("Asinh",w,void 0)},832008:w=>{o.jb("Acosh",w,void 0)},832061:w=>{o.jb("Atanh",w,void 0)},832114:w=>{o.jb("Tanh",w,void 0)},832166:w=>{o.jb("Not",w,void 0)},832217:(w,C,D)=>{o.jb("Clip",w,{min:C,max:D})},832286:w=>{o.jb("Clip",w,void 0)},832338:(w,C)=>{o.jb("Elu",w,{alpha:C})},832396:w=>{o.jb("Gelu",w,void 0)},832448:w=>{o.jb("Relu",w,void 0)},832500:(w,C)=>{o.jb("LeakyRelu",w,{alpha:C})},832564:(w,C)=>{o.jb("ThresholdedRelu",w,{alpha:C})},832634:(w,C)=>{o.jb("Cast",w,{to:C})},832692:w=>{o.jb("Add",w,void 0)},832743:w=>{o.jb("Sub",w,void 0)},832794:w=>{o.jb("Mul",w,void 0)},832845:w=>{o.jb("Div",w,void 0)},832896:w=>{o.jb("Pow",w,void 0)},832947:w=>{o.jb("Equal",w,void 0)},833e3:w=>{o.jb("Greater",w,void 0)},833055:w=>{o.jb("GreaterOrEqual",w,void 0)},833117:w=>{o.jb("Less",w,void 0)},833169:w=>{o.jb("LessOrEqual",w,void 0)},833228:(w,C,D,j,K)=>{o.jb("ReduceMean",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},833403:(w,C,D,j,K)=>{o.jb("ReduceMax",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},833577:(w,C,D,j,K)=>{o.jb("ReduceMin",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},833751:(w,C,D,j,K)=>{o.jb("ReduceProd",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},833926:(w,C,D,j,K)=>{o.jb("ReduceSum",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834100:(w,C,D,j,K)=>{o.jb("ReduceL1",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834273:(w,C,D,j,K)=>{o.jb("ReduceL2",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834446:(w,C,D,j,K)=>{o.jb("ReduceLogSum",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834623:(w,C,D,j,K)=>{o.jb("ReduceSumSquare",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834803:(w,C,D,j,K)=>{o.jb("ReduceLogSumExp",w,{keepDims:!!C,noopWithEmptyAxes:!!D,axes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},834983:w=>{o.jb("Where",w,void 0)},835036:(w,C,D)=>{o.jb("Transpose",w,{perm:C?Array.from(ne().subarray(Number(C)>>>0,Number(D)>>>0)):[]})},835160:(w,C,D,j)=>{o.jb("DepthToSpace",w,{blocksize:C,mode:Wt(D),format:j?"NHWC":"NCHW"})},835293:(w,C,D,j)=>{o.jb("DepthToSpace",w,{blocksize:C,mode:Wt(D),format:j?"NHWC":"NCHW"})},835426:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on,Xo)=>{o.jb("ConvTranspose",w,{format:et?"NHWC":"NCHW",autoPad:C,dilations:[D],group:j,kernelShape:[K],pads:[fe,Ae],strides:[Ue],wIsConst:()=>!!U()[ht>>>0],outputPadding:Ft?Array.from(ne().subarray(Number(Ft)>>>0,Number(Qt)>>>0)):[],outputShape:rr?Array.from(ne().subarray(Number(rr)>>>0,Number(on)>>>0)):[],activation:Wt(Xo)})},835859:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("ConvTranspose",w,{format:Ue?"NHWC":"NCHW",autoPad:C,dilations:Array.from(ne().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),group:j,kernelShape:Array.from(ne().subarray(Number(K)>>>0,2+(Number(K)>>>0)>>>0)),pads:Array.from(ne().subarray(Number(fe)>>>0,4+(Number(fe)>>>0)>>>0)),strides:Array.from(ne().subarray(Number(Ae)>>>0,2+(Number(Ae)>>>0)>>>0)),wIsConst:()=>!!U()[et>>>0],outputPadding:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],outputShape:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[],activation:Wt(on)})},836520:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on,Xo)=>{o.jb("ConvTranspose",w,{format:et?"NHWC":"NCHW",autoPad:C,dilations:[D],group:j,kernelShape:[K],pads:[fe,Ae],strides:[Ue],wIsConst:()=>!!U()[ht>>>0],outputPadding:Ft?Array.from(ne().subarray(Number(Ft)>>>0,Number(Qt)>>>0)):[],outputShape:rr?Array.from(ne().subarray(Number(rr)>>>0,Number(on)>>>0)):[],activation:Wt(Xo)})},836953:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("ConvTranspose",w,{format:Ue?"NHWC":"NCHW",autoPad:C,dilations:Array.from(ne().subarray(Number(D)>>>0,2+(Number(D)>>>0)>>>0)),group:j,kernelShape:Array.from(ne().subarray(Number(K)>>>0,2+(Number(K)>>>0)>>>0)),pads:Array.from(ne().subarray(Number(fe)>>>0,4+(Number(fe)>>>0)>>>0)),strides:Array.from(ne().subarray(Number(Ae)>>>0,2+(Number(Ae)>>>0)>>>0)),wIsConst:()=>!!U()[et>>>0],outputPadding:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],outputShape:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[],activation:Wt(on)})},837614:(w,C)=>{o.jb("GlobalAveragePool",w,{format:C?"NHWC":"NCHW"})},837705:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("AveragePool",w,{format:on?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:j,storage_order:K,dilations:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[],kernel_shape:Ue?Array.from(ne().subarray(Number(Ue)>>>0,Number(et)>>>0)):[],pads:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],strides:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[]})},838184:(w,C)=>{o.jb("GlobalAveragePool",w,{format:C?"NHWC":"NCHW"})},838275:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("AveragePool",w,{format:on?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:j,storage_order:K,dilations:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[],kernel_shape:Ue?Array.from(ne().subarray(Number(Ue)>>>0,Number(et)>>>0)):[],pads:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],strides:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[]})},838754:(w,C)=>{o.jb("GlobalMaxPool",w,{format:C?"NHWC":"NCHW"})},838841:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("MaxPool",w,{format:on?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:j,storage_order:K,dilations:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[],kernel_shape:Ue?Array.from(ne().subarray(Number(Ue)>>>0,Number(et)>>>0)):[],pads:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],strides:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[]})},839316:(w,C)=>{o.jb("GlobalMaxPool",w,{format:C?"NHWC":"NCHW"})},839403:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on)=>{o.jb("MaxPool",w,{format:on?"NHWC":"NCHW",auto_pad:C,ceil_mode:D,count_include_pad:j,storage_order:K,dilations:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[],kernel_shape:Ue?Array.from(ne().subarray(Number(Ue)>>>0,Number(et)>>>0)):[],pads:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],strides:Qt?Array.from(ne().subarray(Number(Qt)>>>0,Number(rr)>>>0)):[]})},839878:(w,C,D,j,K)=>{o.jb("Gemm",w,{alpha:C,beta:D,transA:j,transB:K})},839982:w=>{o.jb("MatMul",w,void 0)},840036:(w,C,D,j)=>{o.jb("ArgMax",w,{keepDims:!!C,selectLastIndex:!!D,axis:j})},840144:(w,C,D,j)=>{o.jb("ArgMin",w,{keepDims:!!C,selectLastIndex:!!D,axis:j})},840252:(w,C)=>{o.jb("Softmax",w,{axis:C})},840315:(w,C)=>{o.jb("Concat",w,{axis:C})},840375:(w,C,D,j,K)=>{o.jb("Split",w,{axis:C,numOutputs:D,splitSizes:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},840531:w=>{o.jb("Expand",w,void 0)},840585:(w,C)=>{o.jb("Gather",w,{axis:Number(C)})},840656:(w,C)=>{o.jb("GatherElements",w,{axis:Number(C)})},840735:(w,C)=>{o.jb("GatherND",w,{batch_dims:Number(C)})},840814:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft)=>{o.jb("Resize",w,{antialias:C,axes:D?Array.from(ne().subarray(Number(D)>>>0,Number(j)>>>0)):[],coordinateTransformMode:Wt(K),cubicCoeffA:fe,excludeOutside:Ae,extrapolationValue:Ue,keepAspectRatioPolicy:Wt(et),mode:Wt(ht),nearestMode:Wt(Ft)})},841176:(w,C,D,j,K,fe,Ae)=>{o.jb("Slice",w,{starts:C?Array.from(ne().subarray(Number(C)>>>0,Number(D)>>>0)):[],ends:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[],axes:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[]})},841440:w=>{o.jb("Tile",w,void 0)},841492:(w,C,D)=>{o.jb("InstanceNormalization",w,{epsilon:C,format:D?"NHWC":"NCHW"})},841606:(w,C,D)=>{o.jb("InstanceNormalization",w,{epsilon:C,format:D?"NHWC":"NCHW"})},841720:w=>{o.jb("Range",w,void 0)},841773:(w,C)=>{o.jb("Einsum",w,{equation:Wt(C)})},841854:(w,C,D,j,K)=>{o.jb("Pad",w,{mode:C,value:D,pads:j?Array.from(ne().subarray(Number(j)>>>0,Number(K)>>>0)):[]})},841997:(w,C,D,j,K,fe)=>{o.jb("BatchNormalization",w,{epsilon:C,momentum:D,spatial:!!K,trainingMode:!!j,format:fe?"NHWC":"NCHW"})},842166:(w,C,D,j,K,fe)=>{o.jb("BatchNormalization",w,{epsilon:C,momentum:D,spatial:!!K,trainingMode:!!j,format:fe?"NHWC":"NCHW"})},842335:(w,C,D)=>{o.jb("CumSum",w,{exclusive:Number(C),reverse:Number(D)})},842432:(w,C,D)=>{o.jb("DequantizeLinear",w,{axis:C,blockSize:D})},842522:(w,C,D,j,K)=>{o.jb("GridSample",w,{align_corners:C,mode:Wt(D),padding_mode:Wt(j),format:K?"NHWC":"NCHW"})},842692:(w,C,D,j,K)=>{o.jb("GridSample",w,{align_corners:C,mode:Wt(D),padding_mode:Wt(j),format:K?"NHWC":"NCHW"})},842862:(w,C)=>{o.jb("ScatterND",w,{reduction:Wt(C)})},842947:(w,C,D,j,K,fe,Ae,Ue,et)=>{o.jb("Attention",w,{numHeads:C,isUnidirectional:D,maskFilterValue:j,scale:K,doRotary:fe,qkvHiddenSizes:Ae?Array.from(ne().subarray(Number(Ue)>>>0,Number(Ue)+Ae>>>0)):[],pastPresentShareBuffer:!!et})},843219:w=>{o.jb("BiasAdd",w,void 0)},843274:w=>{o.jb("BiasSplitGelu",w,void 0)},843335:w=>{o.jb("FastGelu",w,void 0)},843391:(w,C,D,j,K,fe,Ae,Ue,et,ht,Ft,Qt,rr,on,Xo,gc)=>{o.jb("Conv",w,{format:Qt?"NHWC":"NCHW",auto_pad:C,dilations:D?Array.from(ne().subarray(Number(D)>>>0,Number(j)>>>0)):[],group:K,kernel_shape:fe?Array.from(ne().subarray(Number(fe)>>>0,Number(Ae)>>>0)):[],pads:Ue?Array.from(ne().subarray(Number(Ue)>>>0,Number(et)>>>0)):[],strides:ht?Array.from(ne().subarray(Number(ht)>>>0,Number(Ft)>>>0)):[],w_is_const:()=>!!U()[Number(rr)>>>0],activation:Wt(on),activation_params:Xo?Array.from(De().subarray(Number(Xo)>>>0,Number(gc)>>>0)):[]})},843975:w=>{o.jb("Gelu",w,void 0)},844027:(w,C,D,j,K,fe,Ae,Ue,et)=>{o.jb("GroupQueryAttention",w,{numHeads:C,kvNumHeads:D,scale:j,softcap:K,doRotary:fe,rotaryInterleaved:Ae,smoothSoftmax:Ue,localWindowSize:et})},844244:(w,C,D,j)=>{o.jb("LayerNormalization",w,{axis:C,epsilon:D,simplified:!!j})},844355:(w,C,D,j)=>{o.jb("LayerNormalization",w,{axis:C,epsilon:D,simplified:!!j})},844466:(w,C,D,j,K,fe)=>{o.jb("MatMulNBits",w,{k:C,n:D,accuracyLevel:j,bits:K,blockSize:fe})},844593:(w,C,D,j,K,fe)=>{o.jb("MultiHeadAttention",w,{numHeads:C,isUnidirectional:D,maskFilterValue:j,scale:K,doRotary:fe})},844752:(w,C)=>{o.jb("QuickGelu",w,{alpha:C})},844816:(w,C,D,j,K)=>{o.jb("RotaryEmbedding",w,{interleaved:!!C,numHeads:D,rotaryEmbeddingDim:j,scale:K})},844955:(w,C,D)=>{o.jb("SkipLayerNormalization",w,{epsilon:C,simplified:!!D})},845057:(w,C,D)=>{o.jb("SkipLayerNormalization",w,{epsilon:C,simplified:!!D})},845159:(w,C,D,j)=>{o.jb("GatherBlockQuantized",w,{gatherAxis:C,quantizeAxis:D,blockSize:j})},845280:w=>{o.Zb(w)},845314:(w,C)=>o.ac(Number(w),Number(C),o.Fb.dc,o.Fb.errors)};function je(w,C,D){return Fs(async()=>{await o.Xb(Number(w),Number(C),Number(D))})}function Je(){return typeof wasmOffsetConverter<"u"}class Te{constructor(C){ae(this,"name","ExitStatus");this.message=`Program terminated with exit(${C})`,this.status=C}}var ot=w=>{w.terminate(),w.onmessage=()=>{}},Ze=[],it=w=>{jt.length==0&&(Kr(),mr(jt[0]));var C=jt.pop();if(!C)return 6;yt.push(C),Hr[w.Ab]=C,C.Ab=w.Ab;var D={Bb:"run",fc:w.ec,Hb:w.Hb,Ab:w.Ab};return C.postMessage(D,w.Mb),0},nt=0,Ne=(w,C,...D)=>{for(var j=2*D.length,K=Pl(),fe=Ma(8*j),Ae=fe>>>3,Ue=0;Ue<D.length;Ue++){var et=D[Ue];typeof et=="bigint"?(ee[Ae+2*Ue]=1n,ee[Ae+2*Ue+1]=et):(ee[Ae+2*Ue]=0n,Be()[Ae+2*Ue+1>>>0]=et)}return w=uc(w,0,j,fe,C),xa(K),w};function qe(w){if(u)return Ne(0,1,w);if(S=w,!(0<nt)){for(var C of yt)ot(C);for(C of jt)ot(C);jt=[],yt=[],Hr={},le=!0}b(0,new Te(w))}function Mt(w){if(u)return Ne(1,0,w);bt(w)}var bt=w=>{if(S=w,u)throw Mt(w),"unwind";qe(w)},jt=[],yt=[],pr=[],Hr={},Rr=w=>{var C=w.Ab;delete Hr[C],jt.push(w),yt.splice(yt.indexOf(w),1),w.Ab=0,Ml(C)};function wn(){pr.forEach(w=>w())}var mr=w=>new Promise(C=>{w.onmessage=K=>{var fe=(K=K.data).Bb;if(K.Gb&&K.Gb!=wi()){var Ae=Hr[K.Gb];Ae?Ae.postMessage(K,K.Mb):M(`Internal error! Worker sent a message "${fe}" to target pthread ${K.Gb}, but that thread no longer exists!`)}else fe==="checkMailbox"?me():fe==="spawnThread"?it(K):fe==="cleanupThread"?Rr(Hr[K.hc]):fe==="loaded"?(w.loaded=!0,C(w)):fe==="alert"?alert(`Thread ${K.ic}: ${K.text}`):K.target==="setimmediate"?w.postMessage(K):fe==="callHandler"?o[K.Qb](...K.args):fe&&M(`worker sent an unknown command ${fe}`)},w.onerror=K=>{throw M(`worker sent an error! ${K.filename}:${K.lineno}: ${K.message}`),K};var D,j=[];for(D of[])o.propertyIsEnumerable(D)&&j.push(D);w.postMessage({Bb:"load",Rb:j,kc:E,lc:T})});function Kr(){var w=new Worker((()=>{let C=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new C("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});jt.push(w)}var Qs=w=>{F();var C=we()[w+52>>>2>>>0];w=we()[w+56>>>2>>>0],dc(C,C-w),xa(C)},ko=(w,C)=>{nt=0,w=hc(w,C),0<nt?S=w:Tl(w)};class Cs{constructor(C){this.Ib=C-24}}function Yr(w,C,D){var j=new Cs(w>>>=0);throw C>>>=0,D>>>=0,we()[j.Ib+16>>>2>>>0]=0,we()[j.Ib+4>>>2>>>0]=C,we()[j.Ib+8>>>2>>>0]=D,w}function Xs(w,C,D,j){return u?Ne(2,1,w,C,D,j):Ge(w,C,D,j)}function Ge(w,C,D,j){if(w>>>=0,D>>>=0,j>>>=0,h===void 0)return 6;var K=[];return u&&K.length===0?Xs(w,C>>>=0,D,j):(w={ec:D,Ab:w,Hb:j,Mb:K},u?(w.Bb="spawnThread",postMessage(w,K),0):it(w))}var Ht=typeof TextDecoder<"u"?new TextDecoder:void 0,ct=(w,C=0,D=NaN)=>{var j=(C>>>=0)+D;for(D=C;w[D]&&!(D>=j);)++D;if(16<D-C&&w.buffer&&Ht)return Ht.decode(w.buffer instanceof ArrayBuffer?w.subarray(C,D):w.slice(C,D));for(j="";C<D;){var K=w[C++];if(128&K){var fe=63&w[C++];if((224&K)==192)j+=String.fromCharCode((31&K)<<6|fe);else{var Ae=63&w[C++];65536>(K=(240&K)==224?(15&K)<<12|fe<<6|Ae:(7&K)<<18|fe<<12|Ae<<6|63&w[C++])?j+=String.fromCharCode(K):(K-=65536,j+=String.fromCharCode(55296|K>>10,56320|1023&K))}}else j+=String.fromCharCode(K)}return j},Wt=(w,C)=>(w>>>=0)?ct(R(),w,C):"";function $(w,C,D){return u?Ne(3,1,w,C,D):0}function re(w,C){if(u)return Ne(4,1,w,C)}var B=w=>{for(var C=0,D=0;D<w.length;++D){var j=w.charCodeAt(D);127>=j?C++:2047>=j?C+=2:55296<=j&&57343>=j?(C+=4,++D):C+=3}return C},Z=(w,C,D)=>{var j=R();if(C>>>=0,0<D){var K=C;D=C+D-1;for(var fe=0;fe<w.length;++fe){var Ae=w.charCodeAt(fe);if(55296<=Ae&&57343>=Ae&&(Ae=65536+((1023&Ae)<<10)|1023&w.charCodeAt(++fe)),127>=Ae){if(C>=D)break;j[C++>>>0]=Ae}else{if(2047>=Ae){if(C+1>=D)break;j[C++>>>0]=192|Ae>>6}else{if(65535>=Ae){if(C+2>=D)break;j[C++>>>0]=224|Ae>>12}else{if(C+3>=D)break;j[C++>>>0]=240|Ae>>18,j[C++>>>0]=128|Ae>>12&63}j[C++>>>0]=128|Ae>>6&63}j[C++>>>0]=128|63&Ae}}j[C>>>0]=0,w=C-K}else w=0;return w};function ue(w,C){if(u)return Ne(5,1,w,C)}function xe(w,C,D){if(u)return Ne(6,1,w,C,D)}function Re(w,C,D){return u?Ne(7,1,w,C,D):0}function dt(w,C){if(u)return Ne(8,1,w,C)}function Ct(w,C,D){if(u)return Ne(9,1,w,C,D)}function Tt(w,C,D,j){if(u)return Ne(10,1,w,C,D,j)}function Ot(w,C,D,j){if(u)return Ne(11,1,w,C,D,j)}function lt(w,C,D,j){if(u)return Ne(12,1,w,C,D,j)}function Kt(w){if(u)return Ne(13,1,w)}function ur(w,C){if(u)return Ne(14,1,w,C)}function In(w,C,D){if(u)return Ne(15,1,w,C,D)}var Vn,Lr,Zr=()=>ke(""),Nr=w=>{for(var C="";R()[w>>>0];)C+=Vn[R()[w++>>>0]];return C},ks={},$s={};function fn(w,C,D={}){return function(j,K,fe={}){var Ae=K.name;if(!j)throw new Lr(`type "${Ae}" must have a positive integer typeid pointer`);if($s.hasOwnProperty(j)){if(fe.Sb)return;throw new Lr(`Cannot register type '${Ae}' twice`)}$s[j]=K,ks.hasOwnProperty(j)&&(K=ks[j],delete ks[j],K.forEach(Ue=>Ue()))}(w,C,D)}var $o=(w,C,D)=>{switch(C){case 1:return D?j=>U()[j>>>0]:j=>R()[j>>>0];case 2:return D?j=>X()[j>>>1>>>0]:j=>ce()[j>>>1>>>0];case 4:return D?j=>ne()[j>>>2>>>0]:j=>we()[j>>>2>>>0];case 8:return D?j=>ee[j>>>3]:j=>Y[j>>>3];default:throw new TypeError(`invalid integer width (${C}): ${w}`)}};function Ao(w,C,D){D>>>=0,fn(w>>>=0,{name:C=Nr(C>>>0),fromWireType:j=>j,toWireType:function(j,K){if(typeof K!="bigint"&&typeof K!="number")throw K=K===null?"null":(j=typeof K)=="object"||j==="array"||j==="function"?K.toString():""+K,new TypeError(`Cannot convert "${K}" to ${this.name}`);return typeof K=="number"&&(K=BigInt(K)),K},Cb:rn,readValueFromPointer:$o(C,D,C.indexOf("u")==-1),Db:null})}var rn=8;function As(w,C,D,j){fn(w>>>=0,{name:C=Nr(C>>>0),fromWireType:function(K){return!!K},toWireType:function(K,fe){return fe?D:j},Cb:rn,readValueFromPointer:function(K){return this.fromWireType(R()[K>>>0])},Db:null})}var rs=[],Pn=[];function Is(w){9<(w>>>=0)&&--Pn[w+1]==0&&(Pn[w]=void 0,rs.push(w))}var qr=w=>{if(!w)throw new Lr("Cannot use deleted val. handle = "+w);return Pn[w]},$r=w=>{switch(w){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let C=rs.pop()||Pn.length;return Pn[C]=w,Pn[C+1]=1,C}};function Os(w){return this.fromWireType(we()[w>>>2>>>0])}var Ko={name:"emscripten::val",fromWireType:w=>{var C=qr(w);return Is(w),C},toWireType:(w,C)=>$r(C),Cb:rn,readValueFromPointer:Os,Db:null};function On(w){return fn(w>>>0,Ko)}var Ve=(w,C)=>{switch(C){case 4:return function(D){return this.fromWireType(De()[D>>>2>>>0])};case 8:return function(D){return this.fromWireType(Be()[D>>>3>>>0])};default:throw new TypeError(`invalid float width (${C}): ${w}`)}};function We(w,C,D){D>>>=0,fn(w>>>=0,{name:C=Nr(C>>>0),fromWireType:j=>j,toWireType:(j,K)=>K,Cb:rn,readValueFromPointer:Ve(C,D),Db:null})}function ut(w,C,D,j,K){if(w>>>=0,D>>>=0,C=Nr(C>>>0),K===-1&&(K=4294967295),K=Ue=>Ue,j===0){var fe=32-8*D;K=Ue=>Ue<<fe>>>fe}var Ae=C.includes("unsigned")?function(Ue,et){return et>>>0}:function(Ue,et){return et};fn(w,{name:C,fromWireType:K,toWireType:Ae,Cb:rn,readValueFromPointer:$o(C,D,j!==0),Db:null})}function cr(w,C,D){function j(fe){var Ae=we()[fe>>>2>>>0];return fe=we()[fe+4>>>2>>>0],new K(U().buffer,fe,Ae)}var K=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][C];fn(w>>>=0,{name:D=Nr(D>>>0),fromWireType:j,Cb:rn,readValueFromPointer:j},{Sb:!0})}function qo(w,C){fn(w>>>=0,{name:C=Nr(C>>>0),fromWireType:function(D){for(var j,K=we()[D>>>2>>>0],fe=D+4,Ae=fe,Ue=0;Ue<=K;++Ue){var et=fe+Ue;Ue!=K&&R()[et>>>0]!=0||(Ae=Wt(Ae,et-Ae),j===void 0?j=Ae:(j+="\0",j+=Ae),Ae=et+1)}return hs(D),j},toWireType:function(D,j){j instanceof ArrayBuffer&&(j=new Uint8Array(j));var K=typeof j=="string";if(!(K||j instanceof Uint8Array||j instanceof Uint8ClampedArray||j instanceof Int8Array))throw new Lr("Cannot pass non-string to std::string");var fe=K?B(j):j.length,Ae=wa(4+fe+1),Ue=Ae+4;if(we()[Ae>>>2>>>0]=fe,K)Z(j,Ue,fe+1);else if(K)for(K=0;K<fe;++K){var et=j.charCodeAt(K);if(255<et)throw hs(Ae),new Lr("String has UTF-16 code units that do not fit in 8 bits");R()[Ue+K>>>0]=et}else for(K=0;K<fe;++K)R()[Ue+K>>>0]=j[K];return D!==null&&D.push(hs,Ae),Ae},Cb:rn,readValueFromPointer:Os,Db(D){hs(D)}})}var Js=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,ds=(w,C)=>{for(var D=w>>1,j=D+C/2;!(D>=j)&&ce()[D>>>0];)++D;if(32<(D<<=1)-w&&Js)return Js.decode(R().slice(w,D));for(D="",j=0;!(j>=C/2);++j){var K=X()[w+2*j>>>1>>>0];if(K==0)break;D+=String.fromCharCode(K)}return D},da=(w,C,D)=>{if(D??(D=2147483647),2>D)return 0;var j=C;D=(D-=2)<2*w.length?D/2:w.length;for(var K=0;K<D;++K){var fe=w.charCodeAt(K);X()[C>>>1>>>0]=fe,C+=2}return X()[C>>>1>>>0]=0,C-j},ha=w=>2*w.length,fa=(w,C)=>{for(var D=0,j="";!(D>=C/4);){var K=ne()[w+4*D>>>2>>>0];if(K==0)break;++D,65536<=K?(K-=65536,j+=String.fromCharCode(55296|K>>10,56320|1023&K)):j+=String.fromCharCode(K)}return j},pa=(w,C,D)=>{if(C>>>=0,D??(D=2147483647),4>D)return 0;var j=C;D=j+D-4;for(var K=0;K<w.length;++K){var fe=w.charCodeAt(K);if(55296<=fe&&57343>=fe&&(fe=65536+((1023&fe)<<10)|1023&w.charCodeAt(++K)),ne()[C>>>2>>>0]=fe,(C+=4)+4>D)break}return ne()[C>>>2>>>0]=0,C-j},ma=w=>{for(var C=0,D=0;D<w.length;++D){var j=w.charCodeAt(D);55296<=j&&57343>=j&&++D,C+=4}return C};function ge(w,C,D){if(w>>>=0,C>>>=0,D=Nr(D>>>=0),C===2)var j=ds,K=da,fe=ha,Ae=Ue=>ce()[Ue>>>1>>>0];else C===4&&(j=fa,K=pa,fe=ma,Ae=Ue=>we()[Ue>>>2>>>0]);fn(w,{name:D,fromWireType:Ue=>{for(var et,ht=we()[Ue>>>2>>>0],Ft=Ue+4,Qt=0;Qt<=ht;++Qt){var rr=Ue+4+Qt*C;Qt!=ht&&Ae(rr)!=0||(Ft=j(Ft,rr-Ft),et===void 0?et=Ft:(et+="\0",et+=Ft),Ft=rr+C)}return hs(Ue),et},toWireType:(Ue,et)=>{if(typeof et!="string")throw new Lr(`Cannot pass non-string to C++ string type ${D}`);var ht=fe(et),Ft=wa(4+ht+C);return we()[Ft>>>2>>>0]=ht/C,K(et,Ft+4,ht+C),Ue!==null&&Ue.push(hs,Ft),Ft},Cb:rn,readValueFromPointer:Os,Db(Ue){hs(Ue)}})}function O(w,C){fn(w>>>=0,{Tb:!0,name:C=Nr(C>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function H(w){ba(w>>>0,!l,1,!a,131072,!1),wn()}var ie=w=>{if(!le)try{if(w(),!(0<nt))try{u?Tl(S):bt(S)}catch(C){C instanceof Te||C=="unwind"||b(0,C)}}catch(C){C instanceof Te||C=="unwind"||b(0,C)}};function he(w){w>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(ne(),w>>>2,w).value.then(me),w+=128,Atomics.store(ne(),w>>>2,1))}var me=()=>{var w=wi();w&&(he(w),ie(El))};function Ie(w,C){(w>>>=0)==C>>>0?setTimeout(me):u?postMessage({Gb:w,Bb:"checkMailbox"}):(w=Hr[w])&&w.postMessage({Bb:"checkMailbox"})}var He=[];function st(w,C,D,j,K){for(C>>>=0,j/=2,He.length=j,D=K>>>0>>>3,K=0;K<j;K++)He[K]=ee[D+2*K]?ee[D+2*K+1]:Be()[D+2*K+1>>>0];return(C?Oe[C]:xh[w])(...He)}var Ye=()=>{nt=0};function at(w){w>>>=0,u?postMessage({Bb:"cleanupThread",hc:w}):Rr(Hr[w])}function $t(w){}var qt=(w,C)=>{var D=$s[w];if(D===void 0)throw w=ic(w),D=Nr(w),hs(w),new Lr(`${C} has unknown type ${D}`);return D},Yt=(w,C,D)=>{var j=[];return w=w.toWireType(j,D),j.length&&(we()[C>>>2>>>0]=$r(j)),w};function Ar(w,C,D){return C>>>=0,D>>>=0,w=qr(w>>>0),C=qt(C,"emval::as"),Yt(C,D,w)}function ar(w,C){return C>>>=0,w=qr(w>>>0),(C=qt(C,"emval::as")).toWireType(null,w)}var Er=w=>{try{w()}catch(C){ke(C)}},Ir=0,Pr=null,Wn=0,nn=[],Ys={},gr={},jr=0,bn=null,Ds=[];function Fs(w){return function(C){if(!le){if(Ir===0){var D=!1,j=!1;C((K=0)=>{if(!le&&(Wn=K,D=!0,j)){Ir=2,Er(()=>pc(Pr)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),K=!1;try{var fe=function(){var et=ne()[Pr+8>>>2>>>0];return et=vt[gr[et]],--nt,et()}()}catch(et){fe=et,K=!0}var Ae=!1;if(!Pr){var Ue=bn;Ue&&(bn=null,(K?Ue.reject:Ue.resolve)(fe),Ae=!0)}if(K&&!Ae)throw fe}}),j=!0,D||(Ir=1,Pr=function(){var K=wa(65548),fe=K+12;we()[K>>>2>>>0]=fe,we()[K+4>>>2>>>0]=fe+65536,fe=nn[0];var Ae=Ys[fe];return Ae===void 0&&(Ae=jr++,Ys[fe]=Ae,gr[Ae]=fe),fe=Ae,ne()[K+8>>>2>>>0]=fe,K}(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),Er(()=>Sl(Pr)))}else Ir===2?(Ir=0,Er(Cl),hs(Pr),Pr=null,Ds.forEach(ie)):ke(`invalid state: ${Ir}`);return Wn}}(C=>{w().then(C)})}function xn(w){return w>>>=0,Fs(async()=>{var C=await qr(w);return $r(C)})}var Dn=[];function sn(w,C,D,j){return D>>>=0,j>>>=0,(w=Dn[w>>>0])(null,C=qr(C>>>0),D,j)}var zr={},wr=w=>{var C=zr[w];return C===void 0?Nr(w):C};function Qr(w,C,D,j,K){return D>>>=0,j>>>=0,K>>>=0,(w=Dn[w>>>0])(C=qr(C>>>0),C[D=wr(D)],j,K)}var Fn=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Rs(w){return(w>>>=0)==0?$r(Fn()):(w=wr(w),$r(Fn()[w]))}var gl=w=>{var C=Dn.length;return Dn.push(w),C},Qd=(w,C)=>{for(var D=Array(w),j=0;j<w;++j)D[j]=qt(we()[C+4*j>>>2>>>0],"parameter "+j);return D},qu=(w,C)=>Object.defineProperty(C,"name",{value:w});function Xd(w,C,D){var j=(C=Qd(w,C>>>0)).shift();w--;var K=`return function (obj, func, destructorsRef, args) {
`,fe=0,Ae=[];D===0&&Ae.push("obj");for(var Ue=["retType"],et=[j],ht=0;ht<w;++ht)Ae.push("arg"+ht),Ue.push("argType"+ht),et.push(C[ht]),K+=`  var arg${ht} = argType${ht}.readValueFromPointer(args${fe?"+"+fe:""});
`,fe+=C[ht].Cb;return K+=`  var rv = ${D===1?"new func":"func.call"}(${Ae.join(", ")});
`,j.Tb||(Ue.push("emval_returnValue"),et.push(Yt),K+=`  return emval_returnValue(retType, destructorsRef, rv);
`),Ue.push(K+`};
`),w=function(Ft){var Qt=Function;if(!(Qt instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof Qt} which is not a function`);var rr=qu(Qt.name||"unknownFunctionName",function(){});return rr.prototype=Qt.prototype,rr=new rr,(Ft=Qt.apply(rr,Ft))instanceof Object?Ft:rr}(Ue)(...et),D=`methodCaller<(${C.map(Ft=>Ft.name).join(", ")}) => ${j.name}>`,gl(qu(D,w))}function Jd(w){return w=wr(w>>>0),$r(o[w])}function yi(w,C){return C>>>=0,w=qr(w>>>0),C=qr(C),$r(w[C])}function Yd(w){9<(w>>>=0)&&(Pn[w+1]+=1)}function Zd(){return $r([])}function eh(w){w=qr(w>>>0);for(var C=Array(w.length),D=0;D<w.length;D++)C[D]=w[D];return $r(C)}function th(w){return $r(wr(w>>>0))}function rh(){return $r({})}function vi(w){for(var C=qr(w>>>=0);C.length;){var D=C.pop();C.pop()(D)}Is(w)}function nh(w,C,D){C>>>=0,D>>>=0,w=qr(w>>>0),C=qr(C),D=qr(D),w[C]=D}function sh(w,C){return C>>>=0,w=(w=qt(w>>>0,"_emval_take_value")).readValueFromPointer(C),$r(w)}function oh(w,C){w=-9007199254740992>w||9007199254740992<w?NaN:Number(w),C>>>=0,w=new Date(1e3*w),ne()[C>>>2>>>0]=w.getUTCSeconds(),ne()[C+4>>>2>>>0]=w.getUTCMinutes(),ne()[C+8>>>2>>>0]=w.getUTCHours(),ne()[C+12>>>2>>>0]=w.getUTCDate(),ne()[C+16>>>2>>>0]=w.getUTCMonth(),ne()[C+20>>>2>>>0]=w.getUTCFullYear()-1900,ne()[C+24>>>2>>>0]=w.getUTCDay(),w=(w.getTime()-Date.UTC(w.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,ne()[C+28>>>2>>>0]=w}var Qu=w=>w%4==0&&(w%100!=0||w%400==0),Xu=[0,31,60,91,121,152,182,213,244,274,305,335],_l=[0,31,59,90,120,151,181,212,243,273,304,334];function ih(w,C){w=-9007199254740992>w||9007199254740992<w?NaN:Number(w),C>>>=0,w=new Date(1e3*w),ne()[C>>>2>>>0]=w.getSeconds(),ne()[C+4>>>2>>>0]=w.getMinutes(),ne()[C+8>>>2>>>0]=w.getHours(),ne()[C+12>>>2>>>0]=w.getDate(),ne()[C+16>>>2>>>0]=w.getMonth(),ne()[C+20>>>2>>>0]=w.getFullYear()-1900,ne()[C+24>>>2>>>0]=w.getDay();var D=(Qu(w.getFullYear())?Xu:_l)[w.getMonth()]+w.getDate()-1|0;ne()[C+28>>>2>>>0]=D,ne()[C+36>>>2>>>0]=-60*w.getTimezoneOffset(),D=new Date(w.getFullYear(),6,1).getTimezoneOffset();var j=new Date(w.getFullYear(),0,1).getTimezoneOffset();w=0|(D!=j&&w.getTimezoneOffset()==Math.min(j,D)),ne()[C+32>>>2>>>0]=w}function ah(w){w>>>=0;var C=new Date(ne()[w+20>>>2>>>0]+1900,ne()[w+16>>>2>>>0],ne()[w+12>>>2>>>0],ne()[w+8>>>2>>>0],ne()[w+4>>>2>>>0],ne()[w>>>2>>>0],0),D=ne()[w+32>>>2>>>0],j=C.getTimezoneOffset(),K=new Date(C.getFullYear(),6,1).getTimezoneOffset(),fe=new Date(C.getFullYear(),0,1).getTimezoneOffset(),Ae=Math.min(fe,K);return 0>D?ne()[w+32>>>2>>>0]=+(K!=fe&&Ae==j):0<D!=(Ae==j)&&(K=Math.max(fe,K),C.setTime(C.getTime()+6e4*((0<D?Ae:K)-j))),ne()[w+24>>>2>>>0]=C.getDay(),D=(Qu(C.getFullYear())?Xu:_l)[C.getMonth()]+C.getDate()-1|0,ne()[w+28>>>2>>>0]=D,ne()[w>>>2>>>0]=C.getSeconds(),ne()[w+4>>>2>>>0]=C.getMinutes(),ne()[w+8>>>2>>>0]=C.getHours(),ne()[w+12>>>2>>>0]=C.getDate(),ne()[w+16>>>2>>>0]=C.getMonth(),ne()[w+20>>>2>>>0]=C.getYear(),w=C.getTime(),BigInt(isNaN(w)?-1:w/1e3)}function yl(w,C,D,j,K,fe,Ae){return u?Ne(16,1,w,C,D,j,K,fe,Ae):-52}function Ju(w,C,D,j,K,fe){if(u)return Ne(17,1,w,C,D,j,K,fe)}var Qo={},lh=()=>performance.timeOrigin+performance.now();function vl(w,C){if(u)return Ne(18,1,w,C);if(Qo[w]&&(clearTimeout(Qo[w].id),delete Qo[w]),!C)return 0;var D=setTimeout(()=>{delete Qo[w],ie(()=>cc(w,performance.timeOrigin+performance.now()))},C);return Qo[w]={id:D,qc:C},0}function Dm(w,C,D,j){w>>>=0,C>>>=0,D>>>=0,j>>>=0;var K=new Date().getFullYear(),fe=new Date(K,0,1).getTimezoneOffset();K=new Date(K,6,1).getTimezoneOffset();var Ae=Math.max(fe,K);we()[w>>>2>>>0]=60*Ae,ne()[C>>>2>>>0]=+(fe!=K),w=(C=Ue=>{var et=Math.abs(Ue);return`UTC${0<=Ue?"-":"+"}${String(Math.floor(et/60)).padStart(2,"0")}${String(et%60).padStart(2,"0")}`})(fe),C=C(K),K<fe?(Z(w,D,17),Z(C,j,17)):(Z(w,j,17),Z(C,D,17))}var uh=()=>Date.now();function Yu(w,C,D){return 0<=w&&3>=w?(w===0?w=Date.now():w=performance.timeOrigin+performance.now(),ee[D>>>0>>>3]=BigInt(Math.round(1e6*w)),0):28}var ga=[],_a=(w,C)=>{ga.length=0;for(var D;D=R()[w++>>>0];){var j=D!=105;C+=(j&=D!=112)&&C%8?4:0,ga.push(D==112?we()[C>>>2>>>0]:D==106?ee[C>>>3]:D==105?ne()[C>>>2>>>0]:Be()[C>>>3>>>0]),C+=j?8:4}return ga};function ch(w,C,D){return w>>>=0,C=_a(C>>>0,D>>>0),Oe[w](...C)}function dh(w,C,D){return w>>>=0,C=_a(C>>>0,D>>>0),Oe[w](...C)}var hh=()=>{};function fh(w,C){return M(Wt(w>>>0,C>>>0))}var ph=()=>{throw nt+=1,"unwind"};function mh(){return 4294901760}var gh=()=>navigator.hardwareConcurrency;function _h(){return ke("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Zu(w){w>>>=0;var C=R().length;if(w<=C||4294901760<w)return!1;for(var D=1;4>=D;D*=2){var j=C*(1+.2/D);j=Math.min(j,w+100663296);e:{j=(Math.min(4294901760,65536*Math.ceil(Math.max(w,j)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow(j),F();var K=1;break e}catch{}K=void 0}if(K)return!0}return!1}var ya=()=>(ke("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Io={},wl=w=>{w.forEach(C=>{ya()})};function yh(){var w=Error().stack.toString().split(`
`);return w[0]=="Error"&&w.shift(),wl(w),Io.Lb=ya(),Io.cc=w,Io.Lb}function ec(w,C,D){if(w>>>=0,C>>>=0,Io.Lb==w)var j=Io.cc;else(j=Error().stack.toString().split(`
`))[0]=="Error"&&j.shift(),wl(j);for(var K=3;j[K]&&ya()!=w;)++K;for(w=0;w<D&&j[w+K];++w)ne()[C+4*w>>>2>>>0]=ya();return w}var Zs,bl={},vh=()=>{if(!Zs){var w,C={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(w in bl)bl[w]===void 0?delete C[w]:C[w]=bl[w];var D=[];for(w in C)D.push(`${w}=${C[w]}`);Zs=D}return Zs};function tc(w,C){if(u)return Ne(19,1,w,C);w>>>=0,C>>>=0;var D=0;return vh().forEach((j,K)=>{var fe=C+D;for(K=we()[w+4*K>>>2>>>0]=fe,fe=0;fe<j.length;++fe)U()[K++>>>0]=j.charCodeAt(fe);U()[K>>>0]=0,D+=j.length+1}),0}function wh(w,C){if(u)return Ne(20,1,w,C);w>>>=0,C>>>=0;var D=vh();we()[w>>>2>>>0]=D.length;var j=0;return D.forEach(K=>j+=K.length+1),we()[C>>>2>>>0]=j,0}function rc(w){return u?Ne(21,1,w):52}function xl(w,C,D,j){return u?Ne(22,1,w,C,D,j):52}function nc(w,C,D,j){return u?Ne(23,1,w,C,D,j):70}var bh=[null,[],[]];function sc(w,C,D,j){if(u)return Ne(24,1,w,C,D,j);C>>>=0,D>>>=0,j>>>=0;for(var K=0,fe=0;fe<D;fe++){var Ae=we()[C>>>2>>>0],Ue=we()[C+4>>>2>>>0];C+=8;for(var et=0;et<Ue;et++){var ht=R()[Ae+et>>>0],Ft=bh[w];ht===0||ht===10?((w===1?v:M)(ct(Ft)),Ft.length=0):Ft.push(ht)}K+=Ue}return we()[j>>>2>>>0]=K,0}u||function(){for(var w=o.numThreads-1;w--;)Kr();Ze.unshift(()=>{Me++,function(C){u?C():Promise.all(jt.map(mr)).then(C)}(()=>ye())})}();for(var oc=Array(256),va=0;256>va;++va)oc[va]=String.fromCharCode(va);Vn=oc,Lr=o.BindingError=class extends Error{constructor(w){super(w),this.name="BindingError"}},o.InternalError=class extends Error{constructor(w){super(w),this.name="InternalError"}},Pn.push(0,1,void 0,1,null,1,!0,1,!1,1),o.count_emval_handles=()=>Pn.length/2-5-rs.length;var vt,xh=[qe,Mt,Xs,$,re,ue,xe,Re,dt,Ct,Tt,Ot,lt,Kt,ur,In,yl,Ju,vl,tc,wh,rc,xl,nc,sc];(async function(){function w(j,K){return vt=j.exports,vt=function(){var fe=vt,Ae={};for(let[Ue,et]of Object.entries(fe))Ae[Ue]=typeof et=="function"?(...ht)=>{nn.push(Ue);try{return et(...ht)}finally{le||(nn.pop(),Pr&&Ir===1&&nn.length===0&&(Ir=0,nt+=1,Er(fc),typeof Fibers<"u"&&Fibers.rc()))}}:et;return Ae}(),vt=function(){var fe=vt,Ae=et=>ht=>et(ht)>>>0,Ue=et=>()=>et()>>>0;return(fe=Object.assign({},fe)).Da=Ae(fe.Da),fe.fb=Ue(fe.fb),fe.hb=Ae(fe.hb),fe.tb=Ae(fe.tb),fe.ub=Ue(fe.ub),fe.__cxa_get_exception_ptr=Ae(fe.__cxa_get_exception_ptr),fe}(),pr.push(vt.ib),T=K,ye(),vt}Me++;var C=be();if(o.instantiateWasm)return new Promise(j=>{o.instantiateWasm(C,(K,fe)=>{w(K,fe),j(K.exports)})});if(u)return new Promise(j=>{$e=K=>{var fe=new WebAssembly.Instance(K,be());j(w(fe,K))}});Ee??(Ee=o.locateFile?o.locateFile?o.locateFile("ort-wasm-simd-threaded.jsep.wasm",g):g+"ort-wasm-simd-threaded.jsep.wasm":new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href);try{var D=await async function(j){var K=Ee;if(!te&&typeof WebAssembly.instantiateStreaming=="function"&&!oe(K))try{var fe=fetch(K,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(fe,j)}catch(Ae){M(`wasm streaming compile failed: ${Ae}`),M("falling back to ArrayBuffer instantiation")}return async function(Ae,Ue){try{var et=await async function(ht){if(!te)try{var Ft=await f(ht);return new Uint8Array(Ft)}catch{}if(ht==Ee&&te)ht=new Uint8Array(te);else{if(!p)throw"both async and sync fetching of the wasm failed";ht=p(ht)}return ht}(Ae);return await WebAssembly.instantiate(et,Ue)}catch(ht){M(`failed to asynchronously prepare wasm: ${ht}`),ke(ht)}}(K,j)}(C);return w(D.instance,D.module)}catch(j){return s(j),Promise.reject(j)}})();var ic=w=>(ic=vt.Da)(w),ac=()=>(ac=vt.Ea)();o._OrtInit=(w,C)=>(o._OrtInit=vt.Fa)(w,C),o._OrtGetLastError=(w,C)=>(o._OrtGetLastError=vt.Ga)(w,C),o._OrtCreateSessionOptions=(w,C,D,j,K,fe,Ae,Ue,et,ht)=>(o._OrtCreateSessionOptions=vt.Ha)(w,C,D,j,K,fe,Ae,Ue,et,ht),o._OrtAppendExecutionProvider=(w,C,D,j,K)=>(o._OrtAppendExecutionProvider=vt.Ia)(w,C,D,j,K),o._OrtAddFreeDimensionOverride=(w,C,D)=>(o._OrtAddFreeDimensionOverride=vt.Ja)(w,C,D),o._OrtAddSessionConfigEntry=(w,C,D)=>(o._OrtAddSessionConfigEntry=vt.Ka)(w,C,D),o._OrtReleaseSessionOptions=w=>(o._OrtReleaseSessionOptions=vt.La)(w),o._OrtCreateSession=(w,C,D)=>(o._OrtCreateSession=vt.Ma)(w,C,D),o._OrtReleaseSession=w=>(o._OrtReleaseSession=vt.Na)(w),o._OrtGetInputOutputCount=(w,C,D)=>(o._OrtGetInputOutputCount=vt.Oa)(w,C,D),o._OrtGetInputOutputMetadata=(w,C,D,j)=>(o._OrtGetInputOutputMetadata=vt.Pa)(w,C,D,j),o._OrtFree=w=>(o._OrtFree=vt.Qa)(w),o._OrtCreateTensor=(w,C,D,j,K,fe)=>(o._OrtCreateTensor=vt.Ra)(w,C,D,j,K,fe),o._OrtGetTensorData=(w,C,D,j,K)=>(o._OrtGetTensorData=vt.Sa)(w,C,D,j,K),o._OrtReleaseTensor=w=>(o._OrtReleaseTensor=vt.Ta)(w),o._OrtCreateRunOptions=(w,C,D,j)=>(o._OrtCreateRunOptions=vt.Ua)(w,C,D,j),o._OrtAddRunConfigEntry=(w,C,D)=>(o._OrtAddRunConfigEntry=vt.Va)(w,C,D),o._OrtReleaseRunOptions=w=>(o._OrtReleaseRunOptions=vt.Wa)(w),o._OrtCreateBinding=w=>(o._OrtCreateBinding=vt.Xa)(w),o._OrtBindInput=(w,C,D)=>(o._OrtBindInput=vt.Ya)(w,C,D),o._OrtBindOutput=(w,C,D,j)=>(o._OrtBindOutput=vt.Za)(w,C,D,j),o._OrtClearBoundOutputs=w=>(o._OrtClearBoundOutputs=vt._a)(w),o._OrtReleaseBinding=w=>(o._OrtReleaseBinding=vt.$a)(w),o._OrtRunWithBinding=(w,C,D,j,K)=>(o._OrtRunWithBinding=vt.ab)(w,C,D,j,K),o._OrtRun=(w,C,D,j,K,fe,Ae,Ue)=>(o._OrtRun=vt.bb)(w,C,D,j,K,fe,Ae,Ue),o._OrtEndProfiling=w=>(o._OrtEndProfiling=vt.cb)(w),o._JsepOutput=(w,C,D)=>(o._JsepOutput=vt.db)(w,C,D),o._JsepGetNodeName=w=>(o._JsepGetNodeName=vt.eb)(w);var wi=()=>(wi=vt.fb)(),hs=o._free=w=>(hs=o._free=vt.gb)(w),wa=o._malloc=w=>(wa=o._malloc=vt.hb)(w),ba=(w,C,D,j,K,fe)=>(ba=vt.kb)(w,C,D,j,K,fe),lc=()=>(lc=vt.lb)(),uc=(w,C,D,j,K)=>(uc=vt.mb)(w,C,D,j,K),Ml=w=>(Ml=vt.nb)(w),Tl=w=>(Tl=vt.ob)(w),cc=(w,C)=>(cc=vt.pb)(w,C),El=()=>(El=vt.qb)(),dc=(w,C)=>(dc=vt.rb)(w,C),xa=w=>(xa=vt.sb)(w),Ma=w=>(Ma=vt.tb)(w),Pl=()=>(Pl=vt.ub)(),hc=o.dynCall_ii=(w,C)=>(hc=o.dynCall_ii=vt.vb)(w,C),Sl=w=>(Sl=vt.wb)(w),fc=()=>(fc=vt.xb)(),pc=w=>(pc=vt.yb)(w),Cl=()=>(Cl=vt.zb)();return o.stackSave=()=>Pl(),o.stackRestore=w=>xa(w),o.stackAlloc=w=>Ma(w),o.setValue=function(w,C,D="i8"){switch(D.endsWith("*")&&(D="*"),D){case"i1":case"i8":U()[w>>>0]=C;break;case"i16":X()[w>>>1>>>0]=C;break;case"i32":ne()[w>>>2>>>0]=C;break;case"i64":ee[w>>>3]=BigInt(C);break;case"float":De()[w>>>2>>>0]=C;break;case"double":Be()[w>>>3>>>0]=C;break;case"*":we()[w>>>2>>>0]=C;break;default:ke(`invalid type for setValue: ${D}`)}},o.getValue=function(w,C="i8"){switch(C.endsWith("*")&&(C="*"),C){case"i1":case"i8":return U()[w>>>0];case"i16":return X()[w>>>1>>>0];case"i32":return ne()[w>>>2>>>0];case"i64":return ee[w>>>3];case"float":return De()[w>>>2>>>0];case"double":return Be()[w>>>3>>>0];case"*":return we()[w>>>2>>>0];default:ke(`invalid type for getValue: ${C}`)}},o.UTF8ToString=Wt,o.stringToUTF8=Z,o.lengthBytesUTF8=B,function w(){if(0<Me)Pe=w;else if(u)n(o),pe();else{for(;0<Ze.length;)Ze.shift()(o);0<Me?Pe=w:(o.calledRun=!0,le||(pe(),n(o)))}}(),o.PTR_SIZE=4,i}),pL=ry,HC=(t=(e=globalThis.self)==null?void 0:e.name)==null?void 0:t.startsWith("em-pthread"),HC&&ry()}),ny,Pw,KC,ms,mL,Pf,qC,QC,sy,XC,oy,gL,iy,_L,gb=Ke(()=>{mb(),ny=typeof location>"u"?void 0:location.origin,Pw=import.meta.url>"file:"&&import.meta.url<"file;",KC=()=>{{if(Pw){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,ny).href}return import.meta.url}},ms=KC(),mL=()=>{if(ms&&!ms.startsWith("blob:"))return ms.substring(0,ms.lastIndexOf("/")+1)},Pf=(e,t)=>{try{let r=t??ms;return(r?new URL(e,r):new URL(e)).origin===ny}catch{return!1}},qC=(e,t)=>{let r=t??ms;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},QC=(e,t)=>`${t??"./"}${e}`,sy=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},XC=async e=>(await import(e)).default,oy=(JK(),Od(dL)).default,gL=async()=>{if(!ms)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Pf(ms))return[void 0,oy()];let e=await sy(ms);return[e,oy(e)]},iy=(YK(),Od(fL)).default,_L=async(e,t,r)=>{if(!e&&!t&&iy&&ms&&Pf(ms))return[void 0,iy];{let n="ort-wasm-simd-threaded.jsep.mjs",s=e??qC(n,t),o=r&&s&&!Pf(s,t),i=o?await sy(s):s??QC(n,t);return[o?i:void 0,await XC(i)]}}}),ay,Sf,$c,ly,JC,YC,ZC,_b,fr,pl=Ke(()=>{gb(),Sf=!1,$c=!1,ly=!1,JC=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},YC=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ZC=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},_b=async e=>{if(Sf)return Promise.resolve();if($c)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(ly)throw new Error("previous call to 'initializeWebAssembly()' failed.");$c=!0;let t=e.initTimeout,r=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!ZC())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!YC())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=JC();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let s=e.wasmPaths,o=typeof s=="string"?s:void 0,i=s==null?void 0:s.mjs,a=(i==null?void 0:i.href)??i,l=s==null?void 0:s.wasm,u=(l==null?void 0:l.href)??l,h=e.wasmBinary,[c,d]=await _L(a,o,r>1),f=!1,p=[];if(t>0&&p.push(new Promise(m=>{setTimeout(()=>{f=!0,m()},t)})),p.push(new Promise((m,b)=>{let g={numThreads:r};if(h)g.wasmBinary=h;else if(u||o)g.locateFile=_=>u??o+_;else if(a&&a.indexOf("blob:")!==0)g.locateFile=_=>new URL(_,a).href;else if(c){let _=mL();_&&(g.locateFile=y=>_+y)}d(g).then(_=>{$c=!1,Sf=!0,ay=_,m(),c&&URL.revokeObjectURL(c)},_=>{$c=!1,ly=!0,b(_)})})),await Promise.race(p),f)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},fr=()=>{if(Sf&&ay)return ay;throw new Error("WebAssembly is not initialized yet.")}}),yo,Hp,lr,yb=Ke(()=>{pl(),yo=(e,t)=>{let r=fr(),n=r.lengthBytesUTF8(e)+1,s=r._malloc(n);return r.stringToUTF8(e,s,n),t.push(s),s},Hp=(e,t,r,n)=>{if(typeof e=="object"&&e!==null){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([s,o])=>{let i=t?t+s:s;if(typeof o=="object")Hp(o,i+".",r,n);else if(typeof o=="string"||typeof o=="number")n(i,o.toString());else if(typeof o=="boolean")n(i,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},lr=e=>{let t=fr(),r=t.stackSave();try{let n=t.PTR_SIZE,s=t.stackAlloc(2*n);t._OrtGetLastError(s,s+n);let o=Number(t.getValue(s,n===4?"i32":"i64")),i=t.getValue(s+n,"*"),a=i?t.UTF8ToString(i):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${a}`)}finally{t.stackRestore(r)}}}),yL,ZK=Ke(()=>{pl(),yb(),yL=e=>{let t=fr(),r=0,n=[],s=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)s.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)s.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(s.terminate=!1);let o=0;return(e==null?void 0:e.tag)!==void 0&&(o=yo(e.tag,n)),r=t._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,o),r===0&&lr("Can't create run options."),(e==null?void 0:e.extra)!==void 0&&Hp(e.extra,"",new WeakSet,(i,a)=>{let l=yo(i,n),u=yo(a,n);t._OrtAddRunConfigEntry(r,l,u)!==0&&lr(`Can't set a run config entry: ${i} - ${a}.`)}),[r,n]}catch(o){throw r!==0&&t._OrtReleaseRunOptions(r),n.forEach(i=>t._free(i)),o}}}),ek,tk,rk,Ac,nk,vL,eq=Ke(()=>{pl(),yb(),ek=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},tk=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},rk=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(r=>(typeof r=="string"?r:r.name)==="webgpu")&&(e.enableMemPattern=!1)},Ac=(e,t,r,n)=>{let s=yo(t,n),o=yo(r,n);fr()._OrtAddSessionConfigEntry(e,s,o)!==0&&lr(`Can't set a session config entry: ${t} - ${r}.`)},nk=async(e,t,r)=>{for(let n of t){let s=typeof n=="string"?n:n.name,o=[];switch(s){case"webnn":if(s="WEBNN",typeof n!="string"){let h=n==null?void 0:n.deviceType;h&&Ac(e,"deviceType",h,r)}break;case"webgpu":if(s="JS",typeof n!="string"){let h=n;if(h!=null&&h.preferredLayout){if(h.preferredLayout!=="NCHW"&&h.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${h.preferredLayout}`);Ac(e,"preferredLayout",h.preferredLayout,r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let i=yo(s,r),a=o.length,l=0,u=0;if(a>0){l=fr()._malloc(a*fr().PTR_SIZE),r.push(l),u=fr()._malloc(a*fr().PTR_SIZE),r.push(u);for(let h=0;h<a;h++)fr().setValue(l+h*fr().PTR_SIZE,o[h][0],"*"),fr().setValue(u+h*fr().PTR_SIZE,o[h][1],"*")}await fr()._OrtAppendExecutionProvider(e,i,l,u,a)!==0&&lr(`Can't append execution provider: ${s}.`)}},vL=async e=>{let t=fr(),r=0,n=[],s=e||{};rk(s);try{let o=ek(s.graphOptimizationLevel??"all"),i=tk(s.executionMode??"sequential"),a=typeof s.logId=="string"?yo(s.logId,n):0,l=s.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log serverity level is not valid: ${l}`);let u=s.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let h=typeof s.optimizedModelFilePath=="string"?yo(s.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(o,!!s.enableCpuMemArena,!!s.enableMemPattern,i,!!s.enableProfiling,0,a,l,u,h),r===0&&lr("Can't create session options."),s.executionProviders&&await nk(r,s.executionProviders,n),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);Ac(r,"enableGraphCapture",s.enableGraphCapture.toString(),n)}if(s.freeDimensionOverrides)for(let[c,d]of Object.entries(s.freeDimensionOverrides)){if(typeof c!="string")throw new Error(`free dimension override name must be a string: ${c}`);if(typeof d!="number"||!Number.isInteger(d)||d<0)throw new Error(`free dimension override value must be a non-negative integer: ${d}`);let f=yo(c,n);t._OrtAddFreeDimensionOverride(r,f,d)!==0&&lr(`Can't set a free dimension override: ${c} - ${d}.`)}return s.extra!==void 0&&Hp(s.extra,"",new WeakSet,(c,d)=>{Ac(r,c,d,n)}),[r,n]}catch(o){throw r!==0&&t._OrtReleaseSessionOptions(r)!==0&&lr("Can't release session options."),n.forEach(i=>t._free(i)),o}}}),Hl,oi,Ua,vb,Kp,wb,bb,Sw,kt=Ke(()=>{Hl=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},oi=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},Ua=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n=typeof t=="number"?t:t.reduce((s,o)=>s*o,1);return r>0?Math.ceil(n*r):void 0},vb=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Kp=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},wb=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",bb=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Sw=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),xb,wL=Ke(()=>{mb(),xb=async e=>{if(typeof e=="string"){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let s=t.body.getReader(),o;try{o=new ArrayBuffer(n)}catch(a){if(a instanceof RangeError){let l=Math.ceil(n/65536);o=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw a}let i=0;for(;;){let{done:a,value:l}=await s.read();if(a)break;let u=l.byteLength;new Uint8Array(o,i,u).set(l),i+=u}return new Uint8Array(o,0,n)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),sk,ok,ik,ak,Mb,lk,Xt,_i=Ke(()=>{kt(),sk=["V","I","W","E","F"],ok=(e,t)=>{console.log(`[${sk[e]},${new Date().toISOString()}]${t}`)},Mb=(e,t)=>{ik=e,ak=t},lk=(e,t)=>{let r=Kp(e),n=Kp(ik);r>=n&&ok(r,typeof t=="function"?t():t)},Xt=(...e)=>{ak&&lk(...e)}}),uk,Ru,Ce,qp,bL,xL,ML,Lt=Ke(()=>{uk=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},Ru=class{static calcShape(e,t,r=!1){let n=e.length,s=t.length;if(n===0)return t;if(s===0)return e;let o=Math.max(e.length,t.length),i=new Array(o);if(r){if(n<2||s<2)return;let a=uk.calcMatMulShape([e[n-2],e[n-1]],[t[s-2],t[s-1]]);if(a===void 0)return;[i[o-2],i[o-1]]=a}for(let a=r?3:1;a<=o;a++){let l=n-a<0?1:e[n-a],u=s-a<0?1:t[s-a];if(l!==u&&l>1&&u>1)return;let h=Math.max(l,u);if(l&&u)i[o-a]=Math.max(l,u);else{if(h>1)return;i[o-a]=0}}return i}static isValidBroadcast(e,t){let r=e.length,n=t.length;if(r>n)return!1;for(let s=1;s<=r;s++)if(e[r-s]!==1&&e[r-s]!==t[n-s])return!1;return!0}},Ce=class ip{static size(t){return ip.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,r=4){let n=t.length;if(n===0)return[];let s=new Array(n),o=n-1;for(;o>=0;){if(t[o]%r===0){s[o]=t[o]/r;break}if(r%t[o]!==0)throw new Error("cannot convert shape");s[o]=1,r/=t[o],o--}for(o--;o>=0;o--)s[o]=t[o];return s}static sizeFromDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return ip.getSizeFromDimensionRange(t,r,t.length)}static sizeToDimension(t,r){if(r<0||r>t.length)throw new Error(`invalid dimension of ${r} for sizeToDimension as Tensor has ${t.length} dimensions.`);return ip.getSizeFromDimensionRange(t,0,r)}static getSizeFromDimensionRange(t,r,n){let s=1;for(let o=r;o<n;o++){if(t[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");s*=Number(t[o])}return s}static computeStrides(t){let r=t.length;if(r===0)return[];if(r===1)return[1];let n=new Array(r);n[r-1]=1,n[r-2]=t[r-1];for(let s=r-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}static normalizeAxis(t,r){if(t<-r&&t>=r)throw new Error("unsupported axis for this operation.");return t<0?t+r:t}static normalizeAxes(t,r){return t.map(n=>this.normalizeAxis(n,r??t.length))}static sortBasedOnPerm(t,r){return r?r.map(n=>t[n]):t.slice().reverse()}static padShape(t,r){let n=t.length;return t.map((s,o)=>s+r[o]+r[o+n])}static areEqual(t,r){return t.length!==r.length?!1:t.every((n,s)=>n===r[s])}},qp=class Gc{static adjustPoolAttributes(t,r,n,s,o,i){if(!t&&n.length!==r.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let a=0;a<r.length-2;a++)a>=n.length?n.push(r[a+2]):n[a]=r[a+2];for(let a=0;a<n.length;a++)if(a<s.length){if(s[a]<0)throw new Error("strides should be greater than or equal to 1")}else s.push(1);for(let a=0;a<n.length;a++)if(a<o.length){if(o[a]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let a=0;a<n.length*2;a++)if(a<i.length){if(i[a]<0)throw new Error("pad should be greater than or equal to 1")}else i.push(0);for(let a=0;a<n.length;a++){if(n[a]<=0)throw new Error("kernel shapes need to be greater than 0");if(i[a]>=n[a]||i[a+n.length]>=n[a])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,r,n,s,o,i,a){if(a){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(r.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(s.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<t.length-2;l++)Gc.adjustPadAndReturnShape(t[l+(i?1:2)],r[l],n[l],s[l],o,l,l+t.length-2,a)}}static computePoolOutputShape(t,r,n,s,o,i,a){if(r.length<=0)throw new Error("input shape must be of size greater than 0");let l=[r[0],r[1]];return Gc.computeShapeHelper(t,r,l,n,s,o,i,a),l}static computeConvOutputShape(t,r,n,s,o,i,a){if(t.length<=0||r.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[t[0],r[0]];return Gc.computeShapeHelper(!1,t,l,n,s,o,i,a),l}static computeShapeHelper(t,r,n,s,o,i,a,l){if(t)for(let u=0;u<r.length-2;u++)n.push(1);else for(let u=0;u<r.length-2;u++)n.push(Gc.adjustPadAndReturnShape(r[u+2],s[u],o[u],i[u],a,u,u+r.length-2,l))}static adjustPadAndReturnShape(t,r,n,s,o,i,a,l){let u=n*(s-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return o[i]=0,o[a]=0,Math.floor((t-u)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(n!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let h=((t+r-1)/r-1)*r+s-t;return o[i]=Math.floor(l==="SAME_LOWER"?(h+1)/2:h/2),o[a]=h-o[i],Math.floor((t+h-s)/r+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+o[i]+o[a]-u)/r+1)}},bL=class{static getShapeOfGemmResult(e,t,r,n,s){if(e.length!==2||r.length!==2)throw new Error("shape need to be of size 2");let o,i,a;t?(o=e[1],i=e[0]):(o=e[0],i=e[1]);let l=-1;if(n?(a=r[0],l=1):(a=r[1],l=0),r[l]!==i)throw new Error("dimension mismatch");if(o<=0||a<=0||i<=0)throw new Error("invalid shape specified");if(s&&!Ru.isValidBroadcast(s,[o,a]))throw new Error("gemm: invalid bias shape for broadcast");return[o,a,i]}},xL=-34028234663852886e22,ML=34028234663852886e22}),Tb,TL=Ke(()=>{kt(),Tb=(e,t)=>new(vb(t))(e)}),Cw,uy,ck,cy,dk,dy,hy,fy,hk,EL,tq=Ke(()=>{_i(),Cw=(e,t=!0)=>{if(e.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let r=e.byteLength/8,n=new BigInt64Array(e.buffer,e.byteOffset,r),s=new Int32Array(r);for(let o=0;o<r;o++){let i=n[o];if(i>2147483647n||i<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${o}: ${i}`);s[o]=Number(i)}return t?new Uint8Array(s.buffer):s},uy=(e,t=!0)=>{if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let r=e.byteLength/4,n=new Int32Array(e.buffer,e.byteOffset,r),s=BigInt64Array.from(n,BigInt);return t?new Uint8Array(s.buffer):s},ck=1,cy=()=>ck++,dk=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),dy=(e,t)=>{let r=dk.get(e);if(!r)throw new Error("Unsupported data type.");return t.length>0?Math.ceil(t.reduce((n,s)=>n*s)*r/8):0},hy=class{constructor(e){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:t,context:r,tensor:n,dataType:s,shape:o,shouldConvertInt64toInt32:i=!1}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=n,this.dataType=s,this.tensorShape=o,this.shouldConvertInt64toInt32=i}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return dy(this.dataType,this.tensorShape)}destroy(){Xt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e,t){if(e){let r=await this.mlContext.readTensor(this.mlTensor),n=uy(new Uint8Array(r));if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(n);return}else return n.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((n,s)=>n===r[s])}setIsInt64ToInt32Converted(e){this.isInt64ToInt32Converted=e}},fy=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,n){let s=t,o=this.tensorManager.getMLContext(e),i=s==="int64"&&!o.opSupportLimits().input.dataTypes.includes("int64");if(i&&(s="int32",Xt("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(o,s,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==dy(s,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,s,r,a,!0,!0,i),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(t=Cw(e,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),t.byteLength===this.wrapper.byteLength){this.wrapper.write(t);return}else Xt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){var t,r,n;if(this.activeUpload){let s=(t=this.wrapper)!=null&&t.isInt64ToInt32Converted?uy(this.activeUpload):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(s):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(s);return}else return s.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read((r=this.wrapper)==null?void 0:r.shouldConvertInt64toInt32,e):this.wrapper.read((n=this.wrapper)==null?void 0:n.shouldConvertInt64toInt32)}},hk=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=cy();return this.tensorTrackersById.set(e,new fy(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,n,s){Xt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${n}, copyOld: ${s}}`);let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,r,n,s)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");r.upload(t)}async download(e,t){Xt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t==null?void 0:t.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,n){let s=this.getMLContext(e),o=cy(),i=new hy({sessionId:e,context:s,tensor:t,dataType:r,shape:n});return this.tensorTrackersById.set(o,new fy(this,i)),this.externalTensors.add(i),o}async getCachedTensor(e,t,r,n,s,o,i=!1){let a=this.getMLContext(e);for(let[u,h]of this.freeTensors.entries())if(h.canReuseTensor(a,t,r)){Xt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, shape: ${r}}`);let c=this.freeTensors.splice(u,1)[0];return c.sessionId=e,c}Xt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, shape: ${r}}`);let l=await a.createTensor({dataType:t,shape:r,dimensions:r,usage:n,writable:s,readable:o});return new hy({sessionId:e,context:a,tensor:l,dataType:t,shape:r,shouldConvertInt64toInt32:i})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},EL=(...e)=>new hk(...e)}),Cf,fk,PL,rq=Ke(()=>{kt(),pl(),TL(),tq(),_i(),Cf=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),fk=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let r=Object.keys(e).sort(),n=Object.keys(t).sort();return r.length===n.length&&r.every((s,o)=>s===n[o]&&e[s]===t[s])},PL=class{constructor(e){this.tensorManager=EL(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,Mb(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){Xt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){Xt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let r of t)Xt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let r=this.mlContextCache.findIndex(n=>n.gpuDevice===e);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:n}),n}}else if(e===void 0){let r=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(r!==-1)return this.mlContextCache[r].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let t=this.mlContextCache.findIndex(r=>fk(r.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let r=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:r}),r}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),r.size===0){this.sessionIdsByMLContext.delete(t);let n=this.mlContextCache.findIndex(s=>s.mlContext===t);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){Xt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,n,s){let o=Cf.get(r);if(!o)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,n,s)}async createTemporaryTensor(e,t,r){Xt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let n=Cf.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let s=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,s,n,r,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(s):this.temporarySessionTensorIds.set(e,[s]),s}uploadTensor(e,t){if(!fr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Xt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return Tb(r,t)}}registerMLTensor(e,t,r,n){let s=Cf.get(r);if(!s)throw new Error(`Unsupported ONNX data type: ${r}`);let o=this.tensorManager.registerTensor(e,t,s,n);return Xt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${s}, dimensions: ${n}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,r,n,s,o,i=!1){if(!o)throw new Error("External mounted files are not available.");let a=e;e.startsWith("./")&&(a=e.substring(2));let l=o.get(a);if(!l)throw new Error(`File with name ${a} not found in preloaded files.`);if(t+r>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=l.slice(t,t+r).buffer,h;switch(s.dataType){case"float32":h=new Float32Array(u);break;case"float16":h=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":h=new Int32Array(u);break;case"uint32":h=new Uint32Array(u);break;case"int64":i?(h=Cw(new Uint8Array(u),!1),s.dataType="int32"):h=new BigInt64Array(u);break;case"uint64":h=new BigUint64Array(u);break;case"int8":h=new Int8Array(u);break;case"int4":case"uint4":case"uint8":h=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${s.dataType} in creating WebNN Constant from external data.`)}return Xt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${s.dataType}, shape: ${s.shape}}} ${i?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(s,h)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return r?r.includes(t):!1}isInt64Supported(e){var t;return!!((t=this.mlContextBySessionId.get(e))!=null&&t.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),Eb=Ke(()=>{}),py,kf,$f,pk,mk,my,kw,gk,SL,nq=Ke(()=>{_i(),Eb(),py=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),kf=[],$f=e=>Math.ceil(Number(e)/16)*16,pk=e=>{for(let t=0;t<kf.length;t++){let r=kf[t];if(e<=r)return r}return Math.ceil(e/16)*16},mk=1,my=()=>mk++,kw=async(e,t,r,n)=>{let s=$f(r),o=e.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let i=e.getCommandEncoder();e.endComputePass(),i.copyBufferToBuffer(t,0,o,0,s),e.flush(),await o.mapAsync(GPUMapMode.READ);let a=o.getMappedRange();if(n){let l=n();return l.set(new Uint8Array(a,0,r)),l}else return new Uint8Array(a.slice(0,r))}finally{o.destroy()}},gk=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of py)kf.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let r=t.buffer,n=t.byteOffset,s=t.byteLength,o=$f(s),i=this.storageCache.get(e);if(!i)throw new Error("gpu data for uploading does not exist");if(Number(i.originalSize)!==s)throw new Error(`inconsistent data size. gpu data size=${i.originalSize}, data size=${s}`);let a=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=a.getMappedRange();new Uint8Array(l).set(new Uint8Array(r,n,s)),a.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(a,0,i.gpuData.buffer,0,o),this.backend.device.queue.submit([u.finish()]),a.destroy(),Xt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let r=this.storageCache.get(e);if(!r)throw new Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(t);if(!n)throw new Error("destination gpu data for memcpy does not exist");if(r.originalSize!==n.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=$f(r.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(r.gpuData.buffer,0,n.gpuData.buffer,0,s)}registerExternalBuffer(e,t,r){let n;if(r){if(n=r[0],e===r[1])return Xt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=my();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:e},originalSize:t}),Xt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${n}, registered.`),n}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),Xt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let r=pk(e),n,s=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||o){let a=(s?this.freeBuffers:this.freeUniformBuffers).get(r);a?a.length>0?n=a.pop():n=this.backend.device.createBuffer({size:r,usage:t}):n=this.backend.device.createBuffer({size:r,usage:t})}else n=this.backend.device.createBuffer({size:r,usage:t});let i={id:my(),type:0,buffer:n};return this.storageCache.set(i.id,{gpuData:i,originalSize:Number(e)}),Xt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${i.id}`),i}get(e){var t;return(t=this.storageCache.get(e))==null?void 0:t.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,r=this.storageCache.get(t);if(!r){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return Xt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${r.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(r.gpuData.buffer),r.originalSize}async download(e,t){let r=this.storageCache.get(Number(e));if(!r)throw new Error("data does not exist");await kw(this.backend,r.gpuData.buffer,r.originalSize,t)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=py.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let r=this.freeBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let r=this.freeUniformBuffers.get(e.size)||[];t===void 0||r.length>=t?e.destroy():r.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(r=>{r.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(Xt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(r=>{r.gpuData.buffer.destroy()}),this.storageCache=new Map)}},SL=(...e)=>new gk(...e)}),_k,or,Gr=Ke(()=>{_k=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},or=e=>new _k(e)}),Lu,Af,vn,zn,wt,Fr,$w,iu,sa,gt,Ic,Fe,ft,CL,Pb,yk,kL,Nt=Ke(()=>{kt(),Lt(),Lu=64,Af=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},vn=(e,t=1)=>{let r=Af(e,t);return typeof r=="string"?r:r[0]},zn=(e,t=1)=>{let r=Af(e,t);return typeof r=="string"?r:r[1]},wt=(...e)=>{let t=[];return e.forEach(r=>{r.length!==0&&t.push({type:12,data:r},{type:12,data:Ce.computeStrides(r)})}),t},Fr=e=>e%4===0?4:e%2===0?2:1,$w=(e="f32",t,r="0")=>!t||t===1?`${e}(${r})`:`vec${t}<${e}>(${r})`,iu=(e,t,r)=>e==="f32"?r:t===1?`f32(${r})`:`vec${t}<f32>(${r})`,sa=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,gt=(e,t,r,n)=>e.startsWith("uniforms.")&&r>4?typeof t=="string"?n==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:n==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:r>1?`${e}[${t}]`:e,Ic=(e,t,r,n,s)=>{let o=typeof r=="number",i=o?r:r.length,a=[...new Array(i).keys()],l=i<2?"u32":i<=4?`vec${i}<u32>`:`array<u32, ${i}>`,u=Af(t,s),h=typeof u=="string"?u:u[1],c=typeof u=="string"?u:u[0],d={indices:l,value:h,storage:c,tensor:t},f=oe=>typeof oe=="string"?oe:`${oe}u`,p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},m=o?"uniforms.":"",b=`${m}${e}_shape`,g=`${m}${e}_strides`,_="";for(let oe=0;oe<i-1;oe++)_+=`
    let dim${oe} = current / ${gt(g,oe,i)};
    let rest${oe} = current % ${gt(g,oe,i)};
    indices[${oe}] = dim${oe};
    current = rest${oe};
    `;_+=`indices[${i-1}] = current;`;let y=i<2?"":`
  fn o2i_${e}(offset: u32) -> ${d.indices} {
    var indices: ${d.indices};
    var current = offset;
    ${_}
    return indices;
  }`,v=oe=>(p.offsetToIndices=!0,i<2?oe:`o2i_${e}(${oe})`),M=[];if(i>=2)for(let oe=i-1;oe>=0;oe--)M.push(`${gt(g,oe,i)} * (indices[${oe}])`);let E=i<2?"":`
  fn i2o_${e}(indices: ${d.indices}) -> u32 {
    return ${M.join("+")};
  }`,T=oe=>(p.indicesToOffset=!0,i<2?oe:`i2o_${e}(${oe})`),S=(...oe)=>i===0?"0u":`${d.indices}(${oe.map(f).join(",")})`,A=(oe,U)=>i<2?`${oe}`:`${gt(oe,U,i)}`,I=(oe,U,R)=>i<2?`${oe}=${R};`:`${gt(oe,U,i)}=${R};`,V={},N=(oe,U)=>{p.broadcastedIndicesToOffset=!0;let R=`${U.name}broadcastedIndicesTo${e}Offset`;if(R in V)return`${R}(${oe})`;let X=[];for(let ce=i-1;ce>=0;ce--){let ne=U.indicesGet("outputIndices",ce+U.rank-i);X.push(`${A(g,ce)} * (${ne} % ${A(b,ce)})`)}return V[R]=`fn ${R}(outputIndices: ${U.type.indices}) -> u32 {
             return ${X.length>0?X.join("+"):"0u"};
           }`,`${R}(${oe})`},z=(oe,U)=>(()=>{if(d.storage===d.value)return`${e}[${oe}]=${U};`;if(d.storage==="vec2<u32>"&&d.value==="i32")return`${e}[${oe}]=vec2<u32>(u32(${U}), select(0u, 0xFFFFFFFFu, ${U} < 0));`;if(d.storage==="vec2<u32>"&&d.value==="u32")return`${e}[${oe}]=vec2<u32>(u32(${U}), 0u);`;if(d.storage==="u32"&&d.value==="vec4<bool>")return`${e}[${oe}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${U}));`;throw new Error(`not supported combination of storage type ${d.storage} and value type ${d.value} yet`)})(),q=oe=>(()=>{if(d.storage===d.value)return`${e}[${oe}]`;if(d.storage==="vec2<u32>"&&d.value==="i32")return`i32(${e}[${oe}].x)`;if(d.storage==="vec2<u32>"&&d.value==="u32")return`u32(${e}[${oe}].x)`;if(d.storage==="u32"&&d.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${oe}] & 0xFFu), bool(${e}[${oe}] & 0xFF00u), bool(${e}[${oe}] & 0xFF0000u), bool(${e}[${oe}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${d.storage} and value type ${d.value} yet`)})(),G=i<2?"":`
  fn get_${e}ByIndices(indices: ${d.indices}) -> ${h} {
    return ${q(`i2o_${e}(indices)`)};
  }`,ee=i<2?"":(()=>{let oe=a.map(R=>`d${R}: u32`).join(", "),U=a.map(R=>`d${R}`).join(", ");return`
  fn get_${e}(${oe}) -> ${h} {
    return get_${e}ByIndices(${S(U)});
  }`})(),Y=(...oe)=>{if(oe.length!==i)throw new Error(`indices length must be ${i}`);let U=oe.map(f).join(",");return i===0?q("0u"):i===1?q(U[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,`get_${e}(${U})`)},W=oe=>i<2?q(oe):(p.getByIndices=!0,p.indicesToOffset=!0,`get_${e}ByIndices(${oe})`),te=i<2?"":`
  fn set_${e}ByIndices(indices: ${d.indices}, value: ${h}) {
    ${z(`i2o_${e}(indices)`,"value")}
  }`,le=i<2?"":(()=>{let oe=a.map(R=>`d${R}: u32`).join(", "),U=a.map(R=>`d${R}`).join(", ");return`
  fn set_${e}(${oe}, value: ${h}) {
    set_${e}ByIndices(${S(U)}, value);
  }`})();return{impl:()=>{let oe=[],U=!1;return p.offsetToIndices&&(oe.push(y),U=!0),p.indicesToOffset&&(oe.push(E),U=!0),p.broadcastedIndicesToOffset&&(Object.values(V).forEach(R=>oe.push(R)),U=!0),p.set&&(oe.push(le),U=!0),p.setByIndices&&(oe.push(te),U=!0),p.get&&(oe.push(ee),U=!0),p.getByIndices&&(oe.push(G),U=!0),!o&&U&&oe.unshift(`const ${b} = ${d.indices}(${r.join(",")});`,`const ${g} = ${d.indices}(${Ce.computeStrides(r).join(",")});`),oe.join(`
`)},type:d,offsetToIndices:v,indicesToOffset:T,broadcastedIndicesToOffset:N,indices:S,indicesGet:A,indicesSet:I,set:(...oe)=>{if(oe.length!==i+1)throw new Error(`indices length must be ${i}`);let U=oe[i];if(typeof U!="string")throw new Error("value must be string");let R=oe.slice(0,i).map(f).join(",");return i===0?z("0u",U):i===1?z(R[0],U):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,`set_${e}(${R}, ${U})`)},setByOffset:z,setByIndices:(oe,U)=>i<2?z(oe,U):(p.setByIndices=!0,p.indicesToOffset=!0,`set_${e}ByIndices(${oe}, ${U});`),get:Y,getByOffset:q,getByIndices:W,usage:n,name:e,strides:g,shape:b,rank:i}},Fe=(e,t,r,n=1)=>Ic(e,t,r,"input",n),ft=(e,t,r,n=1)=>Ic(e,t,r,"output",n),CL=(e,t,r)=>Ic(e,t,r,"atomicOutput",1),Pb=(e,t,r,n=1)=>Ic(e,t,r,"internal",n),yk=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Lu){let t=typeof e=="number"?e:e[0],r=typeof e=="number"?1:e[1],n=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||r>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*r*n>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${r}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=s?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,i=s?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*r*n}u + local_idx;`;return`@compute @workgroup_size(${t}, ${r}, ${n})
  fn main(${o}) {
    ${i}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let r=e.usage==="input"?"read":"read_write",n=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${r}> ${e.name}: array<${n}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,r=1){return this.uniforms.push({name:e,type:t,length:r}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:r,length:n}of this.uniforms)if(n&&n>4)r==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${r}>, ${Math.ceil(n/8)}>`):e.push(`${t}:array<vec4<${r}>, ${Math.ceil(n/4)}>`);else{let s=n==null||n===1?r:`vec${n}<${r}>`;e.push(`${t}:${s}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},kL=(e,t)=>new yk(e,t)}),vk,gy,wk,bk,xk,Mk,Ts,$L,AL,ca=Ke(()=>{kt(),Lt(),Gr(),Nt(),vk=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},gy=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),wk=(e,t)=>Ce.sortBasedOnPerm(e,gy(e.length,t)),bk=(e,t,r,n)=>{let s=`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`;for(let o=0;o<t;++o)s+=`a[${e[o]}]=i[${o}];`;return s+="return a;}"},xk=(e,t)=>{let r=[],n=[];for(let s=0;s<e.length;++s)e[s]!==1&&r.push(e[s]),e[t[s]]!==1&&n.push(t[s]);return{newShape:r,newPerm:n}},Mk=(e,t)=>{let r=0;for(let n=0;n<e.length;++n)if(t[e[n]]!==1){if(e[n]<r)return!1;r=e[n]}return!0},Ts=(e,t)=>{let r=e.dataType,n=e.dims.length,s=gy(n,t),o=wk(e.dims,s),i=e.dims,a=o,l=n<2||Mk(s,e.dims),u;if(l)return u=p=>{let m=Fe("input",r,i,4),b=ft("output",r,a,4);return`
  ${p.registerUniform("output_size","u32").declareVariables(m,b)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let p=Ce.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:[{type:12,data:Math.ceil(p/4)}]}},getShaderSource:u};let{newShape:h,newPerm:c}=xk(e.dims,s),d=Ce.areEqual(c,[2,3,1]),f=Ce.areEqual(c,[3,1,2]);if(h.length===2||d||f){i=d?[h[0],h[1]*h[2]]:f?[h[0]*h[1],h[2]]:h,a=[i[1],i[0]];let p=16;return u=m=>{let b=Fe("a",r,i.length),g=ft("output",r,a.length);return`
  ${m.registerUniform("output_size","u32").declareVariables(b,g)}
  var<workgroup> tile : array<array<${g.type.value}, ${p+1}>, ${p}>;
  ${m.mainStart([p,p,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${p} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${p}u + local_id.x;
    let input_row = workgroup_id_x * ${p}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${b.getByIndices(`${b.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${p}u + local_id.x;
    let output_row = workgroup_id_y * ${p}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${g.setByIndices(`${g.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let m=Ce.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(a[1]/p),y:Math.ceil(a[0]/p)},programUniforms:[{type:12,data:m},...wt(i,a)]}},getShaderSource:u}}return u=p=>{let m=Fe("a",r,i.length),b=ft("output",r,a.length);return`
  ${p.registerUniform("output_size","u32").declareVariables(m,b)}

  ${bk(s,n,m,b)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${b.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${b.setByOffset("global_idx",m.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let p=Ce.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...wt(i,a)]}},getShaderSource:u}},$L=(e,t)=>{vk(e.inputs,t.perm),e.compute(Ts(e.inputs[0],t.perm))},AL=e=>or({perm:e.perm})}),Tk,Ek,Pk,Sk,Ck,kk,$k,Ak,Ik,Ok,no,IL,OL,DL,FL,RL,LL,NL,jL,zL,BL,sq=Ke(()=>{kt(),Lt(),Nt(),Sb(),ca(),Tk={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Ek={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Pk={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Sk={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Ck=(e,t)=>{let r=[];for(let n=t-e;n<t;++n)r.push(n);return r},kk=(e,t)=>{let r=[],n=e.length;for(let o=0;o<n;o++)t.indexOf(o)===-1&&r.push(e[o]);let s=t.map(o=>e[o]);return[r,s]},$k=(e,t)=>{let r=e.length+t.length,n=[],s=0;for(let o=0;o<r;o++)t.indexOf(o)===-1?n.push(e[s++]):n.push(1);return n},Ak=(e,t)=>{for(let r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0},Ik=(e,t)=>{let r=[];if(!Ak(e,t)){for(let n=0;n<t;++n)e.indexOf(n)===-1&&r.push(n);e.forEach(n=>r.push(n))}return r},Ok=(e,t,r,n,s,o,i)=>{let a=r[0].dims,l=Ce.size(o),u=Ce.size(i),h=Fe("_A",r[0].dataType,a),c=ft("output",s,o),d=64;l===1&&(d=256);let f=`
          var<workgroup> aBestValues : array<f32, ${d}>;
       `,p=m=>`
        ${m.registerUniform("reduceSize","u32").declareVariables(h,c)}
        ${f}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${m.mainStart(d)}

          let outputIndex = global_idx / ${d};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Pk[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${d}) {
           let candidate = f32(${h.getByOffset("offset + k")});
           bestValue = ${Tk[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${d}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Ek[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${c.setByOffset("outputIndex",`${n==="mean"?`${c.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${c.type.storage}(${Sk[n]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${d}`,inputDependencies:["type"]},getShaderSource:p,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:l},programUniforms:[{type:12,data:u}]})}},no=(e,t,r,n)=>{let s=e.inputs.length===1?r:Aw(e.inputs,r),o=s.axes;o.length===0&&!s.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((f,p)=>p));let i=Ce.normalizeAxes(o,e.inputs[0].dims.length),a=i,l=e.inputs[0],u=Ik(a,e.inputs[0].dims.length);u.length>0&&(l=e.compute(Ts(e.inputs[0],u),{inputs:[0],outputs:[-1]})[0],a=Ck(a.length,l.dims.length));let[h,c]=kk(l.dims,a),d=h;s.keepDims&&(d=$k(h,i)),e.compute(Ok(t,s.cacheKey,[l],n,e.inputs[0].dataType,d,c),{inputs:[l]})},IL=(e,t)=>{no(e,"ReduceMeanShared",t,"mean")},OL=(e,t)=>{no(e,"ReduceL1Shared",t,"l1")},DL=(e,t)=>{no(e,"ReduceL2Shared",t,"l2")},FL=(e,t)=>{no(e,"ReduceLogSumExpShared",t,"logSumExp")},RL=(e,t)=>{no(e,"ReduceMaxShared",t,"max")},LL=(e,t)=>{no(e,"ReduceMinShared",t,"min")},NL=(e,t)=>{no(e,"ReduceProdShared",t,"prod")},jL=(e,t)=>{no(e,"ReduceSumShared",t,"sum")},zL=(e,t)=>{no(e,"ReduceSumSquareShared",t,"sumSquare")},BL=(e,t)=>{no(e,"ReduceLogSumShared",t,"logSum")}}),so,Dk,Qp,Aw,oo,Fk,Rk,Lk,Nk,jk,zk,Bk,Uk,Vk,Wk,io,UL,VL,WL,GL,HL,KL,qL,QL,XL,JL,Sb=Ke(()=>{kt(),Lt(),Gr(),Nt(),sq(),so=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Dk=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Qp=(e,t,r,n,s,o,i=!1,a=!1)=>{let l=[],u=r[0].dims,h=u.length,c=Ce.normalizeAxes(s,h),d=!a&&c.length===0;u.forEach((m,b)=>{d||c.indexOf(b)>=0?i&&l.push(1):l.push(m)});let f=l.length,p=Ce.size(l);return{name:e,shaderCache:t,getShaderSource:m=>{let b=[],g=Fe("_A",r[0].dataType,h),_=ft("output",o,f),y=n(g,_,c),v=y[2];for(let M=0,E=0;M<h;M++)d||c.indexOf(M)>=0?(i&&E++,v=`for(var j${M}: u32 = 0; j${M} < ${u[M]}; j${M}++) {
                  ${y[2].includes("last_index")?`let last_index = j${M};`:""}
                  ${g.indicesSet("input_indices",M,`j${M}`)}
                  ${v}
                }`):(b.push(`${g.indicesSet("input_indices",M,_.indicesGet("output_indices",E))};`),E++);return`

        ${m.registerUniform("output_size","u32").declareVariables(g,_)}

        ${m.mainStart()}
          ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${g.type.indices};
          let output_indices = ${_.offsetToIndices("global_idx")};

          ${b.join(`
`)}
          ${y[0]}       // init ops for reduce max/min
          ${y[1]}
          ${v}
          ${y[3]}
          ${y.length===4?_.setByOffset("global_idx","value"):y.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:o}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},...wt(u,l)]})}},Aw=(e,t)=>{let r=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(n=>r.push(Number(n))),or({axes:r,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},oo=(e,t,r,n)=>{let s=e.inputs,o=s.length===1?r:Aw(s,r);e.compute(Qp(t,{hint:o.cacheKey,inputDependencies:["rank"]},[s[0]],o.noopWithEmptyAxes&&o.axes.length===0?Dk:n,o.axes,s[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},Fk=(e,t)=>{so(e.inputs),oo(e,"ReduceLogSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,"value = log(value);"])},Rk=(e,t)=>{so(e.inputs),oo(e,"ReduceL1",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += abs(${r.getByIndices("input_indices")});`,""])},Lk=(e,t)=>{so(e.inputs),oo(e,"ReduceL2",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Nk=(e,t)=>{so(e.inputs),oo(e,"ReduceLogSumExp",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += exp(${r.getByIndices("input_indices")});`,"value = log(value);"])},jk=(e,t)=>{so(e.inputs),oo(e,"ReduceMax",t,(r,n,s)=>{let o=[];for(let i=0;i<r.rank;i++)(s.indexOf(i)>=0||s.length===0)&&o.push(r.indicesSet("input_indices",i,0));return[`${o.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = max(value, ${r.getByIndices("input_indices")});`,""]})},zk=(e,t)=>{so(e.inputs),oo(e,"ReduceMean",t,(r,n,s)=>{let o=1;for(let i=0;i<r.rank;i++)(s.indexOf(i)>=0||s.length===0)&&(o*=e.inputs[0].dims[i]);return["var sum = f32(0);","",`sum += f32(${r.getByIndices("input_indices")});`,`let value = ${n.type.value}(sum / ${o});`]})},Bk=(e,t)=>{so(e.inputs),oo(e,"ReduceMin",t,(r,n,s)=>{let o=[];for(let i=0;i<r.rank;i++)(s.indexOf(i)>=0||s.length===0)&&o.push(`input_indices[${i}] = 0;`);return[`${o.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};`,`value = min(value, ${r.getByIndices("input_indices")});`,""]})},Uk=(e,t)=>{so(e.inputs),oo(e,"ReduceProd",t,(r,n)=>[`var value = ${n.type.storage}(1);`,"",`value *= ${r.getByIndices("input_indices")};`,""])},Vk=(e,t)=>{so(e.inputs),oo(e,"ReduceSum",t,(r,n)=>[`var value = ${n.type.storage}(0);`,"",`value += ${r.getByIndices("input_indices")};`,""])},Wk=(e,t)=>{so(e.inputs),oo(e,"ReduceSumSquare",t,(r,n)=>[`var t = ${n.type.value}(0); var value = ${n.type.value}(0);`,"",`t = ${r.getByIndices("input_indices")}; value += t * t;`,""])},io=(e,t,r)=>{if(t.length===0)return r;let n=1,s=1;for(let o=0;o<t.length;o++)t.indexOf(o)===-1?n*=e[o]:s*=e[o];return s<32&&n>1024},UL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?zk(e,t):IL(e,t)},VL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Rk(e,t):OL(e,t)},WL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Lk(e,t):DL(e,t)},GL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Nk(e,t):FL(e,t)},HL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?jk(e,t):RL(e,t)},KL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Bk(e,t):LL(e,t)},qL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Uk(e,t):NL(e,t)},QL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Vk(e,t):jL(e,t)},XL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Wk(e,t):zL(e,t)},JL=(e,t)=>{io(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Fk(e,t):BL(e,t)}}),_y,YL,ZL,Iw,oq=Ke(()=>{kt(),Gr(),Sb(),_y=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},YL=(e,t)=>{_y(e.inputs);let r=(n,s,o)=>{let i=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&i.push(`input_indices[${a}] = 0;`);return[`${i.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Qp("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},ZL=(e,t)=>{_y(e.inputs);let r=(n,s,o)=>{let i=[];for(let a=0;a<n.rank;a++)(o.indexOf(a)>=0||o.length===0)&&i.push(`input_indices[${a}] = 0;`);return[`${i.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${n.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${n.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Qp("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],r,[t.axis],7,t.keepDims),{inputs:[0]})},Iw=e=>or(e)}),Gk,If,Hk,Kk,qk,Fd,Qk,e3,Cb=Ke(()=>{kt(),Lt(),Eb(),Nt(),Gk=(e,t)=>{let r=e[0],n=e[1],s=e[2],o=e[3],i=e[4],a=e[5];if(i&&a)throw new Error("Attention cannot have both past and attention_bias");if(r.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=r.dims[0],u=r.dims[1],h=r.dims[2];if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(n.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==h)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(s.dims[0]!==n.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let c=s.dims[0]/3,d=c,f=d;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let y of t.qkvHiddenSizes)if(y%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");c=t.qkvHiddenSizes[0],d=t.qkvHiddenSizes[1],f=t.qkvHiddenSizes[2]}let p=u;if(c!==d)throw new Error("qkv_hidden_sizes first element should be same as the second");if(s.dims[0]!==c+d+f)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let m=0;if(i){if(d!==f)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(i.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(i.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(i.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(i.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(i.dims[4]!==d/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(m=i.dims[3])}let b=p+m,g=-1,_=0;if(o)throw new Error("Mask not supported");if(i)throw new Error("past is not supported");if(a){if(a.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(a.dims[0]!==l||a.dims[1]!==t.numHeads||a.dims[2]!==u||a.dims[3]!==b)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:u,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:b,maxSequenceLength:g,inputHiddenSize:h,hiddenSize:c,vHiddenSize:f,headSize:Math.floor(c/t.numHeads),vHeadSize:Math.floor(f/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:_,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},If=(e,t,r)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e==null?void 0:e.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${r?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Hk=(e,t,r,n,s,o,i,a)=>{let l=Fr(i?1:o),u=64,h=o/l;h<u&&(u=32);let c=Math.ceil(o/l/u),d=[{type:12,data:t},{type:12,data:r},{type:12,data:n},{type:12,data:s},{type:12,data:h},{type:12,data:c}],f=vn(e.dataType,l),p=zn(1,l),m=["type"];i&&m.push("type"),a&&m.push("type");let b=g=>{let _=ft("x",e.dataType,e.dims,l),y=[_],v=i?Fe("seq_lens",i.dataType,i.dims):void 0;v&&y.push(v);let M=a?Fe("total_sequence_length_input",a.dataType,a.dims):void 0;M&&y.push(M);let E=zn(e.dataType),T=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${u}>;
  var<workgroup> thread_sum: array<f32, ${u}>;
  ${g.registerUniforms(T).declareVariables(...y)}
  ${g.mainStart([u,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${If(v,M,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${u}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${i?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${p}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${p}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${u}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${p}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${p}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${u}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${_.type.value}(${E}(1.0) / ${E}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${p}(x[offset + i]);
        x[offset + i] = ${_.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${i?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${_.type.value}(${E}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${u};${f};${l}`,inputDependencies:m},getShaderSource:b,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:s,z:t*r},programUniforms:d})}},Kk=(e,t,r,n,s,o,i,a,l)=>{let u=i+o.kvSequenceLength,h=[o.batchSize,o.numHeads,o.sequenceLength,u],c=e>1&&n,d=o.kvNumHeads?o.kvNumHeads:o.numHeads,f=c?[o.batchSize,d,u,o.headSize]:void 0,p=o.nReps?o.nReps:1,m=o.scale===0?1/Math.sqrt(o.headSize):o.scale,b=Fr(o.headSize),g=o.headSize/b,_=12,y={x:Math.ceil(u/_),y:Math.ceil(o.sequenceLength/_),z:o.batchSize*o.numHeads},v=[{type:12,data:o.sequenceLength},{type:12,data:g},{type:12,data:u},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:m},{type:12,data:i},{type:12,data:o.kvSequenceLength},{type:12,data:p}],M=c&&n&&Ce.size(n.dims)>0,E=["type","type"];M&&E.push("type"),s&&E.push("type"),a&&E.push("type"),l&&E.push("type");let T=[{dims:h,dataType:t.dataType,gpuDataType:0}];c&&T.push({dims:f,dataType:t.dataType,gpuDataType:0});let S=A=>{let I=Fe("q",t.dataType,t.dims,b),V=Fe("key",r.dataType,r.dims,b),N=[I,V];if(M){let te=Fe("past_key",n.dataType,n.dims,b);N.push(te)}s&&N.push(Fe("attention_bias",s.dataType,s.dims));let z=a?Fe("seq_lens",a.dataType,a.dims):void 0;z&&N.push(z);let q=l?Fe("total_sequence_length_input",l.dataType,l.dims):void 0;q&&N.push(q);let G=ft("output",t.dataType,h),ee=[G];c&&ee.push(ft("present_key",t.dataType,f,b));let Y=zn(1,b),W=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_}u;

  var<workgroup> tileQ: array<${I.type.storage}, ${_*_}>;
  var<workgroup> tileK: array<${I.type.storage}, ${_*_}>;
  ${A.registerUniforms(W).declareVariables(...N,...ee)}
  ${A.mainStart([_,_,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${p===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${p===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${If(z,q,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${M&&c?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${c?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${Y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${M&&c?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${c?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${Y}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(b){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${b}`)}})()};
        output[outputIdx] = ${G.type.value} (sum * uniforms.alpha) + ${s?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${b};${s!==void 0};${n!==void 0};${e}`,inputDependencies:E},getRunData:()=>({outputs:T,dispatchGroup:y,programUniforms:v}),getShaderSource:S}},qk=(e,t,r,n,s,o,i=void 0,a=void 0)=>{let l=o+s.kvSequenceLength,u=s.nReps?s.nReps:1,h=s.vHiddenSize*u,c=e>1&&n,d=s.kvNumHeads?s.kvNumHeads:s.numHeads,f=c?[s.batchSize,d,l,s.headSize]:void 0,p=[s.batchSize,s.sequenceLength,h],m=12,b={x:Math.ceil(s.vHeadSize/m),y:Math.ceil(s.sequenceLength/m),z:s.batchSize*s.numHeads},g=[{type:12,data:s.sequenceLength},{type:12,data:l},{type:12,data:s.vHeadSize},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:12,data:h},{type:12,data:o},{type:12,data:s.kvSequenceLength},{type:12,data:u}],_=c&&n&&Ce.size(n.dims)>0,y=["type","type"];_&&y.push("type"),i&&y.push("type"),a&&y.push("type");let v=[{dims:p,dataType:t.dataType,gpuDataType:0}];c&&v.push({dims:f,dataType:t.dataType,gpuDataType:0});let M=E=>{let T=Fe("probs",t.dataType,t.dims),S=Fe("v",r.dataType,r.dims),A=[T,S];_&&A.push(Fe("past_value",n.dataType,n.dims));let I=i?Fe("seq_lens",i.dataType,i.dims):void 0;i&&A.push(I);let V=a?Fe("total_sequence_length_input",a.dataType,a.dims):void 0;a&&A.push(V);let N=[ft("output",t.dataType,p)];c&&N.push(ft("present_value",t.dataType,f));let z=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${m}u;
  var<workgroup> tileQ: array<${T.type.value}, ${m*m}>;
  var<workgroup> tileV: array<${T.type.value}, ${m*m}>;
  ${E.registerUniforms(z).declareVariables(...A,...N)}
  ${E.mainStart([m,m,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${u===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${u===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${If(I,V,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${_&&c?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${c?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${T.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${_&&c?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${c?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${n!==void 0};${e}`,inputDependencies:y},getRunData:()=>({outputs:v,dispatchGroup:b,programUniforms:g}),getShaderSource:M}},Fd=(e,t,r,n,s,o,i,a,l,u,h=void 0,c=void 0)=>{let d=Math.min(e.outputCount,1+(i?1:0)+(a?1:0)),f=d>1?u.pastSequenceLength:0,p=f+u.kvSequenceLength,m=l&&Ce.size(l.dims)>0?l:void 0,b=[t,r];d>1&&i&&Ce.size(i.dims)>0&&b.push(i),m&&b.push(m),h&&b.push(h),c&&b.push(c);let g=e.compute(Kk(d,t,r,i,m,u,f,h,c),{inputs:b,outputs:d>1?[-1,1]:[-1]})[0];e.compute(Hk(g,u.batchSize,u.numHeads,f,u.sequenceLength,p,h,c),{inputs:h&&c?[g,h,c]:[g],outputs:[]});let _=[g,n];d>1&&a&&Ce.size(a.dims)>0&&_.push(a),h&&_.push(h),c&&_.push(c),e.compute(qk(d,g,n,a,u,f,h,c),{inputs:_,outputs:d>1?[0,2]:[0]})},Qk=(e,t)=>{let r=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],n=t.sequenceLength,s=t.inputHiddenSize,o=t.headSize,i=12,a={x:Math.ceil(t.headSize/i),y:Math.ceil(t.sequenceLength/i),z:t.batchSize*t.numHeads},l=[e.inputs[0],e.inputs[1],e.inputs[2]],u=[{type:12,data:n},{type:12,data:s},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],h=c=>{let d=ft("output_q",l[0].dataType,r),f=ft("output_k",l[0].dataType,r),p=ft("output_v",l[0].dataType,r),m=Fe("input",l[0].dataType,l[0].dims),b=Fe("weight",l[1].dataType,l[1].dims),g=Fe("bias",l[2].dataType,l[2].dims),_=m.type.storage,y=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${i}u;
  var<workgroup> tileInput: array<${_}, ${i*i}>;
  var<workgroup> tileWeightQ: array<${_}, ${i*i}>;
  var<workgroup> tileWeightK: array<${_}, ${i*i}>;
  var<workgroup> tileWeightV: array<${_}, ${i*i}>;
  ${c.registerUniforms(y).declareVariables(m,b,g,d,f,p)}
  ${c.mainStart([i,i,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${_}(0);
    var valueK = ${_}(0);
    var valueV = ${_}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:r,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:a,programUniforms:u}),getShaderSource:h},{inputs:l,outputs:[-1,-1,-1]})},e3=(e,t)=>{let r=Gk(e.inputs,t),[n,s,o]=Qk(e,r);return Fd(e,n,s,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],r)}}),Xk,Jk,Yk,t3,iq=Ke(()=>{So(),kt(),Lt(),Gr(),Nt(),Xk=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let r=(n,s,o)=>{let i=s.length;if(i!==n.length)throw new Error(`${o}: num dimensions != ${i}`);s.forEach((a,l)=>{if(a!==n[l])throw new Error(`${o}: dim[${l}] do not match`)})};if(e[0].dims.length>1){let n=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);r(e[1].dims,n,"Invalid input scale"),r(e[2].dims,n,"Invalid input B"),r(e[3].dims,n,"Invalid input mean"),r(e[4].dims,n,"Invalid input var")}else r(e[1].dims,[1],"Invalid input scale"),r(e[2].dims,[1],"Invalid input B"),r(e[3].dims,[1],"Invalid input mean"),r(e[4].dims,[1],"Invalid input var")},Jk=(e,t)=>{let{epsilon:r,spatial:n,format:s}=t,o=e[0].dims,i=n?Fr(o[o.length-1]):1,a=s==="NHWC"&&o.length>1?i:1,l=Ce.size(o)/i,u=n,h=u?o.length:o,c=Fe("x",e[0].dataType,e[0].dims,i),d=Fe("scale",e[1].dataType,e[1].dims,a),f=Fe("bias",e[2].dataType,e[2].dims,a),p=Fe("inputMean",e[3].dataType,e[3].dims,a),m=Fe("inputVar",e[4].dataType,e[4].dims,a),b=ft("y",e[0].dataType,h,i),g=()=>{let y="";if(n)y=`let cOffset = ${o.length===1?"0u":s==="NHWC"?`outputIndices[${o.length-1}] / ${i}`:"outputIndices[1]"};`;else if(s==="NCHW")y=`
            ${b.indicesSet("outputIndices","0","0")}
            let cOffset = ${b.indicesToOffset("outputIndices")};`;else{y=`var cIndices = ${d.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let v=1;v<d.rank;v++)y+=`cIndices[${v}] = outputIndices[${v}];`;y+=`let cOffset = ${d.indicesToOffset("cIndices")};`}return y},_=y=>`
  const epsilon = ${r};
  ${y.registerUniform("outputSize","u32").declareVariables(c,d,f,p,m,b)}
  ${y.mainStart()}
  ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${b.offsetToIndices(`global_idx * ${i}`)};
    ${g()}
    let scale = ${d.getByOffset("cOffset")};
    let bias = ${f.getByOffset("cOffset")};
    let inputMean = ${p.getByOffset("cOffset")};
    let inputVar = ${m.getByOffset("cOffset")};
    let x = ${c.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${b.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${n}_${i}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:_,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u?[{type:12,data:l},...wt(o)]:[{type:12,data:l}]})}},Yk=e=>or(e),t3=(e,t)=>{let{inputs:r,outputCount:n}=e,s=Yk({...t,outputCount:n});if(yr.webgpu.validateInputContent&&Xk(r,s),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(Jk(r,s))}}),Zk,e2,r3,aq=Ke(()=>{Lt(),Nt(),Zk=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},e2=e=>{let t=e[0].dims,r=e[0].dims[2],n=Ce.size(t)/4,s=e[0].dataType,o=Fe("input",s,t,4),i=Fe("bias",s,[r],4),a=Fe("residual",s,t,4),l=ft("output",s,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:u=>`
  const channels = ${r}u / 4;
  ${u.declareVariables(o,i,a,l)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${o.getByOffset("global_idx")}
      + ${i.getByOffset("global_idx % channels")} + ${a.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},r3=e=>{Zk(e.inputs),e.compute(e2(e.inputs))}}),t2,tr,n3,s3,o3,i3,a3,l3,u3,c3,d3,r2,h3,f3,p3,m3,Hc,g3,ap,_3,y3,v3,w3,b3,x3,M3,T3,E3,P3,S3,C3,k3,$3,A3,I3,yy,O3,Ow,Dw,D3,F3,R3,n2,s2,L3,kb=Ke(()=>{kt(),Lt(),Gr(),Nt(),t2=(e,t,r,n,s,o,i)=>{let a=Math.ceil(t/4),l="";typeof s=="string"?l=`${s}(a)`:l=s("a");let u=Fe("inputData",r,[a],4),h=ft("outputData",n,[a],4),c=[{name:"vec_size",type:"u32"}];return i&&c.push(...i),`
      ${e.registerUniforms(c).declareVariables(u,h)}

  ${o??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${u.getByOffset("global_idx")};
    ${h.setByOffset("global_idx",l)}
  }`},tr=(e,t,r,n,s,o=e.dataType,i,a)=>{let l=[{type:12,data:Math.ceil(Ce.size(e.dims)/4)}];return i&&l.push(...i),{name:t,shaderCache:{hint:s,inputDependencies:["type"]},getShaderSource:u=>t2(u,Ce.size(e.dims),e.dataType,o,r,n,a),getRunData:u=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Ce.size(u[0].dims)/64/4)},programUniforms:l})}},n3=e=>{e.compute(tr(e.inputs[0],"Abs","abs"))},s3=e=>{e.compute(tr(e.inputs[0],"Acos","acos"))},o3=e=>{e.compute(tr(e.inputs[0],"Acosh","acosh"))},i3=e=>{e.compute(tr(e.inputs[0],"Asin","asin"))},a3=e=>{e.compute(tr(e.inputs[0],"Asinh","asinh"))},l3=e=>{e.compute(tr(e.inputs[0],"Atan","atan"))},u3=e=>{e.compute(tr(e.inputs[0],"Atanh","atanh"))},c3=e=>or(e),d3=(e,t)=>{let r;switch(t.to){case 10:r="vec4<f16>";break;case 1:r="vec4<f32>";break;case 12:r="vec4<u32>";break;case 6:r="vec4<i32>";break;case 9:r="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(tr(e.inputs[0],"Cast",r,void 0,t.cacheKey,t.to))},r2=e=>{let t,r,n=e.length>=2&&e[1].data!==0,s=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=n?e[1].getFloat32Array()[0]:-34028234663852886e22,r=s?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=n?e[1].getUint16Array()[0]:64511,r=s?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return or({min:t,max:r})},h3=(e,t)=>{let r=t||r2(e.inputs),n=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"Clip",s=>`clamp(${s}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,r.cacheKey,void 0,[{type:e.inputs[0].dataType,data:r.min},{type:e.inputs[0].dataType,data:r.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},f3=e=>{e.compute(tr(e.inputs[0],"Ceil","ceil"))},p3=e=>{e.compute(tr(e.inputs[0],"Cos","cos"))},m3=e=>{e.compute(tr(e.inputs[0],"Cosh","cosh"))},Hc=e=>or(e),g3=(e,t)=>{let r=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"Elu",n=>`elu_vf32(${n})`,`
  const elu_alpha_ = ${r}(${t.alpha});

  fn elu_f32(a: ${r}) -> ${r} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${r}>) -> vec4<${r}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},ap=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,_3=e=>{let t=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"Erf",r=>`erf_vf32(${r})`,ap(t)))},y3=e=>{e.compute(tr(e.inputs[0],"Exp","exp"))},v3=e=>{e.compute(tr(e.inputs[0],"Floor","floor"))},w3=e=>{let t=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"Gelu",r=>`0.5 * ${r} * (1.0 + erf_vf32(${r} * 0.7071067811865475))`,ap(t)))},b3=(e,t)=>{let r=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"LeakyRelu",n=>`select(leaky_relu_alpha_ * ${n}, ${n}, ${n} >= vec4<${r}>(0.0))`,`const leaky_relu_alpha_ = ${r}(${t.alpha});`,t.cacheKey))},x3=e=>{e.compute(tr(e.inputs[0],"Not",t=>`!${t}`))},M3=e=>{e.compute(tr(e.inputs[0],"Neg",t=>`-${t}`))},T3=e=>{e.compute(tr(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},E3=e=>{let t=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"Relu",r=>`select(vec4<${t}>(0.0), ${r}, ${r} > vec4<${t}>(0.0))`))},P3=e=>{e.compute(tr(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},S3=e=>or(e),C3=(e,t)=>{let r=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"HardSigmoid",n=>`max(vec4<${r}>(0.0), min(vec4<${r}>(1.0), ${t.alpha} * ${n} + vec4<${r}>(${t.beta})))`,void 0,t.cacheKey))},k3=e=>{e.compute(tr(e.inputs[0],"Sin","sin"))},$3=e=>{e.compute(tr(e.inputs[0],"Sinh","sinh"))},A3=e=>{e.compute(tr(e.inputs[0],"Sqrt","sqrt"))},I3=e=>{e.compute(tr(e.inputs[0],"Tan","tan"))},yy=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,O3=e=>{e.compute(tr(e.inputs[0],"Tanh",yy))},Ow=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${yy("v")};
}
`,Dw=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,D3=e=>{let t=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"FastGelu",Dw,Ow(t),void 0,e.inputs[0].dataType))},F3=(e,t)=>{let r=zn(e.inputs[0].dataType);return e.compute(tr(e.inputs[0],"ThresholdedRelu",n=>`select(vec4<${r}>(0.0), ${n}, ${n} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${r}>(${t.alpha});`,t.cacheKey)),0},R3=e=>{e.compute(tr(e.inputs[0],"Log","log"))},n2=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,s2=e=>`quick_gelu_impl(${e})`,L3=(e,t)=>{let r=zn(e.inputs[0].dataType);e.compute(tr(e.inputs[0],"QuickGelu",s2,n2(r,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),o2,i2,N3,lq=Ke(()=>{Lt(),Nt(),kb(),o2=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},i2=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let r=Fe("input",e[0].dataType,e[0].dims,4),n=Fe("bias",e[0].dataType,[e[0].dims[2]],4),s=ft("output",e[0].dataType,t,4),o=Ce.size(t)/4,i=vn(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:a=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${a.declareVariables(r,n,s)}

  ${ap(i)}

  ${a.mainStart()}
    ${a.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${s.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},N3=e=>{o2(e.inputs),e.compute(i2(e.inputs))}}),a2,l2,ao,j3,z3,B3,U3,V3,W3,G3,H3,K3,q3,uq=Ke(()=>{kt(),Lt(),Nt(),a2=(e,t,r,n,s,o,i,a,l,u,h,c)=>{let d,f;typeof a=="string"?d=f=(_,y)=>`${a}((${_}),(${y}))`:typeof a=="function"?d=f=a:(d=a.scalar,f=a.vector);let p=ft("outputData",h,n.length,4),m=Fe("aData",l,t.length,4),b=Fe("bData",u,r.length,4),g;if(s)if(o){let _=Ce.size(t)===1,y=Ce.size(r)===1,v=t.length>0&&t[t.length-1]%4===0,M=r.length>0&&r[r.length-1]%4===0;_||y?g=p.setByOffset("global_idx",f(_?`${m.type.value}(${m.getByOffset("0")}.x)`:m.getByOffset("global_idx"),y?`${b.type.value}(${b.getByOffset("0")}.x)`:b.getByOffset("global_idx"))):g=`
            let outputIndices = ${p.offsetToIndices("global_idx * 4u")};
            let offsetA = ${m.broadcastedIndicesToOffset("outputIndices",p)};
            let offsetB = ${b.broadcastedIndicesToOffset("outputIndices",p)};
            ${p.setByOffset("global_idx",f(i||v?m.getByOffset("offsetA / 4u"):`${m.type.value}(${m.getByOffset("offsetA / 4u")}[offsetA % 4u])`,i||M?b.getByOffset("offsetB / 4u"):`${b.type.value}(${b.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else g=p.setByOffset("global_idx",f(m.getByOffset("global_idx"),b.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let _=(y,v,M="")=>{let E=`aData[indexA${v}][componentA${v}]`,T=`bData[indexB${v}][componentB${v}]`;return`
            let outputIndices${v} = ${p.offsetToIndices(`global_idx * 4u + ${v}u`)};
            let offsetA${v} = ${m.broadcastedIndicesToOffset(`outputIndices${v}`,p)};
            let offsetB${v} = ${b.broadcastedIndicesToOffset(`outputIndices${v}`,p)};
            let indexA${v} = offsetA${v} / 4u;
            let indexB${v} = offsetB${v} / 4u;
            let componentA${v} = offsetA${v} % 4u;
            let componentB${v} = offsetB${v} % 4u;
            ${y}[${v}] = ${M}(${d(E,T)});
          `};h===9?g=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:g=`
            ${_("outputData[global_idx]",0)}
            ${_("outputData[global_idx]",1)}
            ${_("outputData[global_idx]",2)}
            ${_("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(m,b,p)}

        ${c??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${g}
      }`},l2=(e,t,r,n,s,o,i=r.dataType)=>{let a=r.dims.map(m=>Number(m)??1),l=n.dims.map(m=>Number(m)??1),u=!Ce.areEqual(a,l),h=a,c=Ce.size(a),d=!1,f=!1,p=[u];if(u){let m=Ru.calcShape(a,l,!1);if(!m)throw new Error("Can't perform binary op on the given tensors");h=m.slice(),c=Ce.size(h);let b=Ce.size(a)===1,g=Ce.size(l)===1,_=a.length>0&&a[a.length-1]%4===0,y=l.length>0&&l[l.length-1]%4===0;p.push(b),p.push(g),p.push(_),p.push(y);let v=1;for(let M=1;M<h.length;M++){let E=a[a.length-M],T=l[l.length-M];if(E===T)v*=E;else break}v%4===0?(f=!0,d=!0):(b||g||_||y)&&(d=!0)}else d=!0;return p.push(d),{name:e,shaderCache:{hint:t+p.map(m=>m.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:m=>a2(m,a,l,h,d,u,f,s,r.dataType,n.dataType,i,o),getRunData:()=>({outputs:[{dims:h,dataType:i}],dispatchGroup:{x:Math.ceil(c/64/4)},programUniforms:[{type:12,data:Math.ceil(Ce.size(h)/4)},...wt(a,l,h)]})}},ao=(e,t,r,n,s,o)=>{e.compute(l2(t,s??"",e.inputs[0],e.inputs[1],r,n,o))},j3=e=>{ao(e,"Add",(t,r)=>`${t}+${r}`)},z3=e=>{ao(e,"Div",(t,r)=>`${t}/${r}`)},B3=e=>{ao(e,"Equal",{scalar:(t,r)=>`u32(${t}==${r})`,vector:(t,r)=>`vec4<u32>(${t}==${r})`},void 0,void 0,9)},U3=e=>{ao(e,"Mul",(t,r)=>`${t}*${r}`)},V3=e=>{let t=Fe("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;ao(e,"Pow",{scalar:(r,n)=>`pow_custom(${r},${n})`,vector:(r,n)=>`pow_vector_custom(${r},${n})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},W3=e=>{ao(e,"Sub",(t,r)=>`${t}-${r}`)},G3=e=>{ao(e,"Greater",{scalar:(t,r)=>`u32(${t}>${r})`,vector:(t,r)=>`vec4<u32>(${t}>${r})`},void 0,void 0,9)},H3=e=>{ao(e,"Less",{scalar:(t,r)=>`u32(${t}<${r})`,vector:(t,r)=>`vec4<u32>(${t}<${r})`},void 0,void 0,9)},K3=e=>{ao(e,"GreaterOrEqual",{scalar:(t,r)=>`u32(${t}>=${r})`,vector:(t,r)=>`vec4<u32>(${t}>=${r})`},void 0,void 0,9)},q3=e=>{ao(e,"LessOrEqual",{scalar:(t,r)=>`u32(${t}<=${r})`,vector:(t,r)=>`vec4<u32>(${t}<=${r})`},void 0,void 0,9)}}),u2,c2,d2,h2,Q3,X3,cq=Ke(()=>{kt(),Lt(),Gr(),Nt(),u2=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let r=0,n=e[r],s=n.dataType,o=n.dims.length;e.forEach((i,a)=>{if(a!==r){if(i.dataType!==s)throw new Error("input tensors should be one type");if(i.dims.length!==o)throw new Error("input tensors should have the same shape");i.dims.forEach((l,u)=>{if(u!==t&&l!==n.dims[u])throw new Error("non concat dimensions must match")})}})},c2=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,d2=(e,t)=>{let r=e.length,n=[];for(let s=0;s<r;++s){let o=t.setByOffset("global_idx",e[s].getByIndices("indices"));r===1?n.push(o):s===0?n.push(`if (inputIndex == ${s}u) { ${o} }`):s===r-1?n.push(`else { ${o} }`):n.push(`else if (inputIndex == ${s}) { ${o} }`)}return n.join(`
`)},h2=(e,t,r,n)=>{let s=Ce.size(r),o=new Array(e.length),i=new Array(e.length),a=0,l=[],u=[],h=[{type:12,data:s}];for(let m=0;m<e.length;++m)a+=e[m].dims[t],o[m]=a,u.push(e[m].dims.length),i[m]=Fe(`input${m}`,n,u[m]),l.push("rank"),h.push({type:12,data:o[m]});for(let m=0;m<e.length;++m)h.push(...wt(e[m].dims));h.push(...wt(r));let c=ft("output",n,r.length),d=c.indicesGet("indices",t),f=Array.from(Array(o.length).keys()).map(m=>`uniforms.sizeInConcatAxis${m}`).join(","),p=m=>`

  ${(()=>{m.registerUniform("outputSize","u32");for(let b=0;b<e.length;b++)m.registerUniform(`sizeInConcatAxis${b}`,"u32");return m.declareVariables(...i,c)})()}

  ${c2(o.length,f)}

  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${c.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${d});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${f});
      ${d} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${d2(i,c)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:r,dataType:n}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:h}),getShaderSource:p}},Q3=(e,t)=>{let r=e.inputs,n=r[0].dims,s=Ce.normalizeAxis(t.axis,n.length);u2(r,s);let o=n.slice();o[s]=r.reduce((a,l)=>a+(l.dims.length>s?l.dims[s]:0),0);let i=r.filter(a=>Ce.size(a.dims)>0);e.compute(h2(i,s,o,r[0].dataType),{inputs:i})},X3=e=>or({axis:e.axis})}),ll,ul,cl,$b,ml=Ke(()=>{kt(),Lt(),ll=(e,t,r="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${r}(uniforms.clip_min)), ${t}(${r}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${r}(uniforms.alpha) * value + ${r}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${r}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},ul=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},cl=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},$b=e=>{let t=(e==null?void 0:e.activation)||"";if(t==="HardSigmoid"){let[r,n]=(e==null?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:r,beta:n}}else if(t==="Clip"){let[r,n]=(e==null?void 0:e.activation_params)||[xL,ML];return{activation:t,clipMax:n,clipMin:r}}else if(t==="LeakyRelu"){let[r]=(e==null?void 0:e.activation_params)||[.01];return{activation:t,alpha:r}}return{activation:t}}}),Mn,J3,Ab=Ke(()=>{Mn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},J3=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Y3,dq=Ke(()=>{Y3=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),id,Ib,Ob=Ke(()=>{kt(),Lt(),Nt(),ml(),id=(e,t,r,n,s)=>{let o=n-r;return`
      ${Array.from({length:r}).map((i,a)=>`
      if (${gt(t.shape,a,t.rank)} != 1) {
        ${t.indicesSet(e,a,gt(s,a+o,n))}
      } else {
        ${t.indicesSet(e,a,0)}
      }`).join("")}
`},Ib=(e,t,r,n,s=!1,o)=>{let i=e[0].dims,a=e[1].dims,l=i[i.length-2],u=a[a.length-1],h=i[i.length-1],c=Fr(u),d=Fr(h),f=Fr(l),p=Ce.size(r)/c/f,m=e.length>2,b=n?n.slice(0,-2):r.slice(0,-2),g=[Ce.size(b),l,u],_=[{type:12,data:p},{type:12,data:l},{type:12,data:u},{type:12,data:h}];ul(t,_),_.push(...wt(b,i,a)),m&&_.push(...wt(e[2].dims)),_.push(...wt(g));let y=v=>{let M=Pb("batch_dims",e[0].dataType,b.length),E=Fe("a",e[0].dataType,i.length,d),T=Fe("b",e[1].dataType,a.length,c),S=ft("output",e[0].dataType,g.length,c),A=vn(S.type.tensor),I=ll(t,S.type.value,A),V=[E,T],N="";if(m){let G=s?c:1;V.push(Fe("bias",e[2].dataType,e[2].dims.length,G)),N=`${s?`value += bias[col / ${G}];`:`value += ${S.type.value}(bias[row + i]);`}`}let z=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];cl(t,z);let q=()=>{let G=`var a_data: ${E.type.value};`;for(let ee=0;ee<d;ee++)G+=`
              let b_data${ee} = b[(b_offset + (k + ${ee}) * uniforms.N + col) / ${c}];`;for(let ee=0;ee<f;ee++){G+=`a_data = a[(a_offset + (row + ${ee}) * uniforms.K + k) / ${d}];`;for(let Y=0;Y<d;Y++)G+=`
            values[${ee}] = fma(${T.type.value}(a_data${d===1?"":`[${Y}]`}), b_data${Y}, values[${ee}]);
`}return G};return`
  ${v.registerUniforms(z).registerInternalVariables(M).declareVariables(...V,S)}
  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${c})) * ${c};
    var index1 = global_idx / (uniforms.N / ${c});
    let stride1 = uniforms.M / ${f};
    let row = (index1 % stride1) * ${f};
    let batch = index1 / stride1;

    ${r.length===2?"":`let batch_indices = ${M.offsetToIndices("batch")};`}

    var a_indices: ${E.type.indices};
    ${id("a_indices",E,E.rank-2,M.rank,"batch_indices")}
    ${E.indicesSet("a_indices",E.rank-2,0)}
    ${E.indicesSet("a_indices",E.rank-1,0)}
    let a_offset = ${E.indicesToOffset("a_indices")};

    var b_indices: ${T.type.indices};
    ${id("b_indices",T,T.rank-2,M.rank,"batch_indices")}
    ${T.indicesSet("b_indices",T.rank-2,0)}
    ${T.indicesSet("b_indices",T.rank-1,0)}
    let b_offset = ${T.indicesToOffset("b_indices")};
    var values: array<${S.type.value}, ${f}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${d}) {
      ${q()}
    }
    for (var i = 0u; i < ${f}u; i++) {
      var value = values[i];
      ${N}
      ${I}
      let cur_indices = ${S.type.indices}(batch, row + i, col);
      let offset = ${S.indicesToOffset("cur_indices")};
      ${S.setByOffset(`offset / ${c}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${c};${d};${f};${s}`,inputDependencies:m?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:_}),getShaderSource:y}}}),f2,p2,Fw,vy,m2,Rw,g2,Xp,Db=Ke(()=>{kt(),Lt(),Nt(),ml(),Ob(),Ab(),f2=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,p2=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,Fw=(e,t,r="f32",n,s=!1,o=32,i=!1,a=32)=>{let l=t[1]*e[1],u=t[0]*e[0],h=s?l:o,c=s?o:l,d=h/t[0],f=o/t[1];if(!((s&&d===4&&e[1]===4||!s&&(d===3||d===4))&&h%t[0]===0&&o%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${s} is true, innerElementSize ${d} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${d} must be 3 or 4.
  tileAWidth ${h} must be divisible by workgroupSize[0]${t[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${d}<${r}>, ${h/d}>, ${c}>;
var<workgroup> mm_Bsub: array<array<vec4<${r}>, ${u/e[0]}>, ${o}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${d};
const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${i?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${i?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${i?`i32(globalId.z) * ${a}`:"0"};

  var acc: array<vec4<${r}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${f};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${f2(s,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${d===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${p2(s,d)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},vy=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,m2=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Rw=(e,t,r="f32",n,s=!1,o=32,i=!1,a=32,l=!1)=>{let u=e[1]*t[1],h=e[0]*t[0],c=s?u:o,d=s?o:u;if(!(d%t[1]===0&&c%t[0]===0&&o%t[1]===0))throw new Error(`tileAHight ${d} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${c} must be divisible by workgroupSize[0]${t[0]}, tileInner ${o} must be divisible by workgroupSize[1]${t[1]}`);let f=d/t[1],p=c/t[0],m=o/t[1],b=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${u};
    let globalColStart = i32(workgroupId.x) * ${h};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${d}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${t[0]}) {
          ${vy(s,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${r}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${s?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${u};

let tileRowA = i32(localId.y) * ${f};
let tileColA = i32(localId.x) * ${p};
let tileRowB = i32(localId.y) * ${m};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${f}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${p}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${vy(s,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${r}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${m2(s)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${r}, ${c}>, ${d}>;
  var<workgroup> mm_Bsub : array<array<${r}, ${h}>, ${o}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${i?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${i?`${Math.ceil(a/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${i?`i32(globalId.z) * ${a}`:"0"};

    var acc : array<array<${r}, colPerThread>, rowPerThread>;
    ${b}
  }
`},g2=(e,t,r,n,s=!1)=>{let[o,i,a,l]=n,u=vn(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Mn(e,u)} {
      var value = ${Mn(e,u)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${i.type.indices};
        ${id("aIndices",i,i.rank-2,o.rank,"batchIndices")}
        ${i.indicesSet("aIndices",i.rank-2,"u32(row)")}
        ${i.indicesSet("aIndices",i.rank-1,"u32(colIn)")}
        value = ${i.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Mn(e,u)} {
      var value = ${Mn(e,u)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${a.type.indices};
        ${id("bIndices",a,a.rank-2,o.rank,"batchIndices")}
        ${a.indicesSet("bIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("bIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Mn(e,u)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${s?"bias[colIn]":`${Mn(e,u)}(bias[row])`};`:""}
        ${r}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Xp=(e,t,r,n,s=!1,o)=>{let i=e[0].dims,a=e[1].dims,l=i.slice(0,-2),u=a.slice(0,-2),h=n?n.slice(0,-2):r.slice(0,-2),c=Ce.size(h),d=i[i.length-2],f=i[i.length-1],p=a[a.length-1],m=f%4===0&&p%4===0,b=d<=8?[4,1,1]:[4,4,1],g=[8,8,1],_=[Math.ceil(p/g[0]/b[0]),Math.ceil(d/g[1]/b[1]),Math.ceil(c/g[2]/b[2])],y=m?4:1,v=[...l,d,f/y],M=v.length,E=[...u,f,p/y],T=E.length,S=[c,d,p/y],A=[{type:6,data:d},{type:6,data:p},{type:6,data:f}];ul(t,A),A.push(...wt(h,v,E));let I=["rank","rank"],V=e.length>2;V&&(A.push(...wt(e[2].dims)),I.push("rank")),A.push(...wt(S));let N=z=>{let q=h.length,G=Pb("batchDims",e[0].dataType,q,1),ee=vn(e[0].dataType),Y=Fe("a",e[0].dataType,M,y),W=Fe("b",e[1].dataType,T,y),te=ft("result",e[0].dataType,S.length,y),le=[Y,W];if(V){let ce=s?y:1;le.push(Fe("bias",e[2].dataType,e[2].dims.length,ce))}let oe=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];cl(t,oe);let U=vn(te.type.tensor),R=ll(t,te.type.value,U),X=g2(y,V,R,[G,Y,W,te],s);return`
  ${z.registerUniforms(oe).registerInternalVariables(G).declareVariables(...le,te)}
  ${X}
  ${m?Fw(b,g,ee,G):Rw(b,g,ee,G)}
                   `};return{name:"MatMul",shaderCache:{hint:`${b};${t.activation};${m};${s}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:o?o(r):r,dataType:e[0].dataType}],dispatchGroup:{x:_[0],y:_[1],z:_[2]},programUniforms:A}),getShaderSource:N}}}),_2,Z3,hq=Ke(()=>{kt(),_i(),Nt(),ml(),Ab(),dq(),Db(),_2=(e,t,r,n,s=!1,o,i=4,a=4,l=4,u="f32")=>{let h=A=>{switch(A){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},c=A=>{switch(A){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},d=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,f=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,p=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",m=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",b=e?"row":"col",g=e?"col":"row",_=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${b} / outWidth;
    let outCol = ${b} % outWidth;

    let WRow = ${g} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${g} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${g} % inChannels;
    var resData = ${Mn(i,u)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${p} && xCol >= 0 && xCol < ${m}) {
      ${d}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${h(i)}
    }
    return resData;`,y=e?t&&n?`
    let col = colIn * ${i};
    ${_}`:`
    let col = colIn * ${i};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${_}
    }
    return ${Mn(i,u)}(0.0);`:n&&r?`
    let col = colIn * ${i};
    ${_}`:`
    let col = colIn * ${i};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_}
    }
    return ${Mn(i,u)}(0.0);`,v=e?n&&r?c(a):`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${c(a)}
    }
    return ${Mn(a,u)}(0.0);`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${c(a)}
    }
    return ${Mn(a,u)}(0.0);`,M=Mn(l,u),E=Mn(e?i:a,u),T=Mn(e?a:i,u),S=ll(o,M,u);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${E} {
      ${e?y:v}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${T} {
      ${e?v:y}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${M}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${f}
      ${J3(s)}
      ${S}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Z3=(e,t,r,n,s,o,i,a,l)=>{let u=t.format==="NHWC",h=u?e[0].dims[3]:e[0].dims[1],c=r[0],d=u?r[2]:r[3],f=u?r[1]:r[2],p=u?r[3]:r[1],m=u&&(h%4===0||h%3===0)&&p%4===0,b=u?p:d*f,g=u?d*f:p,_=[8,8,1],y=n<=8?[4,1,1]:[4,4,1],v=[Math.ceil(b/_[0]/y[0]),Math.ceil(g/_[1]/y[1]),Math.ceil(c/_[2]/y[2])];Xt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${v}`);let M=m?u&&h%4!==0?3:4:1,E=_[1]*y[1],T=_[0]*y[0],S=Math.max(_[0]*M,_[1]),A=n%E===0,I=s%T===0,V=o%S===0,N=m?[M,4,4]:[1,1,1],z=[{type:6,data:n},{type:6,data:s},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];ul(t,z),z.push(...wt(e[0].dims,e[1].dims));let q=["rank","rank"];i&&(z.push(...wt(e[2].dims)),q.push("rank")),z.push(...wt(r));let G=ee=>{let Y=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];cl(t,Y);let W=m?4:1,te=vn(e[0].dataType),le=`
      fn setOutputAtIndex(flatIndex : i32, value : ${m?`vec4<${te}>`:te}) {
        result[flatIndex] = ${m?`vec4<${te}>`:te}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${m?`vec4<${te}>`:te}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${m?"/ 4":""}, value);
      }`,oe=Fe("x",e[0].dataType,e[0].dims.length,M===3?1:M),U=Fe("w",e[1].dataType,e[1].dims.length,W),R=[oe,U],X=ft("result",e[0].dataType,r.length,W);if(i){let ce=Fe("bias",e[2].dataType,e[2].dims.length,W);R.push(ce),le+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${m?`vec4<${te}>`:te} {
          return bias[coords.${u?"w":"y"}${m?"/ 4":""}];
        }`}return`
        ${Y3("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${ee.registerUniforms(Y).declareVariables(...R,X)}
        ${le}
        ${_2(u,A,I,V,i,t,N[0],N[1],N[2],te)}
        ${m?Fw(y,_,te,void 0,!u,S):Rw(y,_,te,void 0,!u,S,!1,void 0,a)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${M};${m};${A};${I};${V};${E};${T};${S}`,inputDependencies:q},getRunData:()=>({outputs:[{dims:l?l(r):r,dataType:e[0].dataType}],dispatchGroup:{x:v[0],y:v[1],z:v[2]},programUniforms:z}),getShaderSource:G}}}),y2,wy,Oc,v2,by,w2,eN,tN,fq=Ke(()=>{kt(),_i(),Lt(),Nt(),ml(),Ab(),y2=e=>{let t=1;for(let r=0;r<e.length;r++)t*=e[r];return t},wy=e=>typeof e=="number"?[e,e,e]:e,Oc=(e,t)=>t<=1?e:e+(e-1)*(t-1),v2=(e,t,r,n=1)=>{let s=Oc(t,n);return Math.floor((e[0]*(r-1)-r+s)/2)},by=(e,t,r,n,s)=>{s==null&&(s=v2(e,t[0],n[0]));let o=[0,0,0,r];for(let i=0;i<3;i++)e[i]+2*s>=t[i]&&(o[i]=Math.trunc((e[i]-t[i]+2*s)/n[i]+1));return o},w2=(e,t,r,n,s,o,i,a,l,u)=>{let h,c,d,f;if(e==="VALID"&&(e=0),typeof e=="number"){h={top:e,bottom:e,left:e,right:e,front:e,back:e};let p=by([t,r,n,1],[a,l,u],1,[s,o,i],e);c=p[0],d=p[1],f=p[2]}else if(Array.isArray(e)){if(!e.every((m,b,g)=>m===g[0]))throw Error(`Unsupported padding parameter: ${e}`);h={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let p=by([t,r,n,1],[a,l,u],1,[s,o,i],e[0]);c=p[0],d=p[1],f=p[2]}else if(e==="SAME_UPPER"){c=Math.ceil(t/s),d=Math.ceil(r/o),f=Math.ceil(n/i);let p=(c-1)*s+a-t,m=(d-1)*o+l-r,b=(f-1)*i+u-n,g=Math.floor(p/2),_=p-g,y=Math.floor(m/2),v=m-y,M=Math.floor(b/2),E=b-M;h={top:y,bottom:v,left:M,right:E,front:g,back:_}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outDepth:c,outHeight:d,outWidth:f}},eN=(e,t,r,n,s,o=!1,i="channelsLast")=>{let a,l,u,h,c;if(i==="channelsLast")[a,l,u,h,c]=e;else if(i==="channelsFirst")[a,c,l,u,h]=e;else throw new Error(`Unknown dataFormat ${i}`);let[d,,f,p,m]=t,[b,g,_]=wy(r),[y,v,M]=wy(n),E=Oc(f,y),T=Oc(p,v),S=Oc(m,M),{padInfo:A,outDepth:I,outHeight:V,outWidth:N}=w2(s,l,u,h,b,g,_,E,T,S),z=o?d*c:d,q=[0,0,0,0,0];return i==="channelsFirst"?q=[a,z,I,V,N]:i==="channelsLast"&&(q=[a,I,V,N,z]),{batchSize:a,dataFormat:i,inDepth:l,inHeight:u,inWidth:h,inChannels:c,outDepth:I,outHeight:V,outWidth:N,outChannels:z,padInfo:A,strideDepth:b,strideHeight:g,strideWidth:_,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:E,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationDepth:y,dilationHeight:v,dilationWidth:M,inShape:e,outShape:q,filterShape:t}},tN=(e,t,r,n,s,o)=>{let i=o==="channelsLast";i?e[0].dims[3]:e[0].dims[1];let a=[64,1,1],l={x:r.map((b,g)=>g)},u=[Math.ceil(y2(l.x.map(b=>r[b]))/a[0]),1,1];Xt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let h=1,c=Ce.size(r),d=[{type:12,data:c},{type:12,data:n},{type:12,data:s},{type:12,data:t.strides},{type:12,data:t.dilations}];ul(t,d),d.push(...wt(e[0].dims,e[1].dims));let f=["rank","rank"],p=e.length===3;p&&(d.push(...wt(e[2].dims)),f.push("rank")),d.push(...wt(r));let m=b=>{let g=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:s.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];cl(t,g);let _=1,y=vn(e[0].dataType),v=Fe("x",e[0].dataType,e[0].dims.length,h),M=Fe("W",e[1].dataType,e[1].dims.length,_),E=[v,M],T=ft("result",e[0].dataType,r.length,_),S="";if(p){let V=Fe("bias",e[2].dataType,e[2].dims.length,_);E.push(V),S+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${y} {
          return bias[${i?gt("coords",4,5):gt("coords",1,5)}];
        }`}let A=Mn(h,y),I=ll(t,A,y);return`
            ${S}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${v.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${M.getByIndices("aIndices")};
            }
          ${b.registerUniforms(g).declareVariables(...E,T)}
          ${b.mainStart()}
          ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${T.offsetToIndices("global_idx")};
              let batch = ${gt("coords",0,v.rank)};
              let d2 = ${i?gt("coords",v.rank-1,v.rank):gt("coords",1,v.rank)};
              let xFRCCorner = vec3<u32>(${i?gt("coords",1,v.rank):gt("coords",2,v.rank)},
              ${i?gt("coords",2,v.rank):gt("coords",3,v.rank)},
              ${i?gt("coords",3,v.rank):gt("coords",4,v.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${i?gt("uniforms.x_shape",1,v.rank):gt("uniforms.x_shape",2,v.rank)};
              let xShapeZ = ${i?gt("uniforms.x_shape",2,v.rank):gt("uniforms.x_shape",3,v.rank)};
              let xShapeW = ${i?gt("uniforms.x_shape",3,v.rank):gt("uniforms.x_shape",4,v.rank)};
              let xShapeU = ${i?gt("uniforms.x_shape",4,v.rank):gt("uniforms.x_shape",1,v.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${i?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${i?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${i?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${i?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${p?"value = value + getBiasByOutputCoords(coords)":""};
              ${I}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${i};${h};${p}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:d}),getShaderSource:m}}}),rN,nN,pq=Ke(()=>{kt(),Lt(),Nt(),ml(),rN=(e,t,r,n)=>{let s=e.length>2,o=s?"value += b[output_channel];":"",i=e[0].dims,a=e[1].dims,l=t.format==="NHWC",u=l?r[3]:r[1],h=u/t.group,c=l&&h>=4?Fr(u):1,d=Ce.size(r)/c,f=[{type:12,data:d},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:h}];ul(t,f),f.push(...wt(i,[a[0],a[1],a[2],a[3]/c]));let p=s?["rank","rank","rank"]:["rank","rank"];f.push(...wt([r[0],r[1],r[2],r[3]/c]));let m=b=>{let g=ft("output",e[0].dataType,r.length,c),_=vn(g.type.tensor),y=ll(t,g.type.value,_),v=Fe("x",e[0].dataType,i.length),M=Fe("w",e[1].dataType,a.length,c),E=[v,M];s&&E.push(Fe("b",e[2].dataType,e[2].dims,c));let T=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];cl(t,T);let S=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${v.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${M.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${v.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${M.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${b.registerUniforms(T).declareVariables(...E,g)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${g.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${c} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${g.type.value} = ${g.type.value}(0);
    ${S}
    ${o}
    ${y}
    ${g.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${c}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:f}),getShaderSource:m}},nN=(e,t,r,n)=>{let s=e.length>2,o=Fr(r[3]),i=Fr(r[2]),a=Ce.size(r)/o/i,l=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],u=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],h=[r[0],r[1],r[2],r[3]/o],c=[{type:12,data:a},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];ul(t,c),c.push(...wt(l,u,h));let d=(i-1)*t.strides[1]+u[1],f=p=>{let m=ft("output",e[0].dataType,h.length,o),b=vn(m.type.tensor),g=ll(t,m.type.value,b),_=Fe("x",e[0].dataType,l.length,o),y=Fe("w",e[1].dataType,u.length,o),v=[_,y];s&&v.push(Fe("b",e[2].dataType,e[2].dims,o));let M=s?"value += b[output_channel];":"",E=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return cl(t,E),`
  ${p.registerUniforms(E).declareVariables(...v,m)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${i}u;
    let col = (index1 % width1) * ${i}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${_.type.value}, ${d}>;
    var values: array<${m.type.value}, ${i}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${u[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${d}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${_.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${_.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${u[1]}; w_width++) {
          let w_val = ${y.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${i}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${i}u; i++) {
      var value = values[i];
      ${M}
      ${g}
      ${m.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${o};${i};${d};${u[0]};${u[1]}`,inputDependencies:s?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(r):r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:c}),getShaderSource:f}}}),b2,Of,x2,Df,Lw,xy,M2,T2,Nw,mq=Ke(()=>{Lt(),hq(),fq(),Db(),pq(),ml(),Ob(),ca(),b2=(e,t,r,n,s,o)=>{let i=e[0],a=e.slice(o?1:2,o?3:4),l=a.length,u=t[0],h=t.slice(2).map((d,f)=>d+(d-1)*(r[f]-1)),c=a.map((d,f)=>d+n[f]+n[f+l]).map((d,f)=>Math.floor((d-h[f]+s[f])/s[f]));return c.splice(0,0,i),c.splice(o?3:1,0,u),c},Of=[2,3,1,0],x2=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[1]*t.group;if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let s=e[0].dims.length-2;if(t.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(t.strides.length!==s)throw new Error(`strides should be ${s}D`);if(t.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Df=(e,t)=>{let r=e.kernelShape.slice();r.length<t[1].dims.length-2&&r.push(...Array(t[1].dims.length-2-r.length).fill(0));for(let o=2;o<t[1].dims.length;++o)r[o-2]===0&&(r[o-2]=t[1].dims[o]);let n=e.pads.slice();qp.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,r,n,e.format==="NHWC",e.autoPad);let s=Object.assign({},e);return Object.assign(s,{kernelShape:r,pads:n}),s},Lw=e=>{let t=$b(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],s=e.dilations,o=e.group,i=e.kernel_shape,a=e.pads,l=e.strides,u=e.w_is_const();return{autoPad:n,format:r,dilations:s,group:o,kernelShape:i,pads:a,strides:l,wIsConst:u,...t,cacheKey:`${e.format};${t.activation};`}},xy=(e,t,r,n)=>{let s=r.format==="NHWC",o=b2(t[0].dims,t[1].dims,r.dilations,r.pads,r.strides,s);if(r.group!==1){let E=[t[0]];if(s){let T=e.kernelCustomData.wT??e.compute(Ts(t[1],Of),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=T),E.push(T)}else E.push(t[1]);t.length===3&&E.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&s&&t[1].dims[0]===r.group&&t[1].dims[1]===1&&r.dilations[0]===1&&r.dilations[1]===1?e.compute(nN(E,r,o,n),{inputs:E}):e.compute(rN(E,r,o,n),{inputs:E});return}let i=t.length===3,a=t[0].dims[s?1:2],l=t[0].dims[s?2:3],u=t[0].dims[s?3:1],h=t[1].dims[2],c=t[1].dims[3],d=o[s?1:2],f=o[s?2:3],p=o[s?3:1],m=s&&h===a&&c===l&&r.pads[0]===0&&r.pads[1]===0;if(m||h===1&&c===1&&r.dilations[0]===1&&r.dilations[1]===1&&r.strides[0]===1&&r.strides[1]===1&&r.pads[0]===0&&r.pads[1]===0){let E=o[0],T,S,A,I=[];if(s){let z=e.kernelCustomData.wT??e.compute(Ts(t[1],Of),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];if(r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=z),m){let q=a*l*u;T=t[0].reshape([1,E,q]),S=z.reshape([1,q,p]),A=[1,E,p]}else T=t[0].reshape([E,a*l,u]),S=z.reshape([1,u,p]),A=[E,d*f,p];I.push(T),I.push(S)}else T=t[0].reshape([E,u,a*l]),S=t[1].reshape([1,p,u]),A=[E,p,d*f],I.push(S),I.push(T);i&&I.push(t[2]);let V=A[2],N=I[0].dims[I[0].dims.length-1];V<8&&N<8?e.compute(Ib(I,r,o,A,s,n),{inputs:I}):e.compute(Xp(I,r,o,A,s,n),{inputs:I});return}let b=!0,g=e.kernelCustomData.wT??e.compute(Ts(t[1],Of),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=g);let _=[t[0],g];i&&_.push(t[2]);let y=s?d*f:p,v=s?p:d*f,M=h*c*u;e.compute(Z3(_,r,o,y,v,M,i,b,n),{inputs:_})},M2=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let s=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),i=[1].concat(t.dilations),a=[1].concat(t.kernelShape),l=Df({...t,pads:s,strides:o,dilations:i,kernelShape:a},n);xy(e,n,l,u=>r?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},T2=(e,t,r)=>{let n=r.format==="NHWC"?"channelsLast":"channelsFirst",s=Df(r,t),o=r.autoPad==="NOTSET"?r.pads:r.autoPad,i=eN(t[0].dims,t[1].dims,r.strides,r.dilations,o,!1,n);e.compute(tN(t,s,i.outShape,[i.filterDepth,i.filterHeight,i.filterWidth],[i.padInfo.front,i.padInfo.top,i.padInfo.left],n))},Nw=(e,t)=>{if(x2(e.inputs,t),e.inputs[0].dims.length===3)M2(e,t);else if(e.inputs[0].dims.length===5)T2(e,e.inputs,t);else{let r=Df(t,e.inputs);xy(e,e.inputs,r)}}}),sN,gq=Ke(()=>{kt(),_i(),Lt(),Nt(),sN=(e,t,r)=>{let n=e.length>2,s=t.outputShape,o=t.format==="NHWC",i=t.group,a=e[1].dims,l=a[2]/i,u=a[3],h=o?Fr(l):1,c=o&&u===1&&l>=4,d=c?Math.floor(l/4)*4:Math.floor(l/h)*h,f=l-d,p=o?Fr(u):1,m=o?u===1?h:p:1,b=Ce.size(s)/p,g=[Math.ceil(b/64),1,1];Xt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${g}`);let _=["rank","rank"],y=[t.strides[0],t.strides[1]],v=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],M=[t.dilations[0],t.dilations[1]],E=[v[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),v[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],T=[E[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),E[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],S=[{type:12,data:b},{type:12,data:y},{type:12,data:v},{type:12,data:M},{type:12,data:E},{type:6,data:T},{type:12,data:d},{type:12,data:l},{type:12,data:u},...wt(e[0].dims,e[1].dims)];n&&(S.push(...wt(e[2].dims)),_.push("rank")),S.push(...wt(s));let A=I=>{let V=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:y.length},{name:"filter_dims",type:"u32",length:v.length},{name:"dilations",type:"u32",length:v.length},{name:"effective_filter_dims",type:"u32",length:E.length},{name:"pads",type:"i32",length:T.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],N=vn(e[0].dataType),z=o?1:2,q=o?2:3,G=o?3:1,ee=Fe("W",e[1].dataType,e[1].dims.length,m),Y=Fe("Dy",e[0].dataType,e[0].dims.length,h),W=[Y,ee];n&&W.push(Fe("bias",e[2].dataType,[s[G]].length,p));let te=ft("result",e[0].dataType,s.length,p),le=()=>{let R="";if(c)h===4?R+=`
        let xValue = ${Y.getByOffset("x_offset")};
        let wValue = ${ee.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:h===2?R+=`
          dotProd = dotProd + dot(vec4<${N}>(${Y.getByOffset("x_offset")}, ${Y.getByOffset("x_offset + 1u")}), vec4<${N}>(${ee.getByOffset("w_offset")}, ${ee.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:h===1&&(R+=`
          dotProd = dotProd + dot(vec4<${N}>(${Y.getByOffset("x_offset")}, ${Y.getByOffset("x_offset + 1u")}, ${Y.getByOffset("x_offset + 2u")}, ${Y.getByOffset("x_offset + 3u")}), vec4<${N}>(${ee.getByOffset("w_offset")}, ${ee.getByOffset("w_offset + 1u")}, ${ee.getByOffset("w_offset + 2u")}, ${ee.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(R+=`
                  let xValue = ${o?Y.getByOffset(`${Y.indicesToOffset(`${Y.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${h}`):Y.get("batch","inputChannel","idyR","idyC")};
        `,h===1)R+=`
          let w_offset = ${ee.indicesToOffset(`${ee.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${ee.getByOffset(`w_offset / ${m}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let X=0;X<h;X++)R+=`
            let wValue${X} = ${ee.getByOffset(`${ee.indicesToOffset(`${ee.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${X}, wOutChannel)`)} / ${m}`)};
            dotProd = dotProd + xValue[${X}] * wValue${X};`;return R},oe=()=>{if(f===0)return"";if(!c)throw new Error(`packInputAs4 ${c} is not true.`);let R="";if(h===1){R+="dotProd = dotProd";for(let X=0;X<f;X++)R+=`
            + ${Y.getByOffset(`x_offset + ${X}`)} * ${ee.getByOffset(`w_offset + ${X}`)}`;R+=";"}else if(h===2){if(f!==2)throw new Error(`Invalid inputChannelsRemainder ${f}.`);R+=`
          let xValue = ${Y.getByOffset("x_offset")};
          let wValue = ${ee.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return R},U=`
            let outputIndices = ${te.offsetToIndices(`global_idx * ${p}`)};
            let batch = ${te.indicesGet("outputIndices",0)};
            let d1 = ${te.indicesGet("outputIndices",G)};
            let r = ${te.indicesGet("outputIndices",z)};
            let c = ${te.indicesGet("outputIndices",q)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${te.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${N}(dyRCorner) + ${N}(wR)) / ${N}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${N}(uniforms.Dy_shape[${z}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${N}(dyCCorner) + ${N}(wC)) / ${N}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${N}(uniforms.Dy_shape[${q}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${c?`
                var x_offset = ${Y.indicesToOffset(`${Y.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${h};
                var w_offset = ${ee.indicesToOffset(`${ee.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${m};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${c?4:h}) {
                  ${le()}
                  inputChannel = inputChannel + ${c?4:h};
                }
                ${oe()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${p}]`:""};
            ${te.setByOffset("global_idx","value")};
          `;return`
    ${I.registerUniforms(V).declareVariables(...W,te)}
      ${I.mainStart()}
      ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${U}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${h}${m}${p}${c}${f}`,inputDependencies:_},getRunData:()=>({dispatchGroup:{x:g[0],y:g[1],z:g[2]},outputs:[{dims:r?r(s):s,dataType:e[0].dataType}],programUniforms:S}),getShaderSource:A}}}),E2,P2,S2,My,oN,C2,Ty,k2,iN,_q=Ke(()=>{gq(),ml(),ca(),E2=(e,t,r,n,s,o)=>(e-1)*t+r+(n-1)*s+1-o,P2=(e,t,r,n,s)=>{let o=Math.floor(e/2);t==="SAME_UPPER"?(r[n]=o,r[s]=e-o):t==="SAME_LOWER"&&(r[n]=e-o,r[s]=o)},S2=(e,t,r,n,s,o,i,a,l,u)=>{let h=e.length-2,c=u.length===0;l.length<h&&l.push(...Array(h-l.length).fill(0));let d=e[0],f=t[a?3:1]*s;for(let p=0,m=e.length-h-(a?1:0);p<h;++p,++m){let b=e[m],g=c?b*i[p]:u[p],_=E2(b,i[p],o[p],t[m],r[p],g);P2(_,n,o,p,p+h),c&&u.push(i[p]*(b-1)+l[p]+(t[m]-1)*r[p]+1-o[p]-o[p+h])}u.splice(0,0,d),u.splice(a?3:1,0,f)},My=(e,t)=>{let r=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((c,d)=>c*d,1)===0){r.length=0;for(let c=2;c<t[1].dims.length;++c)r.push(t[1].dims[c])}let n=e.format==="NHWC";r.splice(0,0,t[1].dims[0]),r.splice(n?3:1,0,t[1].dims[1]);let s=e.pads.slice(),o=e.outputShape.slice(),i=e.outputPadding.slice(),a=t[0].dims,l=e.dilations.slice();if(l.reduce((c,d)=>c+d,0)===0){let c=t[0].dims.length-2;l=new Array(c).fill(1)}let u=e.strides.slice();if(u.reduce((c,d)=>c+d,0)===0){let c=t[0].dims.length-2;u=new Array(c).fill(1)}S2(a,r,l,e.autoPad,e.group,s,u,n,i,o);let h=Object.assign({},e);return Object.assign(h,{kernelShape:r,pads:s,outputPadding:i,outputShape:o,dilations:l,strides:u}),h},oN=e=>{let t=$b(e),r=e.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],s=e.dilations,o=e.group,i=e.kernelShape,a=e.pads,l=e.strides,u=e.wIsConst(),h=e.outputPadding,c=e.outputShape;return{autoPad:n,format:r,dilations:s,group:o,kernelShape:i,outputPadding:h,outputShape:c,pads:a,strides:l,wIsConst:u,...t,cacheKey:`${e.format};${t.activation};`}},C2=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let r=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],n=e[1].dims[0];if(r!==n)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let s=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==s))throw new Error("invalid bias");let o=e[0].dims.length-2;if(t.dilations.reduce((i,a)=>i+a,0)>0&&t.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(t.strides.reduce((i,a)=>i+a,0)>0&&t.strides.length!==o)throw new Error(`strides should be ${o}D`);if(t.pads.reduce((i,a)=>i+a,0)>0&&t.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(t.outputPadding.length!==o&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(t.kernelShape.reduce((i,a)=>i+a,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},Ty=(e,t,r,n)=>{let s=e.kernelCustomData.wT??e.compute(Ts(t[1],[2,3,0,1]),{inputs:[1],outputs:[r.wIsConst?-2:-1]})[0];r.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=s);let o=[t[0],s];t.length===3&&o.push(t[2]),e.compute(sN(o,r,n),{inputs:o})},k2=(e,t)=>{let r=t.format==="NHWC",n=[e.inputs[0].reshape(r?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&n.push(e.inputs[2]);let s=t.kernelShape;(s.length===0||s[0]===0)&&(s=[e.inputs[1].dims[2]]);let o=t.dilations;(o.length===0||o[0]===0)&&(o=[1]);let i=t.strides;(i.length===0||i[0]===0)&&(i=[1]);let a=t.pads;a.length===0&&(a=[0,0]),a=[0,a[0],0,a[1]],i=[1].concat(i),o=[1].concat(o),s=[1].concat(s);let l=t.outputPadding;l=[0].concat(l);let u=My({...t,pads:a,strides:i,dilations:o,kernelShape:s,outputPadding:l},n);Ty(e,n,u,h=>r?[h[0],h[2],h[3]]:[h[0],h[1],h[3]])},iN=(e,t)=>{if(C2(e.inputs,t),e.inputs[0].dims.length===3)k2(e,t);else{let r=My(t,e.inputs);Ty(e,e.inputs,r)}}}),$2,aN,lN,yq=Ke(()=>{kt(),Lt(),Gr(),Nt(),$2=(e,t,r,n)=>{let s=Ce.size(t),o=t.length,i=Fe("input",e,o),a=ft("output",e,o),l=r.dataType===6?r.getInt32Array()[0]:Number(r.getBigInt64Array()[0]),u=Ce.normalizeAxis(l,o),h=c=>{let d=` i32(${i.indicesGet("inputIndices","uniforms.axis")}) `,f=gt("uniforms.input_shape","uniforms.axis",o),p=n.reverse?d+(n.exclusive?" + 1":""):"0",m=n.reverse?f:d+(n.exclusive?"":" + 1");return`
                ${c.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(i,a)}
                ${c.mainStart()}
                  ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${a.offsetToIndices("global_idx")};
                  var sum = ${a.type.value}(0);
                  let first : i32 = ${p};
                  let last : i32 = ${m};
                  for (var i : i32 = first; i < last; i++) {
                    ${i.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${i.getByIndices("inputIndices")};
                  }
                  ${a.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},{type:12,data:u},...wt(t,t)]}),getShaderSource:h}},aN=(e,t)=>{let r=e.inputs[0].dims,n=e.inputs[0].dataType,s=e.inputs[1];e.compute($2(n,r,s,t),{inputs:[0]})},lN=e=>{let t=e.exclusive===1,r=e.reverse===1;return or({exclusive:t,reverse:r})}}),A2,I2,O2,uN,cN,vq=Ke(()=>{kt(),Lt(),Gr(),Nt(),A2=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},I2=(e,t,r,n)=>{let s=[];s.push(`fn perm(i: ${n.type.indices}) -> ${r.type.indices} {
    var a: ${r.type.indices};`);for(let o=0;o<t;++o)s.push(r.indicesSet("a",e[o],`i[${o}]`));return s.push("return a;}"),s.join(`
`)},O2=(e,t)=>{let r,n,s,o,i,a,l=t.format==="NHWC",u=t.blocksize,h=t.mode==="DCR";l?([r,n,s,o]=e.dims,i=h?[r,n,s,u,u,o/u**2]:[r,n,s,o/u**2,u,u],a=h?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([r,n,s,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],i=h?[r,u,u,o/u**2,n,s]:[r,o/u**2,u,u,n,s],a=h?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let c=e.reshape(i),d=c.dims.length,f=e.dataType,p=Fe("a",f,d),m=ft("output",f,d),b=g=>`
  ${g.registerUniform("output_size","u32").declareVariables(p,m)}

  ${I2(a,d,p,m)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${m.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${m.setByOffset("global_idx",p.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:g=>{let _=l?[r,n*u,s*u,o/u**2]:[r,o/u**2,n*u,s*u],y=Ce.size(_),v=c.dims,M=Ce.sortBasedOnPerm(v,a);return{outputs:[{dims:_,dataType:g[0].dataType}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:12,data:y},...wt(v,M)]}},getShaderSource:b}},uN=(e,t)=>{A2(e.inputs),e.compute(O2(e.inputs[0],t))},cN=e=>or({blocksize:e.blocksize,mode:e.mode,format:e.format})}),Ff,Dc,Ey,D2,F2,R2,L2,Py,N2,dN,hN,wq=Ke(()=>{kt(),Lt(),Gr(),Nt(),Ff="[a-zA-Z]|\\.\\.\\.",Dc="("+Ff+")+",Ey="^"+Dc+"$",D2="("+Dc+",)*"+Dc,F2="^"+D2+"$",R2=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let r=this.symbolToIndices.get(e);r===void 0?r=[t]:r.push(t),this.symbolToIndices.set(e,r)}},L2=class{constructor(e,t){var s;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[r,n]=t.includes("->")?t.split("->",2):[t,""];if(!r.match(RegExp(F2)))throw new Error("Invalid LHS term");if(r.split(",").forEach((o,i)=>{let a=e[i].dims.slice();if(!o.match(RegExp(Ey)))throw new Error("Invalid LHS term");let l=this.processTerm(o,!0,a,i);this.lhs.push(l)}),n==="")n+=[...this.symbolToInfo.entries()].filter(([o,i])=>i.count===1||o==="...").map(([o])=>o).join("");else if(!n.match(RegExp(Dc)))throw new Error("Invalid RHS");(s=n.match(RegExp(Ff,"g")))==null||s.forEach(o=>{if(o==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let i=this.symbolToInfo.get(o);if(i===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(i.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(e,t,r){let n=this.symbolToInfo.get(e);if(n!==void 0){if(n.dimValue!==t&&n.count!==1)throw new Error("Dimension mismatch");n.count++,n.inputIndices.push(r)}else n={count:1,dimValue:t,inputIndices:[r]};this.symbolToInfo.set(e,n)}processTerm(e,t,r,n=-1){let s=r.length,o=!1,i=[],a=0;if(!e.match(RegExp(Ey))&&!t&&e!=="")throw new Error("Invalid LHS term");let l=e.match(RegExp(Ff,"g")),u=new R2(n);return l==null||l.forEach((h,c)=>{if(h==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let d=s-l.length+1;if(d<0)throw new Error("Ellipsis out of bounds");if(i=r.slice(a,a+d),this.hasEllipsis){if(this.ellipsisDims.length!==i.length||this.ellipsisDims.toString()!==i.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=i;else throw new Error("Ellipsis must be specified in the LHS");for(let f=0;f<i.length;f++){let p=String.fromCharCode(48+f);u.addSymbol(p,c+f),this.addSymbol(p,r[a++],n)}}else u.addSymbol(h,c+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(h,r[a++],n)}),u}},Py=e=>e+"_max",N2=(e,t,r,n)=>{let s=e.map(u=>u.length).map((u,h)=>Fe(`input${h}`,t,u)),o=Ce.size(n),i=ft("output",t,n.length),a=[...r.symbolToInfo.keys()].filter(u=>!r.rhs.symbolToIndices.has(u)),l=u=>{let h=[],c="var prod = 1.0;",d="var sum = 0.0;",f="sum += prod;",p=[],m=[],b=[],g=[],_=r.symbolToInfo.size===r.rhs.symbolToIndices.size;r.symbolToInfo.forEach((v,M)=>{var E;if(r.rhs.symbolToIndices.has(M)){let T=(E=r.rhs.symbolToIndices.get(M))==null?void 0:E[0];T!==void 0&&r.lhs.forEach((S,A)=>{if(v.inputIndices.includes(A)){let I=S.symbolToIndices.get(M);if(I===void 0)throw new Error("Invalid symbol error");I.forEach(V=>{h.push(`${s[A].indicesSet(`input${A}Indices`,V,i.indicesGet("outputIndices",T))}`)})}})}else r.lhs.forEach((T,S)=>{if(v.inputIndices.includes(S)){let A=T.symbolToIndices.get(M);if(A===void 0)throw new Error("Invalid symbol error");A.forEach(I=>{p.push(`${s[S].indicesSet(`input${S}Indices`,I,`${M}`)}`)}),g.push(`prod *= ${s[S].getByIndices(`input${S}Indices`)};`)}}),m.push(`for(var ${M}: u32 = 0; ${M} < uniforms.${Py(M)}; ${M}++) {`),b.push("}")});let y=_?[...h,`let sum = ${s.map((v,M)=>v.getByIndices(`input${M}Indices`)).join(" * ")};`]:[...h,d,...m,...p,c,...g,f,...b];return`
            ${u.registerUniforms(a.map(v=>({name:`${Py(v)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...s,i)}

            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${i.offsetToIndices("global_idx")};
            ${s.map((v,M)=>`var input${M}Indices: ${s[M].type.indices};`).join(`
`)}
            ${y.join(`
`)};
            ${i.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:r.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let u=a.filter(c=>r.symbolToInfo.has(c)).map(c=>{var d;return{type:12,data:((d=r.symbolToInfo.get(c))==null?void 0:d.dimValue)||0}});u.push({type:12,data:o});let h=e.map((c,d)=>[...wt(c)]).reduce((c,d)=>c.concat(d),u);return h.push(...wt(n)),{outputs:[{dims:n,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}},getShaderSource:l}},dN=(e,t)=>{let r=new L2(e.inputs,t.equation),n=r.outputDims,s=e.inputs.map((o,i)=>o.dims);e.compute(N2(s,e.inputs[0].dataType,r,n))},hN=e=>{let t=e.equation.replace(/\s+/g,"");return or({equation:t})}}),j2,Sy,z2,B2,fN,bq=Ke(()=>{kt(),Lt(),Nt(),j2=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=r.length<t.length?0:r.length-t.length,s=t.length<r.length?0:t.length-r.length;for(;n<r.length&&s<t.length;++n,++s)if(r[n]!==t[s]&&r[n]!==1&&t[s]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Sy=(e,t)=>{let r=e.length-t.length,n=[];for(let s=0;s<r;++s)n.push(e[s]);for(let s=0;s<t.length;++s)n.push(t[s]===1?e[s+r]:t[s]);return n},z2=(e,t)=>e.length>t.length?Sy(e,t):Sy(t,e),B2=e=>{let t=e[0].dims,r=Array.from(e[1].getBigInt64Array(),Number),n=z2(t,r),s=e[0].dataType,o=s===9||Ce.size(t)===1,i=s===9||t.length>0&&t[t.length-1]%4===0?4:1,a=o||n.length>0&&n[n.length-1]%4===0?4:1,l=Math.ceil(Ce.size(n)/a),u=c=>{let d=Fe("input",s,t.length,i),f=ft("output",s,n.length,a),p;if(s===9){let m=(b,g,_="")=>`
          let outputIndices${g} = ${f.offsetToIndices(`outputOffset + ${g}u`)};
          let offset${g} = ${d.broadcastedIndicesToOffset(`outputIndices${g}`,f)};
          let index${g} = offset${g} / 4u;
          let component${g} = offset${g} % 4u;
          ${b}[${g}] = ${_}(${d.getByOffset(`index${g}`)}[component${g}]);
        `;p=`
        let outputOffset = global_idx * ${a};
        var data = vec4<u32>(0);
        ${m("data",0,"u32")}
        ${m("data",1,"u32")}
        ${m("data",2,"u32")}
        ${m("data",3,"u32")}
        ${f.setByOffset("global_idx","data")}
      }`}else p=`
        let outputIndices = ${f.offsetToIndices(`global_idx * ${a}`)};
        let inputOffset = ${d.broadcastedIndicesToOffset("outputIndices",f)};
        let data = ${f.type.value}(${d.getByOffset(`inputOffset / ${i}`)});
        ${f.setByOffset("global_idx","data")}
      }`;return`
    ${c.registerUniform("vec_size","u32").declareVariables(d,f)}
    ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${p}`},h=[{type:12,data:l},...wt(t,n)];return{name:"Expand",shaderCache:{hint:`${n.length};${i}${a}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h})}},fN=e=>{j2(e.inputs),e.compute(B2(e.inputs),{inputs:[0]})}}),U2,pN,xq=Ke(()=>{kt(),Lt(),Nt(),kb(),U2=e=>{let t=e[0].dataType,r=Ce.size(e[0].dims),n=Ce.size(e[1].dims),s=n%4===0,o=i=>{let a=Fe("x",t,[1],4),l=Fe("bias",t,[1],4),u=ft("y",t,[1],4),h=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],c=f=>`
      let bias${f}_offset: u32 = (global_idx * 4 + ${f}) % uniforms.bias_size;
      let bias${f} = ${l.getByOffset(`bias${f}_offset / 4`)}[bias${f}_offset % 4];`,d=s?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${c(0)}${c(1)}${c(2)}${c(3)}
      let bias = ${a.type.value}(bias0, bias1, bias2, bias3);`;return`${i.registerUniforms(h).declareVariables(a,l,u)}

    ${Ow(zn(t))}

    ${i.mainStart(Lu)}
      ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${a.getByOffset("global_idx")};
      ${d}
      let x_in = x + bias;
      ${u.setByOffset("global_idx",Dw("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${s}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:i=>({outputs:[{dims:i[0].dims,dataType:i[0].dataType}],programUniforms:[{type:12,data:Math.ceil(r/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(r/Lu/4)}})}},pN=e=>{e.inputs.length<2||Ce.size(e.inputs[1].dims)===0?D3(e):e.compute(U2(e.inputs))}}),V2,W2,mN,gN,Mq=Ke(()=>{kt(),Lt(),Gr(),Nt(),V2=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},W2=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r.length,o=Ce.normalizeAxis(t.axis,s),i=r.slice(0);i.splice(o,1,...n);let a=r[o],l=e[0].dataType===9?4:1,u=Math.ceil(Ce.size(i)/l),h=[{type:12,data:u},{type:6,data:a},{type:12,data:o},...wt(e[0].dims,e[1].dims,i)],c=d=>{let f=Fe("data",e[0].dataType,e[0].dims.length,l),p=Fe("inputIndices",e[1].dataType,e[1].dims.length),m=ft("output",e[0].dataType,i.length,l),b=_=>{let y=n.length,v=`var indicesIndices${_}  = ${p.type.indices}(0);`;for(let M=0;M<y;M++)v+=`${y>1?`indicesIndices${_}[${M}]`:`indicesIndices${_}`} = ${i.length>1?`outputIndices${_}[uniforms.axis + ${M}]`:`outputIndices${_}`};`;v+=`
          var idx${_} = ${p.getByIndices(`indicesIndices${_}`)};
          if (idx${_} < 0) {
            idx${_} = idx${_} + uniforms.axisDimLimit;
          }
          var dataIndices${_} : ${f.type.indices};
        `;for(let M=0,E=0;M<s;M++)M===o?(v+=`${s>1?`dataIndices${_}[${M}]`:`dataIndices${_}`} = u32(idx${_});`,E+=y):(v+=`${s>1?`dataIndices${_}[${M}]`:`dataIndices${_}`} = ${i.length>1?`outputIndices${_}[${E}]`:`outputIndices${_}`};`,E++);return v},g;if(e[0].dataType===9){let _=(y,v,M="")=>`
          let outputIndices${v} = ${m.offsetToIndices(`outputOffset + ${v}u`)};
          ${b(v)};
          let offset${v} = ${f.indicesToOffset(`dataIndices${v}`)};
          let index${v} = offset${v} / 4u;
          let component${v} = offset${v} % 4u;
          ${y}[${v}] = ${M}(${f.getByOffset(`index${v}`)}[component${v}]);
        `;g=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${_("value",0,"u32")}
        ${_("value",1,"u32")}
        ${_("value",2,"u32")}
        ${_("value",3,"u32")}
        ${m.setByOffset("global_idx","value")}
      `}else g=`
      let outputIndices = ${m.offsetToIndices("global_idx")};
      ${b("")};
      let value = ${f.getByIndices("dataIndices")};
      ${m.setByOffset("global_idx","value")};
      `;return`
      ${d.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(f,p,m)}
      ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${g}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:c}},mN=e=>or({axis:e.axis}),gN=(e,t)=>{let r=e.inputs;V2(r),e.compute(W2(e.inputs,t))}}),G2,_N,yN,Tq=Ke(()=>{kt(),Lt(),Nt(),G2=(e,t,r,n,s,o,i,a,l)=>{let u=[{type:12,data:o},{type:12,data:n},{type:12,data:s},{type:12,data:r},{type:12,data:i},{type:12,data:a},{type:12,data:l}],h=[o];u.push(...wt(t.dims,h));let c=d=>{let f=Fe("indices_data",t.dataType,t.dims.length),p=ft("input_slice_offsets_data",12,1,1),m=[f,p],b=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:s.length},{name:"sizes_from_slice_dims_data",type:"u32",length:r.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${d.registerUniforms(b).declareVariables(...m)}
  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${s.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${r.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${s.length}_${r.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:h,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:u}),getShaderSource:c},{inputs:[t],outputs:[-1]})[0]},_N=(e,t)=>{let r=e.inputs,n=r[0].dims,s=r[0].dataType,o=r[1].dims,i=o[o.length-1],a=Ce.sizeToDimension(o,o.length-1),l=Ce.sizeFromDimension(n,t.batchDims+i),u=Ce.sizeToDimension(n,t.batchDims),h=Ce.sizeFromDimension(n,t.batchDims),c=a/u,d=new Array(i),f=l;for(let v=0;v<i;++v)d[i-1-v]=f,f*=n[t.batchDims+i-1-v];let p=G2(e,r[1],d,t.batchDims,n,a,c,h,i),m=t.batchDims+i;if(m>n.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let b=o.slice(0,-1).concat(n.slice(m)),g=Ce.size(b),_=[{type:12,data:g},{type:12,data:l},...wt(r[0].dims,p.dims,b)],y=v=>{let M=Fe("data",r[0].dataType,r[0].dims.length),E=Fe("slice_offsets",12,p.dims.length),T=ft("output",r[0].dataType,b.length);return`
          ${v.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(M,E,T)}
            ${v.mainStart()}
            ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:b,dataType:s}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:_}),getShaderSource:y},{inputs:[r[0],p]})},yN=e=>({batchDims:e.batch_dims,cacheKey:""})}),H2,K2,vN,wN,Eq=Ke(()=>{kt(),Lt(),Gr(),Nt(),H2=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let r=Ce.normalizeAxis(t.quantizeAxis,e[0].dims.length),n=t.blockSize,s=e[0],o=e[2],i=e.length===4?e[3]:void 0;if(o.dims.length!==s.dims.length||!s.dims.map((a,l)=>l===r?Math.ceil(a/n)===o.dims[l]:a===o.dims[l]).reduce((a,l)=>a&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(i){if(i.dataType!==s.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(i.dims.length!==o.dims.length||!i.dims.map((a,l)=>a===o.dims[l]).reduce((a,l)=>a&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},K2=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r.length,o=Ce.normalizeAxis(t.gatherAxis,s),i=Ce.normalizeAxis(t.quantizeAxis,s),a=r.slice(0);a.splice(o,1,...n);let l=Ce.size(a),u=e[2].dataType,h=e[0].dataType===22,c=[{type:12,data:l},{type:12,data:i},{type:12,data:o},{type:12,data:t.blockSize},...wt(...e.map((f,p)=>f.dims),a)],d=f=>{let p=Fe("data",e[0].dataType,e[0].dims.length),m=Fe("inputIndices",e[1].dataType,e[1].dims.length),b=Fe("scales",e[2].dataType,e[2].dims.length),g=e.length>3?Fe("zeroPoint",e[3].dataType,e[3].dims.length):void 0,_=ft("output",u,a.length),y=[p,m,b];g&&y.push(g);let v=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${f.registerUniforms(v).declareVariables(...y,_)}
        ${f.mainStart()}
        let output_indices = ${_.offsetToIndices("global_idx")};
        var indices_indices = ${m.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${_.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${m.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${_.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${p.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${_.indicesGet("output_indices","i")};
          ${p.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${m.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${r[o]};
        }
        ${p.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${a.length}; i++) {
          let index = ${_.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${p.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${p.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${p.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${h?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${b.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${b.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${b.getByIndices("scale_indices")};
        ${g?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${g.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${g.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${h?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${zn(u)}(quantized_data - zero_point) * scale;
        ${_.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((f,p)=>p!==1).map(f=>f.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(f,p)=>"rank")},getRunData:()=>({outputs:[{dims:a,dataType:u}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c}),getShaderSource:d}},vN=(e,t)=>{let r=e.inputs;H2(r,t),e.compute(K2(e.inputs,t))},wN=e=>or({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),q2,Q2,bN,xN,Pq=Ke(()=>{kt(),Lt(),Gr(),Nt(),q2=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},Q2=(e,t)=>{let r=e[0].dims,n=e[0].dataType,s=r.length,o=e[1].dims,i=e[1].dataType,a=Ce.normalizeAxis(t.axis,s),l=r[a],u=o.slice(0),h=Ce.size(u),c=Fe("input",n,s),d=Fe("indicesInput",i,o.length),f=ft("output",n,u.length),p=[{type:12,data:h},{type:6,data:l},{type:12,data:a}];return p.push(...wt(r,o,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:p}),getShaderSource:m=>`
      ${m.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(c,d,f)}
      ${m.mainStart()}
      ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${f.offsetToIndices("global_idx")};

      var idx = ${d.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${c.type.indices}(outputIndices);
      ${c.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${c.getByIndices("inputIndices")};

      ${f.setByOffset("global_idx","value")};
  }`}},bN=e=>or({axis:e.axis}),xN=(e,t)=>{let r=e.inputs;q2(r),e.compute(Q2(e.inputs,t))}}),X2,J2,MN,TN,Sq=Ke(()=>{kt(),Lt(),Nt(),X2=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},J2=(e,t)=>{let r=e[0].dims.slice(),n=e[1].dims.slice(),[s,o,i]=bL.getShapeOfGemmResult(r,t.transA,n,t.transB,e.length===3?e[2].dims:void 0),a=[s,o];if(!a)throw new Error("Can't use gemm on the given tensors");let l=16,u=Math.ceil(o/l),h=Math.ceil(s/l),c=!0,d=Ce.size(a),f=[{type:12,data:c?u:d},{type:12,data:s},{type:12,data:o},{type:12,data:i},{type:1,data:t.alpha},{type:1,data:t.beta}],p=["type","type"];e.length===3&&(f.push(...wt(e[2].dims)),p.push("rank")),f.push(...wt(a));let m=g=>{let _="";t.transA&&t.transB?_="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?_="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?_="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(_="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let y=t.alpha===1?"":"value *= uniforms.alpha;",v=Fe("a",e[0].dataType,e[0].dims),M=Fe("b",e[1].dataType,e[1].dims),E=v.type.value,T=null,S=[v,M];e.length===3&&(T=Fe("c",e[2].dataType,e[2].dims.length),S.push(T));let A=ft("output",e[0].dataType,a.length);S.push(A);let I=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${g.registerUniforms(I).declareVariables(...S)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${E}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${_}
    }

    ${y}
    ${T!=null?`let cOffset = ${T.broadcastedIndicesToOffset("vec2(m, n)",A)}; value += ${E}(uniforms.beta) * ${T.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},b=g=>{let _=Fe("a",e[0].dataType,e[0].dims),y=Fe("b",e[1].dataType,e[1].dims),v=null,M=[_,y];e.length===3&&(v=Fe("c",e[2].dataType,e[2].dims.length),M.push(v));let E=ft("output",e[0].dataType,a.length);M.push(E);let T=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],S="",A="";t.transA&&t.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${y.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${y.type.value}(0);
      }
      `,S="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${y.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${_.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${y.type.value}(0);
      }
      `,S="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let I=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${g.registerUniforms(T).declareVariables(...M)}
  var<workgroup> tile_a: array<array<${_.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${y.type.storage}, ${l}>, ${l}>;
  ${g.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${E.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${A}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${S}
      }
      workgroupBarrier();
    }

    ${I}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${v!=null?`let cOffset = ${v.broadcastedIndicesToOffset("vec2(m, n)",E)}; value += ${E.type.value}(uniforms.beta) * ${v.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return c?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:u*h},programUniforms:f}),getShaderSource:b}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:f}),getShaderSource:m}},MN=e=>{let t=e.transA,r=e.transB,n=e.alpha,s=e.beta;return{transA:t,transB:r,alpha:n,beta:s,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},TN=(e,t)=>{X2(e.inputs),e.compute(J2(e.inputs,t))}}),Do,Yo,$a,Aa,Y2,Z2,e$,t$,r$,n$,s$,o$,EN,PN,Cq=Ke(()=>{kt(),Lt(),Gr(),Nt(),[Do,Yo,$a,Aa]=[0,1,2,3],Y2=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},Z2=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,e$=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,t$=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,r$=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,n$=(e,t,r)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${Do}] = batch;
     indices[${Yo}] = channel;`+(()=>{switch(r.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${$a}] = u32(r);
            indices[${Aa}] = u32(c);
          } else {
            return ${t}(0);
          }
        `;case"border":return`
          indices[${$a}] = u32(clamp(r, 0, H - 1));
          indices[${Aa}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${$a}] = gs_reflect(r, border[1], border[3]);
          indices[${Aa}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${r.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,s$=(e,t,r)=>(()=>{switch(r.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Do}], indices[${Yo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Do}], indices[${Yo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Do}], indices[${Yo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Do}], indices[${Yo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Do}], indices[${Yo}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Do}], indices[${Yo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${r.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,o$=(e,t)=>{let r=Fe("x",e[0].dataType,e[0].dims.length),n=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],s=Fe("grid",e[1].dataType,n.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Do,Yo,$a,Aa]=[0,3,1,2]);let i=ft("output",e[0].dataType,o.length),a=r.type.value,l=Ce.size(o),u=[{type:12,data:l},...wt(e[0].dims,n,o)],h=c=>`
  ${c.registerUniform("output_size","u32").declareVariables(r,s,i)}
  ${Z2}
  ${e$(a)}
  ${t$(t)}
  ${r$(t)}
  ${n$(r,a,t)}

  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${$a}]);
      let W_in = i32(uniforms.x_shape[${Aa}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${i.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Do}], indices[${$a}], indices[${Aa}]);
      let nxy = ${s.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${s$(i,a,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:c=>{let d=Ce.size(o);return{outputs:[{dims:o,dataType:c[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:u}},getShaderSource:h}},EN=(e,t)=>{Y2(e.inputs),e.compute(o$(e.inputs,t))},PN=e=>or({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),Hn,i$,SN,Cy,a$,Kc,CN,kN=Ke(()=>{kt(),Lt(),Gr(),Eb(),Cb(),Nt(),ca(),Hn=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,i$=(e,t)=>{let r=e[0],n=Hn(e,1),s=Hn(e,2),o=Hn(e,3),i=Hn(e,4),a=Hn(e,5),l=Hn(e,6),u=Hn(e,7);if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let h=r.dims[0],c=r.dims[1],d=r.dims.length===3?r.dims[2]:t.numHeads*r.dims[4],f=c,p=0,m=0,b=Math.floor(d/t.numHeads);if(l&&u&&Ce.size(l.dims)&&Ce.size(u.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==h||l.dims[1]!==t.numHeads||l.dims[3]!==b)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==h||u.dims[1]!==t.numHeads||u.dims[3]!==b)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');p=l.dims[2],m=l.dims[2]}else if(l&&Ce.size(l.dims)||u&&Ce.size(u.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g;if(n&&Ce.size(n.dims)>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(n.dims[2]!==r.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');g=2,f=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==b)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');g=5,f=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==b)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');g=0,f=n.dims[2]}}else{if(r.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(r.dims[2]!==t.numHeads||r.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}if(o&&Ce.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(n&&n.dims.length===5&&n.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let _=p+f,y=0;if(i&&Ce.size(i.dims)>0){y=8;let T=i.dims;throw T.length===1?T[0]===h?y=1:T[0]===3*h+2&&(y=3):T.length===2&&T[0]===h&&T[1]===_&&(y=5),y===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let v=!1,M=d;if(s&&Ce.size(s.dims)>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(f!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');M=s.dims[2]}else{if(f!==s.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');M=s.dims[1]*s.dims[3],v=!0}}let E=!1;if(i&&Ce.size(i.dims)>0)throw new Error("Key padding mask is not supported");if(a&&Ce.size(a.dims)>0){if(a.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(a.dims[0]!==h||a.dims[1]!==t.numHeads||a.dims[2]!==c||a.dims[3]!==_)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:h,sequenceLength:c,pastSequenceLength:p,kvSequenceLength:f,totalSequenceLength:_,maxSequenceLength:m,inputHiddenSize:0,hiddenSize:d,vHiddenSize:M,headSize:b,vHeadSize:Math.floor(M/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:y,scale:t.scale,broadcastResPosBias:E,passPastInKv:v,qkvFormat:g}},SN=e=>or({...e}),Cy=or({perm:[0,2,1,3]}),a$=(e,t,r,n,s,o,i)=>{let a=[n,s,o],l=Ce.size(a),u=[{type:12,data:l},{type:12,data:i},{type:12,data:o}],h=c=>{let d=ft("qkv_with_bias",t.dataType,a),f=Fe("qkv",t.dataType,a),p=Fe("bias",r.dataType,a),m=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${c.registerUniforms(m).declareVariables(f,p,d)}
  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:a,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:h},{inputs:[t,r],outputs:[-1]})[0]},Kc=(e,t,r,n,s,o,i,a)=>{let l=o;if(i&&Ce.size(i.dims)>0){if(n===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=a$(e,o,i,t,n,r*s,a),l=l.reshape([t,n,r,s]),r===1||n===1?l:e.compute(Ts(l,Cy.perm),{inputs:[l],outputs:[-1]})[0]}else return o.dims.length===3&&(l=o.reshape([t,n,r,s])),r===1||n===1?l:e.compute(Ts(l,Cy.perm),{inputs:[l],outputs:[-1]})[0]},CN=(e,t)=>{let r=i$(e.inputs,t),n=e.inputs[0],s=Hn(e.inputs,1),o=Hn(e.inputs,2),i=Hn(e.inputs,3),a=Hn(e.inputs,4),l=Hn(e.inputs,5),u=Hn(e.inputs,6),h=Hn(e.inputs,7);if(n.dims.length===5)throw new Error("Packed QKV is not implemented");if((s==null?void 0:s.dims.length)===5)throw new Error("Packed KV is not implemented");let c=s&&o&&s.dims.length===4&&o.dims.length===4,d=Kc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,n,i,0);if(c)return Fd(e,d,s,o,a,void 0,u,h,l,r);if(!s||!o)throw new Error("key and value must be provided");let f=Kc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.headSize,s,i,r.hiddenSize),p=Kc(e,r.batchSize,r.numHeads,r.kvSequenceLength,r.vHeadSize,o,i,2*r.hiddenSize);Fd(e,d,f,p,a,void 0,u,h,l,r)}}),l$,u$,c$,d$,jw,$N,AN,IN=Ke(()=>{kt(),Lt(),Gr(),Nt(),l$=e=>{if(!e||e.length<1)throw new Error("too few inputs")},u$=(e,t)=>{let r=[],n=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(s=>r.push(Number(s))),n=r.length),or({numOutputs:n,axis:t.axis,splitSizes:r})},c$=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${gt("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,d$=e=>{let t=e.length,r=[];for(let n=0;n<t;++n){let s=e[n].setByIndices("indices","input[global_idx]");t===1?r.push(s):n===0?r.push(`if (output_number == ${n}u) { ${s} }`):n===t-1?r.push(`else { ${s} }`):r.push(`else if (output_number == ${n}) { ${s} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${r.join(`
`)}
      }`},jw=(e,t)=>{let r=e[0].dims,n=Ce.size(r),s=e[0].dataType,o=Ce.normalizeAxis(t.axis,r.length),i=new Array(t.numOutputs),a=Fe("input",s,r.length),l=new Array(t.numOutputs),u=[],h=[],c=0,d=[{type:12,data:n}];for(let p=0;p<t.numOutputs;p++){c+=t.splitSizes[p],l[p]=c;let m=r.slice();m[o]=t.splitSizes[p],h.push(m),i[p]=ft(`output${p}`,s,m.length),u.push({dims:h[p],dataType:e[0].dataType})}d.push({type:12,data:l},...wt(r,...h));let f=p=>`
  ${p.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(a,...i)}
  ${c$(l.length)}
  ${d$(i)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${a.offsetToIndices("global_idx")};
    var index = ${a.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${gt("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${a.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:d})}},$N=(e,t)=>{l$(e.inputs);let r=e.inputs.length===1?t:u$(e.inputs,t);e.compute(jw(e.inputs,r),{inputs:[0]})},AN=e=>{let t=e.axis,r=e.splitSizes,n=e.numOutputs<0?r.length:e.numOutputs;if(n!==r.length)throw new Error("numOutputs and splitSizes lengh must be equal");return or({axis:t,numOutputs:n,splitSizes:r})}}),h$,Jp,ON,DN=Ke(()=>{kt(),Lt(),Gr(),Nt(),h$=(e,t)=>{let[r,n,s,o]=e,{numHeads:i,rotaryEmbeddingDim:a}=t;if(r.dims.length!==3&&r.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${r.dims.length}`);if(!Ce.areEqual(n.dims,[])&&!Ce.areEqual(n.dims,[1])&&n.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!Ce.areEqual(s.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(a>0&&i===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=r.dims[0],u=r.dims[r.dims.length-2],h=s.dims[0],c=Ce.sizeFromDimension(r.dims,1)/u,d=a===0?s.dims[1]*2:c/i;if(a>d)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(n.dims.length===2){if(l!==n.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(u!==n.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(d/2!==s.dims[1]&&a/2!==s.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${s.dims[1]}`);if(u>h)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Jp=(e,t)=>{let{interleaved:r,numHeads:n,rotaryEmbeddingDim:s,scale:o}=t,i=e[0].dims[0],a=Ce.sizeFromDimension(e[0].dims,1),l=e[0].dims[e[0].dims.length-2],u=a/l,h=e[2].dims[1],c=s===0?h*2:u/n,d=new Array(i,l,u/c,c-h),f=Ce.computeStrides(d),p=[{type:1,data:o},{type:12,data:d},{type:12,data:f},...e[0].dims.length===3?new Array({type:12,data:[a,u,c,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[a,c,l*c,1]}):[],...wt(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],m=b=>{let g=Fe("input",e[0].dataType,e[0].dims.length),_=Fe("position_ids",e[1].dataType,e[1].dims.length),y=Fe("cos_cache",e[2].dataType,e[2].dims.length),v=Fe("sin_cache",e[3].dataType,e[3].dims.length),M=ft("output",e[0].dataType,e[0].dims.length);return b.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:d.length},{name:"global_strides",type:"u32",length:f.length},{name:"input_output_strides",type:"u32",length:f.length}]),`
        ${b.declareVariables(g,_,y,v,M)}

        ${b.mainStart(Lu)}
          let half_rotary_emb_dim = uniforms.${y.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${b.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${_.broadcastedIndicesToOffset("bsnh.xy",ft("",_.type.tensor,2))};
            let position_id =
                u32(${_.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${r});
            let j = i + select(half_rotary_emb_dim, 1, ${r});
            let re = ${g.getByOffset("i")} * ${y.get("position_id","bsnh[3]")} -
                ${g.getByOffset("j")} * ${v.get("position_id","bsnh[3]")};
            ${M.setByOffset("i","re")}
            let im = ${g.getByOffset("i")} * ${v.get("position_id","bsnh[3]")} +
                ${g.getByOffset("j")} * ${y.get("position_id","bsnh[3]")};
            ${M.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${M.setByOffset("k",g.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:or({interleaved:r}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:m,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ce.size(d)/Lu)},programUniforms:p})}},ON=(e,t)=>{h$(e.inputs,t),e.compute(Jp(e.inputs,t))}}),f$,p$,ky,m$,FN,kq=Ke(()=>{Gr(),kt(),Cb(),kN(),IN(),ca(),DN(),Nt(),f$=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let r=e[0],n=e[1],s=e[2],o=e[3],i=e[4];if(t.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(r.dims.length!==3&&r.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let a=!1,l=r.dims[0],u=r.dims[1],h=r.dims.length===3?a?r.dims[2]/3:r.dims[2]:t.numHeads*r.dims[4],c=u,d=0,f=!n||n.dims.length===0,p=Math.floor(f?h/(t.numHeads+2*t.kvNumHeads):h/t.numHeads);f&&(h=p*t.numHeads);let m=o&&o.dims.length!==0,b=i&&i.dims.length!==0;if(m&&o.dims.length===4&&o.dims[0]===l&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===p)throw new Error("BSNH pastKey/pastValue is not supported");if(m&&b){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(i.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');d=o.dims[2]}else if(m||b)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let g=1;if(n&&n.dims.length>0){if(r.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(r.dims[0]!==n.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(n.dims.length===3){if(r.dims[2]%n.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');c=n.dims[1]}else if(n.dims.length===5){if(n.dims[2]!==t.numHeads||n.dims[3]!==2||n.dims[4]!==p)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');c=n.dims[1]}else{if(n.dims[1]!==t.numHeads||n.dims[3]!==p)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');c=n.dims[2]}}else{if(r.dims.length!==3&&r.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(r.dims.length===5&&(r.dims[2]!==t.numHeads||r.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');g=3}let _=0,y=!1,v=t.kvNumHeads?p*t.kvNumHeads:h;if(s&&s.dims.length>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(r.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(c!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');v=s.dims[2]}else{if(c!==s.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');v=s.dims[1]*s.dims[3],y=!0}}let M=e.length>4?e[5]:void 0;if(M&&M.dims.length!==1&&M.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:d,kvSequenceLength:c,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:h,vHiddenSize:v,headSize:p,vHeadSize:Math.floor(v/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:_,scale:t.scale,broadcastResPosBias:!1,passPastInKv:y,qkvFormat:g}},p$=or({perm:[0,2,1,3]}),ky=(e,t,r)=>{let n=t,s=r.kvNumHeads;return t.dims.length===3&&r.kvSequenceLength!==0&&(n=t.reshape([r.batchSize,r.kvSequenceLength,s,r.headSize]),n=e.compute(Ts(n,p$.perm),{inputs:[n],outputs:[-1]})[0]),n},m$=(e,t,r,n)=>{let s=7,o=["type","type"],i=[e*t],a=e*t,l=[{type:12,data:a},{type:12,data:t},{type:12,data:e}],u=h=>{let c=Fe("seq_lens",r.dataType,r.dims),d=Fe("total_seq_lens",n.dataType,n.dims),f=ft("pos_ids",s,i),p=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${h.registerUniforms(p).declareVariables(c,d,f)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${d.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${c.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${f.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${f.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${f.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${t}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:i,dataType:s}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:l}),getShaderSource:u}},FN=(e,t)=>{var v;let r=f$(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((v=e.inputs[1])==null?void 0:v.dims.length)===5)throw new Error("Packed KV is not implemented");let n=e.inputs[0],s=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,o=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,i=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,a=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,l=e.inputs.length>4?e.inputs[5]:void 0,u=e.inputs.length>5?e.inputs[6]:void 0,h=r.kvNumHeads?r.kvNumHeads:r.numHeads,c=or({axis:2,numOutputs:3,splitSizes:[r.numHeads*r.headSize,h*r.headSize,h*r.headSize]}),[d,f,p]=!s&&!o?e.compute(jw([n],c),{inputs:[n],outputs:[-1,-1,-1]}):[n,s,o],m,b;if(t.doRotary){let M=e.compute(m$(r.batchSize,r.sequenceLength,l,u),{inputs:[l,u],outputs:[-1]})[0],E=e.inputs[7],T=e.inputs[8],S=or({interleaved:t.rotaryInterleaved!==0,numHeads:r.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),A=[d,M,E,T],I=[-1];m=e.compute(Jp(A,S),{inputs:A,outputs:I})[0],A.splice(0,1,f);let V=or({interleaved:t.rotaryInterleaved!==0,numHeads:r.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});b=e.compute(Jp(A,V),{inputs:A,outputs:I})[0]}let g=Kc(e,r.batchSize,r.numHeads,r.sequenceLength,r.headSize,t.doRotary?m:d,void 0,0),_=ky(e,t.doRotary?b:f,r),y=ky(e,p,r);Fd(e,g,_,y,void 0,void 0,i,a,void 0,r,l,u)}}),$y,g$,_$,RN,$q=Ke(()=>{kt(),Lt(),ca(),Nt(),$y=(e,t,r,n,s,o,i,a)=>{let l=Fr(o),u=l===1?"f32":`vec${l}f`,h=l===1?"vec2f":`mat2x${l}f`,c=s*i,d=64;c===1&&(d=256);let f=[s,i,o/l],p=[s,i,2],m=["rank","type","type"],b=[];b.push(...wt(f,p));let g=_=>{let y=Fe("x",t.dataType,3,l),v=Fe("scale",r.dataType,r.dims),M=Fe("bias",n.dataType,n.dims),E=ft("output",1,3,2),T=[y,v,M,E];return`
  var<workgroup> workgroup_shared : array<${h}, ${d}>;
  const workgroup_size = ${d}u;
  ${_.declareVariables(...T)}
  ${_.mainStart(d)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${u}(0);
    var squared_sum = ${u}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${u}(${y.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${h}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${sa("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${sa("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${a}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${a};${d}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:p,dataType:1}],dispatchGroup:{x:c},programUniforms:b}),getShaderSource:g},{inputs:[t,r,n],outputs:[-1]})[0]},g$=(e,t,r)=>{let n=t[0].dims,s=n,o=2,i=n[0],a=n[1],l=Ce.sizeFromDimension(n,o),u=Fr(l),h=Ce.size(s)/u,c=$y(e,t[0],t[1],t[2],i,l,a,r.epsilon),d=[i,a,l/u],f=[i,a],p=["type","none"],m=b=>{let g=Fe("x",t[0].dataType,d.length,u),_=Fe("scale_shift",1,f.length,2),y=ft("output",t[0].dataType,d.length,u),v=[g,_,y];return`
  ${b.registerUniform("output_size","u32").declareVariables(...v)}
  ${b.mainStart()}
  ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${y.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${_.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${g.getByOffset("global_idx")} * ${y.type.value}(scale_shift.x) + ${y.type.value}(scale_shift.y);
      ${y.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${u}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},...wt(d,f,d)]}),getShaderSource:m},{inputs:[t[0],c]})},_$=(e,t,r)=>{let n=t[0].dims,s=n,o=n[0],i=n[n.length-1],a=Ce.sizeFromDimension(n,1)/i,l=Fr(i),u=Ce.size(s)/l,h=[{type:12,data:a},{type:12,data:Math.floor(i/l)}],c=["type","type"],d=!1,f=[0,n.length-1];for(let g=0;g<n.length-2;g++)d=d||n[g+1]!==1,f.push(g+1);d=d&&n[n.length-1]!==1;let p=d?e.compute(Ts(e.inputs[0],f),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:n.length},(g,_)=>n[f[_]])),m=$y(e,p,t[1],t[2],o,a,i,r.epsilon),b=g=>{let _=vn(t[0].dataType),y=l===1?"vec2f":`mat${l}x2f`,v=T=>{let S=T===0?"x":"y",A=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${_}(${A}(scale.${S}))`;case 2:return`vec2<${_}>(${A}(scale[0].${S}, scale[1].${S}))`;case 4:return`vec4<${_}>(${A}(scale[0].${S}, scale[1].${S}, scale[2].${S}, scale[3].${S}))`;default:throw new Error(`Not supported compoents ${l}`)}},M=Fe("input",t[0].dataType,t[0].dims,l),E=ft("output",t[0].dataType,s,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${M.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${y}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${E.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${g.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${v(0)}, ${v(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:b},{inputs:[t[0],m]})},RN=(e,t)=>{t.format==="NHWC"?_$(e,e.inputs,t):g$(e,e.inputs,t)}}),y$,v$,LN,Aq=Ke(()=>{kt(),Lt(),Nt(),y$=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},v$=(e,t,r)=>{let n=t.simplified,s=e[0].dims,o=e[1],i=!n&&e[2],a=s,l=Ce.normalizeAxis(t.axis,s.length),u=Ce.sizeToDimension(s,l),h=Ce.sizeFromDimension(s,l),c=Ce.size(o.dims),d=i?Ce.size(i.dims):0;if(c!==h||i&&d!==h)throw new Error(`Size of X.shape()[axis:] == ${h}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${c} and bias size of ${d}`);let f=[];for(let M=0;M<s.length;++M)M<l?f.push(s[M]):f.push(1);let p=Fr(h),m=["type","type"],b=[{type:12,data:u},{type:1,data:h},{type:12,data:Math.floor(h/p)},{type:1,data:t.epsilon}];i&&m.push("type");let g=r>1,_=r>2,y=M=>{let E=vn(e[0].dataType),T=[Fe("x",e[0].dataType,e[0].dims,p),Fe("scale",o.dataType,o.dims,p)];i&&T.push(Fe("bias",i.dataType,i.dims,p)),T.push(ft("output",e[0].dataType,a,p)),g&&T.push(ft("mean_data_output",1,f)),_&&T.push(ft("inv_std_output",1,f));let S=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${M.registerUniforms(S).declareVariables(...T)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${$w("f32",p)};
    var mean_square_vector = ${$w("f32",p)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${iu(E,p,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${sa("mean_vector",p)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${sa("mean_square_vector",p)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${iu(E,p,"x[j + offset]")};
      let f32scale = ${iu(E,p,"scale[j]")};
      output[j + offset] = ${T[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${i?`+ ${iu(E,p,"bias[j]")}`:""}
      );
    }

    ${g?"mean_data_output[global_idx] = mean":""};
    ${_?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},v=[{dims:a,dataType:e[0].dataType}];return g&&v.push({dims:f,dataType:1}),_&&v.push({dims:f,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${p};${r};${n}`,inputDependencies:m},getRunData:()=>({outputs:v,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:b}),getShaderSource:y}},LN=(e,t)=>{y$(e.inputs),e.compute(v$(e.inputs,t,e.outputCount))}}),w$,NN,Iq=Ke(()=>{Lt(),Ob(),Db(),w$=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},NN=e=>{w$(e.inputs);let t=Ru.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let r=t[t.length-1],n=e.inputs[0].dims[e.inputs[0].dims.length-1];if(r<8&&n<8)e.compute(Ib(e.inputs,{activation:""},t));else{let s=t[t.length-2],o=Ce.size(e.inputs[0].dims.slice(0,-2)),i=Ce.size(e.inputs[1].dims.slice(0,-2));if(o!==1&&s===1&&i===1){let a=e.inputs[0].reshape([1,o,n]),l=e.inputs[1].reshape([1,n,r]),u=[1,o,r],h=[a,l];e.compute(Xp(h,{activation:""},t,u),{inputs:h})}else e.compute(Xp(e.inputs,{activation:""},t))}}}),b$,x$,M$,jN,zN,Oq=Ke(()=>{kt(),Lt(),Gr(),Nt(),b$=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let r=e[0],n=r.dims.length;if(r.dims[n-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let s=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,i=e[1];if(!Ce.areEqual(i.dims,[t.n,s,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let a=e[2].dims;if(Ce.size(a)!==t.n*s)throw new Error("scales input size error.");if(e.length===4){let l=e[3].dims,u=t.bits>4?t.n*s:t.n*Math.floor((s+1)/2);if(Ce.size(l)!==u)throw new Error("zeroPoints input size error.")}},x$=(e,t)=>{let r=e[0].dims,n=r.length,s=r[n-2],o=t.k,i=t.n,a=r.slice(0,n-2),l=Ce.size(a),u=e[1].dims[2]/4,h=e[0].dataType,c=Fr(t.k),d=Fr(u),f=Fr(i),p=a.concat([s,i]),m=s>1&&i/f%2===0?2:1,b=Ce.size(p)/f/m,g=64,_=[],y=[l,s,o/c],v=Ce.convertShape(e[1].dims).slice();v.splice(-1,1,u/d),_.push(...wt(y)),_.push(...wt(v)),_.push(...wt(e[2].dims)),e.length===4&&_.push(...wt(Ce.convertShape(e[3].dims)));let M=[l,s,i/f];_.push(...wt(M));let E=T=>{let S=y.length,A=Fe("a",e[0].dataType,S,c),I=Fe("b",12,v.length,d),V=Fe("scales",e[2].dataType,e[2].dims.length),N=[A,I,V],z=e.length===4?Fe("zero_points",12,e[3].dims.length):void 0;z&&N.push(z);let q=M.length,G=ft("output",e[0].dataType,q,f),ee=vn(e[0].dataType),Y=(()=>{switch(c){case 1:return`array<${ee}, 8>`;case 2:return`mat4x2<${ee}>`;case 4:return`mat2x4<${ee}>`;default:throw new Error(`${c}-component is not supported.`)}})(),W=()=>{let oe=`
          // reuse a data
            var input_offset = ${A.indicesToOffset(`${A.type.indices}(batch, row, word_offset)`)};
            var a_data: ${Y};
            for (var j: u32 = 0; j < ${8/c}; j++) {
              a_data[j] = ${A.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let U=0;U<f*m;U++)oe+=`
            b_value = ${d===1?`b${U}_data`:`b${U}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${Y}(${Array.from({length:4},(R,X)=>`${ee}(b_value_lower[${X}]), ${ee}(b_value_upper[${X}])`).join(", ")});
            b_dequantized_values = ${c===1?`${Y}(${Array.from({length:8},(R,X)=>`(b_quantized_values[${X}] - ${z?`zero_point${U}`:"zero_point"}) * scale${U}`).join(", ")});`:`(b_quantized_values - ${Y}(${Array(8).fill(`${z?`zero_point${U}`:"zero_point"}`).join(",")})) * scale${U};`};
            workgroup_shared[local_id.x * ${m} + ${Math.floor(U/f)}]${f>1?`[${U%f}]`:""} += ${Array.from({length:8/c},(R,X)=>`${c===1?`a_data[${X}] * b_dequantized_values[${X}]`:`dot(a_data[${X}], b_dequantized_values[${X}])`}`).join(" + ")};
          `;return oe},te=()=>{let oe=`
            var col_index = col * ${f};
            ${z?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ee}(8);`}
            `;for(let U=0;U<f*m;U++)oe+=`
            let scale${U} = ${V.getByOffset("col_index * nBlocksPerCol + block")};
            ${z?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${z.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${U} = ${ee}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return oe},le=()=>{let oe=`col_index = col * ${f};`;for(let U=0;U<f*m;U++)oe+=`
            let b${U}_data = ${I.getByIndices(`${I.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return oe+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${Y};
            var b_dequantized_values: ${Y};`,oe};return`
        var<workgroup> workgroup_shared: array<${G.type.value}, ${m*g}>;
        ${T.declareVariables(...N,G)}
        ${T.mainStart([g,1,1])}
          let output_indices = ${G.offsetToIndices(`(global_idx / ${g}) * ${m}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${g}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/c};
            ${te()}
            for (var word: u32 = 0; word < ${u}; word += ${d}) {
              ${le()}
              for (var i: u32 = 0; i < ${d}; i++) {
                ${W()}
                word_offset += ${8/c};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${m}) {
            var output_value: ${G.type.value} = ${G.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${g}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${m};
            }
            ${G.setByIndices(`${G.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${c};${d};${f};${m};${g}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:h}],dispatchGroup:{x:b},programUniforms:_}),getShaderSource:E}},M$=(e,t)=>{let r=e[0].dims,n=r.length,s=r[n-2],o=t.k,i=t.n,a=r.slice(0,n-2),l=Ce.size(a),u=e[1].dims[2]/4,h=e[0].dataType,c=Fr(t.k),d=Fr(u),f=a.concat([s,i]),p=128,m=i%8===0?8:i%4===0?4:1,b=p/m,g=b*d*8,_=g/c,y=g/t.blockSize,v=Ce.size(f)/m,M=[],E=[l,s,o/c],T=Ce.convertShape(e[1].dims).slice();T.splice(-1,1,u/d),M.push(...wt(E)),M.push(...wt(T)),M.push(...wt(e[2].dims)),e.length===4&&M.push(...wt(Ce.convertShape(e[3].dims)));let S=[l,s,i];M.push(...wt(S));let A=I=>{let V=E.length,N=Fe("a",e[0].dataType,V,c),z=Fe("b",12,T.length,d),q=Fe("scales",e[2].dataType,e[2].dims.length),G=[N,z,q],ee=e.length===4?Fe("zero_points",12,e[3].dims.length):void 0;ee&&G.push(ee);let Y=S.length,W=ft("output",e[0].dataType,Y),te=vn(e[0].dataType),le=()=>{switch(c){case 1:return`
          let a_data0 = vec4<${te}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${te}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${te}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${te}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${c}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${N.type.value}, ${_}>;
        var<workgroup> inter_results: array<array<${W.type.value}, ${b}>, ${m}>;
        ${I.declareVariables(...G,W)}
        ${I.mainStart([b,m,1])}
          let output_indices = ${W.offsetToIndices(`workgroup_index * ${m}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${y} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${_};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${_}; a_offset += ${p})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${N.getByIndices(`${N.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${N.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${y} + local_id.x;
            ${ee?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${ee.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${te}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${te}(8);`}
            let scale = ${q.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${z.getByIndices(`${z.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/c};
            for (var i: u32 = 0; i < ${d}; i++) {
              ${le()}
              let b_value = ${d===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${te}>(${Array.from({length:4},(oe,U)=>`${te}(b_value_lower[${U}]), ${te}(b_value_upper[${U}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${te}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(oe,U)=>`${`dot(a_data${U}, b_dequantized_values[${U}])`}`).join(" + ")};
              word_offset += ${8/c};
            }
            workgroupBarrier();
          }

          if (local_idx < ${m}) {
            var output_value: ${W.type.value} = ${W.type.value}(0);
            for (var b = 0u; b < ${b}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${W.setByIndices(`${W.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${c};${d};${b};${m}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:f,dataType:h}],dispatchGroup:{x:v},programUniforms:M}),getShaderSource:A}},jN=(e,t)=>{b$(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(M$(e.inputs,t)):e.compute(x$(e.inputs,t))},zN=e=>or(e)}),T$,E$,P$,S$,C$,k$,$$,A$,BN,Dq=Ke(()=>{kt(),Lt(),Nt(),T$=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},E$=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
            k = i32(${e.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${gt("uniforms.x_shape",s,t)})) {
              break;
            }
            offset += k * i32(${gt("uniforms.x_strides",s,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},P$=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${gt("uniforms.x_shape",s,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${gt("uniforms.x_shape",s,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${gt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},S$=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${gt("uniforms.x_shape",s,t)})) {
                  k = i32(${gt("uniforms.x_shape",s,t)}) - 1;
                }
                offset += k * i32(${gt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},C$=(e,t,r)=>{let n="";for(let s=t-1;s>=0;--s)n+=`
                k = i32(${e.indicesGet("indices",s)}) - ${gt("uniforms.pads",s,r)};
                if (k < 0)  {
                  k += i32(${gt("uniforms.x_shape",s,t)}]);
                }
                if (k >= i32(${gt("uniforms.x_shape",s,t)})) {
                  k -= i32(${gt("uniforms.x_shape",s,t)});
                }
                offset += k * i32(${gt("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},k$=(e,t,r)=>{switch(r.mode){case 0:return E$(e,t,r.pads.length);case 1:return P$(e,t,r.pads.length);case 2:return S$(e,t,r.pads.length);case 3:return C$(e,t,r.pads.length);default:throw new Error("Invalid mode")}},$$=(e,t)=>{let r=Ce.padShape(e[0].dims.slice(),t.pads),n=e[0].dims,s=Ce.size(r),o=[{type:12,data:s},{type:6,data:t.pads}],i=e.length>=3&&e[2].data;t.mode===0&&o.push({type:i?e[2].dataType:1,data:t.value}),o.push(...wt(e[0].dims,r));let a=["rank"],l=u=>{let h=ft("output",e[0].dataType,r.length),c=Fe("x",e[0].dataType,n.length),d=c.type.value,f=k$(h,n.length,t),p=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&p.push({name:"constant_value",type:i?d:"f32"}),`
            ${u.registerUniforms(p).declareVariables(c,h)}
            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${h.offsetToIndices("global_idx")};

            var value = ${d}(0);
            ${f}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${i}`,inputDependencies:a},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ce.size(r)/64)},programUniforms:o}),getShaderSource:l}},A$=(e,t)=>{if(e.length>1){let r=e[1].getBigInt64Array(),n=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,s=e[0].dims.length,o=new Int32Array(2*s).fill(0);if(e.length>=4){let a=e[3].getBigInt64Array();for(let l=0;l<a.length;l++)o[Number(a[l])]=Number(r[l]),o[Number(a[l])+s]=Number(r[l+a.length])}else r.forEach((a,l)=>o[Number(l)]=Number(a));let i=[];return o.forEach(a=>i.push(a)),{mode:t.mode,value:n,pads:i}}else return t},BN=(e,t)=>{T$(e.inputs);let r=A$(e.inputs,t);e.compute($$(e.inputs,r),{inputs:[0]})}}),Fc,Ay,Iy,Oy,Dy,I$,O$,Fy,Ry,UN,VN,Ly,WN,GN,Ny,HN,KN,qN,QN,Fq=Ke(()=>{So(),kt(),Lt(),Nt(),Fc=e=>{if(yr.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},Ay=(e,t,r)=>{let n=t.format==="NHWC",s=e.dims.slice();n&&s.splice(1,0,s.pop());let o=Object.hasOwnProperty.call(t,"dilations"),i=t.kernelShape.slice(),a=t.strides.slice(),l=o?t.dilations.slice():[],u=t.pads.slice();qp.adjustPoolAttributes(r,s,i,a,l,u);let h=qp.computePoolOutputShape(r,s,a,l,i,u,t.autoPad),c=Object.assign({},t);o?Object.assign(c,{kernelShape:i,strides:a,pads:u,dilations:l,cacheKey:t.cacheKey}):Object.assign(c,{kernelShape:i,strides:a,pads:u,cacheKey:t.cacheKey});let d=h.slice();return d.push(d.splice(1,1)[0]),[c,n?d:h]},Iy=(e,t)=>{let r=t.format==="NHWC",n=Ce.size(e),s=Ce.size(t.kernelShape),o=[{type:12,data:n},{type:12,data:s}],i=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let a=t.kernelShape[t.kernelShape.length-1],l=t.strides[t.strides.length-1],u=t.pads[t.pads.length/2-1],h=t.pads[t.pads.length-1],c=!!(u+h);o.push({type:12,data:a},{type:12,data:l},{type:12,data:u},{type:12,data:h}),i.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let d=!1;if(t.kernelShape.length===2){let f=t.kernelShape[t.kernelShape.length-2],p=t.strides[t.strides.length-2],m=t.pads[t.pads.length/2-2],b=t.pads[t.pads.length-2];d=!!(m+b),o.push({type:12,data:f},{type:12,data:p},{type:12,data:m},{type:12,data:b}),i.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,i,!0,c,d]}else{if(r)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let a=Ce.computeStrides(t.kernelShape);o.push({type:12,data:a},{type:12,data:t.pads},{type:12,data:t.strides}),i.push({name:"kernelStrides",type:"u32",length:a.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let l=t.pads.reduce((u,h)=>u+h);return[o,i,!!l,!1,!1]}},Oy=(e,t,r,n,s,o,i,a,l,u,h,c)=>{let d=s.format==="NHWC",f=t.type.value,p=ft("output",t.type.tensor,n);if(s.kernelShape.length<=2){let m="",b="",g="",_=r-(d?2:1);if(h?m=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${_}] < 0 || xIndices[${_}]
                      >= uniforms.x_shape[${_}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`:m=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`,s.kernelShape.length===2){let y=r-(d?3:2);c?b=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${y}] < 0 || xIndices[${y}] >= uniforms.x_shape[${y}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:b=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sh - uniforms.phStart + j;
                `,g=`
              }
            `}return`
            ${e.registerUniforms(l).declareVariables(t,p)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${p.offsetToIndices("global_idx")};
              var xIndices = ${p.offsetToIndices("global_idx")};

              var value = ${f}(${a});
              var pad = 0;
              ${b}
              ${m}
              ${g}
              ${i}

              output[global_idx] = value;
            }`}else{if(d)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let m=s.kernelShape.length,b=s.pads.length,g="";return u?g=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${o}
              }`:g=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${e.registerUniforms(l).declareVariables(t,p)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${p.offsetToIndices("global_idx")};
              var xIndices = ${p.offsetToIndices("global_idx")};

              var offsets: array<u32, ${m}>;

              var value = ${f}(${a});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${m-1}u; j++) {
                  offsets[j] = offset / ${gt("uniforms.kernelStrides","j",m)};
                  offset -= offsets[j] * ${gt("uniforms.kernelStrides","j",m)};
                }
                offsets[${m-1}] = offset;

                isPad = false;
                for (var j = ${r-m}u; j < ${r}u; j++) {
                  xIndices[j] = indices[j] * ${gt("uniforms.strides",`j - ${r-m}u`,m)}
                    + offsets[j - ${r-m}u] - ${gt("uniforms.pads","j - 2u",b)};
                  ${g}
              }
              ${i}

              output[global_idx] = value;
            }`}},Dy=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,I$=e=>`${Dy(e)};${e.countIncludePad}`,O$=e=>`${Dy(e)};${e.storageOrder};${e.dilations}`,Fy=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),Ry=(e,t,r,n)=>{let[s,o]=Ay(t,n,r),i=Fe("x",t.dataType,t.dims.length),a=i.type.value,l="value += x_val;",u="";s.countIncludePad?u+=`value /= ${a}(uniforms.kernelSize);`:u+=`value /= ${a}(i32(uniforms.kernelSize) - pad);`;let[h,c,d,f,p]=Iy(o,s);h.push(...wt(t.dims,o));let m=["rank"];return{name:e,shaderCache:{hint:`${n.cacheKey};${d};${f};${p}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ce.size(o)/64)},programUniforms:h}),getShaderSource:b=>Oy(b,i,t.dims.length,o.length,s,l,u,0,c,d,f,p)}},UN=e=>{let t=e.count_include_pad!==0,r=Fy(e);if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:t,...r,cacheKey:""};return{...n,cacheKey:I$(n)}},VN=(e,t)=>{Fc(e.inputs),e.compute(Ry("AveragePool",e.inputs[0],!1,t))},Ly={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},WN=e=>{let t=e.format;return{format:t,...Ly,cacheKey:t}},GN=(e,t)=>{Fc(e.inputs),e.compute(Ry("GlobalAveragePool",e.inputs[0],!0,t))},Ny=(e,t,r,n)=>{let[s,o]=Ay(t,n,r),i=`
      value = max(x_val, value);
    `,a="",l=Fe("x",t.dataType,t.dims.length),u=["rank"],[h,c,d,f,p]=Iy(o,s);return h.push(...wt(t.dims,o)),{name:e,shaderCache:{hint:`${n.cacheKey};${d};${f};${p}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ce.size(o)/64)},programUniforms:h}),getShaderSource:m=>Oy(m,l,t.dims.length,o.length,s,i,a,t.dataType===10?-65504:-1e5,c,d,f,p)}},HN=(e,t)=>{Fc(e.inputs),e.compute(Ny("MaxPool",e.inputs[0],!1,t))},KN=e=>{let t=e.storage_order,r=e.dilations,n=Fy(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let s={storageOrder:t,dilations:r,...n,cacheKey:""};return{...s,cacheKey:O$(s)}},qN=e=>{let t=e.format;return{format:t,...Ly,cacheKey:t}},QN=(e,t)=>{Fc(e.inputs),e.compute(Ny("GlobalMaxPool",e.inputs[0],!0,t))}}),D$,F$,XN,JN,Rq=Ke(()=>{kt(),Lt(),Gr(),Nt(),D$=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((r,n)=>r===e[2].dims[n]).reduce((r,n)=>r&&n,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((s,o)=>o===t.axis||s===e[0].dims[o]).reduce((s,o)=>s&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let r=e[0].dims[t.axis],n=e[1].dims[t.axis];if(t.blockSize<Math.ceil(r/n)||t.blockSize>Math.ceil(r/(n-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},F$=(e,t)=>{let r=Ce.normalizeAxis(t.axis,e[0].dims.length),n=e[0].dataType,s=n===3,o=e[0].dims,i=e[1].dataType,a=Ce.size(o),l=n===3||n===2,u=l?[Math.ceil(Ce.size(e[0].dims)/4)]:e[0].dims,h=e[1].dims,c=e.length>2?e[2]:void 0,d=c?l?[Math.ceil(Ce.size(c.dims)/4)]:c.dims:void 0,f=h.length===0||h.length===1&&h[0]===1,p=f===!1&&h.length===1,m=Fr(a),b=f&&(!l||m===4),g=b?m:1,_=b&&!l?m:1,y=Fe("input",l?12:n,u.length,_),v=Fe("scale",i,h.length),M=c?Fe("zero_point",l?12:n,d.length):void 0,E=ft("output",i,o.length,g),T=[y,v];M&&T.push(M);let S=[u,h];c&&S.push(d);let A=[{type:12,data:a/g},{type:12,data:r},{type:12,data:t.blockSize},...wt(...S,o)],I=V=>{let N=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${V.registerUniforms(N).declareVariables(...T,E)}
      ${V.mainStart()}
          ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${E.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${y.getByOffset("global_idx / 4")};
            let x_vec = ${s?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${g===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${y.getByOffset("global_idx")};`};

          // Set scale input
          ${f?`let scale_value= ${v.getByOffset("0")}`:p?`
            let scale_index = ${E.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${v.getByOffset("scale_index")};`:`
            var scale_indices: ${v.type.indices} = output_indices;
            let index = ${v.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${v.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${v.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${M?f?l?`
                let zero_point_input = ${M.getByOffset("0")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${M.getByOffset("0")}`:p?l?`
                let zero_point_index = ${E.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${M.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${E.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${M.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${v.indicesToOffset("scale_indices")};
                let zero_point_input = ${M.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${M.getByIndices("scale_indices")};`:`let zero_point_value = ${l?s?"i32":"u32":y.type.value}(0);`};
      // Compute and write output
      ${E.setByOffset("global_idx",`${E.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:M?["rank","rank","rank"]:["rank","rank"]},getShaderSource:I,getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:Math.ceil(a/g/64),y:1,z:1},programUniforms:A})}},XN=(e,t)=>{D$(e.inputs,t),e.compute(F$(e.inputs,t))},JN=e=>or({axis:e.axis,blockSize:e.blockSize})}),R$,L$,YN,Lq=Ke(()=>{So(),kt(),Nt(),R$=(e,t,r)=>{let n=e===t,s=e<t&&r<0,o=e>t&&r>0;if(n||s||o)throw new Error("Range these inputs' contents are invalid.")},L$=(e,t,r,n)=>{let s=Math.abs(Math.ceil((t-e)/r)),o=[s],i=s,a=[{type:12,data:i},{type:n,data:e},{type:n,data:r},...wt(o)],l=u=>{let h=ft("output",n,o.length),c=h.type.value,d=[{name:"outputSize",type:"u32"},{name:"start",type:c},{name:"delta",type:c}];return`
        ${u.registerUniforms(d).declareVariables(h)}
        ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${c}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:o,dataType:n}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:a})}},YN=e=>{let t=0,r=0,n=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],r=e.inputs[1].getInt32Array()[0],n=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],r=e.inputs[1].getFloat32Array()[0],n=e.inputs[2].getFloat32Array()[0]),yr.webgpu.validateInputContent&&R$(t,r,n),e.compute(L$(t,r,n,e.inputs[0].dataType),{inputs:[]})}}),N$,jy,zy,j$,ZN,ej,Nq=Ke(()=>{kt(),Lt(),Gr(),Nt(),N$=(e,t,r,n)=>{if(e!=="none"&&n!=="i32"&&n!=="u32"&&n!=="f32")throw new Error(`Input ${n} is not supported with reduction ${e}.`);let s=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${r};`;case"add":return n==="i32"||n==="u32"?`atomicAdd(&${t}, bitcast<${n}>(${r}));`:`
              ${s}bitcast<${n}>(oldValue) + (${r})${o}`;case"max":return n==="i32"||n==="u32"?`atomicMax(&${t}, bitcast<${n}>(${r}));`:`
                ${s}max(bitcast<f32>(oldValue), (${r}))${o}`;case"min":return n==="i32"||n==="u32"?`atomicMin(&${t}, bitcast<${n}>(${r}));`:`${s}min(bitcast<${n}>(oldValue), (${r}))${o}`;case"mul":return`${s}(bitcast<${n}>(oldValue) * (${r}))${o}`;default:throw new Error(`Reduction ${e} is not supported.`)}},jy=(e,t)=>`${e===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${t?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${t?"i - indices_start":"i"} + uniforms.last_index_dimension];`}

    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,zy=(e,t,r)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${r?"global_idx":"idx"} + i];
        ${N$(e.reduction,"output[data_offset + i]","value",t)}
      }`,j$=(e,t)=>{let r=e[0].dims,n=e[1].dims,s=r,o=1,i=Math.ceil(Ce.size(n)/o),a=n[n.length-1],l=Ce.sizeFromDimension(r,a),u=Ce.sizeFromDimension(n,0)/a,h=[{type:12,data:i},{type:12,data:a},{type:12,data:l},...wt(e[1].dims,e[2].dims,s)],c=d=>{let f=Fe("indices",e[1].dataType,e[1].dims.length),p=Fe("updates",e[2].dataType,e[2].dims.length,o),m=t.reduction!=="none"&&t.reduction!==""?CL("output",e[0].dataType,s.length):ft("output",e[0].dataType,s.length,o);return`
      ${d.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(f,p,m)}
      ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    for (var i = 0; i < ${u}; i = i + 1) {
      for (var j = i + 1; j < ${u}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${u}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${jy(r.length,!1)}
      }
      ${zy(t,m.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${jy(r.length,!0)}
  }
  ${zy(t,m.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:h}),getShaderSource:c}},ZN=e=>or({reduction:e.reduction}),ej=(e,t)=>{e.compute(j$(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),z$,B$,U$,By,V$,W$,G$,H$,K$,q$,Q$,X$,Uy,J$,Y$,Z$,eA,tA,tj,rj,jq=Ke(()=>{kt(),Lt(),Gr(),Nt(),z$=(e,t)=>{if(e.every(r=>r>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},B$=(e,t,r)=>{t.every(s=>s>=0&&s<r||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let n=new Array(r).fill(1);return t.forEach((s,o)=>n[s]=e[o]),n},U$=(e,t,r,n,s,o)=>{let[i,a,l]=r>10?[1,2,3]:[-1,e.length>1?1:-1,-1],u=e[0].dims.length;if(i>0&&e.length>i&&e[i].dims.length>0)e[i].getFloat32Array().forEach(h=>o.push(h));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(a>0&&e.length>a&&e[a].dims.length===1&&e[a].dims[0]>0){if(e[a].getFloat32Array().forEach(h=>n.push(h)),n.length!==0&&n.length!==u&&r>=18&&n.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");z$(n,t),t.axes.length>0&&B$(n,t.axes,u).forEach((h,c)=>n[c]=h)}if(l>0&&e.length>l&&e[l].dims.length===1&&e[l].dims[0]>0&&(e[l].getBigInt64Array().forEach(h=>s.push(Number(h))),s.length!==0&&s.length!==u&&r>=18&&s.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(n.length!==0&&n.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(s.length!==0&&s.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof n<"u"&&typeof s<"u"&&n.length>0&&s.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},By=(e,t,r,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${n}(big / (${r}));
  let fract = ${n}(big % (${r})) / ${n}(${r});
  return whole + fract;
`,V$=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${By("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${By("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",W$=(e,t,r)=>`fn getNearestPixelFromOriginal(xOriginal: ${r}, isDownSample: bool) -> ${r} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",G$=(e,t,r)=>{let n=new Array(r).fill(0).concat(new Array(r).fill(1)),s=e.length===0?n:e.slice();return t.length>0?(t.forEach((o,i)=>{n[o]=s[i],n[i+r]=s[t.length+i]}),n):s},H$=(e,t,r,n)=>{let s=[];if(r.length>0)if(n.length>0){if(e.forEach(o=>s.push(o)),Math.max(...n)>e.length)throw new Error("axes is out of bound");n.forEach((o,i)=>s[o]=r[i])}else r.forEach(o=>s.push(o));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");s=e.map((o,i)=>Math.round(o*t[i]))}return s},K$=(e,t,r)=>{let n=(()=>{switch(r.keepAspectRatioPolicy){case"not_larger":return r.axes.length>0?Math.min(...r.axes.map(o=>t[o]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return r.axes.length>0?Math.max(...r.axes.map(o=>t[o]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${r.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let s=e.slice();return r.axes.length>0?(r.axes.forEach(o=>t[o]=n),r.axes.forEach(o=>s[o]=Math.round(e[o]*t[o]))):(t.fill(n,0,t.length),s.forEach((o,i)=>s[i]=Math.round(o*t[i]))),s},q$=(e,t,r,n,s)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${r.length}> {
      var original_indices: array<${e.type.value}, ${r.length}>;
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${gt("uniforms.scales","i",n)};
        var roi_low = ${gt("uniforms.roi","i",s)};
        var roi_hi = ${gt("uniforms.roi",`i + ${t.length}`,s)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${gt("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${gt("uniforms.output_shape","i",r.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Q$=(e,t,r,n,s,o,i)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${gt("uniforms.scales","i",s)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${gt("uniforms.roi","i",o)};
          var roi_hi = ${gt("uniforms.roi",`i + ${r.length}`,o)};
          var input_shape_i = ${gt("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${gt("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${i} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,X$=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${gt("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,Uy=(e,t,r,n)=>e.rank>n?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",r,"batch")};
`:"",J$=(e,t,r,n,s)=>{let[o,i,a,l]=r.length===2?[-1,0,1,-1]:[0,2,3,1],u=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",i,`max(0, min(row, ${r[i]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(col, ${r[a]} - 1))`)};
      ${Uy(e,l,o,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${u} = originalIndices[${i}];
      var col:${u} = originalIndices[${a}];
      ${n?`if (row < 0 || row > (${r[i]} - 1) || col < 0 || col > (${r[a]} - 1)) {
        return ${s};
      }`:""};
      row = max(0, min(row, ${r[i]} - 1));
      col = max(0, min(col, ${r[a]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${r.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${r.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${u} = getInputValue(batch, channel, row1, col1);
      var x12: ${u} = getInputValue(batch, channel, row1, col2);
      var x21: ${u} = getInputValue(batch, channel, row2, col1);
      var x22: ${u} = getInputValue(batch, channel, row2, col2);
      var dx1: ${u} = abs(row - ${u}(row1));
      var dx2: ${u} = abs(${u}(row2) - row);
      var dy1: ${u} = abs(col - ${u}(col1));
      var dy2: ${u} = abs(${u}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Y$=(e,t,r,n,s,o,i,a,l,u)=>{let h=r.length===2,[c,d]=h?[0,1]:[2,3],f=e.type.value,p=m=>{let b=m===c?"row":"col";return`
      fn ${b}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${f} {
        var output_index = ${t.indicesGet("output_indices",m)};
        var originalIdx: ${f} = getOriginalCoordinateFromResizedCoordinate(output_index, ${s[m]},
        ${n[m]}, ${r[m]}, ${o[m]}, ${o[m]} + ${r.length});
        var fractOriginalIdx: ${f} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${a} && (originalIdx < 0 || originalIdx > (${r[m]} - 1))) {
          return ${l};
        }
        var data: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${b}: ${f} = originalIdx + ${f}(i);
          if (${b} < 0 || ${b} >= ${r[m]}) {
            ${u?`coefs[i + 1] = 0.0;
                        continue;`:a?`return ${l};`:`${b} = max(0, min(${b}, ${r[m]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",m,`u32(${b})`)};
          data[i + 1] = ${m===c?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${p(c)};
    ${p(d)};
  fn getCubicInterpolationCoefs(s: ${f}) -> array<${f}, 4> {
    var absS = abs(s);
    var coeffs: array<${f}, 4> = array<${f}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${f} = 1.0 - absS;
    var twoMinusAbsS: ${f} = 2.0 - absS;
    var onePlusAbsS: ${f} = 1.0 + absS;
    coeffs[0] = ((${i} * onePlusAbsS - 5 * ${i}) * onePlusAbsS + 8 * ${i}) * onePlusAbsS - 4 * ${i};
    coeffs[1] = ((${i} + 2) * absS - (${i} + 3)) * absS * absS + 1;
    coeffs[2] = ((${i} + 2) * oneMinusAbsS - (${i} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${i} * twoMinusAbsS - 5 * ${i}) * twoMinusAbsS + 8 * ${i}) * twoMinusAbsS - 4 * ${i};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${f}, 4>, coefs: array<${f}, 4>) -> ${f} {
    var coefsSum: ${f} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${f} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},Z$=(e,t,r,n,s)=>{let[o,i,a,l,u]=r.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],h=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${h} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",i,`max(0, min(depth, ${r[i]} - 1))`)};
      ${e.indicesSet("input_indices",a,`max(0, min(height, ${r[a]} - 1))`)};
      ${e.indicesSet("input_indices",l,`max(0, min(width, ${r[l]} - 1))`)};
      ${Uy(e,u,o,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${h} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${h} = originalIndices[${i}];
      var height:${h} = originalIndices[${a}];
      var width:${h} = originalIndices[${l}];
      ${n?`if (depth < 0 || depth > (${r[i]} - 1) || height < 0 || height > (${r[a]} - 1) || width < 0 || (width > ${r[l]} - 1)) {
      return ${s};
        }`:""};

    depth = max(0, min(depth, ${r[i]} - 1));
      height = max(0, min(height, ${r[a]} - 1));
      width = max(0, min(width, ${r[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${r.length>3?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${r.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${h} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${h} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${h} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${h} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${h} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${h} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${h} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${h} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${h} = abs(depth - ${h}(depth1));
      var dx2: ${h} = abs(${h}(depth2) - depth);
      var dy1: ${h} = abs(height - ${h}(height1));
      var dy2: ${h} = abs(${h}(height2) - height);
      var dz1: ${h} = abs(width - ${h}(width1));
      var dz2: ${h} = abs(${h}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},eA=(e,t,r,n,s,o)=>{let i=e.dims,a=G$(o,t.axes,i.length),l=H$(i,n,s,t.axes),u=n.slice();n.length===0&&(u=i.map((_,y)=>_===0?1:l[y]/_),t.keepAspectRatioPolicy!=="stretch"&&(l=K$(i,u,t)));let h=ft("output",e.dataType,l.length),c=Fe("input",e.dataType,i.length),d=Ce.size(l),f=i.length===l.length&&i.every((_,y)=>_===l[y]),p=t.coordinateTransformMode==="tf_crop_and_resize",m=t.extrapolationValue,b=c.type.value,g=_=>`
      ${f?"":`
      ${V$(t.coordinateTransformMode,b)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${X$(c,i)};
              ${W$(t.nearestMode,r,b)};
              ${Q$(c,h,i,l,u.length,a.length,p)};
              `;case"linear":return`
              ${q$(h,i,l,u.length,a.length)};
              ${(()=>{if(i.length===2||i.length===4)return`${J$(c,h,i,p,m)}`;if(i.length===3||i.length===5)return`${Z$(c,h,i,p,m)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(i.length===2||i.length===4)return`${Y$(c,h,i,l,u,a,t.cubicCoeffA,p,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${_.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",a.length).declareVariables(c,h)}
      ${_.mainStart()}
        ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${f?"output[global_idx] = input[global_idx];":`
        let output_indices = ${h.offsetToIndices("global_idx")};
        var input_indices: ${c.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${c.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${i.length===2||i.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${r}|${u.length>0?t.mode==="cubic"?u:u.length:""}|${s.length>0?s:""}|${a.length>0?a:""}|${f}|${t.mode==="nearest"?i.length:i}`,inputDependencies:["rank"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:[{type:12,data:d},{type:1,data:u},{type:1,data:a},...wt(i,l)]})}},tA=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},tj=(e,t)=>{let r=[],n=[],s=[],o=tA(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");U$(e.inputs,t,o,r,n,s),e.compute(eA(e.inputs[0],t,o,r,n,s),{inputs:[0]})},rj=e=>{let t=e.antialias,r=e.axes,n=e.coordinateTransformMode,s=e.cubicCoeffA,o=e.excludeOutside!==0,i=e.extrapolationValue,a=e.keepAspectRatioPolicy,l=e.mode,u=e.nearestMode===""?"simple":e.nearestMode;return or({antialias:t,axes:r,coordinateTransformMode:n,cubicCoeffA:s,excludeOutside:o,extrapolationValue:i,keepAspectRatioPolicy:a,mode:l,nearestMode:u})}}),rA,nA,nj,zq=Ke(()=>{kt(),Lt(),Nt(),rA=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],r=e[1],n=e[2];if(t.dataType!==r.dataType||t.dataType!==n.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(r.dims.length!==3&&r.dims.length!==2)throw new Error("Skip must be 2D or 3D");let s=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(r.dims[r.dims.length-1]!==s)throw new Error("Skip must have the same hidden size as input");if(r.dims[r.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(n.dims.length!==1)throw new Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==s)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let i=e[3];if(i.dims.length!==1)throw new Error("Beta must be 1D");if(i.dims[i.dims.length-1]!==s)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let i=e[4];if(i.dims.length!==1)throw new Error("Bias must be 1D");if(i.dims[i.dims.length-1]!==s)throw new Error("Bias must have the same hidden size as input")}},nA=(e,t,r,n)=>{let s=t.simplified,o=e[0].dims,i=Ce.size(o),a=o,l=i,u=o.slice(-1)[0],h=n?o.slice(0,-1).concat(1):[],c=!s&&e.length>3,d=e.length>4,f=n&&r>1,p=n&&r>2,m=r>3,b=64,g=Fr(u),_=[{type:12,data:l},{type:12,data:g},{type:12,data:u},{type:1,data:t.epsilon}],y=M=>{let E=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],T=[Fe("x",e[0].dataType,e[0].dims,g),Fe("skip",e[1].dataType,e[1].dims,g),Fe("gamma",e[2].dataType,e[2].dims,g)];c&&T.push(Fe("beta",e[3].dataType,e[3].dims,g)),d&&T.push(Fe("bias",e[4].dataType,e[4].dims,g)),T.push(ft("output",e[0].dataType,a,g)),f&&T.push(ft("mean_output",1,h)),p&&T.push(ft("inv_std_output",1,h)),m&&T.push(ft("input_skip_bias_sum",e[0].dataType,a,g));let S=vn(e[0].dataType),A=vn(1,g);return`

      ${M.registerUniforms(E).declareVariables(...T)}
      var<workgroup> sum_shared : array<${A}, ${b}>;
      var<workgroup> sum_squared_shared : array<${A}, ${b}>;

      ${M.mainStart([b,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${b};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${b};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${b-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${d?"bias[offset1d + i]":S+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${m?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${iu(S,g,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${b};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${sa("sum",g)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${sa("square_sum",g)} / f32(uniforms.hidden_size) ${s?"":"- mean * mean"} + uniforms.epsilon);
        ${f?"mean_output[global_idx] = mean;":""}
        ${p?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${s?"":`- ${S}(mean)`}) *
            ${S}(inv_std_dev) * gamma[offset1d + i]
            ${c?"+ beta[offset1d + i]":""};
        }
      }`},v=[{dims:a,dataType:e[0].dataType}];return r>1&&v.push({dims:h,dataType:1}),r>2&&v.push({dims:h,dataType:1}),r>3&&v.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${g};${f};${p};${m}`,inputDependencies:e.map((M,E)=>"type")},getShaderSource:y,getRunData:()=>({outputs:v,dispatchGroup:{x:Math.ceil(l/u)},programUniforms:_})}},nj=(e,t)=>{rA(e.inputs);let r=[0];e.outputCount>1&&r.push(-3),e.outputCount>2&&r.push(-3),e.outputCount>3&&r.push(3),e.compute(nA(e.inputs,t,e.outputCount,!1),{outputs:r})}}),sA,Rc,oA,Vy,iA,aA,sj,oj,Bq=Ke(()=>{kt(),Lt(),Gr(),Nt(),sA=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((r,n)=>{if(e[n+1].dataType!==6&&e[n+1].dataType!==7)throw new Error(`Input ${n} must be an array of int32 or int64`)})},Rc=(e,t)=>{let r=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(n=>r.push(Number(n)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(n=>r.push(Number(n)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return r},oA=(e,t)=>{if(e.length>1){let r=Rc(e,1),n=Rc(e,2),s=Rc(e,3);return s.length===0&&(s=[...Array(e[0].dims.length).keys()]),or({starts:r,ends:n,axes:s})}else return t},Vy=(e,t,r,n,s)=>{let o=e;return e<0&&(o+=r[n[t]]),s[t]<0?Math.max(0,Math.min(o,r[n[t]]-1)):Math.max(0,Math.min(o,r[n[t]]))},iA=(e,t,r)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${r.length}; i >= 0; i--) {
            let input_shape_i = ${gt("uniforms.input_shape","i",r.length)};
            let steps_i = ${gt("uniforms.steps","i",r.length)};
            let signs_i = ${gt("uniforms.signs","i",r.length)};
            let starts_i = ${gt("uniforms.starts","i",r.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,aA=(e,t)=>{let r=e[0].dims,n=Ce.size(r),s=t.axes.length>0?Ce.normalizeAxes(t.axes,r.length):[...Array(r.length).keys()],o=Rc(e,4);o.forEach(g=>g!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(s.length).fill(1));let i=t.starts.map((g,_)=>Vy(g,_,r,s,o)),a=t.ends.map((g,_)=>Vy(g,_,r,s,o));if(s.length!==i.length||s.length!==a.length)throw new Error("start, ends and axes should have the same number of elements");if(s.length!==r.length)for(let g=0;g<r.length;++g)s.includes(g)||(i.splice(g,0,0),a.splice(g,0,r[g]),o.splice(g,0,1));let l=o.map(g=>Math.sign(g));o.forEach((g,_,y)=>{if(g<0){let v=(a[_]-i[_])/g,M=i[_],E=M+v*o[_];i[_]=E,a[_]=M,y[_]=-g}});let u=r.slice(0);s.forEach((g,_)=>{u[g]=Math.ceil((a[g]-i[g])/o[g])});let h={dims:u,dataType:e[0].dataType},c=ft("output",e[0].dataType,u.length),d=Fe("input",e[0].dataType,e[0].dims.length),f=Ce.size(u),p=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:i.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:o.length}],m=[{type:12,data:f},{type:12,data:i},{type:6,data:l},{type:12,data:o},...wt(e[0].dims,u)],b=g=>`
      ${g.registerUniforms(p).declareVariables(d,c)}
        ${iA(d,c,r)}
        ${g.mainStart()}
          ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${c.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${c.setByOffset("global_idx",d.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${i.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:b,getRunData:()=>({outputs:[h],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:m})}},sj=(e,t)=>{sA(e.inputs,t);let r=oA(e.inputs,t);e.compute(aA(e.inputs,r),{inputs:[0]})},oj=e=>{let t=e.starts,r=e.ends,n=e.axes;return or({starts:t,ends:r,axes:n})}}),lA,uA,ij,aj,Uq=Ke(()=>{kt(),Lt(),Gr(),ca(),Nt(),lA=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},uA=(e,t)=>{let r=e.inputs[0],n=r.dims,s=Ce.size(n),o=n.length,i=Ce.normalizeAxis(t.axis,o),a=i<n.length-1,l,u=[];a?(u=Array.from({length:o},(T,S)=>S),u[i]=o-1,u[o-1]=i,l=e.compute(Ts(r,u),{inputs:[r],outputs:[-1]})[0]):l=r;let h=l.dims,c=h[o-1],d=s/c,f=Fr(c),p=c/f,m=64;d===1&&(m=256);let b=(T,S)=>S===4?`max(max(${T}.x, ${T}.y), max(${T}.z, ${T}.w))`:S===2?`max(${T}.x, ${T}.y)`:S===3?`max(max(${T}.x, ${T}.y), ${T}.z)`:T,g=Fe("x",l.dataType,l.dims,f),_=ft("result",l.dataType,l.dims,f),y=g.type.value,v=vn(l.dataType)==="f32"?`var threadMax = ${y}(-3.402823e+38f);`:`var threadMax = ${y}(-65504.0h);`,M=T=>`
      var<workgroup> rowMaxShared : ${y};
      var<workgroup> rowSumShared : ${y};
      var<workgroup> threadShared : array<${y}, ${m}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${y} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${y}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${T.registerUniform("packedCols","i32").declareVariables(g,_)}
      ${T.mainStart(m)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${m};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${v}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${y}(${b("threadShared[0]",f)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${y}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${y}(${sa("threadShared[0]",f)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,E=e.compute({name:"Softmax",shaderCache:{hint:`${f};${m}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:h,dataType:l.dataType}],dispatchGroup:{x:d},programUniforms:[{type:6,data:p}]}),getShaderSource:M},{inputs:[l],outputs:[a?-1:0]})[0];a&&e.compute(Ts(E,u),{inputs:[E]})},ij=(e,t)=>{lA(e.inputs),uA(e,t)},aj=e=>or({axis:e.axis})}),Wy,cA,dA,hA,lj,Vq=Ke(()=>{kt(),Lt(),Nt(),Wy=e=>Array.from(e.getBigInt64Array(),Number),cA=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Wy(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},dA=(e,t)=>{let r=[];for(let n=0;n<e.length;++n)r.push(e[n]*t[n]);return r},hA=(e,t)=>{let r=e[0].dims,n=t??Wy(e[1]),s=dA(r,n),o=Ce.size(s),i=e[0].dataType,a=Fe("input",i,r.length),l=ft("output",i,s.length),u=h=>`
      const inputShape = ${a.indices(...r)};
      ${h.registerUniform("output_size","u32").declareVariables(a,l)}
      ${h.mainStart()}
      ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${a.type.indices};
      for (var i = 0; i < ${r.length}; i++) {
        let input_dim_i = ${a.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${a.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",a.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...wt(e[0].dims,s)]}),getShaderSource:u}},lj=e=>{cA(e.inputs),e.compute(hA(e.inputs),{inputs:[0]})}}),fA,pA,uj,Wq=Ke(()=>{kt(),Lt(),Nt(),fA=(e,t,r,n,s)=>{let o=ft("output_data",s,r.length,4),i=Fe("a_data",t[1].dataType,t[1].dims.length,4),a=Fe("b_data",t[2].dataType,t[2].dims.length,4),l=Fe("c_data",t[0].dataType,t[0].dims.length,4),u,h=(c,d,f)=>`select(${d}, ${c}, ${f})`;if(!n)u=o.setByOffset("global_idx",h(i.getByOffset("global_idx"),a.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let c=(d,f,p="")=>{let m=`a_data[index_a${f}][component_a${f}]`,b=`b_data[index_b${f}][component_b${f}]`,g=`bool(c_data[index_c${f}] & (0xffu << (component_c${f} * 8)))`;return`
            let output_indices${f} = ${o.offsetToIndices(`global_idx * 4u + ${f}u`)};
            let offset_a${f} = ${i.broadcastedIndicesToOffset(`output_indices${f}`,o)};
            let offset_b${f} = ${a.broadcastedIndicesToOffset(`output_indices${f}`,o)};
            let offset_c${f} = ${l.broadcastedIndicesToOffset(`output_indices${f}`,o)};
            let index_a${f} = offset_a${f} / 4u;
            let index_b${f} = offset_b${f} / 4u;
            let index_c${f} = offset_c${f} / 4u;
            let component_a${f} = offset_a${f} % 4u;
            let component_b${f} = offset_b${f} % 4u;
            let component_c${f} = offset_c${f} % 4u;
            ${d}[${f}] = ${p}(${h(m,b,g)});
          `};s===9?u=`
            var data = vec4<u32>(0);
            ${c("data",0,"u32")}
            ${c("data",1,"u32")}
            ${c("data",2,"u32")}
            ${c("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:u=`
            ${c("output_data[global_idx]",0)}
            ${c("output_data[global_idx]",1)}
            ${c("output_data[global_idx]",2)}
            ${c("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(l,i,a,o)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${u}
      }`},pA=e=>{let t=e[1].dims,r=e[2].dims,n=e[0].dims,s=e[1].dataType,o=!(Ce.areEqual(t,r)&&Ce.areEqual(r,n)),i=t,a=Ce.size(t);if(o){let u=Ru.calcShape(Ru.calcShape(t,r,!1),n,!1);if(!u)throw new Error("Can't perform where op on the given tensors");i=u,a=Ce.size(i)}let l=Math.ceil(a/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:u=>fA(u,e,i,o,s),getRunData:()=>({outputs:[{dims:i,dataType:s}],dispatchGroup:{x:Math.ceil(a/64/4)},programUniforms:[{type:12,data:l},...wt(n,t,r,i)]})}},uj=e=>{e.compute(pA(e.inputs))}}),cj,Gq=Ke(()=>{oq(),Cb(),iq(),aq(),lq(),uq(),cq(),mq(),_q(),yq(),vq(),wq(),bq(),xq(),Mq(),Tq(),Eq(),Pq(),Sq(),Cq(),kq(),$q(),Aq(),Iq(),Oq(),kN(),Dq(),Fq(),Rq(),Lq(),Nq(),Sb(),jq(),DN(),zq(),Bq(),Uq(),IN(),Vq(),ca(),kb(),Wq(),cj=new Map([["Abs",[n3]],["Acos",[s3]],["Acosh",[o3]],["Add",[j3]],["ArgMax",[ZL,Iw]],["ArgMin",[YL,Iw]],["Asin",[i3]],["Asinh",[a3]],["Atan",[l3]],["Atanh",[u3]],["Attention",[e3]],["AveragePool",[VN,UN]],["BatchNormalization",[t3]],["BiasAdd",[r3]],["BiasSplitGelu",[N3]],["Cast",[d3,c3]],["Ceil",[f3]],["Clip",[h3]],["Concat",[Q3,X3]],["Conv",[Nw,Lw]],["ConvTranspose",[iN,oN]],["Cos",[p3]],["Cosh",[m3]],["CumSum",[aN,lN]],["DepthToSpace",[uN,cN]],["DequantizeLinear",[XN,JN]],["Div",[z3]],["Einsum",[dN,hN]],["Elu",[g3,Hc]],["Equal",[B3]],["Erf",[_3]],["Exp",[y3]],["Expand",[fN]],["FastGelu",[pN]],["Floor",[v3]],["FusedConv",[Nw,Lw]],["Gather",[gN,mN]],["GatherElements",[xN,bN]],["GatherBlockQuantized",[vN,wN]],["GatherND",[_N,yN]],["Gelu",[w3]],["Gemm",[TN,MN]],["GlobalAveragePool",[GN,WN]],["GlobalMaxPool",[QN,qN]],["Greater",[G3]],["GreaterOrEqual",[K3]],["GridSample",[EN,PN]],["GroupQueryAttention",[FN]],["HardSigmoid",[C3,S3]],["InstanceNormalization",[RN]],["LayerNormalization",[LN]],["LeakyRelu",[b3,Hc]],["Less",[H3]],["LessOrEqual",[q3]],["Log",[R3]],["MatMul",[NN]],["MatMulNBits",[jN,zN]],["MaxPool",[HN,KN]],["Mul",[U3]],["MultiHeadAttention",[CN,SN]],["Neg",[M3]],["Not",[x3]],["Pad",[BN]],["Pow",[V3]],["QuickGelu",[L3,Hc]],["Range",[YN]],["Reciprocal",[T3]],["ReduceMin",[KL]],["ReduceMean",[UL]],["ReduceMax",[HL]],["ReduceSum",[QL]],["ReduceProd",[qL]],["ReduceL1",[VL]],["ReduceL2",[WL]],["ReduceLogSum",[JL]],["ReduceLogSumExp",[GL]],["ReduceSumSquare",[XL]],["Relu",[E3]],["Resize",[tj,rj]],["RotaryEmbedding",[ON]],["ScatterND",[ej,ZN]],["Sigmoid",[P3]],["Sin",[k3]],["Sinh",[$3]],["Slice",[sj,oj]],["SkipLayerNormalization",[nj]],["Split",[$N,AN]],["Sqrt",[A3]],["Softmax",[ij,aj]],["Sub",[W3]],["Tan",[I3]],["Tanh",[O3]],["ThresholdedRelu",[F3,Hc]],["Tile",[lj]],["Transpose",[$L,AL]],["Where",[uj]]])}),dj,Hq=Ke(()=>{So(),_i(),Nt(),dj=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,r,n,s){Po(e.programInfo.name);let o=this.backend.device,i=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let a=[];for(let u of t)a.push({binding:a.length,resource:{buffer:u.buffer}});for(let u of r)a.push({binding:a.length,resource:{buffer:u.buffer}});s&&a.push({binding:a.length,resource:s});let l=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:a,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let u={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:l,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(u)}i.setPipeline(e.computePipeline),i.setBindGroup(0,l),i.dispatchWorkgroups(...n),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Hs(e.programInfo.name)}dispose(){}build(e,t){Po(e.name);let r=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(u=>{r.features.has(u.feature)&&n.push(`enable ${u.extension};`)});let s=kL(t,this.backend.device.limits),o=e.getShaderSource(s),i=`${n.join(`
`)}
${s.additionalImplementations}
${o}`,a=r.createShaderModule({code:i,label:e.name});Xt("verbose",()=>`[WebGPU] ${e.name} shader code: ${i}`);let l=r.createComputePipeline({compute:{module:a,entryPoint:"main"},layout:"auto",label:e.name});return Hs(e.name),{programInfo:e,computePipeline:l,uniformVariablesInfo:s.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,r=typeof e=="number"?1:e.y||1,n=typeof e=="number"?1:e.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=s&&r<=s&&n<=s)return[t,r,n];let o=t*r*n,i=Math.ceil(Math.sqrt(o));if(i>s){if(i=Math.ceil(Math.cbrt(o)),i>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[i,i,i]}else return[i,i,1]}}}),hj={};Ku(hj,{WebGpuBackend:()=>fj});var mA,gA,_A,fj,Kq=Ke(()=>{So(),kt(),_i(),TL(),nq(),Gq(),Hq(),mA=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let r=[];for(let n=0;n<e.length;++n){let s=e[n].dataType;switch(t[n]){case"none":{r.push("");break}case"type":{r.push(`${s}`);break}case"rank":{let o=e[n].dims.length;r.push(`${s};${o}`);break}case"dims":{let o=e[n].dims.join(",");r.push(`${s};${o}`);break}default:throw new Error(`unsupported input dependency: ${t[n]}`)}}return r.join("|")},gA=(e,t,r)=>{var s,o;let n=e.name;return(s=e.shaderCache)!=null&&s.hint&&(n+="["+e.shaderCache.hint+"]"),n+=":"+r+`:${mA(t,((o=e.shaderCache)==null?void 0:o.inputDependencies)??new Array(t.length).fill("dims"))}`,n},_A=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},fj=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let r=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:r},s=o=>t.features.has(o)&&r.push(o)&&!0;s("chromium-experimental-timestamp-query-inside-passes")||s("timestamp-query"),s("shader-f16"),s("subgroups"),this.device=await t.requestDevice(n),this.adapterInfo=new _A(t.info||await t.requestAdapterInfo()),this.gpuDataManager=SL(this),this.programManager=new dj(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Mb(e.logLevel,!!e.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Po(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{var n;let t=new BigUint64Array(e.getMappedRange()),r=this.pendingQueries.get(e);for(let s=0;s<t.length/2;s++){let o=r[s],i=o.kernelId,a=this.kernels.get(i),l=a.kernelType,u=a.kernelName,h=o.programName,c=o.inputTensorViews,d=o.outputTensorViews,f=t[s*2],p=t[s*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=f);let m=Number(f-this.queryTimeBase),b=Number(p-this.queryTimeBase);if(!Number.isSafeInteger(m)||!Number.isSafeInteger(b))throw new RangeError("incorrect timestamp range");if((n=this.env.webgpu.profiling)!=null&&n.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:c.map(g=>({dims:g.dims,dataType:oi(g.dataType)})),outputsMetadata:d.map(g=>({dims:g.dims,dataType:oi(g.dataType)})),kernelId:i,kernelType:l,kernelName:u,programName:h,startTime:m,endTime:b});else{let g="";c.forEach((y,v)=>{g+=`input[${v}]: [${y.dims}] | ${oi(y.dataType)}, `});let _="";d.forEach((y,v)=>{_+=`output[${v}]: [${y.dims}] | ${oi(y.dataType)}, `}),console.log(`[profiling] kernel "${i}|${l}|${u}|${h}" ${g}${_}execution time: ${b-m} ns`)}Dd("GPU",`${h}::${f}::${p}`)}e.unmap(),this.pendingQueries.delete(e)}),Hs()}run(e,t,r,n,s,o){Po(e.name);let i=[];for(let _=0;_<t.length;++_){let y=t[_].data;if(y===0)continue;let v=this.gpuDataManager.get(y);if(!v)throw new Error(`no GPU data for input: ${y}`);i.push(v)}let{outputs:a,dispatchGroup:l,programUniforms:u}=e.getRunData(t),h=r.length===0?a.map((_,y)=>y):r;if(h.length!==a.length)throw new Error(`Output size ${h.length} must be equal to ${a.length}.`);let c=[],d=[];for(let _=0;_<a.length;++_){if(!Number.isInteger(h[_])||h[_]<-3||h[_]>=o)throw new Error(`Invalid output index: ${h[_]}`);if(h[_]===-3)continue;let y=h[_]===-1,v=h[_]===-2,M=y||v?s(a[_].dataType,a[_].dims):n(h[_],a[_].dataType,a[_].dims);if(c.push(M),M.data===0)continue;let E=this.gpuDataManager.get(M.data);if(!E)throw new Error(`no GPU data for output: ${M.data}`);if(y&&this.temporaryData.push(E),v){let T=this.kernelPersistentData.get(this.currentKernelId);T||(T=[],this.kernelPersistentData.set(this.currentKernelId,T)),T.push(E)}d.push(E)}if(i.length!==t.length||d.length!==c.length){if(d.length===0)return Hs(e.name),c;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let f;if(u){let _=0,y=[];u.forEach(T=>{let S=typeof T.data=="number"?[T.data]:T.data;if(S.length===0)return;let A=T.type===10?2:4,I,V;T.type===10?(V=S.length>4?16:S.length>2?8:S.length*A,I=S.length>4?16:A*S.length):(V=S.length<=2?S.length*A:16,I=16),_=Math.ceil(_/V)*V,y.push(_);let N=T.type===10?8:4;_+=S.length>4?Math.ceil(S.length/N)*I:S.length*A});let v=16;_=Math.ceil(_/v)*v;let M=new ArrayBuffer(_);u.forEach((T,S)=>{let A=y[S],I=typeof T.data=="number"?[T.data]:T.data;if(T.type===6)new Int32Array(M,A,I.length).set(I);else if(T.type===12)new Uint32Array(M,A,I.length).set(I);else if(T.type===10)new Uint16Array(M,A,I.length).set(I);else if(T.type===1)new Float32Array(M,A,I.length).set(I);else throw new Error(`Unsupported uniform type: ${oi(T.type)}`)});let E=this.gpuDataManager.create(_,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(E.buffer,0,M,0,_),this.gpuDataManager.release(E.id),f={offset:0,size:_,buffer:E.buffer}}let p=this.programManager.normalizeDispatchGroupSize(l),m=p[1]===1&&p[2]===1,b=gA(e,t,m),g=this.programManager.getArtifact(b);if(g||(g=this.programManager.build(e,p),this.programManager.setArtifact(b,g),Xt("info",()=>`[artifact] key: ${b}, programName: ${e.name}`)),u&&g.uniformVariablesInfo){if(u.length!==g.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${g.uniformVariablesInfo.length}, got ${u.length} in program "${g.programInfo.name}".`);for(let _=0;_<u.length;_++){let y=u[_],v=y.type,M=typeof y.data=="number"?1:y.data.length,[E,T]=g.uniformVariablesInfo[_];if(v!==E||M!==T)throw new Error(`Uniform variable ${_} mismatch: expect type ${E} with size ${T}, got type ${v} with size ${M} in program "${g.programInfo.name}".`)}}if(Xt("info",()=>`[ProgramManager] run "${e.name}" (key=${b}) with ${p[0]}x${p[1]}x${p[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let _={kernelId:this.currentKernelId,programName:g.programInfo.name,inputTensorViews:t,outputTensorViews:c};this.pendingKernels.push(_),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(_)}return this.programManager.run(g,i,d,p,f),Hs(e.name),c}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,r,n){let s=cj.get(e);if(!s)throw new Error(`kernel not implemented: ${e}`);let o={kernelType:e,kernelName:n,kernelEntry:s[0],attributes:[s[1],r]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let r of t)this.gpuDataManager.release(r.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,r){let n=this.kernels.get(e);if(!n)throw new Error(`kernel not created: ${e}`);let s=n.kernelType,o=n.kernelName,i=n.kernelEntry,a=n.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${o}" is not allowed to be called recursively`);this.currentKernelId=e,a[0]&&(a[1]=a[0](a[1]),a[0]=void 0),Xt("info",()=>`[WebGPU] Start to run kernel "[${s}] ${o}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),i(t,a[1]),0}catch(u){return r.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${o}" failed. ${u}`)),1}finally{l&&r.push(this.device.popErrorScope().then(u=>u?`GPU validation error for kernel "[${s}] ${o}": ${u.message}`:null));for(let u of this.temporaryData)this.gpuDataManager.release(u.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,r,n){let s=this.sessionExternalDataMapping.get(e);s||(s=new Map,this.sessionExternalDataMapping.set(e,s));let o=s.get(t),i=this.gpuDataManager.registerExternalBuffer(r,n,o);return s.set(t,[i,r]),i}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(r=>this.gpuDataManager.unregisterExternalBuffer(r[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,r){return async()=>{let n=await kw(this,e,t);return Tb(n.buffer,r)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",(((e=this.env.webgpu.profiling)==null?void 0:e.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Xt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Xt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Xt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),r=e.length;this.pendingKernels=[];for(let n=0;n<r;n++){let s=this.getComputePassEncoder(),o=e[n];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(o.computePipeline),s.setBindGroup(0,o.bindGroup),s.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),pj={};Ku(pj,{init:()=>mj});var Rf,yA,mj,qq=Ke(()=>{kt(),_i(),Lt(),rq(),Rf=class gj{constructor(t,r,n,s){this.module=t,this.dataType=r,this.data=n,this.dims=s}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=Ce.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=Ce.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=Ce.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=Ce.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(Ce.size(t)!==Ce.size(this.dims))throw new Error("Invalid new shape");return new gj(this.module,this.dataType,this.data,t)}},yA=class{constructor(e,t,r){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let n=e.PTR_SIZE,s=r/e.PTR_SIZE,o=n===4?"i32":"i64";this.opKernelContext=Number(e.getValue(n*s++,o));let i=Number(e.getValue(n*s++,o));this.outputCount=Number(e.getValue(n*s++,o)),this.customDataOffset=Number(e.getValue(n*s++,"*")),this.customDataSize=Number(e.getValue(n*s++,o));let a=[];for(let l=0;l<i;l++){let u=Number(e.getValue(n*s++,o)),h=Number(e.getValue(n*s++,"*")),c=Number(e.getValue(n*s++,o)),d=[];for(let f=0;f<c;f++)d.push(Number(e.getValue(n*s++,o)));a.push(new Rf(e,u,h,d))}this.inputs=a}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var i;let r=((i=t==null?void 0:t.inputs)==null?void 0:i.map(a=>typeof a=="number"?this.inputs[a]:a))??this.inputs,n=(t==null?void 0:t.outputs)??[],s=(a,l,u)=>new Rf(this.module,l,this.output(a,u),u),o=(a,l)=>{let u=Ua(a,l);if(!u)throw new Error(`Unsupported data type: ${a}`);let h=u>0?this.backend.gpuDataManager.create(u).id:0;return new Rf(this.module,a,h,l)};return this.backend.run(e,r,n,s,o,this.outputCount)}output(e,t){let r=this.module.stackSave();try{let n=this.module.PTR_SIZE,s=n===4?"i32":"i64",o=this.module.stackAlloc((1+t.length)*n);this.module.setValue(o,t.length,s);for(let i=0;i<t.length;i++)this.module.setValue(o+n*(i+1),t[i],s);return this.module._JsepOutput(this.opKernelContext,e,o)}catch(n){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${n}`)}finally{this.module.stackRestore(r)}}},mj=async(e,t,r,n)=>{let s=t.jsepInit;if(!s)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let o=(Kq(),Od(hj)).WebGpuBackend,i=new o;await i.initialize(r,n),s("webgpu",[i,a=>i.alloc(Number(a)),a=>i.free(a),(a,l,u,h=!1)=>{if(h)Xt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(a)}, dst=${Number(l)}, size=${Number(u)}`),i.memcpy(Number(a),Number(l));else{Xt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(a)}, gpuDataId=${Number(l)}, size=${Number(u)}`);let c=t.HEAPU8.subarray(Number(a>>>0),Number(a>>>0)+Number(u));i.upload(Number(l),c)}},async(a,l,u)=>{Xt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${a}, dataOffset=${l}, size=${u}`),await i.download(Number(a),()=>t.HEAPU8.subarray(Number(l)>>>0,Number(l+u)>>>0))},(a,l,u)=>i.createKernel(a,Number(l),u,t.UTF8ToString(t._JsepGetNodeName(Number(l)))),a=>i.releaseKernel(a),(a,l,u,h)=>{Xt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${a}, contextDataOffset=${l}`);let c=new yA(t,i,Number(l));return i.computeKernel(Number(a),c,h)},()=>i.captureBegin(),()=>i.captureEnd(),()=>i.replay()])}else{let o=new PL(r);s("webnn",[o,()=>o.reserveTensorId(),i=>o.releaseTensorId(i),async(i,a,l,u,h)=>o.ensureTensor(i,a,l,u,h),(i,a)=>{o.uploadTensor(i,a)},async(i,a)=>o.downloadTensor(i,a)])}}}),vA,Fb,Rb,ki,wA,Gy,Yp,Lb,Nb,Hy,jb,zb,Bb,_j=Ke(()=>{ZK(),eq(),kt(),pl(),yb(),wL(),vA=(e,t)=>{fr()._OrtInit(e,t)!==0&&lr("Can't initialize onnxruntime.")},Fb=async e=>{vA(e.wasm.numThreads,Kp(e.logLevel))},Rb=async(e,t)=>{var r,n;(n=(r=fr()).asyncInit)==null||n.call(r);{let s=(qq(),Od(pj)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let o=e.webgpu.adapter;if(o){if(typeof o.limits!="object"||typeof o.features!="object"||typeof o.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=e.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let a=e.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(o=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:a}),!o)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await s("webgpu",fr(),e,o)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await s("webnn",fr(),e)}}},ki=new Map,wA=e=>{let t=fr(),r=t.stackSave();try{let n=t.PTR_SIZE,s=t.stackAlloc(2*n);t._OrtGetInputOutputCount(e,s,s+n)!==0&&lr("Can't get session input/output count.");let o=n===4?"i32":"i64";return[Number(t.getValue(s,o)),Number(t.getValue(s+n,o))]}finally{t.stackRestore(r)}},Gy=(e,t)=>{let r=fr(),n=r.stackSave(),s=0;try{let o=r.PTR_SIZE,i=r.stackAlloc(2*o);r._OrtGetInputOutputMetadata(e,t,i,i+o)!==0&&lr("Can't get session input/output metadata.");let a=Number(r.getValue(i,"*"));s=Number(r.getValue(i+o,"*"));let l=r.HEAP32[s/4];if(l===0)return[a,0];let u=r.HEAPU32[s/4+1],h=[];for(let c=0;c<u;c++){let d=Number(r.getValue(s+8+c*o,"*"));h.push(d!==0?r.UTF8ToString(d):Number(r.getValue(s+8+(c+u)*o,"*")))}return[a,l,h]}finally{r.stackRestore(n),s!==0&&r._OrtFree(s)}},Yp=e=>{let t=fr(),r=t._malloc(e.byteLength);if(r===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},Lb=async(e,t)=>{var c,d,f,p;let r,n,s=fr();Array.isArray(e)?[r,n]=e:e.buffer===s.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=Yp(e);let o=0,i=0,a=0,l=[],u=[],h=[];try{if([i,l]=await vL(t),(t==null?void 0:t.externalData)&&s.mountExternalData){let S=[];for(let A of t.externalData){let I=typeof A=="string"?A:A.path;S.push(xb(typeof A=="string"?A:A.data).then(V=>{s.mountExternalData(I,V)}))}await Promise.all(S)}for(let S of(t==null?void 0:t.executionProviders)??[])if((typeof S=="string"?S:S.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof S!="string"){let A=S,I=A==null?void 0:A.context,V=A==null?void 0:A.gpuDevice,N=A==null?void 0:A.deviceType,z=A==null?void 0:A.powerPreference;I?s.currentContext=I:V?s.currentContext=await s.webnnCreateMLContext(V):s.currentContext=await s.webnnCreateMLContext({deviceType:N,powerPreference:z})}else s.currentContext=await s.webnnCreateMLContext();break}o=await s._OrtCreateSession(r,n,i),(c=s.webgpuOnCreateSession)==null||c.call(s,o),o===0&&lr("Can't create a session."),(d=s.jsepOnCreateSession)==null||d.call(s),s.currentContext&&(s.webnnRegisterMLContext(o,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[m,b]=wA(o),g=!!(t!=null&&t.enableGraphCapture),_=[],y=[],v=[],M=[],E=[];for(let S=0;S<m;S++){let[A,I,V]=Gy(o,S);A===0&&lr("Can't get an input name."),u.push(A);let N=s.UTF8ToString(A);_.push(N),v.push(I===0?{name:N,isTensor:!1}:{name:N,isTensor:!0,type:oi(I),shape:V})}for(let S=0;S<b;S++){let[A,I,V]=Gy(o,S+m);A===0&&lr("Can't get an output name."),h.push(A);let N=s.UTF8ToString(A);y.push(N),M.push(I===0?{name:N,isTensor:!1}:{name:N,isTensor:!0,type:oi(I),shape:V});{if(g&&(t==null?void 0:t.preferredOutputLocation)===void 0){E.push("gpu-buffer");continue}let z=typeof(t==null?void 0:t.preferredOutputLocation)=="string"?t.preferredOutputLocation:((f=t==null?void 0:t.preferredOutputLocation)==null?void 0:f[N])??"cpu";if(z!=="cpu"&&z!=="cpu-pinned"&&z!=="gpu-buffer"&&z!=="ml-tensor")throw new Error(`Not supported preferred output location: ${z}.`);if(g&&z!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${z}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);E.push(z)}}let T=null;return E.some(S=>S==="gpu-buffer"||S==="ml-tensor")&&(a=s._OrtCreateBinding(o),a===0&&lr("Can't create IO binding."),T={handle:a,outputPreferredLocations:E,outputPreferredLocationsEncoded:E.map(S=>Sw(S))}),ki.set(o,[o,u,h,T,g,!1]),[o,_,y,v,M]}catch(m){throw u.forEach(b=>s._OrtFree(b)),h.forEach(b=>s._OrtFree(b)),a!==0&&s._OrtReleaseBinding(a)!==0&&lr("Can't release IO binding."),o!==0&&s._OrtReleaseSession(o)!==0&&lr("Can't release session."),m}finally{s._free(r),i!==0&&s._OrtReleaseSessionOptions(i)!==0&&lr("Can't release session options."),l.forEach(m=>s._free(m)),(p=s.unmountExternalData)==null||p.call(s)}},Nb=e=>{var l,u,h;let t=fr(),r=ki.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,s,o,i,a]=r;i&&(a&&t._OrtClearBoundOutputs(i.handle)!==0&&lr("Can't clear bound outputs."),t._OrtReleaseBinding(i.handle)!==0&&lr("Can't release IO binding.")),(l=t.jsepOnReleaseSession)==null||l.call(t,e),(u=t.webnnOnReleaseSession)==null||u.call(t,e),(h=t.webgpuOnReleaseSession)==null||h.call(t,e),s.forEach(c=>t._OrtFree(c)),o.forEach(c=>t._OrtFree(c)),t._OrtReleaseSession(n)!==0&&lr("Can't release session."),ki.delete(e)},Hy=async(e,t,r,n,s,o,i=!1)=>{if(!e){t.push(0);return}let a=fr(),l=a.PTR_SIZE,u=e[0],h=e[1],c=e[3],d=c,f,p;if(u==="string"&&(c==="gpu-buffer"||c==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(i&&c!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(c==="gpu-buffer"){let g=e[2].gpuBuffer;p=Ua(Hl(u),h);{let _=a.jsepRegisterBuffer;if(!_)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');f=_(n,o,g,p)}}else if(c==="ml-tensor"){let g=e[2].mlTensor;p=Ua(Hl(u),h);let _=a.webnnRegisterMLTensor;if(!_)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');f=_(n,g,Hl(u),h)}else{let g=e[2];if(Array.isArray(g)){p=l*g.length,f=a._malloc(p),r.push(f);for(let _=0;_<g.length;_++){if(typeof g[_]!="string")throw new TypeError(`tensor data at index ${_} is not a string`);a.setValue(f+_*l,yo(g[_],r),"*")}}else{let _=a.webnnIsGraphInput;if(u!=="string"&&_){let y=a.UTF8ToString(s);if(_(n,y)){let v=Hl(u);p=Ua(v,h),d="ml-tensor";let M=a.webnnCreateTemporaryTensor,E=a.webnnUploadTensor;if(!M||!E)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let T=await M(n,v,h);E(T,new Uint8Array(g.buffer,g.byteOffset,g.byteLength)),f=T}else p=g.byteLength,f=a._malloc(p),r.push(f),a.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,p),f)}else p=g.byteLength,f=a._malloc(p),r.push(f),a.HEAPU8.set(new Uint8Array(g.buffer,g.byteOffset,p),f)}}let m=a.stackSave(),b=a.stackAlloc(4*h.length);try{h.forEach((_,y)=>a.setValue(b+y*l,_,l===4?"i32":"i64"));let g=a._OrtCreateTensor(Hl(u),f,p,b,h.length,Sw(d));g===0&&lr(`Can't create tensor for input/output. session=${n}, index=${o}.`),t.push(g)}finally{a.stackRestore(m)}},jb=async(e,t,r,n,s,o)=>{var V,N,z,q;let i=fr(),a=i.PTR_SIZE,l=ki.get(e);if(!l)throw new Error(`cannot run inference. invalid session id: ${e}`);let u=l[0],h=l[1],c=l[2],d=l[3],f=l[4],p=l[5],m=t.length,b=n.length,g=0,_=[],y=[],v=[],M=[],E=i.stackSave(),T=i.stackAlloc(m*a),S=i.stackAlloc(m*a),A=i.stackAlloc(b*a),I=i.stackAlloc(b*a);try{[g,_]=yL(o);for(let Y=0;Y<m;Y++)await Hy(r[Y],y,M,e,h[t[Y]],t[Y],f);for(let Y=0;Y<b;Y++)await Hy(s[Y],v,M,e,c[n[Y]],m+n[Y],f);for(let Y=0;Y<m;Y++)i.setValue(T+Y*a,y[Y],"*"),i.setValue(S+Y*a,h[t[Y]],"*");for(let Y=0;Y<b;Y++)i.setValue(A+Y*a,v[Y],"*"),i.setValue(I+Y*a,c[n[Y]],"*");if(d&&!p){let{handle:Y,outputPreferredLocations:W,outputPreferredLocationsEncoded:te}=d;if(h.length!==m)throw new Error(`input count from feeds (${m}) is expected to be always equal to model's input count (${h.length}).`);for(let le=0;le<m;le++){let oe=t[le];await i._OrtBindInput(Y,h[oe],y[le])!==0&&lr(`Can't bind input[${le}] for session=${e}.`)}for(let le=0;le<b;le++){let oe=n[le];(V=s[le])!=null&&V[3]?i._OrtBindOutput(Y,c[oe],v[le],0)!==0&&lr(`Can't bind pre-allocated output[${le}] for session=${e}.`):i._OrtBindOutput(Y,c[oe],0,te[oe])!==0&&lr(`Can't bind output[${le}] to ${W[le]} for session=${e}.`)}ki.set(e,[u,h,c,d,f,!0])}(N=i.jsepOnRunStart)==null||N.call(i,u),(z=i.webnnOnRunStart)==null||z.call(i,u);let G;d?G=await i._OrtRunWithBinding(u,d.handle,b,A,g):G=await i._OrtRun(u,S,T,m,I,b,A,g),G!==0&&lr("failed to call OrtRun().");let ee=[];for(let Y=0;Y<b;Y++){let W=Number(i.getValue(A+Y*a,"*"));if(W===v[Y]){ee.push(s[Y]);continue}let te=i.stackSave(),le=i.stackAlloc(4*a),oe=!1,U,R=0;try{i._OrtGetTensorData(W,le,le+a,le+2*a,le+3*a)!==0&&lr(`Can't access output tensor data on index ${Y}.`);let X=a===4?"i32":"i64",ce=Number(i.getValue(le,X));R=i.getValue(le+a,"*");let ne=i.getValue(le+a*2,"*"),we=Number(i.getValue(le+a*3,X)),De=[];for(let se=0;se<we;se++)De.push(Number(i.getValue(ne+se*a,X)));i._OrtFree(ne)!==0&&lr("Can't free memory for tensor dims.");let Be=De.reduce((se,F)=>se*F,1);U=oi(ce);let $e=d==null?void 0:d.outputPreferredLocations[n[Y]];if(U==="string"){if($e==="gpu-buffer"||$e==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let se=[];for(let F=0;F<Be;F++){let pe=i.getValue(R+F*a,"*"),Ee=i.getValue(R+(F+1)*a,"*"),Me=F===Be-1?void 0:Ee-pe;se.push(i.UTF8ToString(pe,Me))}ee.push([U,De,se,"cpu"])}else if($e==="gpu-buffer"&&Be>0){let se=i.jsepGetBuffer;if(!se)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let F=se(R),pe=Ua(ce,Be);if(pe===void 0||!wb(U))throw new Error(`Unsupported data type: ${U}`);oe=!0,ee.push([U,De,{gpuBuffer:F,download:i.jsepCreateDownloader(F,pe,U),dispose:()=>{i._OrtReleaseTensor(W)!==0&&lr("Can't release tensor.")}},"gpu-buffer"])}else if($e==="ml-tensor"&&Be>0){let se=i.webnnEnsureTensor,F=i.webnnIsInt64Supported;if(!se||!F)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(Ua(ce,Be)===void 0||!bb(U))throw new Error(`Unsupported data type: ${U}`);if(U==="int64"&&!F(e))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let pe=await se(e,R,ce,De,!1);oe=!0,ee.push([U,De,{mlTensor:pe,download:i.webnnCreateMLTensorDownloader(R,U),dispose:()=>{i.webnnReleaseTensorId(R),i._OrtReleaseTensor(W)}},"ml-tensor"])}else{let se=vb(U),F=new se(Be);new Uint8Array(F.buffer,F.byteOffset,F.byteLength).set(i.HEAPU8.subarray(R,R+F.byteLength)),ee.push([U,De,F,"cpu"])}}finally{i.stackRestore(te),U==="string"&&R&&i._free(R),oe||i._OrtReleaseTensor(W),(q=i.webnnOnRunEnd)==null||q.call(i,u)}}return d&&!f&&(i._OrtClearBoundOutputs(d.handle)!==0&&lr("Can't clear bound outputs."),ki.set(e,[u,h,c,d,f,!1])),ee}finally{i.stackRestore(E),y.forEach(G=>i._OrtReleaseTensor(G)),v.forEach(G=>i._OrtReleaseTensor(G)),M.forEach(G=>i._free(G)),g!==0&&i._OrtReleaseRunOptions(g),_.forEach(G=>i._free(G))}},zb=e=>{let t=fr(),r=ki.get(e);if(!r)throw new Error("invalid session id");let n=r[0],s=t._OrtEndProfiling(n);s===0&&lr("Can't get an profile file name."),t._OrtFree(s)},Bb=e=>{let t=[];for(let r of e){let n=r[2];!Array.isArray(n)&&"buffer"in n&&t.push(n.buffer)}return t}}),$i,ns,jl,Lc,Nc,Lf,Ky,Nf,Ia,Oa,bA,yj,vj,wj,bj,xj,Mj,Tj,Ej=Ke(()=>{So(),_j(),pl(),gb(),$i=()=>!!yr.wasm.proxy&&typeof document<"u",jl=!1,Lc=!1,Nc=!1,Nf=new Map,Ia=(e,t)=>{let r=Nf.get(e);r?r.push(t):Nf.set(e,[t])},Oa=()=>{if(jl||!Lc||Nc||!ns)throw new Error("worker not ready")},bA=e=>{switch(e.data.type){case"init-wasm":jl=!1,e.data.err?(Nc=!0,Ky[1](e.data.err)):(Lc=!0,Ky[0]()),Lf&&(URL.revokeObjectURL(Lf),Lf=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Nf.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},yj=async()=>{if(!Lc){if(jl)throw new Error("multiple calls to 'initWasm()' detected.");if(Nc)throw new Error("previous call to 'initWasm()' failed.");if(jl=!0,$i())return new Promise((e,t)=>{ns==null||ns.terminate(),gL().then(([r,n])=>{try{ns=n,ns.onerror=o=>t(o),ns.onmessage=bA,Ky=[e,t];let s={type:"init-wasm",in:yr};!s.in.wasm.wasmPaths&&(r||Pw)&&(s.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href}),ns.postMessage(s),Lf=r}catch(s){t(s)}},t)});try{await _b(yr.wasm),await Fb(yr),Lc=!0}catch(e){throw Nc=!0,e}finally{jl=!1}}},vj=async e=>{if($i())return Oa(),new Promise((t,r)=>{Ia("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:yr}};ns.postMessage(n)});await Rb(yr,e)},wj=async e=>$i()?(Oa(),new Promise((t,r)=>{Ia("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};ns.postMessage(n,[e.buffer])})):Yp(e),bj=async(e,t)=>{if($i()){if(t!=null&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Oa(),new Promise((r,n)=>{Ia("create",[r,n]);let s={type:"create",in:{model:e,options:{...t}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),ns.postMessage(s,o)})}else return Lb(e,t)},xj=async e=>{if($i())return Oa(),new Promise((t,r)=>{Ia("release",[t,r]);let n={type:"release",in:e};ns.postMessage(n)});Nb(e)},Mj=async(e,t,r,n,s,o)=>{if($i()){if(r.some(i=>i[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(i=>i))throw new Error("pre-allocated output tensor is not supported for proxy.");return Oa(),new Promise((i,a)=>{Ia("run",[i,a]);let l=r,u={type:"run",in:{sessionId:e,inputIndices:t,inputs:l,outputIndices:n,options:o}};ns.postMessage(u,Bb(l))})}else return jb(e,t,r,n,s,o)},Tj=async e=>{if($i())return Oa(),new Promise((t,r)=>{Ia("end-profiling",[t,r]);let n={type:"end-profiling",in:e};ns.postMessage(n)});zb(e)}}),qy,xA,Pj,Qq=Ke(()=>{So(),Ej(),kt(),mb(),wL(),qy=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},xA=e=>{switch(e[3]){case"cpu":return new vo(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!wb(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:s}=e[2];return vo.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:s})}case"ml-tensor":{let t=e[0];if(!bb(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:s}=e[2];return vo.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:s})}default:throw new Error(`invalid data location: ${e[3]}`)}},Pj=class{async fetchModelAndCopyToWasmMemory(e){return wj(await xb(e))}async loadModel(e,t){Po();let r;typeof e=="string"?r=await this.fetchModelAndCopyToWasmMemory(e):r=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await bj(r,t),Hs()}async dispose(){return xj(this.sessionId)}async run(e,t,r){Po();let n=[],s=[];Object.entries(e).forEach(c=>{let d=c[0],f=c[1],p=this.inputNames.indexOf(d);if(p===-1)throw new Error(`invalid input '${d}'`);n.push(f),s.push(p)});let o=[],i=[];Object.entries(t).forEach(c=>{let d=c[0],f=c[1],p=this.outputNames.indexOf(d);if(p===-1)throw new Error(`invalid output '${d}'`);o.push(f),i.push(p)});let a=n.map((c,d)=>qy(c,()=>`input "${this.inputNames[s[d]]}"`)),l=o.map((c,d)=>c?qy(c,()=>`output "${this.outputNames[i[d]]}"`):null),u=await Mj(this.sessionId,s,a,i,l,r),h={};for(let c=0;c<u.length;c++)h[this.outputNames[i[c]]]=o[c]??xA(u[c]);return Hs(),h}startProfiling(){}endProfiling(){Tj(this.sessionId)}}}),Sj={};Ku(Sj,{OnnxruntimeWebAssemblyBackend:()=>Bw,initializeFlags:()=>zw,wasmBackend:()=>Cj});var zw,Bw,Cj,Xq=Ke(()=>{So(),Ej(),Qq(),zw=()=>{(typeof yr.wasm.initTimeout!="number"||yr.wasm.initTimeout<0)&&(yr.wasm.initTimeout=0);let e=yr.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),yr.wasm.simd=!1),typeof yr.wasm.proxy!="boolean"&&(yr.wasm.proxy=!1),typeof yr.wasm.trace!="boolean"&&(yr.wasm.trace=!1),typeof yr.wasm.numThreads!="number"||!Number.isInteger(yr.wasm.numThreads)||yr.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)yr.wasm.numThreads=1;else{let t=typeof navigator>"u"?RK("node:os").cpus().length:navigator.hardwareConcurrency;yr.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},Bw=class{async init(e){zw(),await yj(),await vj(e)}async createInferenceSessionHandler(e,t){let r=new Pj;return await r.loadModel(e,t),r}},Cj=new Bw});So();So();So();var Jq="1.22.0-dev.20250409-89f8206ba4",Yq=cL;{let e=(Xq(),Od(Sj)).wasmBackend;Ka("webgpu",e,5),Ka("webnn",e,5),Ka("cpu",e,10),Ka("wasm",e,10)}Object.defineProperty(yr.versions,"web",{value:Jq,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zq=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return pb},get TRACE(){return Dd},get TRACE_FUNC_BEGIN(){return Po},get TRACE_FUNC_END(){return Hs},get Tensor(){return vo},default:Yq,get env(){return yr},get registerBackend(){return Ka}},Symbol.toStringTag,{value:"Module"}));var Zo={},e9={"onnxruntime-common":e=>{e.exports=IK},"onnxruntime-web":e=>{e.exports=Zq},"?2ce3":()=>{},"?7992":()=>{},"?5af5":()=>{},"?2b25":()=>{},"?db59":()=>{},"?383f":()=>{},"?fa4b":()=>{},"./node_modules/@huggingface/jinja/dist/index.js":(e,t,r)=>{r.r(t),r.d(t,{Environment:()=>Ne,Interpreter:()=>Mt,Template:()=>Wt,parse:()=>ne,tokenize:()=>h});var n=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),s=class{constructor($,re){this.value=$,this.type=re}};function o($){return/\w/.test($)}function i($){return/[0-9]/.test($)}var a=[["{%",n.OpenStatement],["%}",n.CloseStatement],["{{",n.OpenExpression],["}}",n.CloseExpression],["(",n.OpenParen],[")",n.CloseParen],["{",n.OpenCurlyBracket],["}",n.CloseCurlyBracket],["[",n.OpenSquareBracket],["]",n.CloseSquareBracket],[",",n.Comma],[".",n.Dot],[":",n.Colon],["|",n.Pipe],["<=",n.ComparisonBinaryOperator],[">=",n.ComparisonBinaryOperator],["==",n.ComparisonBinaryOperator],["!=",n.ComparisonBinaryOperator],["<",n.ComparisonBinaryOperator],[">",n.ComparisonBinaryOperator],["+",n.AdditiveBinaryOperator],["-",n.AdditiveBinaryOperator],["~",n.AdditiveBinaryOperator],["*",n.MultiplicativeBinaryOperator],["/",n.MultiplicativeBinaryOperator],["%",n.MultiplicativeBinaryOperator],["=",n.Equals]],l=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function u($,re={}){return $.endsWith(`
`)&&($=$.slice(0,-1)),re.lstrip_blocks&&($=$.replace(/^[ \t]*({[#%-])/gm,"$1")),re.trim_blocks&&($=$.replace(/([#%-]})\n/g,"$1")),$.replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{").replace(/-#}\s*/g,"#}").replace(/\s*{#-/g,"{#").replace(/{%\s*(end)?generation\s*%}/gs,"")}function h($,re={}){var dt,Ct;const B=[],Z=u($,re);let ue=0,xe=0;const Re=Tt=>{let Ot="";for(;Tt(Z[ue]);){if(Z[ue]==="\\"){if(++ue,ue>=Z.length)throw new SyntaxError("Unexpected end of input");const lt=Z[ue++],Kt=l.get(lt);if(Kt===void 0)throw new SyntaxError(`Unexpected escaped character: ${lt}`);Ot+=Kt;continue}if(Ot+=Z[ue++],ue>=Z.length)throw new SyntaxError("Unexpected end of input")}return Ot};e:for(;ue<Z.length;){const Tt=(dt=B.at(-1))==null?void 0:dt.type;if(Tt===void 0||Tt===n.CloseStatement||Tt===n.CloseExpression||Tt===n.Comment){let lt="";for(;ue<Z.length&&!(Z[ue]==="{"&&(Z[ue+1]==="%"||Z[ue+1]==="{"||Z[ue+1]==="#"));)lt+=Z[ue++];if(lt.length>0){B.push(new s(lt,n.Text));continue}}if(Z[ue]==="{"&&Z[ue+1]==="#"){ue+=2;let lt="";for(;Z[ue]!=="#"||Z[ue+1]!=="}";){if(ue+2>=Z.length)throw new SyntaxError("Missing end of comment tag");lt+=Z[ue++]}B.push(new s(lt,n.Comment)),ue+=2;continue}Re(lt=>/\s/.test(lt));const Ot=Z[ue];if(Ot==="-"||Ot==="+"){const lt=(Ct=B.at(-1))==null?void 0:Ct.type;if(lt===n.Text||lt===void 0)throw new SyntaxError(`Unexpected character: ${Ot}`);switch(lt){case n.Identifier:case n.NumericLiteral:case n.StringLiteral:case n.CloseParen:case n.CloseSquareBracket:break;default:{++ue;const Kt=Re(i);B.push(new s(`${Ot}${Kt}`,Kt.length>0?n.NumericLiteral:n.UnaryOperator));continue}}}for(const[lt,Kt]of a){if(lt==="}}"&&xe>0)continue;if(Z.slice(ue,ue+lt.length)===lt){B.push(new s(lt,Kt)),Kt===n.OpenExpression?xe=0:Kt===n.OpenCurlyBracket?++xe:Kt===n.CloseCurlyBracket&&--xe,ue+=lt.length;continue e}}if(Ot==="'"||Ot==='"'){++ue;const lt=Re(Kt=>Kt!==Ot);B.push(new s(lt,n.StringLiteral)),++ue;continue}if(i(Ot)){let lt=Re(i);if(Z[ue]==="."&&i(Z[ue+1])){++ue;const Kt=Re(i);lt=`${lt}.${Kt}`}B.push(new s(lt,n.NumericLiteral));continue}if(o(Ot)){const lt=Re(o);B.push(new s(lt,n.Identifier));continue}throw new SyntaxError(`Unexpected character: ${Ot}`)}return B}var c=class{constructor(){ae(this,"type","Statement")}},d=class extends c{constructor(re){super();ae(this,"type","Program");this.body=re}},f=class extends c{constructor(re,B,Z){super();ae(this,"type","If");this.test=re,this.body=B,this.alternate=Z}},p=class extends c{constructor(re,B,Z,ue){super();ae(this,"type","For");this.loopvar=re,this.iterable=B,this.body=Z,this.defaultBlock=ue}},m=class extends c{constructor(){super(...arguments);ae(this,"type","Break")}},b=class extends c{constructor(){super(...arguments);ae(this,"type","Continue")}},g=class extends c{constructor(re,B,Z){super();ae(this,"type","Set");this.assignee=re,this.value=B,this.body=Z}},_=class extends c{constructor(re,B,Z){super();ae(this,"type","Macro");this.name=re,this.args=B,this.body=Z}},y=class extends c{constructor(re){super();ae(this,"type","Comment");this.value=re}},v=class extends c{constructor(){super(...arguments);ae(this,"type","Expression")}},M=class extends v{constructor(re,B,Z){super();ae(this,"type","MemberExpression");this.object=re,this.property=B,this.computed=Z}},E=class extends v{constructor(re,B){super();ae(this,"type","CallExpression");this.callee=re,this.args=B}},T=class extends v{constructor(re){super();ae(this,"type","Identifier");this.value=re}},S=class extends v{constructor(re){super();ae(this,"type","Literal");this.value=re}},A=class extends S{constructor(){super(...arguments);ae(this,"type","IntegerLiteral")}},I=class extends S{constructor(){super(...arguments);ae(this,"type","FloatLiteral")}},V=class extends S{constructor(){super(...arguments);ae(this,"type","StringLiteral")}},N=class extends S{constructor(){super(...arguments);ae(this,"type","ArrayLiteral")}},z=class extends S{constructor(){super(...arguments);ae(this,"type","TupleLiteral")}},q=class extends S{constructor(){super(...arguments);ae(this,"type","ObjectLiteral")}},G=class extends v{constructor(re,B,Z){super();ae(this,"type","BinaryExpression");this.operator=re,this.left=B,this.right=Z}},ee=class extends v{constructor(re,B){super();ae(this,"type","FilterExpression");this.operand=re,this.filter=B}},Y=class extends c{constructor(re,B){super();ae(this,"type","FilterStatement");this.filter=re,this.body=B}},W=class extends v{constructor(re,B){super();ae(this,"type","SelectExpression");this.lhs=re,this.test=B}},te=class extends v{constructor(re,B,Z){super();ae(this,"type","TestExpression");this.operand=re,this.negate=B,this.test=Z}},le=class extends v{constructor(re,B){super();ae(this,"type","UnaryExpression");this.operator=re,this.argument=B}},oe=class extends v{constructor(re=void 0,B=void 0,Z=void 0){super();ae(this,"type","SliceExpression");this.start=re,this.stop=B,this.step=Z}},U=class extends v{constructor(re,B){super();ae(this,"type","KeywordArgumentExpression");this.key=re,this.value=B}},R=class extends v{constructor(re){super();ae(this,"type","SpreadExpression");this.argument=re}},X=class extends c{constructor(re,B,Z){super();ae(this,"type","CallStatement");this.call=re,this.callerArgs=B,this.body=Z}},ce=class extends v{constructor(re,B,Z){super();ae(this,"type","Ternary");this.condition=re,this.trueExpr=B,this.falseExpr=Z}};function ne($){const re=new d([]);let B=0;function Z(Ve,We){const ut=$[B++];if(!ut||ut.type!==Ve)throw new Error(`Parser Error: ${We}. ${ut.type} !== ${Ve}.`);return ut}function ue(Ve){if(!Ct(Ve))throw new SyntaxError(`Expected ${Ve}`);++B}function xe(){switch($[B].type){case n.Comment:return new y($[B++].value);case n.Text:return Tt();case n.OpenStatement:return Ot();case n.OpenExpression:return lt();default:throw new SyntaxError(`Unexpected token type: ${$[B].type}`)}}function Re(...Ve){return B+Ve.length<=$.length&&Ve.every((We,ut)=>We===$[B+ut].type)}function dt(...Ve){var We,ut,cr;return((We=$[B])==null?void 0:We.type)===n.OpenStatement&&((ut=$[B+1])==null?void 0:ut.type)===n.Identifier&&Ve.includes((cr=$[B+1])==null?void 0:cr.value)}function Ct(...Ve){return B+Ve.length<=$.length&&Ve.every((We,ut)=>$[B+ut].type==="Identifier"&&We===$[B+ut].value)}function Tt(){return new V(Z(n.Text,"Expected text token").value)}function Ot(){if(Z(n.OpenStatement,"Expected opening statement token"),$[B].type!==n.Identifier)throw new SyntaxError(`Unknown statement, got ${$[B].type}`);const Ve=$[B].value;let We;switch(Ve){case"set":++B,We=Kt();break;case"if":++B,We=ur(),Z(n.OpenStatement,"Expected {% token"),ue("endif"),Z(n.CloseStatement,"Expected %} token");break;case"macro":++B,We=In(),Z(n.OpenStatement,"Expected {% token"),ue("endmacro"),Z(n.CloseStatement,"Expected %} token");break;case"for":++B,We=Lr(),Z(n.OpenStatement,"Expected {% token"),ue("endfor"),Z(n.CloseStatement,"Expected %} token");break;case"call":{++B;let ut=null;Re(n.OpenParen)&&(ut=rs());const cr=On();if(cr.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const qo=rs();Z(n.CloseStatement,"Expected closing statement token");const Js=[];for(;!dt("endcall");)Js.push(xe());Z(n.OpenStatement,"Expected '{%'"),ue("endcall"),Z(n.CloseStatement,"Expected closing statement token");const ds=new E(cr,qo);We=new X(ds,ut,Js);break}case"break":++B,Z(n.CloseStatement,"Expected closing statement token"),We=new m;break;case"continue":++B,Z(n.CloseStatement,"Expected closing statement token"),We=new b;break;case"filter":{++B;let ut=On();ut instanceof T&&Re(n.OpenParen)&&(ut=As(ut)),Z(n.CloseStatement,"Expected closing statement token");const cr=[];for(;!dt("endfilter");)cr.push(xe());Z(n.OpenStatement,"Expected '{%'"),ue("endfilter"),Z(n.CloseStatement,"Expected '%}'"),We=new Y(ut,cr);break}default:throw new SyntaxError(`Unknown statement type: ${Ve}`)}return We}function lt(){Z(n.OpenExpression,"Expected opening expression token");const Ve=Zr();return Z(n.CloseExpression,"Expected closing expression token"),Ve}function Kt(){const Ve=Vn();let We=null;const ut=[];if(Re(n.Equals))++B,We=Vn();else{for(Z(n.CloseStatement,"Expected %} token");!dt("endset");)ut.push(xe());Z(n.OpenStatement,"Expected {% token"),ue("endset")}return Z(n.CloseStatement,"Expected closing statement token"),new g(Ve,We,ut)}function ur(){const Ve=Zr();Z(n.CloseStatement,"Expected closing statement token");const We=[],ut=[];for(;!dt("elif","else","endif");)We.push(xe());if(dt("elif")){++B,++B;const cr=ur();ut.push(cr)}else if(dt("else"))for(++B,++B,Z(n.CloseStatement,"Expected closing statement token");!dt("endif");)ut.push(xe());return new f(Ve,We,ut)}function In(){const Ve=On();if(Ve.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const We=rs();Z(n.CloseStatement,"Expected closing statement token");const ut=[];for(;!dt("endmacro");)ut.push(xe());return new _(Ve,We,ut)}function Vn(Ve=!1){const We=Ve?On:Zr,ut=[We()],cr=Re(n.Comma);for(;cr&&(++B,ut.push(We()),!!Re(n.Comma)););return cr?new z(ut):ut[0]}function Lr(){const Ve=Vn(!0);if(!(Ve instanceof T||Ve instanceof z))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Ve.type} instead`);if(!Ct("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++B;const We=Zr();Z(n.CloseStatement,"Expected closing statement token");const ut=[];for(;!dt("endfor","else");)ut.push(xe());const cr=[];if(dt("else"))for(++B,++B,Z(n.CloseStatement,"Expected closing statement token");!dt("endfor");)cr.push(xe());return new p(Ve,We,ut,cr)}function Zr(){return Nr()}function Nr(){const Ve=ks();if(Ct("if")){++B;const We=ks();if(Ct("else")){++B;const ut=Nr();return new ce(We,Ve,ut)}else return new W(Ve,We)}return Ve}function ks(){let Ve=$s();for(;Ct("or");){const We=$[B];++B;const ut=$s();Ve=new G(We,Ve,ut)}return Ve}function $s(){let Ve=fn();for(;Ct("and");){const We=$[B];++B;const ut=fn();Ve=new G(We,Ve,ut)}return Ve}function fn(){let Ve;for(;Ct("not");){const We=$[B];++B;const ut=fn();Ve=new le(We,ut)}return Ve??$o()}function $o(){let Ve=Ao();for(;;){let We;if(Ct("not","in"))We=new s("not in",n.Identifier),B+=2;else if(Ct("in"))We=$[B++];else if(Re(n.ComparisonBinaryOperator))We=$[B++];else break;const ut=Ao();Ve=new G(We,Ve,ut)}return Ve}function Ao(){let Ve=$r();for(;Re(n.AdditiveBinaryOperator);){const We=$[B];++B;const ut=$r();Ve=new G(We,Ve,ut)}return Ve}function rn(){const Ve=qr(On());return Re(n.OpenParen)?As(Ve):Ve}function As(Ve){let We=new E(Ve,rs());return We=qr(We),Re(n.OpenParen)&&(We=As(We)),We}function rs(){Z(n.OpenParen,"Expected opening parenthesis for arguments list");const Ve=Pn();return Z(n.CloseParen,"Expected closing parenthesis for arguments list"),Ve}function Pn(){const Ve=[];for(;!Re(n.CloseParen);){let We;if($[B].type===n.MultiplicativeBinaryOperator&&$[B].value==="*"){++B;const ut=Zr();We=new R(ut)}else if(We=Zr(),Re(n.Equals)){if(++B,!(We instanceof T))throw new SyntaxError("Expected identifier for keyword argument");const ut=Zr();We=new U(We,ut)}Ve.push(We),Re(n.Comma)&&++B}return Ve}function Is(){const Ve=[];let We=!1;for(;!Re(n.CloseSquareBracket);)Re(n.Colon)?(Ve.push(void 0),++B,We=!0):(Ve.push(Zr()),Re(n.Colon)&&(++B,We=!0));if(Ve.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(We){if(Ve.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new oe(...Ve)}return Ve[0]}function qr(Ve){for(;Re(n.Dot)||Re(n.OpenSquareBracket);){const We=$[B];++B;let ut;const cr=We.type===n.OpenSquareBracket;if(cr)ut=Is(),Z(n.CloseSquareBracket,"Expected closing square bracket");else if(ut=On(),ut.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Ve=new M(Ve,ut,cr)}return Ve}function $r(){let Ve=Os();for(;Re(n.MultiplicativeBinaryOperator);){const We=$[B++],ut=Os();Ve=new G(We,Ve,ut)}return Ve}function Os(){let Ve=Ko();for(;Ct("is");){++B;const We=Ct("not");We&&++B;const ut=On();if(!(ut instanceof T))throw new SyntaxError("Expected identifier for the test");Ve=new te(Ve,We,ut)}return Ve}function Ko(){let Ve=rn();for(;Re(n.Pipe);){++B;let We=On();if(!(We instanceof T))throw new SyntaxError("Expected identifier for the filter");Re(n.OpenParen)&&(We=As(We)),Ve=new ee(Ve,We)}return Ve}function On(){const Ve=$[B++];switch(Ve.type){case n.NumericLiteral:{const We=Ve.value;return We.includes(".")?new I(Number(We)):new A(Number(We))}case n.StringLiteral:{let We=Ve.value;for(;Re(n.StringLiteral);)We+=$[B++].value;return new V(We)}case n.Identifier:return new T(Ve.value);case n.OpenParen:{const We=Vn();return Z(n.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),We}case n.OpenSquareBracket:{const We=[];for(;!Re(n.CloseSquareBracket);)We.push(Zr()),Re(n.Comma)&&++B;return++B,new N(We)}case n.OpenCurlyBracket:{const We=new Map;for(;!Re(n.CloseCurlyBracket);){const ut=Zr();Z(n.Colon,"Expected colon between key and value in object literal");const cr=Zr();We.set(ut,cr),Re(n.Comma)&&++B}return++B,new q(We)}default:throw new SyntaxError(`Unexpected token: ${Ve.type}`)}}for(;B<$.length;)re.body.push(xe());return re}function we($,re,B=1){re===void 0&&(re=$,$=0);const Z=[];for(let ue=$;ue<re;ue+=B)Z.push(ue);return Z}function De($,re,B,Z=1){const ue=Math.sign(Z);ue>=0?(re=(re??(re=0))<0?Math.max($.length+re,0):Math.min(re,$.length),B=(B??(B=$.length))<0?Math.max($.length+B,0):Math.min(B,$.length)):(re=(re??(re=$.length-1))<0?Math.max($.length+re,-1):Math.min(re,$.length-1),B=(B??(B=-1))<-1?Math.max($.length+B,-1):Math.min(B,$.length-1));const xe=[];for(let Re=re;ue*Re<ue*B;Re+=Z)xe.push($[Re]);return xe}function Be($){return $.replace(/\b\w/g,re=>re.toUpperCase())}function $e($){return se(new Date,$)}function se($,re){const B=new Intl.DateTimeFormat(void 0,{month:"long"}),Z=new Intl.DateTimeFormat(void 0,{month:"short"}),ue=xe=>xe<10?"0"+xe:xe.toString();return re.replace(/%[YmdbBHM%]/g,xe=>{switch(xe){case"%Y":return $.getFullYear().toString();case"%m":return ue($.getMonth()+1);case"%d":return ue($.getDate());case"%b":return Z.format($);case"%B":return B.format($);case"%H":return ue($.getHours());case"%M":return ue($.getMinutes());case"%%":return"%";default:return xe}})}function F($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pe($,re,B,Z){if(Z===0)return $;let ue=Z==null||Z<0?1/0:Z;const xe=re.length===0?new RegExp("(?=)","gu"):new RegExp(F(re),"gu");return $.replaceAll(xe,Re=>ue>0?(--ue,B):Re)}var Ee=class extends Error{},Me=class extends Error{},Pe=class{constructor($=void 0){ae(this,"type","RuntimeValue");ae(this,"value");ae(this,"builtins",new Map);this.value=$}__bool__(){return new Oe(!!this.value)}toString(){return String(this.value)}},ye=class extends Pe{constructor(){super(...arguments);ae(this,"type","IntegerValue")}},ke=class extends Pe{constructor(){super(...arguments);ae(this,"type","FloatValue")}toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},be=class extends Pe{constructor(){super(...arguments);ae(this,"type","StringValue");ae(this,"builtins",new Map([["upper",new Ze(()=>new be(this.value.toUpperCase()))],["lower",new Ze(()=>new be(this.value.toLowerCase()))],["strip",new Ze(()=>new be(this.value.trim()))],["title",new Ze(()=>new be(Be(this.value)))],["capitalize",new Ze(()=>new be(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new ye(this.value.length)],["rstrip",new Ze(()=>new be(this.value.trimEnd()))],["lstrip",new Ze(()=>new be(this.value.trimStart()))],["startswith",new Ze(re=>{if(re.length===0)throw new Error("startswith() requires at least one argument");const B=re[0];if(B instanceof be)return new Oe(this.value.startsWith(B.value));if(B instanceof Te){for(const Z of B.value){if(!(Z instanceof be))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(Z.value))return new Oe(!0)}return new Oe(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new Ze(re=>{if(re.length===0)throw new Error("endswith() requires at least one argument");const B=re[0];if(B instanceof be)return new Oe(this.value.endsWith(B.value));if(B instanceof Te){for(const Z of B.value){if(!(Z instanceof be))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(Z.value))return new Oe(!0)}return new Oe(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new Ze(re=>{const B=re[0]??new it;if(!(B instanceof be||B instanceof it))throw new Error("sep argument must be a string or null");const Z=re[1]??new ye(-1);if(!(Z instanceof ye))throw new Error("maxsplit argument must be a number");let ue=[];if(B instanceof it){const xe=this.value.trimStart();for(const{0:Re,index:dt}of xe.matchAll(/\S+/g)){if(Z.value!==-1&&ue.length>=Z.value&&dt!==void 0){ue.push(Re+xe.slice(dt+Re.length));break}ue.push(Re)}}else{if(B.value==="")throw new Error("empty separator");ue=this.value.split(B.value),Z.value!==-1&&ue.length>Z.value&&ue.push(ue.splice(Z.value).join(B.value))}return new Te(ue.map(xe=>new be(xe)))})],["replace",new Ze(re=>{if(re.length<2)throw new Error("replace() requires at least two arguments");const B=re[0],Z=re[1];if(!(B instanceof be&&Z instanceof be))throw new Error("replace() arguments must be strings");let ue;if(re.length>2?re[2].type==="KeywordArgumentsValue"?ue=re[2].value.get("count")??new it:ue=re[2]:ue=new it,!(ue instanceof ye||ue instanceof it))throw new Error("replace() count argument must be a number or null");return new be(pe(this.value,B.value,Z.value,ue.value))})]]))}},Oe=class extends Pe{constructor(){super(...arguments);ae(this,"type","BooleanValue")}},je=class extends Pe{constructor(){super(...arguments);ae(this,"type","ObjectValue");ae(this,"builtins",new Map([["get",new Ze(([re,B])=>{if(!(re instanceof be))throw new Error(`Object key must be a string: got ${re.type}`);return this.value.get(re.value)??B??new it})],["items",new Ze(()=>this.items())],["keys",new Ze(()=>this.keys())],["values",new Ze(()=>this.values())]]))}__bool__(){return new Oe(this.value.size>0)}items(){return new Te(Array.from(this.value.entries()).map(([re,B])=>new Te([new be(re),B])))}keys(){return new Te(Array.from(this.value.keys()).map(re=>new be(re)))}values(){return new Te(Array.from(this.value.values()))}},Je=class extends je{constructor(){super(...arguments);ae(this,"type","KeywordArgumentsValue")}},Te=class extends Pe{constructor(){super(...arguments);ae(this,"type","ArrayValue");ae(this,"builtins",new Map([["length",new ye(this.value.length)]]))}__bool__(){return new Oe(this.value.length>0)}},ot=class extends Te{constructor(){super(...arguments);ae(this,"type","TupleValue")}},Ze=class extends Pe{constructor(){super(...arguments);ae(this,"type","FunctionValue")}},it=class extends Pe{constructor(){super(...arguments);ae(this,"type","NullValue")}},nt=class extends Pe{constructor(){super(...arguments);ae(this,"type","UndefinedValue")}},Ne=class{constructor($){ae(this,"variables",new Map([["namespace",new Ze($=>{if($.length===0)return new je(new Map);if($.length!==1||!($[0]instanceof je))throw new Error("`namespace` expects either zero arguments or a single object argument");return $[0]})]]));ae(this,"tests",new Map([["boolean",$=>$.type==="BooleanValue"],["callable",$=>$ instanceof Ze],["odd",$=>{if(!($ instanceof ye))throw new Error(`cannot odd on ${$.type}`);return $.value%2!==0}],["even",$=>{if(!($ instanceof ye))throw new Error(`cannot even on ${$.type}`);return $.value%2===0}],["false",$=>$.type==="BooleanValue"&&!$.value],["true",$=>$.type==="BooleanValue"&&$.value],["none",$=>$.type==="NullValue"],["string",$=>$.type==="StringValue"],["number",$=>$ instanceof ye||$ instanceof ke],["integer",$=>$ instanceof ye],["iterable",$=>$.type==="ArrayValue"||$.type==="StringValue"],["mapping",$=>$.type==="ObjectValue"],["lower",$=>{const re=$.value;return $.type==="StringValue"&&re===re.toLowerCase()}],["upper",$=>{const re=$.value;return $.type==="StringValue"&&re===re.toUpperCase()}],["none",$=>$.type==="NullValue"],["defined",$=>$.type!=="UndefinedValue"],["undefined",$=>$.type==="UndefinedValue"],["equalto",($,re)=>$.value===re.value],["eq",($,re)=>$.value===re.value]]));this.parent=$}set($,re){return this.declareVariable($,bt(re))}declareVariable($,re){if(this.variables.has($))throw new SyntaxError(`Variable already declared: ${$}`);return this.variables.set($,re),re}setVariable($,re){return this.variables.set($,re),re}resolve($){if(this.variables.has($))return this;if(this.parent)return this.parent.resolve($);throw new Error(`Unknown variable: ${$}`)}lookupVariable($){try{return this.resolve($).variables.get($)??new nt}catch{return new nt}}};function qe($){$.set("false",!1),$.set("true",!0),$.set("none",null),$.set("raise_exception",re=>{throw new Error(re)}),$.set("range",we),$.set("strftime_now",$e),$.set("True",!0),$.set("False",!1),$.set("None",null)}var Mt=class{constructor($){ae(this,"global");this.global=$??new Ne}run($){return this.evaluate($,this.global)}evaluateBinaryExpression($,re){const B=this.evaluate($.left,re);switch($.operator.value){case"and":return B.__bool__().value?this.evaluate($.right,re):B;case"or":return B.__bool__().value?B:this.evaluate($.right,re)}const Z=this.evaluate($.right,re);switch($.operator.value){case"==":return new Oe(B.value==Z.value);case"!=":return new Oe(B.value!=Z.value)}if(B instanceof nt||Z instanceof nt){if(Z instanceof nt&&["in","not in"].includes($.operator.value))return new Oe($.operator.value==="not in");throw new Error(`Cannot perform operation ${$.operator.value} on undefined values`)}else{if(B instanceof it||Z instanceof it)throw new Error("Cannot perform operation on null values");if($.operator.value==="~")return new be(B.value.toString()+Z.value.toString());if((B instanceof ye||B instanceof ke)&&(Z instanceof ye||Z instanceof ke)){const ue=B.value,xe=Z.value;switch($.operator.value){case"+":case"-":case"*":{const Re=$.operator.value==="+"?ue+xe:$.operator.value==="-"?ue-xe:ue*xe;return B instanceof ke||Z instanceof ke?new ke(Re):new ye(Re)}case"/":return new ke(ue/xe);case"%":{const Re=ue%xe;return B instanceof ke||Z instanceof ke?new ke(Re):new ye(Re)}case"<":return new Oe(ue<xe);case">":return new Oe(ue>xe);case">=":return new Oe(ue>=xe);case"<=":return new Oe(ue<=xe)}}else if(B instanceof Te&&Z instanceof Te)switch($.operator.value){case"+":return new Te(B.value.concat(Z.value))}else if(Z instanceof Te){const ue=Z.value.find(xe=>xe.value===B.value)!==void 0;switch($.operator.value){case"in":return new Oe(ue);case"not in":return new Oe(!ue)}}}if(B instanceof be||Z instanceof be)switch($.operator.value){case"+":return new be(B.value.toString()+Z.value.toString())}if(B instanceof be&&Z instanceof be)switch($.operator.value){case"in":return new Oe(Z.value.includes(B.value));case"not in":return new Oe(!Z.value.includes(B.value))}if(B instanceof be&&Z instanceof je)switch($.operator.value){case"in":return new Oe(Z.value.has(B.value));case"not in":return new Oe(!Z.value.has(B.value))}throw new SyntaxError(`Unknown operator "${$.operator.value}" between ${B.type} and ${Z.type}`)}evaluateArguments($,re){const B=[],Z=new Map;for(const ue of $)if(ue.type==="SpreadExpression"){const xe=ue,Re=this.evaluate(xe.argument,re);if(!(Re instanceof Te))throw new Error(`Cannot unpack non-iterable type: ${Re.type}`);for(const dt of Re.value)B.push(dt)}else if(ue.type==="KeywordArgumentExpression"){const xe=ue;Z.set(xe.key.value,this.evaluate(xe.value,re))}else{if(Z.size>0)throw new Error("Positional arguments must come before keyword arguments");B.push(this.evaluate(ue,re))}return[B,Z]}applyFilter($,re,B){if(re.type==="Identifier"){const Z=re;if(Z.value==="tojson")return new be(jt($));if($ instanceof Te)switch(Z.value){case"list":return $;case"first":return $.value[0];case"last":return $.value[$.value.length-1];case"length":return new ye($.value.length);case"reverse":return new Te($.value.reverse());case"sort":return new Te($.value.sort((ue,xe)=>{if(ue.type!==xe.type)throw new Error(`Cannot compare different types: ${ue.type} and ${xe.type}`);switch(ue.type){case"IntegerValue":case"FloatValue":return ue.value-xe.value;case"StringValue":return ue.value.localeCompare(xe.value);default:throw new Error(`Cannot compare type: ${ue.type}`)}}));case"join":return new be($.value.map(ue=>ue.value).join(""));case"string":return new be(jt($));case"unique":{const ue=new Set,xe=[];for(const Re of $.value)ue.has(Re.value)||(ue.add(Re.value),xe.push(Re));return new Te(xe)}default:throw new Error(`Unknown ArrayValue filter: ${Z.value}`)}else if($ instanceof be)switch(Z.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const ue=$.builtins.get(Z.value);if(ue instanceof Ze)return ue.value([],B);if(ue instanceof ye)return ue;throw new Error(`Unknown StringValue filter: ${Z.value}`)}case"trim":return new be($.value.trim());case"indent":return new be($.value.split(`
`).map((ue,xe)=>xe===0||ue.length===0?ue:"    "+ue).join(`
`));case"join":case"string":return $;case"int":{const ue=parseInt($.value,10);return new ye(isNaN(ue)?0:ue)}case"float":{const ue=parseFloat($.value);return new ke(isNaN(ue)?0:ue)}default:throw new Error(`Unknown StringValue filter: ${Z.value}`)}else if($ instanceof ye||$ instanceof ke)switch(Z.value){case"abs":return $ instanceof ye?new ye(Math.abs($.value)):new ke(Math.abs($.value));case"int":return new ye(Math.floor($.value));case"float":return new ke($.value);default:throw new Error(`Unknown NumericValue filter: ${Z.value}`)}else if($ instanceof je)switch(Z.value){case"items":return new Te(Array.from($.value.entries()).map(([ue,xe])=>new Te([new be(ue),xe])));case"length":return new ye($.value.size);default:throw new Error(`Unknown ObjectValue filter: ${Z.value}`)}else if($ instanceof Oe)switch(Z.value){case"bool":return new Oe($.value);case"int":return new ye($.value?1:0);case"float":return new ke($.value?1:0);case"string":return new be($.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${Z.value}`)}throw new Error(`Cannot apply filter "${Z.value}" to type: ${$.type}`)}else if(re.type==="CallExpression"){const Z=re;if(Z.callee.type!=="Identifier")throw new Error(`Unknown filter: ${Z.callee.type}`);const ue=Z.callee.value;if(ue==="tojson"){const[,xe]=this.evaluateArguments(Z.args,B),Re=xe.get("indent")??new it;if(!(Re instanceof ye||Re instanceof it))throw new Error("If set, indent must be a number");return new be(jt($,Re.value))}else if(ue==="join"){let xe;if($ instanceof be)xe=Array.from($.value);else if($ instanceof Te)xe=$.value.map(Tt=>Tt.value);else throw new Error(`Cannot apply filter "${ue}" to type: ${$.type}`);const[Re,dt]=this.evaluateArguments(Z.args,B),Ct=Re.at(0)??dt.get("separator")??new be("");if(!(Ct instanceof be))throw new Error("separator must be a string");return new be(xe.join(Ct.value))}else if(ue==="int"||ue==="float"){const[xe,Re]=this.evaluateArguments(Z.args,B),dt=xe.at(0)??Re.get("default")??(ue==="int"?new ye(0):new ke(0));if($ instanceof be){const Ct=ue==="int"?parseInt($.value,10):parseFloat($.value);return isNaN(Ct)?dt:ue==="int"?new ye(Ct):new ke(Ct)}else{if($ instanceof ye||$ instanceof ke)return $;if($ instanceof Oe)return ue==="int"?new ye($.value?1:0):new ke($.value?1:0);throw new Error(`Cannot apply filter "${ue}" to type: ${$.type}`)}}else if(ue==="default"){const[xe,Re]=this.evaluateArguments(Z.args,B),dt=xe[0]??new be(""),Ct=xe[1]??Re.get("boolean")??new Oe(!1);if(!(Ct instanceof Oe))throw new Error("`default` filter flag must be a boolean");return $ instanceof nt||Ct.value&&!$.__bool__().value?dt:$}if($ instanceof Te){switch(ue){case"selectattr":case"rejectattr":{const xe=ue==="selectattr";if($.value.some(lt=>!(lt instanceof je)))throw new Error(`\`${ue}\` can only be applied to array of objects`);if(Z.args.some(lt=>lt.type!=="StringLiteral"))throw new Error(`arguments of \`${ue}\` must be strings`);const[Re,dt,Ct]=Z.args.map(lt=>this.evaluate(lt,B));let Tt;if(dt){const lt=B.tests.get(dt.value);if(!lt)throw new Error(`Unknown test: ${dt.value}`);Tt=lt}else Tt=(...lt)=>lt[0].__bool__().value;const Ot=$.value.filter(lt=>{const Kt=lt.value.get(Re.value),ur=Kt?Tt(Kt,Ct):!1;return xe?ur:!ur});return new Te(Ot)}case"map":{const[,xe]=this.evaluateArguments(Z.args,B);if(xe.has("attribute")){const Re=xe.get("attribute");if(!(Re instanceof be))throw new Error("attribute must be a string");const dt=xe.get("default"),Ct=$.value.map(Tt=>{if(!(Tt instanceof je))throw new Error("items in map must be an object");return Tt.value.get(Re.value)??dt??new nt});return new Te(Ct)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${ue}`)}else if($ instanceof be){switch(ue){case"indent":{const[xe,Re]=this.evaluateArguments(Z.args,B),dt=xe.at(0)??Re.get("width")??new ye(4);if(!(dt instanceof ye))throw new Error("width must be a number");const Ct=xe.at(1)??Re.get("first")??new Oe(!1),Tt=xe.at(2)??Re.get("blank")??new Oe(!1),Ot=$.value.split(`
`),lt=" ".repeat(dt.value),Kt=Ot.map((ur,In)=>!Ct.value&&In===0||!Tt.value&&ur.length===0?ur:lt+ur);return new be(Kt.join(`
`))}case"replace":{const xe=$.builtins.get("replace");if(!(xe instanceof Ze))throw new Error("replace filter not available");const[Re,dt]=this.evaluateArguments(Z.args,B);return xe.value([...Re,new Je(dt)],B)}}throw new Error(`Unknown StringValue filter: ${ue}`)}else throw new Error(`Cannot apply filter "${ue}" to type: ${$.type}`)}throw new Error(`Unknown filter: ${re.type}`)}evaluateFilterExpression($,re){const B=this.evaluate($.operand,re);return this.applyFilter(B,$.filter,re)}evaluateTestExpression($,re){const B=this.evaluate($.operand,re),Z=re.tests.get($.test.value);if(!Z)throw new Error(`Unknown test: ${$.test.value}`);const ue=Z(B);return new Oe($.negate?!ue:ue)}evaluateSelectExpression($,re){return this.evaluate($.test,re).__bool__().value?this.evaluate($.lhs,re):new nt}evaluateUnaryExpression($,re){const B=this.evaluate($.argument,re);switch($.operator.value){case"not":return new Oe(!B.value);default:throw new SyntaxError(`Unknown operator: ${$.operator.value}`)}}evaluateTernaryExpression($,re){return this.evaluate($.condition,re).__bool__().value?this.evaluate($.trueExpr,re):this.evaluate($.falseExpr,re)}evalProgram($,re){return this.evaluateBlock($.body,re)}evaluateBlock($,re){let B="";for(const Z of $){const ue=this.evaluate(Z,re);ue.type!=="NullValue"&&ue.type!=="UndefinedValue"&&(B+=ue.toString())}return new be(B)}evaluateIdentifier($,re){return re.lookupVariable($.value)}evaluateCallExpression($,re){const[B,Z]=this.evaluateArguments($.args,re);Z.size>0&&B.push(new Je(Z));const ue=this.evaluate($.callee,re);if(ue.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${ue.type}`);return ue.value(B,re)}evaluateSliceExpression($,re,B){if(!($ instanceof Te||$ instanceof be))throw new Error("Slice object must be an array or string");const Z=this.evaluate(re.start,B),ue=this.evaluate(re.stop,B),xe=this.evaluate(re.step,B);if(!(Z instanceof ye||Z instanceof nt))throw new Error("Slice start must be numeric or undefined");if(!(ue instanceof ye||ue instanceof nt))throw new Error("Slice stop must be numeric or undefined");if(!(xe instanceof ye||xe instanceof nt))throw new Error("Slice step must be numeric or undefined");return $ instanceof Te?new Te(De($.value,Z.value,ue.value,xe.value)):new be(De(Array.from($.value),Z.value,ue.value,xe.value).join(""))}evaluateMemberExpression($,re){const B=this.evaluate($.object,re);let Z;if($.computed){if($.property.type==="SliceExpression")return this.evaluateSliceExpression(B,$.property,re);Z=this.evaluate($.property,re)}else Z=new be($.property.value);let ue;if(B instanceof je){if(!(Z instanceof be))throw new Error(`Cannot access property with non-string: got ${Z.type}`);ue=B.value.get(Z.value)??B.builtins.get(Z.value)}else if(B instanceof Te||B instanceof be)if(Z instanceof ye)ue=B.value.at(Z.value),B instanceof be&&(ue=new be(B.value.at(Z.value)));else if(Z instanceof be)ue=B.builtins.get(Z.value);else throw new Error(`Cannot access property with non-string/non-number: got ${Z.type}`);else{if(!(Z instanceof be))throw new Error(`Cannot access property with non-string: got ${Z.type}`);ue=B.builtins.get(Z.value)}return ue instanceof Pe?ue:new nt}evaluateSet($,re){const B=$.value?this.evaluate($.value,re):this.evaluateBlock($.body,re);if($.assignee.type==="Identifier"){const Z=$.assignee.value;re.setVariable(Z,B)}else if($.assignee.type==="TupleLiteral"){const Z=$.assignee;if(!(B instanceof Te))throw new Error(`Cannot unpack non-iterable type in set: ${B.type}`);const ue=B.value;if(ue.length!==Z.value.length)throw new Error(`Too ${Z.value.length>ue.length?"few":"many"} items to unpack in set`);for(let xe=0;xe<Z.value.length;++xe){const Re=Z.value[xe];if(Re.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${Re.type}`);re.setVariable(Re.value,ue[xe])}}else if($.assignee.type==="MemberExpression"){const Z=$.assignee,ue=this.evaluate(Z.object,re);if(!(ue instanceof je))throw new Error("Cannot assign to member of non-object");if(Z.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");ue.value.set(Z.property.value,B)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify($.assignee)}`);return new it}evaluateIf($,re){const B=this.evaluate($.test,re);return this.evaluateBlock(B.__bool__().value?$.body:$.alternate,re)}evaluateFor($,re){const B=new Ne(re);let Z,ue;if($.iterable.type==="SelectExpression"){const Tt=$.iterable;ue=this.evaluate(Tt.lhs,B),Z=Tt.test}else ue=this.evaluate($.iterable,B);if(!(ue instanceof Te||ue instanceof je))throw new Error(`Expected iterable or object type in for loop: got ${ue.type}`);ue instanceof je&&(ue=ue.keys());const xe=[],Re=[];for(let Tt=0;Tt<ue.value.length;++Tt){const Ot=new Ne(B),lt=ue.value[Tt];let Kt;if($.loopvar.type==="Identifier")Kt=ur=>ur.setVariable($.loopvar.value,lt);else if($.loopvar.type==="TupleLiteral"){const ur=$.loopvar;if(lt.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${lt.type}`);const In=lt;if(ur.value.length!==In.value.length)throw new Error(`Too ${ur.value.length>In.value.length?"few":"many"} items to unpack`);Kt=Vn=>{for(let Lr=0;Lr<ur.value.length;++Lr){if(ur.value[Lr].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${ur.value[Lr].type}`);Vn.setVariable(ur.value[Lr].value,In.value[Lr])}}}else throw new Error(`Invalid loop variable(s): ${$.loopvar.type}`);Z&&(Kt(Ot),!this.evaluate(Z,Ot).__bool__().value)||(xe.push(lt),Re.push(Kt))}let dt="",Ct=!0;for(let Tt=0;Tt<xe.length;++Tt){const Ot=new Map([["index",new ye(Tt+1)],["index0",new ye(Tt)],["revindex",new ye(xe.length-Tt)],["revindex0",new ye(xe.length-Tt-1)],["first",new Oe(Tt===0)],["last",new Oe(Tt===xe.length-1)],["length",new ye(xe.length)],["previtem",Tt>0?xe[Tt-1]:new nt],["nextitem",Tt<xe.length-1?xe[Tt+1]:new nt]]);B.setVariable("loop",new je(Ot)),Re[Tt](B);try{const lt=this.evaluateBlock($.body,B);dt+=lt.value}catch(lt){if(lt instanceof Me)continue;if(lt instanceof Ee)break;throw lt}Ct=!1}if(Ct){const Tt=this.evaluateBlock($.defaultBlock,B);dt+=Tt.value}return new be(dt)}evaluateMacro($,re){return re.setVariable($.name.value,new Ze((B,Z)=>{var Re;const ue=new Ne(Z);B=B.slice();let xe;((Re=B.at(-1))==null?void 0:Re.type)==="KeywordArgumentsValue"&&(xe=B.pop());for(let dt=0;dt<$.args.length;++dt){const Ct=$.args[dt],Tt=B[dt];if(Ct.type==="Identifier"){const Ot=Ct;if(!Tt)throw new Error(`Missing positional argument: ${Ot.value}`);ue.setVariable(Ot.value,Tt)}else if(Ct.type==="KeywordArgumentExpression"){const Ot=Ct,lt=Tt??(xe==null?void 0:xe.value.get(Ot.key.value))??this.evaluate(Ot.value,ue);ue.setVariable(Ot.key.value,lt)}else throw new Error(`Unknown argument type: ${Ct.type}`)}return this.evaluateBlock($.body,ue)})),new it}evaluateCallStatement($,re){const B=new Ze((dt,Ct)=>{const Tt=new Ne(Ct);if($.callerArgs)for(let Ot=0;Ot<$.callerArgs.length;++Ot){const lt=$.callerArgs[Ot];if(lt.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${lt.type}`);Tt.setVariable(lt.value,dt[Ot]??new nt)}return this.evaluateBlock($.body,Tt)}),[Z,ue]=this.evaluateArguments($.call.args,re);Z.push(new Je(ue));const xe=this.evaluate($.call.callee,re);if(xe.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${xe.type}`);const Re=new Ne(re);return Re.setVariable("caller",B),xe.value(Z,Re)}evaluateFilterStatement($,re){const B=this.evaluateBlock($.body,re);return this.applyFilter(B,$.filter,re)}evaluate($,re){if(!$)return new nt;switch($.type){case"Program":return this.evalProgram($,re);case"Set":return this.evaluateSet($,re);case"If":return this.evaluateIf($,re);case"For":return this.evaluateFor($,re);case"Macro":return this.evaluateMacro($,re);case"CallStatement":return this.evaluateCallStatement($,re);case"Break":throw new Ee;case"Continue":throw new Me;case"IntegerLiteral":return new ye($.value);case"FloatLiteral":return new ke($.value);case"StringLiteral":return new be($.value);case"ArrayLiteral":return new Te($.value.map(B=>this.evaluate(B,re)));case"TupleLiteral":return new ot($.value.map(B=>this.evaluate(B,re)));case"ObjectLiteral":{const B=new Map;for(const[Z,ue]of $.value){const xe=this.evaluate(Z,re);if(!(xe instanceof be))throw new Error(`Object keys must be strings: got ${xe.type}`);B.set(xe.value,this.evaluate(ue,re))}return new je(B)}case"Identifier":return this.evaluateIdentifier($,re);case"CallExpression":return this.evaluateCallExpression($,re);case"MemberExpression":return this.evaluateMemberExpression($,re);case"UnaryExpression":return this.evaluateUnaryExpression($,re);case"BinaryExpression":return this.evaluateBinaryExpression($,re);case"FilterExpression":return this.evaluateFilterExpression($,re);case"FilterStatement":return this.evaluateFilterStatement($,re);case"TestExpression":return this.evaluateTestExpression($,re);case"SelectExpression":return this.evaluateSelectExpression($,re);case"Ternary":return this.evaluateTernaryExpression($,re);case"Comment":return new it;default:throw new SyntaxError(`Unknown node type: ${$.type}`)}}};function bt($){switch(typeof $){case"number":return Number.isInteger($)?new ye($):new ke($);case"string":return new be($);case"boolean":return new Oe($);case"undefined":return new nt;case"object":return $===null?new it:Array.isArray($)?new Te($.map(bt)):new je(new Map(Object.entries($).map(([re,B])=>[re,bt(B)])));case"function":return new Ze((re,B)=>{const Z=$(...re.map(ue=>ue.value))??null;return bt(Z)});default:throw new Error(`Cannot convert to runtime value: ${$}`)}}function jt($,re,B){const Z=B??0;switch($.type){case"NullValue":case"UndefinedValue":return"null";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify($.value);case"ArrayValue":case"ObjectValue":{const ue=re?" ".repeat(re):"",xe=`
`+ue.repeat(Z),Re=xe+ue;if($.type==="ArrayValue"){const dt=$.value.map(Ct=>jt(Ct,re,Z+1));return re?`[${Re}${dt.join(`,${Re}`)}${xe}]`:`[${dt.join(", ")}]`}else{const dt=Array.from($.value.entries()).map(([Ct,Tt])=>{const Ot=`"${Ct}": ${jt(Tt,re,Z+1)}`;return re?`${Re}${Ot}`:Ot});return re?`{${dt.join(",")}${xe}}`:`{${dt.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${$.type}`)}}var yt=`
`,pr="{%- ",Hr=" -%}";function Rr($){switch($.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return $.operator.value==="and"?1:$.operator.value==="in"||$.operator.value==="not in"?2:0}return 0}function wn($,re="	"){const B=typeof re=="number"?" ".repeat(re):re;return Kr($.body,0,B).replace(/\n$/,"")}function mr(...$){return pr+$.join(" ")+Hr}function Kr($,re,B){return $.map(Z=>Qs(Z,re,B)).join(yt)}function Qs($,re,B){const Z=B.repeat(re);switch($.type){case"Program":return Kr($.body,re,B);case"If":return ko($,re,B);case"For":return Cs($,re,B);case"Set":return Yr($,re,B);case"Macro":return Xs($,re,B);case"Break":return Z+mr("break");case"Continue":return Z+mr("continue");case"CallStatement":return Ge($,re,B);case"FilterStatement":return Ht($,re,B);case"Comment":return Z+"{# "+$.value+" #}";default:return Z+"{{- "+ct($)+" -}}"}}function ko($,re,B){const Z=B.repeat(re),ue=[];let xe=$;for(;xe&&(ue.push({test:xe.test,body:xe.body}),xe.alternate.length===1&&xe.alternate[0].type==="If");)xe=xe.alternate[0];let Re=Z+mr("if",ct(ue[0].test))+yt+Kr(ue[0].body,re+1,B);for(let dt=1;dt<ue.length;++dt)Re+=yt+Z+mr("elif",ct(ue[dt].test))+yt+Kr(ue[dt].body,re+1,B);return xe&&xe.alternate.length>0&&(Re+=yt+Z+mr("else")+yt+Kr(xe.alternate,re+1,B)),Re+=yt+Z+mr("endif"),Re}function Cs($,re,B){const Z=B.repeat(re);let ue="";if($.iterable.type==="SelectExpression"){const Re=$.iterable;ue=`${ct(Re.lhs)} if ${ct(Re.test)}`}else ue=ct($.iterable);let xe=Z+mr("for",ct($.loopvar),"in",ue)+yt+Kr($.body,re+1,B);return $.defaultBlock.length>0&&(xe+=yt+Z+mr("else")+yt+Kr($.defaultBlock,re+1,B)),xe+=yt+Z+mr("endfor"),xe}function Yr($,re,B){const Z=B.repeat(re),ue=ct($.assignee),xe=$.value?ct($.value):"",Re=Z+mr("set",`${ue}${$.value?" = "+xe:""}`);return $.body.length===0?Re:Re+yt+Kr($.body,re+1,B)+yt+Z+mr("endset")}function Xs($,re,B){const Z=B.repeat(re),ue=$.args.map(ct).join(", ");return Z+mr("macro",`${$.name.value}(${ue})`)+yt+Kr($.body,re+1,B)+yt+Z+mr("endmacro")}function Ge($,re,B){const Z=B.repeat(re),ue=$.callerArgs&&$.callerArgs.length>0?`(${$.callerArgs.map(ct).join(", ")})`:"",xe=ct($.call);let Re=Z+mr(`call${ue}`,xe)+yt;return Re+=Kr($.body,re+1,B)+yt,Re+=Z+mr("endcall"),Re}function Ht($,re,B){const Z=B.repeat(re),ue=$.filter.type==="Identifier"?$.filter.value:ct($.filter);let xe=Z+mr("filter",ue)+yt;return xe+=Kr($.body,re+1,B)+yt,xe+=Z+mr("endfilter"),xe}function ct($,re=-1){switch($.type){case"SpreadExpression":return`*${ct($.argument)}`;case"Identifier":return $.value;case"IntegerLiteral":return`${$.value}`;case"FloatLiteral":return`${$.value}`;case"StringLiteral":return JSON.stringify($.value);case"BinaryExpression":{const B=$,Z=Rr(B),ue=ct(B.left,Z),xe=ct(B.right,Z+1),Re=`${ue} ${B.operator.value} ${xe}`;return Z<re?`(${Re})`:Re}case"UnaryExpression":{const B=$;return B.operator.value+(B.operator.value==="not"?" ":"")+ct(B.argument,1/0)}case"CallExpression":{const B=$,Z=B.args.map(ct).join(", ");return`${ct(B.callee)}(${Z})`}case"MemberExpression":{const B=$;let Z=ct(B.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(B.object.type)||(Z=`(${Z})`);let ue=ct(B.property);return!B.computed&&B.property.type!=="Identifier"&&(ue=`(${ue})`),B.computed?`${Z}[${ue}]`:`${Z}.${ue}`}case"FilterExpression":{const B=$,Z=ct(B.operand,1/0);return B.filter.type==="CallExpression"?`${Z} | ${ct(B.filter)}`:`${Z} | ${B.filter.value}`}case"SelectExpression":{const B=$;return`${ct(B.lhs)} if ${ct(B.test)}`}case"TestExpression":{const B=$;return`${ct(B.operand)} is${B.negate?" not":""} ${B.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const B=$.value.map(ct),Z=$.type==="ArrayLiteral"?"[]":"()";return`${Z[0]}${B.join(", ")}${Z[1]}`}case"ObjectLiteral":return`{${Array.from($.value.entries()).map(([Z,ue])=>`${ct(Z)}: ${ct(ue)}`).join(", ")}}`;case"SliceExpression":{const B=$,Z=B.start?ct(B.start):"",ue=B.stop?ct(B.stop):"",xe=B.step?`:${ct(B.step)}`:"";return`${Z}:${ue}${xe}`}case"KeywordArgumentExpression":{const B=$;return`${B.key.value}=${ct(B.value)}`}case"Ternary":{const B=$,Z=`${ct(B.trueExpr)} if ${ct(B.condition,0)} else ${ct(B.falseExpr)}`;return re>-1?`(${Z})`:Z}default:throw new Error(`Unknown expression type: ${$.type}`)}}var Wt=class{constructor($){ae(this,"parsed");const re=h($,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=ne(re)}render($){const re=new Ne;if(qe(re),$)for(const[ue,xe]of Object.entries($))re.set(ue,xe);return new Mt(re).run(this.parsed).value}format($){return wn(this.parsed,($==null?void 0:$.indent)||"	")}}},"./src/backends/onnx.js":(e,t,r)=>{var n;r.r(t),r.d(t,{Tensor:()=>a.Tensor,createInferenceSession:()=>b,deviceToExecutionProviders:()=>p,isONNXProxy:()=>E,isONNXTensor:()=>v,runInferenceSession:()=>y});var s=r("./src/env.js"),o=r("?2ce3"),i=r("onnxruntime-web"),a=r("onnxruntime-common");const l=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),u=[];let h,c;const d=Symbol.for("onnxruntime");if(d in globalThis)c=globalThis[d];else if(s.apis.IS_NODE_ENV){switch(c=o??(n||(n=r.t(o,2))),process.platform){case"win32":u.push("dml");break;case"linux":process.arch==="x64"&&u.push("cuda");break}u.push("cpu"),h=["cpu"]}else c=i,s.apis.IS_WEBNN_AVAILABLE&&u.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),s.apis.IS_WEBGPU_AVAILABLE&&u.push("webgpu"),u.push("wasm"),h=["wasm"];const f=c.InferenceSession;function p(T=null){if(!T)return h;switch(T){case"auto":return u;case"gpu":return u.filter(S=>["webgpu","cuda","dml","webnn-gpu"].includes(S))}if(u.includes(T))return[l[T]??T];throw new Error(`Unsupported device: "${T}". Should be one of: ${u.join(", ")}.`)}let m=null;async function b(T,S,A){m&&await m;const I=f.create(T,S);m??(m=I);const V=await I;return V.config=A,V}let g=Promise.resolve();const _=s.apis.IS_BROWSER_ENV||s.apis.IS_WEBWORKER_ENV;async function y(T,S){const A=()=>T.run(S);return await(_?g=g.then(A):A())}function v(T){return T instanceof c.Tensor}const M=c==null?void 0:c.env;M!=null&&M.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!M.wasm.wasmPaths&&(M.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${s.env.version}/dist/`),M.wasm.proxy=!1),M!=null&&M.webgpu&&(M.webgpu.powerPreference="high-performance");function E(){var T;return(T=M==null?void 0:M.wasm)==null?void 0:T.proxy}s.env.backends.onnx=M},"./src/base/feature_extraction_utils.js":(e,t,r)=>{r.r(t),r.d(t,{FeatureExtractor:()=>i,validate_audio_inputs:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),o=r("./src/utils/hub.js");class i extends s.Callable{constructor(u){super(),this.config=u}static async from_pretrained(u,h={}){const c=await(0,o.getModelJSON)(u,n.FEATURE_EXTRACTOR_NAME,!0,h);return new this(c)}}function a(l,u){var h;if(!(l instanceof Float32Array||l instanceof Float64Array))throw new Error(`${u} expects input to be a Float32Array or a Float64Array, but got ${((h=l==null?void 0:l.constructor)==null?void 0:h.name)??typeof l} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}},"./src/base/image_processors_utils.js":(e,t,r)=>{r.r(t),r.d(t,{ImageProcessor:()=>v,center_to_corners_format:()=>c,post_process_instance_segmentation:()=>y,post_process_object_detection:()=>d,post_process_panoptic_segmentation:()=>_,post_process_semantic_segmentation:()=>f});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/maths.js");r("./src/utils/image.js");var i=r("./src/utils/core.js"),a=r("./src/utils/hub.js"),l=r("./src/utils/constants.js");function u(M,E,T=0,S=null){const A=M/E;let I=(0,o.bankers_round)(A)*E;return S!==null&&I>S&&(I=Math.floor(A)*E),I<T&&(I=Math.ceil(A)*E),I}function h([M,E],T){return[Math.max(Math.floor(M/T),1)*T,Math.max(Math.floor(E/T),1)*T]}function c([M,E,T,S]){return[M-T/2,E-S/2,M+T/2,E+S/2]}function d(M,E=.5,T=null,S=!1){const A=M.logits,I=M.pred_boxes,[V,N,z]=A.dims;if(T!==null&&T.length!==V)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let q=[];for(let G=0;G<V;++G){let ee=T!==null?T[G]:null,Y={boxes:[],classes:[],scores:[]},W=A[G],te=I[G];for(let le=0;le<N;++le){let oe=W[le],U=[],R;if(S){R=oe.sigmoid().data;for(let X=0;X<R.length;++X)R[X]>E&&U.push(X)}else{let X=(0,o.max)(oe.data)[1];if(X===z-1||(R=(0,o.softmax)(oe.data),R[X]<E))continue;U.push(X)}for(const X of U){let ce=te[le].data;ce=c(ce),ee!==null&&(ce=ce.map((ne,we)=>ne*ee[(we+1)%2])),Y.boxes.push(ce),Y.classes.push(X),Y.scores.push(R[X])}}q.push(Y)}return q}function f(M,E=null){const T=M.logits,S=T.dims[0];if(E!==null&&E.length!==S)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const A=[];for(let I=0;I<S;++I){const V=E!==null?E[I]:null;let N=T[I];V!==null&&(N=(0,s.interpolate)(N,V,"bilinear",!1));const[z,q]=V??N.dims.slice(-2),G=new s.Tensor("int32",new Int32Array(z*q),[z,q]),ee=N[0].data,Y=G.data;for(let le=1;le<N.dims[0];++le){const oe=N[le].data;for(let U=0;U<oe.length;++U)oe[U]>ee[U]&&(ee[U]=oe[U],Y[U]=le)}const W=new Array(N.dims[0]);for(let le=0;le<Y.length;++le){const oe=Y[le];W[oe]=oe}const te=W.filter(le=>le!==void 0);A.push({segmentation:G,labels:te})}return A}function p(M,E,T,S){const A=[],I=[],V=[];for(let N=0;N<M.dims[0];++N){const z=M[N],q=E[N],G=(0,o.max)(z.data)[1];if(G===S)continue;const Y=(0,o.softmax)(z.data)[G];Y>T&&(A.push(q),I.push(Y),V.push(G))}return[A,I,V]}function m(M,E,T,S=.5,A=.8){const I=[];let V=0,N=0;const z=E[T].data;for(let G=0;G<M.length;++G)M[G]===T&&(I.push(G),++V),z[G]>=S&&++N;let q=V>0&&N>0;return q&&(q=V/N>A),[q,I]}function b(M,E,T,S,A,I=null,V=null){const[N,z]=V??M[0].dims,q=new s.Tensor("int32",new Int32Array(N*z),[N,z]),G=[];if(V!==null)for(let le=0;le<M.length;++le)M[le]=(0,s.interpolate)(M[le],V,"bilinear",!1);const ee=new Int32Array(M[0].data.length),Y=new Float32Array(M[0].data.length);for(let le=0;le<M.length;++le){let oe=E[le];const U=M[le].data;for(let R=0;R<U.length;++R)U[R]*=oe,U[R]>Y[R]&&(ee[R]=le,Y[R]=U[R])}let W=0;const te=q.data;for(let le=0;le<T.length;++le){const oe=T[le],[U,R]=m(ee,M,le,S,A);if(U){++W;for(const X of R)te[X]=W;G.push({id:W,label_id:oe,score:E[le]})}}return[q,G]}function g(M,E,T=28,S=56*56,A=14*14*4*1280){if(M<T||E<T)throw new Error(`height:${M} or width:${E} must be larger than factor:${T}`);if(Math.max(M,E)/Math.min(M,E)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(M,E)/Math.min(M,E)}`);let I=Math.round(M/T)*T,V=Math.round(E/T)*T;if(I*V>A){const N=Math.sqrt(M*E/A);I=Math.floor(M/N/T)*T,V=Math.floor(E/N/T)*T}else if(I*V<S){const N=Math.sqrt(S/(M*E));I=Math.ceil(M*N/T)*T,V=Math.ceil(E*N/T)*T}return[I,V]}function _(M,E=.5,T=.5,S=.8,A=null,I=null){A===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),A=new Set);const V=M.class_queries_logits??M.logits,z=(M.masks_queries_logits??M.pred_masks).sigmoid();let[q,G,ee]=V.dims;if(ee-=1,I!==null&&I.length!==q)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let Y=[];for(let W=0;W<q;++W){let te=I!==null?I[W]:null,le=V[W],oe=z[W],[U,R,X]=p(le,oe,E,ee);if(X.length===0){let[we,De]=te??oe.dims.slice(-2),Be=new s.Tensor("int32",new Int32Array(we*De).fill(-1),[we,De]);Y.push({segmentation:Be,segments_info:[]});continue}let[ce,ne]=b(U,R,X,T,S,A,te);Y.push({segmentation:ce,segments_info:ne})}return Y}function y(M,E=.5,T=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class v extends n.Callable{constructor(E){super(),this.image_mean=E.image_mean??E.mean,this.image_std=E.image_std??E.std,this.resample=E.resample??2,this.do_rescale=E.do_rescale??!0,this.rescale_factor=E.rescale_factor??1/255,this.do_normalize=E.do_normalize,this.do_thumbnail=E.do_thumbnail,this.size=E.size??E.image_size,this.do_resize=E.do_resize??this.size!==void 0,this.size_divisibility=E.size_divisibility??E.size_divisor,this.do_center_crop=E.do_center_crop,this.crop_size=E.crop_size,this.do_convert_rgb=E.do_convert_rgb??!0,this.do_crop_margin=E.do_crop_margin,this.pad_size=E.pad_size,this.do_pad=E.do_pad,this.min_pixels=E.min_pixels,this.max_pixels=E.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=E.do_flip_channel_order??!1,this.config=E}async thumbnail(E,T,S=2){const A=E.height,I=E.width,V=T.height,N=T.width;let z=Math.min(A,V),q=Math.min(I,N);return z===A&&q===I?E:(A>I?q=Math.floor(I*z/A):I>A&&(z=Math.floor(A*q/I)),await E.resize(q,z,{resample:S}))}async crop_margin(E,T=200){const S=E.clone().grayscale(),A=(0,o.min)(S.data)[0],V=(0,o.max)(S.data)[0]-A;if(V===0)return E;const N=T/255;let z=S.width,q=S.height,G=0,ee=0;const Y=S.data;for(let W=0;W<S.height;++W){const te=W*S.width;for(let le=0;le<S.width;++le)(Y[te+le]-A)/V<N&&(z=Math.min(z,le),q=Math.min(q,W),G=Math.max(G,le),ee=Math.max(ee,W))}return E=await E.crop([z,q,G,ee]),E}pad_image(E,T,S,{mode:A="constant",center:I=!1,constant_values:V=0}={}){const[N,z,q]=T;let G,ee;if(typeof S=="number"?(G=S,ee=S):S==="square"?G=ee=Math.max(N,z):(G=S.width,ee=S.height),G!==z||ee!==N){const Y=new Float32Array(G*ee*q);if(Array.isArray(V))for(let le=0;le<Y.length;++le)Y[le]=V[le%q];else V!==0&&Y.fill(V);const[W,te]=I?[Math.floor((G-z)/2),Math.floor((ee-N)/2)]:[0,0];for(let le=0;le<N;++le){const oe=(le+te)*G,U=le*z;for(let R=0;R<z;++R){const X=(oe+R+W)*q,ce=(U+R)*q;for(let ne=0;ne<q;++ne)Y[X+ne]=E[ce+ne]}}if(A==="symmetric"){if(I)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const le=N-1,oe=z-1;for(let U=0;U<ee;++U){const R=U*G,X=(0,i.calculateReflectOffset)(U,le)*z;for(let ce=0;ce<G;++ce){if(U<N&&ce<z)continue;const ne=(R+ce)*q,we=(X+(0,i.calculateReflectOffset)(ce,oe))*q;for(let De=0;De<q;++De)Y[ne+De]=E[we+De]}}}E=Y,T=[ee,G,q]}return[E,T]}rescale(E){for(let T=0;T<E.length;++T)E[T]=this.rescale_factor*E[T]}get_resize_output_image_size(E,T){const[S,A]=E.size;let I,V;if(this.do_thumbnail){const{height:N,width:z}=T;I=Math.min(N,z)}else Number.isInteger(T)?(I=T,V=this.config.max_size??I):T!==void 0&&(I=T.shortest_edge,V=T.longest_edge);if(I!==void 0||V!==void 0){const N=I===void 0?1:Math.max(I/S,I/A),z=S*N,q=A*N,G=V===void 0?1:Math.min(V/z,V/q);let ee=Math.floor(Number((z*G).toFixed(2))),Y=Math.floor(Number((q*G).toFixed(2)));return this.size_divisibility!==void 0&&([ee,Y]=h([ee,Y],this.size_divisibility)),[ee,Y]}else if(T!==void 0&&T.width!==void 0&&T.height!==void 0){let N=T.width,z=T.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let q=z/A,G=N/S;Math.abs(1-G)<Math.abs(1-q)?q=G:G=q,z=u(q*A,this.config.ensure_multiple_of),N=u(G*S,this.config.ensure_multiple_of)}return[N,z]}else{if(this.size_divisibility!==void 0)return h([S,A],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const N=this.config.patch_size*this.config.merge_size;return g(A,S,N,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(T)}`)}}async resize(E){const[T,S]=this.get_resize_output_image_size(E,this.size);return await E.resize(T,S,{resample:this.resample})}async preprocess(E,{do_normalize:T=null,do_pad:S=null,do_convert_rgb:A=null,do_convert_grayscale:I=null,do_flip_channel_order:V=null}={}){this.do_crop_margin&&(E=await this.crop_margin(E));const[N,z]=E.size;if(A??this.do_convert_rgb?E=E.rgb():I&&(E=E.grayscale()),this.do_resize&&(E=await this.resize(E)),this.do_thumbnail&&(E=await this.thumbnail(E,this.size,this.resample)),this.do_center_crop){let W,te;Number.isInteger(this.crop_size)?(W=this.crop_size,te=this.crop_size):(W=this.crop_size.width,te=this.crop_size.height),E=await E.center_crop(W,te)}const q=[E.height,E.width];let G=Float32Array.from(E.data),ee=[E.height,E.width,E.channels];if(this.do_rescale&&this.rescale(G),T??this.do_normalize){let W=this.image_mean;Array.isArray(this.image_mean)||(W=new Array(E.channels).fill(W));let te=this.image_std;if(Array.isArray(this.image_std)||(te=new Array(E.channels).fill(te)),W.length!==E.channels||te.length!==E.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${W.length}) and \`image_std\` (${te.length}) must match the number of channels in the image (${E.channels}).`);for(let le=0;le<G.length;le+=E.channels)for(let oe=0;oe<E.channels;++oe)G[le+oe]=(G[le+oe]-W[oe])/te[oe]}if(S??this.do_pad){if(this.pad_size)[G,ee]=this.pad_image(G,[E.height,E.width,E.channels],this.pad_size);else if(this.size_divisibility){const[W,te]=h([ee[1],ee[0]],this.size_divisibility);[G,ee]=this.pad_image(G,ee,{width:W,height:te})}}if(V??this.do_flip_channel_order){if(ee[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let W=0;W<G.length;W+=3){const te=G[W];G[W]=G[W+2],G[W+2]=te}}const Y=new s.Tensor("float32",G,ee).permute(2,0,1);return{original_size:[z,N],reshaped_input_size:q,pixel_values:Y}}async _call(E,...T){Array.isArray(E)||(E=[E]);const S=await Promise.all(E.map(I=>this.preprocess(I)));return{pixel_values:(0,s.stack)(S.map(I=>I.pixel_values),0),original_sizes:S.map(I=>I.original_size),reshaped_input_sizes:S.map(I=>I.reshaped_input_size)}}static async from_pretrained(E,T={}){const S=await(0,a.getModelJSON)(E,l.IMAGE_PROCESSOR_NAME,!0,T);return new this(S)}}},"./src/base/processing_utils.js":(e,t,r)=>{r.r(t),r.d(t,{Processor:()=>i});var n=r("./src/utils/constants.js"),s=r("./src/utils/generic.js"),o=r("./src/utils/hub.js");class i extends s.Callable{constructor(l,u,h){super(),this.config=l,this.components=u,this.chat_template=h}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(l,u={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(l,{tokenize:!1,chat_template:this.chat_template??void 0,...u})}batch_decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...l)}decode(...l){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...l)}async _call(l,...u){for(const h of[this.image_processor,this.feature_extractor,this.tokenizer])if(h)return h(l,...u);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(l,u={}){const[h,c,d]=await Promise.all([this.uses_processor_config?(0,o.getModelJSON)(l,n.PROCESSOR_NAME,!0,u):{},Promise.all(this.classes.filter(f=>f in this).map(async f=>{const p=await this[f].from_pretrained(l,u);return[f.replace(/_class$/,""),p]})).then(Object.fromEntries),this.uses_chat_template_file?(0,o.getModelText)(l,n.CHAT_TEMPLATE_NAME,!0,u):null]);return new this(h,c,d)}}ae(i,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),ae(i,"uses_processor_config",!1),ae(i,"uses_chat_template_file",!1)},"./src/configs.js":(e,t,r)=>{r.r(t),r.d(t,{AutoConfig:()=>h,PretrainedConfig:()=>u,getCacheShapes:()=>a});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js");async function o(c,d){return await(0,s.getModelJSON)(c,"config.json",!0,d)}function i(c){const d={};let f={};switch(c.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":f=i(c.text_config);break;case"moondream1":f=i(c.phi_config);break;case"musicgen":f=i(c.decoder);break;case"multi_modality":f=i(c.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":d.num_heads="num_attention_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.hidden_size="hidden_size",d.num_attention_heads="num_attention_heads",d.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":d.num_heads="num_key_value_heads",d.num_layers="num_hidden_layers",d.dim_kv="head_dim";break;case"openelm":d.num_heads="num_kv_heads",d.num_layers="num_transformer_layers",d.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":d.num_heads="num_heads",d.num_layers="num_layers",d.hidden_size="hidden_size";break;case"bloom":d.num_heads="n_head",d.num_layers="n_layer",d.hidden_size="hidden_size";break;case"mpt":d.num_heads="n_heads",d.num_layers="n_layers",d.hidden_size="d_model";break;case"exaone":d.num_heads="num_key_value_heads",d.num_layers="num_layers",d.dim_kv="head_dim",d.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":d.num_decoder_layers="num_decoder_layers",d.num_decoder_heads="num_heads",d.decoder_dim_kv="d_kv",d.num_encoder_layers="num_layers",d.num_encoder_heads="num_heads",d.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="d_model",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="d_model";break;case"speecht5":d.num_decoder_layers="decoder_layers",d.num_decoder_heads="decoder_attention_heads",d.decoder_hidden_size="hidden_size",d.num_encoder_layers="encoder_layers",d.num_encoder_heads="encoder_attention_heads",d.encoder_hidden_size="hidden_size";break;case"trocr":d.num_encoder_layers=d.num_decoder_layers="decoder_layers",d.num_encoder_heads=d.num_decoder_heads="decoder_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="d_model";break;case"musicgen_decoder":d.num_encoder_layers=d.num_decoder_layers="num_hidden_layers",d.num_encoder_heads=d.num_decoder_heads="num_attention_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"moonshine":d.num_decoder_layers="decoder_num_hidden_layers",d.num_decoder_heads="decoder_num_key_value_heads",d.num_encoder_layers="encoder_num_hidden_layers",d.num_encoder_heads="encoder_num_key_value_heads",d.encoder_hidden_size=d.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const m=i(c.decoder),b="num_decoder_layers"in m,g=(0,n.pick)(c,["model_type","is_encoder_decoder"]);return b?(g.num_decoder_layers=m.num_decoder_layers,g.num_decoder_heads=m.num_decoder_heads,g.decoder_hidden_size=m.decoder_hidden_size,g.num_encoder_layers=m.num_encoder_layers,g.num_encoder_heads=m.num_encoder_heads,g.encoder_hidden_size=m.encoder_hidden_size):(g.num_layers=m.num_layers,g.num_heads=m.num_heads,g.hidden_size=m.hidden_size),g}const p={...f,...(0,n.pick)(c,["model_type","multi_query","is_encoder_decoder"])};for(const m in d)p[m]=c[d[m]];return p}function a(c,d){if(c.model_type==="lfm2"){const f=(d==null?void 0:d.prefix)??"past_key_values",p=f==="present"?"present":"past",m={},{layer_types:b,num_attention_heads:g,num_key_value_heads:_,hidden_size:y,conv_L_cache:v}=c,M=y/g,E=(d==null?void 0:d.batch_size)??1;for(let T=0;T<b.length;++T)if(b[T]==="full_attention")for(const S of["key","value"])m[`${f}.${T}.${S}`]=[E,_,0,M];else if(b[T]==="conv")m[`${p}_conv.${T}`]=[E,y,v];else throw new Error(`Unsupported layer type: ${b[T]}`);return m}return l(c,d)}function l(c,{prefix:d="past_key_values",batch_size:f=1}={}){const p={},m=c.normalized_config;if(m.is_encoder_decoder&&"num_encoder_heads"in m&&"num_decoder_heads"in m){const b=m.encoder_dim_kv??m.encoder_hidden_size/m.num_encoder_heads,g=m.decoder_dim_kv??m.decoder_hidden_size/m.num_decoder_heads,_=[f,m.num_encoder_heads,0,b],y=[f,m.num_decoder_heads,0,g];for(let v=0;v<m.num_decoder_layers;++v)p[`${d}.${v}.encoder.key`]=_,p[`${d}.${v}.encoder.value`]=_,p[`${d}.${v}.decoder.key`]=y,p[`${d}.${v}.decoder.value`]=y}else{const b=m.num_heads,g=m.num_layers,_=m.dim_kv??m.hidden_size/(m.num_attention_heads??b);if(m.model_type==="falcon"){const y=[f*b,0,_];for(let v=0;v<g;++v)p[`${d}.${v}.key`]=y,p[`${d}.${v}.value`]=y}else if(m.multi_query){const y=[f*b,0,2*_];for(let v=0;v<g;++v)p[`${d}.${v}.key_value`]=y}else if(m.model_type==="bloom"){const y=[f*b,_,0],v=[f*b,0,_];for(let M=0;M<g;++M)p[`${d}.${M}.key`]=y,p[`${d}.${M}.value`]=v}else if(m.model_type==="openelm")for(let y=0;y<g;++y){const v=[f,b[y],0,_];p[`${d}.${y}.key`]=v,p[`${d}.${y}.value`]=v}else{const y=[f,b,0,_];for(let v=0;v<g;++v)p[`${d}.${v}.key`]=y,p[`${d}.${v}.value`]=y}}return p}class u{constructor(d){ae(this,"model_type",null);ae(this,"is_encoder_decoder",!1);ae(this,"max_position_embeddings");ae(this,"transformers.js_config");Object.assign(this,d),this.normalized_config=i(this)}static async from_pretrained(d,{progress_callback:f=null,config:p=null,cache_dir:m=null,local_files_only:b=!1,revision:g="main"}={}){p&&!(p instanceof u)&&(p=new u(p));const _=p??await o(d,{progress_callback:f,config:p,cache_dir:m,local_files_only:b,revision:g});return new this(_)}}class h{static async from_pretrained(...d){return u.from_pretrained(...d)}}},"./src/env.js":(e,t,r)=>{var A,I;r.r(t),r.d(t,{apis:()=>g,env:()=>T});var n=r("?db59"),s=r("?383f"),o=r("?fa4b");const i="3.8.0",a=typeof window<"u"&&typeof window.document<"u",l=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes((A=self.constructor)==null?void 0:A.name),u=typeof self<"u"&&"caches"in self,h=typeof navigator<"u"&&"gpu"in navigator,c=typeof navigator<"u"&&"ml"in navigator,d=typeof process<"u",f=d&&((I=process==null?void 0:process.release)==null?void 0:I.name)==="node",p=!S(n),m=!S(s),b=typeof globalThis.Deno<"u",g=Object.freeze({IS_BROWSER_ENV:a,IS_WEBWORKER_ENV:l,IS_WEB_CACHE_AVAILABLE:u,IS_WEBGPU_AVAILABLE:h,IS_WEBNN_AVAILABLE:c,IS_PROCESS_AVAILABLE:d,IS_NODE_ENV:f,IS_FS_AVAILABLE:p,IS_PATH_AVAILABLE:m}),_=p&&m;let y="./";if(_){const V=Object(import.meta).url;V?y=s.dirname(s.dirname(o.fileURLToPath(V))):typeof __dirname<"u"&&(y=s.dirname(__dirname))}const v=_?s.join(y,"/.cache/"):null,M="/models/",E=_?s.join(y,M):M,T={version:i,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(a||l),localModelPath:E,useFS:p,useBrowserCache:u&&!b,useFSCache:p,cacheDir:v,useCustomCache:!1,customCache:null};function S(V){return Object.keys(V).length===0}},"./src/generation/configuration_utils.js":(e,t,r)=>{r.r(t),r.d(t,{GenerationConfig:()=>s});var n=r("./src/utils/core.js");class s{constructor(i){ae(this,"max_length",20);ae(this,"max_new_tokens",null);ae(this,"min_length",0);ae(this,"min_new_tokens",null);ae(this,"early_stopping",!1);ae(this,"max_time",null);ae(this,"do_sample",!1);ae(this,"num_beams",1);ae(this,"num_beam_groups",1);ae(this,"penalty_alpha",null);ae(this,"use_cache",!0);ae(this,"temperature",1);ae(this,"top_k",50);ae(this,"top_p",1);ae(this,"typical_p",1);ae(this,"epsilon_cutoff",0);ae(this,"eta_cutoff",0);ae(this,"diversity_penalty",0);ae(this,"repetition_penalty",1);ae(this,"encoder_repetition_penalty",1);ae(this,"length_penalty",1);ae(this,"no_repeat_ngram_size",0);ae(this,"bad_words_ids",null);ae(this,"force_words_ids",null);ae(this,"renormalize_logits",!1);ae(this,"constraints",null);ae(this,"forced_bos_token_id",null);ae(this,"forced_eos_token_id",null);ae(this,"remove_invalid_values",!1);ae(this,"exponential_decay_length_penalty",null);ae(this,"suppress_tokens",null);ae(this,"streamer",null);ae(this,"begin_suppress_tokens",null);ae(this,"forced_decoder_ids",null);ae(this,"guidance_scale",null);ae(this,"num_return_sequences",1);ae(this,"output_attentions",!1);ae(this,"output_hidden_states",!1);ae(this,"output_scores",!1);ae(this,"return_dict_in_generate",!1);ae(this,"pad_token_id",null);ae(this,"bos_token_id",null);ae(this,"eos_token_id",null);ae(this,"encoder_no_repeat_ngram_size",0);ae(this,"decoder_start_token_id",null);ae(this,"generation_kwargs",{});Object.assign(this,(0,n.pick)(i,Object.getOwnPropertyNames(this)))}}},"./src/generation/logits_process.js":(e,t,r)=>{r.r(t),r.d(t,{ClassifierFreeGuidanceLogitsProcessor:()=>g,ForcedBOSTokenLogitsProcessor:()=>l,ForcedEOSTokenLogitsProcessor:()=>u,LogitsProcessor:()=>o,LogitsProcessorList:()=>a,LogitsWarper:()=>i,MinLengthLogitsProcessor:()=>p,MinNewTokensLengthLogitsProcessor:()=>m,NoBadWordsLogitsProcessor:()=>b,NoRepeatNGramLogitsProcessor:()=>d,RepetitionPenaltyLogitsProcessor:()=>f,SuppressTokensAtBeginLogitsProcessor:()=>h,TemperatureLogitsWarper:()=>_,TopKLogitsWarper:()=>v,TopPLogitsWarper:()=>y,WhisperTimeStampLogitsProcessor:()=>c});var n=r("./src/utils/generic.js");r("./src/utils/tensor.js");var s=r("./src/utils/maths.js");class o extends n.Callable{_call(E,T){throw Error("`_call` should be implemented in a subclass")}}class i extends n.Callable{_call(E,T){throw Error("`_call` should be implemented in a subclass")}}class a extends n.Callable{constructor(){super(),this.processors=[]}push(E){this.processors.push(E)}extend(E){this.processors.push(...E)}_call(E,T){let S=T;for(const A of this.processors)S=A(E,S);return S}[Symbol.iterator](){return this.processors.values()}}class l extends o{constructor(E){super(),this.bos_token_id=E}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===1){const A=T[S].data;A.fill(-1/0),A[this.bos_token_id]=0}return T}}class u extends o{constructor(E,T){super(),this.max_length=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===this.max_length-1){const A=T[S].data;A.fill(-1/0);for(const I of this.eos_token_id)A[I]=0}return T}}class h extends o{constructor(E,T){super(),this.begin_suppress_tokens=E,this.begin_index=T}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length===this.begin_index){const A=T[S].data;for(const I of this.begin_suppress_tokens)A[I]=-1/0}return T}}class c extends o{constructor(E,T){super(),this.eos_token_id=Array.isArray(E.eos_token_id)?E.eos_token_id[0]:E.eos_token_id,this.no_timestamps_token_id=E.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=T.length,T.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=E.max_initial_timestamp_index}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data;if(A[this.no_timestamps_token_id]=-1/0,E[S].length===this.begin_index-1){A.fill(-1/0),A[this.timestamp_begin]=0;continue}const I=E[S].slice(this.begin_index),V=I.length>=1&&I[I.length-1]>=this.timestamp_begin,N=I.length<2||I[I.length-2]>=this.timestamp_begin;if(V&&(N?A.subarray(this.timestamp_begin).fill(-1/0):A.subarray(0,this.eos_token_id).fill(-1/0)),E[S].length===this.begin_index&&this.max_initial_timestamp_index!==null){const ee=this.timestamp_begin+this.max_initial_timestamp_index;A.subarray(ee+1).fill(-1/0)}const z=(0,s.log_softmax)(A),q=Math.log(z.subarray(this.timestamp_begin).map(Math.exp).reduce((ee,Y)=>ee+Y)),G=(0,s.max)(z.subarray(0,this.timestamp_begin))[0];q>G&&A.subarray(0,this.timestamp_begin).fill(-1/0)}return T}}class d extends o{constructor(E){super(),this.no_repeat_ngram_size=E}getNgrams(E){const T=E.length,S=[];for(let I=0;I<T+1-this.no_repeat_ngram_size;++I){const V=[];for(let N=0;N<this.no_repeat_ngram_size;++N)V.push(E[I+N]);S.push(V.map(Number))}const A=new Map;for(const I of S){const V=I.slice(0,I.length-1),N=JSON.stringify(V),z=A.get(N)??[];z.push(I[I.length-1]),A.set(N,z)}return A}getGeneratedNgrams(E,T){const S=T.slice(T.length+1-this.no_repeat_ngram_size,T.length);return E.get(JSON.stringify(S.map(Number)))??[]}calcBannedNgramTokens(E){const T=[];if(E.length+1<this.no_repeat_ngram_size)return T;{const S=this.getNgrams(E);return this.getGeneratedNgrams(S,E)}}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data,I=this.calcBannedNgramTokens(E[S]);for(const V of I)A[V]=-1/0}return T}}class f extends o{constructor(E){super(),this.penalty=E}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data;for(const I of new Set(E[S])){const V=Number(I);A[V]<0?A[V]*=this.penalty:A[V]/=this.penalty}}return T}}class p extends o{constructor(E,T){super(),this.min_length=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length<this.min_length){const A=T[S].data;for(const I of this.eos_token_id)A[I]=-1/0}return T}}class m extends o{constructor(E,T,S){super(),this.prompt_length_to_skip=E,this.min_new_tokens=T,this.eos_token_id=Array.isArray(S)?S:[S]}_call(E,T){for(let S=0;S<E.length;++S)if(E[S].length-this.prompt_length_to_skip<this.min_new_tokens){const I=T[S].data;for(const V of this.eos_token_id)I[V]=-1/0}return T}}class b extends o{constructor(E,T){super(),this.bad_words_ids=E,this.eos_token_id=Array.isArray(T)?T:[T]}_call(E,T){for(let S=0;S<E.length;++S){const A=T[S].data,I=E[S];for(const V of this.bad_words_ids){if(I.length<V.length-1)continue;let N=!0;for(let z=1;z<=V.length-1;++z)if(V.at(-z-1)!=I.at(-z)){N=!1;break}N&&(A[V.at(-1)]=-1/0)}}return T}}class g extends o{constructor(E){if(super(),E<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${E}.`);this.guidance_scale=E}_call(E,T){if(T.dims[0]!==2*E.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${T.dims[0]} for the logits and ${E.length} for the input ids.`);const S=E.length,A=T.slice([0,S],null),I=T.slice([S,T.dims[0]],null);for(let V=0;V<I.data.length;++V)I.data[V]+=(A.data[V]-I.data[V])*this.guidance_scale;return I}}class _ extends i{constructor(E){super(),this.temperature=E}_call(E,T){const S=T.data;for(let A=0;A<S.length;++A)S[A]/=this.temperature;return T}}class y extends i{constructor(E,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),E<0||E>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${E}`);if(!Number.isInteger(S)||S<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${S}`);this.top_p=E,this.filter_value=T,this.min_tokens_to_keep=S}}class v extends i{constructor(E,{filter_value:T=-1/0,min_tokens_to_keep:S=1}={}){if(super(),!Number.isInteger(E)||E<0)throw new Error(`\`top_k\` must be a positive integer, but is ${E}`);this.top_k=Math.max(E,S),this.filter_value=T}}},"./src/generation/logits_sampler.js":(e,t,r)=>{r.r(t),r.d(t,{LogitsSampler:()=>i});var n=r("./src/utils/generic.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/maths.js");r("./src/generation/configuration_utils.js");class i extends n.Callable{constructor(c){super(),this.generation_config=c}async _call(c){return this.sample(c)}async sample(c){throw Error("sample should be implemented in subclasses.")}getLogits(c,d){let f=c.dims.at(-1),p=c.data;if(d===-1)p=p.slice(-f);else{let m=d*f;p=p.slice(m,m+f)}return p}randomSelect(c){let d=0;for(let p=0;p<c.length;++p)d+=c[p];let f=Math.random()*d;for(let p=0;p<c.length;++p)if(f-=c[p],f<=0)return p;return 0}static getSampler(c){if(c.do_sample)return new l(c);if(c.num_beams>1)return new u(c);if(c.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${c.num_return_sequences}.`);return new a(c)}}class a extends i{async sample(c){const d=(0,o.max)(c.data)[1];return[[BigInt(d),0]]}}class l extends i{async sample(c){let d=c.dims.at(-1);this.generation_config.top_k>0&&(d=Math.min(this.generation_config.top_k,d));const[f,p]=await(0,s.topk)(c,d),m=(0,o.softmax)(f.data);return Array.from({length:this.generation_config.num_beams},()=>{const b=this.randomSelect(m);return[p.data[b],Math.log(m[b])]})}}class u extends i{async sample(c){let d=c.dims.at(-1);this.generation_config.top_k>0&&(d=Math.min(this.generation_config.top_k,d));const[f,p]=await(0,s.topk)(c,d),m=(0,o.softmax)(f.data);return Array.from({length:this.generation_config.num_beams},(b,g)=>[p.data[g],Math.log(m[g])])}}},"./src/generation/stopping_criteria.js":(e,t,r)=>{r.r(t),r.d(t,{EosTokenCriteria:()=>a,InterruptableStoppingCriteria:()=>l,MaxLengthCriteria:()=>i,StoppingCriteria:()=>s,StoppingCriteriaList:()=>o});var n=r("./src/utils/generic.js");class s extends n.Callable{_call(h,c){throw Error("StoppingCriteria needs to be subclassed")}}class o extends n.Callable{constructor(){super(),this.criteria=[]}push(h){this.criteria.push(h)}extend(h){h instanceof o?h=h.criteria:h instanceof s&&(h=[h]),this.criteria.push(...h)}_call(h,c){const d=new Array(h.length).fill(!1);for(const f of this.criteria){const p=f(h,c);for(let m=0;m<d.length;++m)d[m]||(d[m]=p[m])}return d}[Symbol.iterator](){return this.criteria.values()}}class i extends s{constructor(h,c=null){super(),this.max_length=h,this.max_position_embeddings=c}_call(h){return h.map(c=>c.length>=this.max_length)}}class a extends s{constructor(h){super(),Array.isArray(h)||(h=[h]),this.eos_token_id=h}_call(h,c){return h.map(d=>{const f=d.at(-1);return this.eos_token_id.some(p=>f==p)})}}class l extends s{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(h,c){return new Array(h.length).fill(this.interrupted)}}},"./src/generation/streamers.js":(e,t,r)=>{r.r(t),r.d(t,{BaseStreamer:()=>i,TextStreamer:()=>l,WhisperTextStreamer:()=>u});var n=r("./src/utils/core.js"),s=r("./src/tokenizers.js"),o=r("./src/env.js");class i{put(c){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const a=o.apis.IS_PROCESS_AVAILABLE?h=>process.stdout.write(h):h=>console.log(h);class l extends i{constructor(c,{skip_prompt:d=!1,callback_function:f=null,token_callback_function:p=null,skip_special_tokens:m=!0,decode_kwargs:b={},...g}={}){super(),this.tokenizer=c,this.skip_prompt=d,this.callback_function=f??a,this.token_callback_function=p,this.decode_kwargs={skip_special_tokens:m,...b,...g},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(c){var b;if(c.length>1)throw Error("TextStreamer only supports batch size of 1");const d=this.next_tokens_are_prompt;if(d&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const f=c[0];(b=this.token_callback_function)==null||b.call(this,f),this.token_cache=(0,n.mergeArrays)(this.token_cache,f);const p=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let m;d||p.endsWith(`
`)?(m=p.slice(this.print_len),this.token_cache=[],this.print_len=0):p.length>0&&(0,s.is_chinese_char)(p.charCodeAt(p.length-1))?(m=p.slice(this.print_len),this.print_len+=m.length):(m=p.slice(this.print_len,p.lastIndexOf(" ")+1),this.print_len+=m.length),this.on_finalized_text(m,!1)}end(){let c;this.token_cache.length>0?(c=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):c="",this.next_tokens_are_prompt=!0,this.on_finalized_text(c,!0)}on_finalized_text(c,d){var f,p;c.length>0&&((f=this.callback_function)==null||f.call(this,c)),d&&this.callback_function===a&&o.apis.IS_PROCESS_AVAILABLE&&((p=this.callback_function)==null||p.call(this,`
`))}}class u extends l{constructor(c,{skip_prompt:d=!1,callback_function:f=null,token_callback_function:p=null,on_chunk_start:m=null,on_chunk_end:b=null,on_finalize:g=null,time_precision:_=.02,skip_special_tokens:y=!0,decode_kwargs:v={}}={}){super(c,{skip_prompt:d,skip_special_tokens:y,callback_function:f,token_callback_function:p,decode_kwargs:v}),this.timestamp_begin=c.timestamp_begin,this.on_chunk_start=m,this.on_chunk_end=b,this.on_finalize=g,this.time_precision=_,this.waiting_for_timestamp=!1}put(c){var f,p,m;if(c.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const d=c[0];if(d.length===1){const b=Number(d[0])-this.timestamp_begin;if(b>=0){const g=b*this.time_precision;this.waiting_for_timestamp?(f=this.on_chunk_end)==null||f.call(this,g):(p=this.on_chunk_start)==null||p.call(this,g),this.waiting_for_timestamp=!this.waiting_for_timestamp,(m=this.token_callback_function)==null||m.call(this,d);return}}return super.put(c)}end(){var c;super.end(),(c=this.on_finalize)==null||c.call(this)}}},"./src/models.js":(e,t,r)=>{r.r(t),r.d(t,{ASTForAudioClassification:()=>ah,ASTModel:()=>ih,ASTPreTrainedModel:()=>_l,AlbertForMaskedLM:()=>Ye,AlbertForQuestionAnswering:()=>st,AlbertForSequenceClassification:()=>He,AlbertModel:()=>Ie,AlbertPreTrainedModel:()=>me,ArceeForCausalLM:()=>Xo,ArceeModel:()=>on,ArceePreTrainedModel:()=>rr,AutoModel:()=>Yg,AutoModelForAudioClassification:()=>aP,AutoModelForAudioFrameClassification:()=>uP,AutoModelForAudioTextToText:()=>yP,AutoModelForCTC:()=>iP,AutoModelForCausalLM:()=>QE,AutoModelForDepthEstimation:()=>fP,AutoModelForDocumentQuestionAnswering:()=>cP,AutoModelForImageClassification:()=>ZE,AutoModelForImageFeatureExtraction:()=>gP,AutoModelForImageMatting:()=>dP,AutoModelForImageSegmentation:()=>eP,AutoModelForImageTextToText:()=>_P,AutoModelForImageToImage:()=>hP,AutoModelForMaskGeneration:()=>oP,AutoModelForMaskedLM:()=>XE,AutoModelForNormalEstimation:()=>pP,AutoModelForObjectDetection:()=>nP,AutoModelForPoseEstimation:()=>mP,AutoModelForQuestionAnswering:()=>JE,AutoModelForSemanticSegmentation:()=>tP,AutoModelForSeq2SeqLM:()=>GE,AutoModelForSequenceClassification:()=>VE,AutoModelForSpeechSeq2Seq:()=>HE,AutoModelForTextToSpectrogram:()=>KE,AutoModelForTextToWaveform:()=>qE,AutoModelForTokenClassification:()=>WE,AutoModelForUniversalSegmentation:()=>rP,AutoModelForVision2Seq:()=>YE,AutoModelForXVector:()=>lP,AutoModelForZeroShotObjectDetection:()=>sP,BartForConditionalGeneration:()=>Ys,BartForSequenceClassification:()=>gr,BartModel:()=>nn,BartPretrainedModel:()=>Wn,BaseModelOutput:()=>Ee,BeitForImageClassification:()=>h1,BeitModel:()=>d1,BeitPreTrainedModel:()=>hg,BertForMaskedLM:()=>ye,BertForQuestionAnswering:()=>Oe,BertForSequenceClassification:()=>ke,BertForTokenClassification:()=>be,BertModel:()=>Pe,BertPreTrainedModel:()=>Me,BlenderbotForConditionalGeneration:()=>zr,BlenderbotModel:()=>sn,BlenderbotPreTrainedModel:()=>Dn,BlenderbotSmallForConditionalGeneration:()=>Fn,BlenderbotSmallModel:()=>Qr,BlenderbotSmallPreTrainedModel:()=>wr,BloomForCausalLM:()=>Dx,BloomModel:()=>Ox,BloomPreTrainedModel:()=>eg,CLIPModel:()=>bl,CLIPPreTrainedModel:()=>Zs,CLIPSegForImageSegmentation:()=>wa,CLIPSegModel:()=>hs,CLIPSegPreTrainedModel:()=>wi,CLIPTextModel:()=>vh,CLIPTextModelWithProjection:()=>tc,CLIPVisionModel:()=>wh,CLIPVisionModelWithProjection:()=>rc,CamembertForMaskedLM:()=>Ct,CamembertForQuestionAnswering:()=>lt,CamembertForSequenceClassification:()=>Tt,CamembertForTokenClassification:()=>Ot,CamembertModel:()=>dt,CamembertPreTrainedModel:()=>Re,CausalLMOutput:()=>xi,CausalLMOutputWithPast:()=>Mz,ChineseCLIPModel:()=>va,ChineseCLIPPreTrainedModel:()=>oc,ClapAudioModelWithProjection:()=>ET,ClapModel:()=>MT,ClapPreTrainedModel:()=>$h,ClapTextModelWithProjection:()=>TT,CodeGenForCausalLM:()=>j,CodeGenModel:()=>D,CodeGenPreTrainedModel:()=>C,CohereForCausalLM:()=>hx,CohereModel:()=>dx,CoherePreTrainedModel:()=>Wm,ConvBertForMaskedLM:()=>Ge,ConvBertForQuestionAnswering:()=>Wt,ConvBertForSequenceClassification:()=>Ht,ConvBertForTokenClassification:()=>ct,ConvBertModel:()=>Xs,ConvBertPreTrainedModel:()=>Yr,ConvNextForImageClassification:()=>iM,ConvNextModel:()=>oM,ConvNextPreTrainedModel:()=>Sg,ConvNextV2ForImageClassification:()=>lM,ConvNextV2Model:()=>aM,ConvNextV2PreTrainedModel:()=>Cg,DFineForObjectDetection:()=>E1,DFineModel:()=>T1,DFinePreTrainedModel:()=>yg,DINOv3ConvNextModel:()=>gM,DINOv3ConvNextPreTrainedModel:()=>mM,DINOv3ViTModel:()=>pM,DINOv3ViTPreTrainedModel:()=>fM,DPTForDepthEstimation:()=>B1,DPTModel:()=>z1,DPTPreTrainedModel:()=>Tg,DacDecoderModel:()=>fE,DacDecoderOutput:()=>cE,DacEncoderModel:()=>hE,DacEncoderOutput:()=>uE,DacModel:()=>dE,DacPreTrainedModel:()=>Lh,DebertaForMaskedLM:()=>In,DebertaForQuestionAnswering:()=>Zr,DebertaForSequenceClassification:()=>Vn,DebertaForTokenClassification:()=>Lr,DebertaModel:()=>ur,DebertaPreTrainedModel:()=>Kt,DebertaV2ForMaskedLM:()=>$s,DebertaV2ForQuestionAnswering:()=>Ao,DebertaV2ForSequenceClassification:()=>fn,DebertaV2ForTokenClassification:()=>$o,DebertaV2Model:()=>ks,DebertaV2PreTrainedModel:()=>Nr,DecisionTransformerModel:()=>HT,DecisionTransformerPreTrainedModel:()=>GT,DeiTForImageClassification:()=>$1,DeiTModel:()=>k1,DeiTPreTrainedModel:()=>wg,DepthAnythingForDepthEstimation:()=>V1,DepthAnythingPreTrainedModel:()=>U1,DepthProForDepthEstimation:()=>q1,DepthProPreTrainedModel:()=>K1,DetrForObjectDetection:()=>p1,DetrForSegmentation:()=>fg,DetrModel:()=>f1,DetrObjectDetectionOutput:()=>pg,DetrPreTrainedModel:()=>Mh,DetrSegmentationOutput:()=>m1,Dinov2ForImageClassification:()=>cM,Dinov2Model:()=>uM,Dinov2PreTrainedModel:()=>kg,Dinov2WithRegistersForImageClassification:()=>hM,Dinov2WithRegistersModel:()=>dM,Dinov2WithRegistersPreTrainedModel:()=>$g,DistilBertForMaskedLM:()=>qr,DistilBertForQuestionAnswering:()=>Is,DistilBertForSequenceClassification:()=>rs,DistilBertForTokenClassification:()=>Pn,DistilBertModel:()=>As,DistilBertPreTrainedModel:()=>rn,DonutSwinModel:()=>sM,DonutSwinPreTrainedModel:()=>nM,EdgeTamModel:()=>SM,EfficientNetForImageClassification:()=>IT,EfficientNetModel:()=>AT,EfficientNetPreTrainedModel:()=>Ug,ElectraForMaskedLM:()=>B,ElectraForQuestionAnswering:()=>xe,ElectraForSequenceClassification:()=>Z,ElectraForTokenClassification:()=>ue,ElectraModel:()=>re,ElectraPreTrainedModel:()=>$,Ernie4_5_ForCausalLM:()=>yT,Ernie4_5_Model:()=>_T,Ernie4_5_PretrainedModel:()=>Lg,EsmForMaskedLM:()=>Ko,EsmForSequenceClassification:()=>On,EsmForTokenClassification:()=>Ve,EsmModel:()=>Os,EsmPreTrainedModel:()=>$r,ExaoneForCausalLM:()=>ex,ExaoneModel:()=>Zb,ExaonePreTrainedModel:()=>Nm,FalconForCausalLM:()=>xT,FalconModel:()=>bT,FalconPreTrainedModel:()=>jg,FastViTForImageClassification:()=>e1,FastViTModel:()=>Zx,FastViTPreTrainedModel:()=>ag,Florence2ForConditionalGeneration:()=>fh,Florence2PreTrainedModel:()=>hh,GLPNForDepthEstimation:()=>rM,GLPNModel:()=>tM,GLPNPreTrainedModel:()=>Pg,GPT2LMHeadModel:()=>uc,GPT2Model:()=>lc,GPT2PreTrainedModel:()=>ba,GPTBigCodeForCausalLM:()=>w,GPTBigCodeModel:()=>mc,GPTBigCodePreTrainedModel:()=>Cl,GPTJForCausalLM:()=>pc,GPTJModel:()=>fc,GPTJPreTrainedModel:()=>Sl,GPTNeoForCausalLM:()=>xa,GPTNeoModel:()=>dc,GPTNeoPreTrainedModel:()=>El,GPTNeoXForCausalLM:()=>hc,GPTNeoXModel:()=>Pl,GPTNeoXPreTrainedModel:()=>Ma,Gemma2ForCausalLM:()=>gx,Gemma2Model:()=>mx,Gemma2PreTrainedModel:()=>Hm,Gemma3ForCausalLM:()=>wx,Gemma3Model:()=>vx,Gemma3PreTrainedModel:()=>qm,Gemma3nForConditionalGeneration:()=>Zu,Gemma3nPreTrainedModel:()=>_h,GemmaForCausalLM:()=>px,GemmaModel:()=>fx,GemmaPreTrainedModel:()=>Gm,GlmForCausalLM:()=>Yb,GlmModel:()=>Jb,GlmPreTrainedModel:()=>Lm,GraniteForCausalLM:()=>lx,GraniteModel:()=>ax,GraniteMoeHybridForCausalLM:()=>cx,GraniteMoeHybridModel:()=>ux,GraniteMoeHybridPreTrainedModel:()=>Vm,GranitePreTrainedModel:()=>Um,GroundingDinoForObjectDetection:()=>yM,GroundingDinoPreTrainedModel:()=>_M,GroupViTModel:()=>Yx,GroupViTPreTrainedModel:()=>Jx,HeliumForCausalLM:()=>Xb,HeliumModel:()=>Qb,HeliumPreTrainedModel:()=>Rm,HieraForImageClassification:()=>I1,HieraModel:()=>A1,HieraPreTrainedModel:()=>bg,HubertForCTC:()=>eT,HubertForSequenceClassification:()=>tT,HubertModel:()=>ZM,HubertPreTrainedModel:()=>uz,IJepaForImageClassification:()=>Ux,IJepaModel:()=>Bx,IJepaPreTrainedModel:()=>sg,Idefics3ForConditionalGeneration:()=>Io,Idefics3PreTrainedModel:()=>ya,ImageMattingOutput:()=>wP,JAISLMHeadModel:()=>cc,JAISModel:()=>Tl,JAISPreTrainedModel:()=>Ml,JinaCLIPModel:()=>xh,JinaCLIPPreTrainedModel:()=>vt,JinaCLIPTextModel:()=>ic,JinaCLIPVisionModel:()=>ac,Lfm2ForCausalLM:()=>Hb,Lfm2Model:()=>Gb,Lfm2PreTrainedModel:()=>gc,LiteWhisperForConditionalGeneration:()=>lh,Llama4ForCausalLM:()=>et,Llama4PreTrainedModel:()=>Ue,LlamaForCausalLM:()=>Ae,LlamaModel:()=>fe,LlamaPreTrainedModel:()=>K,LlavaForConditionalGeneration:()=>_a,LlavaOnevisionForConditionalGeneration:()=>ch,LlavaPreTrainedModel:()=>ga,LlavaQwen2ForCausalLM:()=>gh,LongT5ForConditionalGeneration:()=>ar,LongT5Model:()=>Ar,LongT5PreTrainedModel:()=>Yt,M2M100ForConditionalGeneration:()=>IM,M2M100Model:()=>AM,M2M100PreTrainedModel:()=>Og,MBartForCausalLM:()=>xn,MBartForConditionalGeneration:()=>Ds,MBartForSequenceClassification:()=>Fs,MBartModel:()=>bn,MBartPreTrainedModel:()=>jr,MPNetForMaskedLM:()=>ha,MPNetForQuestionAnswering:()=>ma,MPNetForSequenceClassification:()=>fa,MPNetForTokenClassification:()=>pa,MPNetModel:()=>da,MPNetPreTrainedModel:()=>ds,MT5ForConditionalGeneration:()=>Pr,MT5Model:()=>Ir,MT5PreTrainedModel:()=>Er,MarianMTModel:()=>$M,MarianModel:()=>kM,MarianPreTrainedModel:()=>Ig,MaskFormerForInstanceSegmentation:()=>eM,MaskFormerModel:()=>Z1,MaskFormerPreTrainedModel:()=>Eg,MaskedLMOutput:()=>pn,Metric3DForDepthEstimation:()=>X1,Metric3DPreTrainedModel:()=>Q1,Metric3Dv2ForDepthEstimation:()=>Y1,Metric3Dv2PreTrainedModel:()=>J1,MgpstrForSceneTextRecognition:()=>JT,MgpstrModelOutput:()=>QT,MgpstrPreTrainedModel:()=>XT,MimiDecoderModel:()=>lE,MimiDecoderOutput:()=>oE,MimiEncoderModel:()=>aE,MimiEncoderOutput:()=>sE,MimiModel:()=>iE,MimiPreTrainedModel:()=>Rh,MistralForCausalLM:()=>gT,MistralModel:()=>mT,MistralPreTrainedModel:()=>Rg,MobileBertForMaskedLM:()=>cr,MobileBertForQuestionAnswering:()=>Js,MobileBertForSequenceClassification:()=>qo,MobileBertModel:()=>ut,MobileBertPreTrainedModel:()=>We,MobileLLMForCausalLM:()=>rx,MobileLLMModel:()=>tx,MobileLLMPreTrainedModel:()=>jm,MobileNetV1ForImageClassification:()=>DT,MobileNetV1ForSemanticSegmentation:()=>FT,MobileNetV1Model:()=>OT,MobileNetV1PreTrainedModel:()=>Ih,MobileNetV2ForImageClassification:()=>LT,MobileNetV2ForSemanticSegmentation:()=>NT,MobileNetV2Model:()=>RT,MobileNetV2PreTrainedModel:()=>Oh,MobileNetV3ForImageClassification:()=>zT,MobileNetV3ForSemanticSegmentation:()=>BT,MobileNetV3Model:()=>jT,MobileNetV3PreTrainedModel:()=>Dh,MobileNetV4ForImageClassification:()=>VT,MobileNetV4ForSemanticSegmentation:()=>WT,MobileNetV4Model:()=>UT,MobileNetV4PreTrainedModel:()=>Fh,MobileViTForImageClassification:()=>s1,MobileViTModel:()=>n1,MobileViTPreTrainedModel:()=>lg,MobileViTV2ForImageClassification:()=>i1,MobileViTV2Model:()=>o1,MobileViTV2PreTrainedModel:()=>ug,ModelOutput:()=>pe,ModernBertDecoderForCausalLM:()=>pr,ModernBertDecoderModel:()=>yt,ModernBertDecoderPreTrainedModel:()=>jt,ModernBertForMaskedLM:()=>qe,ModernBertForSequenceClassification:()=>Mt,ModernBertForTokenClassification:()=>bt,ModernBertModel:()=>Ne,ModernBertPreTrainedModel:()=>nt,Moondream1ForConditionalGeneration:()=>dh,MoonshineForConditionalGeneration:()=>uh,MoonshineModel:()=>Dm,MoonshinePreTrainedModel:()=>vl,MptForCausalLM:()=>Rx,MptModel:()=>Fx,MptPreTrainedModel:()=>tg,MultiModalityCausalLM:()=>qT,MultiModalityPreTrainedModel:()=>KT,MusicgenForCausalLM:()=>fz,MusicgenForConditionalGeneration:()=>Wg,MusicgenModel:()=>hz,MusicgenPreTrainedModel:()=>Vg,NanoChatForCausalLM:()=>Qt,NanoChatModel:()=>Ft,NanoChatPreTrainedModel:()=>ht,NeoBertForMaskedLM:()=>Te,NeoBertForQuestionAnswering:()=>it,NeoBertForSequenceClassification:()=>ot,NeoBertForTokenClassification:()=>Ze,NeoBertModel:()=>Je,NeoBertPreTrainedModel:()=>je,NomicBertModel:()=>Rr,NomicBertPreTrainedModel:()=>Hr,OPTForCausalLM:()=>Nx,OPTModel:()=>Lx,OPTPreTrainedModel:()=>rg,Olmo2ForCausalLM:()=>ix,Olmo2Model:()=>ox,Olmo2PreTrainedModel:()=>Bm,OlmoForCausalLM:()=>sx,OlmoModel:()=>nx,OlmoPreTrainedModel:()=>zm,OpenELMForCausalLM:()=>xx,OpenELMModel:()=>bx,OpenELMPreTrainedModel:()=>Qm,OwlViTForObjectDetection:()=>l1,OwlViTModel:()=>a1,OwlViTPreTrainedModel:()=>cg,Owlv2ForObjectDetection:()=>c1,Owlv2Model:()=>u1,Owlv2PreTrainedModel:()=>dg,PaliGemmaForConditionalGeneration:()=>mh,PaliGemmaPreTrainedModel:()=>ph,ParakeetForCTC:()=>NM,ParakeetPreTrainedModel:()=>LM,PatchTSMixerForPrediction:()=>tE,PatchTSMixerModel:()=>eE,PatchTSMixerPreTrainedModel:()=>Hg,PatchTSTForPrediction:()=>ZT,PatchTSTModel:()=>YT,PatchTSTPreTrainedModel:()=>Gg,Phi3ForCausalLM:()=>Ix,Phi3Model:()=>Ax,Phi3PreTrainedModel:()=>Zm,Phi3VForCausalLM:()=>ec,Phi3VPreTrainedModel:()=>yh,PhiForCausalLM:()=>$x,PhiModel:()=>kx,PhiPreTrainedModel:()=>Ym,PreTrainedModel:()=>F,PretrainedMixin:()=>er,PvtForImageClassification:()=>Hx,PvtModel:()=>Gx,PvtPreTrainedModel:()=>og,PyAnnoteForAudioFrameClassification:()=>zM,PyAnnoteModel:()=>jM,PyAnnotePreTrainedModel:()=>Dg,QuestionAnsweringModelOutput:()=>Sn,Qwen2ForCausalLM:()=>Tx,Qwen2Model:()=>Mx,Qwen2PreTrainedModel:()=>Xm,Qwen2VLForConditionalGeneration:()=>Cx,Qwen2VLPreTrainedModel:()=>Sx,Qwen3ForCausalLM:()=>Px,Qwen3Model:()=>Ex,Qwen3PreTrainedModel:()=>Jm,RFDetrForObjectDetection:()=>x1,RFDetrModel:()=>b1,RFDetrObjectDetectionOutput:()=>M1,RFDetrPreTrainedModel:()=>_g,RTDetrForObjectDetection:()=>_1,RTDetrModel:()=>g1,RTDetrObjectDetectionOutput:()=>_c,RTDetrPreTrainedModel:()=>mg,RTDetrV2ForObjectDetection:()=>v1,RTDetrV2Model:()=>y1,RTDetrV2ObjectDetectionOutput:()=>w1,RTDetrV2PreTrainedModel:()=>gg,ResNetForImageClassification:()=>D1,ResNetModel:()=>O1,ResNetPreTrainedModel:()=>xg,RoFormerForMaskedLM:()=>Kr,RoFormerForQuestionAnswering:()=>Cs,RoFormerForSequenceClassification:()=>Qs,RoFormerForTokenClassification:()=>ko,RoFormerModel:()=>mr,RoFormerPreTrainedModel:()=>wn,RobertaForMaskedLM:()=>Qd,RobertaForQuestionAnswering:()=>Jd,RobertaForSequenceClassification:()=>qu,RobertaForTokenClassification:()=>Xd,RobertaModel:()=>gl,RobertaPreTrainedModel:()=>Rs,Sam2ImageSegmentationOutput:()=>EM,Sam2Model:()=>Ph,Sam2PreTrainedModel:()=>PM,Sam3TrackerModel:()=>CM,SamImageSegmentationOutput:()=>TM,SamModel:()=>MM,SamPreTrainedModel:()=>xM,SapiensForDepthEstimation:()=>G1,SapiensForNormalEstimation:()=>H1,SapiensForSemanticSegmentation:()=>W1,SapiensPreTrainedModel:()=>Eh,SegformerForImageClassification:()=>ST,SegformerForSemanticSegmentation:()=>CT,SegformerModel:()=>dz,SegformerPreTrainedModel:()=>Ah,Seq2SeqLMOutput:()=>xz,SequenceClassifierOutput:()=>Rt,SiglipModel:()=>nc,SiglipPreTrainedModel:()=>xl,SiglipTextModel:()=>bh,SiglipVisionModel:()=>sc,SmolLM3ForCausalLM:()=>qb,SmolLM3Model:()=>Kb,SmolLM3PreTrainedModel:()=>Fm,SmolVLMForConditionalGeneration:()=>wl,SnacDecoderModel:()=>gE,SnacEncoderModel:()=>mE,SnacModel:()=>pE,SnacPreTrainedModel:()=>Nh,SpeechT5ForSpeechToText:()=>uT,SpeechT5ForTextToSpeech:()=>cT,SpeechT5HifiGan:()=>dT,SpeechT5Model:()=>cz,SpeechT5PreTrainedModel:()=>kh,SqueezeBertForMaskedLM:()=>H,SqueezeBertForQuestionAnswering:()=>he,SqueezeBertForSequenceClassification:()=>ie,SqueezeBertModel:()=>O,SqueezeBertPreTrainedModel:()=>ge,StableLmForCausalLM:()=>$T,StableLmModel:()=>kT,StableLmPreTrainedModel:()=>Bg,Starcoder2ForCausalLM:()=>wT,Starcoder2Model:()=>vT,Starcoder2PreTrainedModel:()=>Ng,StyleTextToSpeech2Model:()=>lT,StyleTextToSpeech2PreTrainedModel:()=>aT,SupertonicForConditionalGeneration:()=>Fg,SupertonicPreTrainedModel:()=>hT,Swin2SRForImageSuperResolution:()=>j1,Swin2SRModel:()=>N1,Swin2SRPreTrainedModel:()=>Mg,SwinForImageClassification:()=>R1,SwinForSemanticSegmentation:()=>L1,SwinModel:()=>F1,SwinPreTrainedModel:()=>Th,T5ForConditionalGeneration:()=>qt,T5Model:()=>$t,T5PreTrainedModel:()=>at,TableTransformerForObjectDetection:()=>S1,TableTransformerModel:()=>P1,TableTransformerObjectDetectionOutput:()=>C1,TableTransformerPreTrainedModel:()=>vg,TokenClassifierOutput:()=>an,TrOCRForCausalLM:()=>pT,TrOCRPreTrainedModel:()=>fT,UltravoxModel:()=>Kg,UltravoxPreTrainedModel:()=>rE,UniSpeechForCTC:()=>WM,UniSpeechForSequenceClassification:()=>GM,UniSpeechModel:()=>VM,UniSpeechPreTrainedModel:()=>Sh,UniSpeechSatForAudioFrameClassification:()=>QM,UniSpeechSatForCTC:()=>KM,UniSpeechSatForSequenceClassification:()=>qM,UniSpeechSatModel:()=>HM,UniSpeechSatPreTrainedModel:()=>yc,VaultGemmaForCausalLM:()=>yx,VaultGemmaModel:()=>_x,VaultGemmaPreTrainedModel:()=>Km,ViTForImageClassification:()=>zx,ViTMAEModel:()=>qx,ViTMAEPreTrainedModel:()=>Kx,ViTMSNForImageClassification:()=>Xx,ViTMSNModel:()=>Qx,ViTMSNPreTrainedModel:()=>ig,ViTModel:()=>jx,ViTPreTrainedModel:()=>ng,VisionEncoderDecoderModel:()=>Yu,VitMatteForImageMatting:()=>r1,VitMattePreTrainedModel:()=>t1,VitPoseForPoseEstimation:()=>Wx,VitPosePreTrainedModel:()=>Vx,VitsModel:()=>zg,VitsModelOutput:()=>bP,VitsPreTrainedModel:()=>PT,VoxtralForConditionalGeneration:()=>nE,Wav2Vec2BertForCTC:()=>JM,Wav2Vec2BertForSequenceClassification:()=>YM,Wav2Vec2BertModel:()=>XM,Wav2Vec2BertPreTrainedModel:()=>Ch,Wav2Vec2ForAudioFrameClassification:()=>RM,Wav2Vec2ForCTC:()=>DM,Wav2Vec2ForSequenceClassification:()=>FM,Wav2Vec2Model:()=>OM,Wav2Vec2PreTrainedModel:()=>bi,WavLMForAudioFrameClassification:()=>iT,WavLMForCTC:()=>nT,WavLMForSequenceClassification:()=>sT,WavLMForXVector:()=>oT,WavLMModel:()=>rT,WavLMPreTrainedModel:()=>kl,WeSpeakerResNetModel:()=>UM,WeSpeakerResNetPreTrainedModel:()=>BM,WhisperForConditionalGeneration:()=>Qo,WhisperModel:()=>Ju,WhisperPreTrainedModel:()=>yl,XLMForQuestionAnswering:()=>rh,XLMForSequenceClassification:()=>eh,XLMForTokenClassification:()=>th,XLMModel:()=>Yd,XLMPreTrainedModel:()=>yi,XLMRobertaForMaskedLM:()=>sh,XLMRobertaForQuestionAnswering:()=>Xu,XLMRobertaForSequenceClassification:()=>oh,XLMRobertaForTokenClassification:()=>Qu,XLMRobertaModel:()=>nh,XLMRobertaPreTrainedModel:()=>vi,XLMWithLMHeadModel:()=>Zd,XVectorOutput:()=>vP,YolosForObjectDetection:()=>wM,YolosModel:()=>vM,YolosObjectDetectionOutput:()=>bM,YolosPreTrainedModel:()=>Ag});var n=r("./src/configs.js"),s=r("./src/backends/onnx.js"),o=r("./src/utils/dtypes.js"),i=r("./src/utils/generic.js"),a=r("./src/utils/core.js"),l=r("./src/utils/hub.js"),u=r("./src/utils/constants.js"),h=r("./src/generation/logits_process.js"),c=r("./src/generation/configuration_utils.js"),d=r("./src/utils/tensor.js"),f=r("./src/utils/image.js"),p=r("./src/utils/maths.js"),m=r("./src/generation/stopping_criteria.js"),b=r("./src/generation/logits_sampler.js"),g=r("./src/env.js"),_=r("./src/models/whisper/generation_whisper.js"),y=r("./src/models/whisper/common_whisper.js");const v={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12,Supertonic:13},M=new Map,E=new Map,T=new Map;async function S(P,k,L){var mn;let de=((mn=L.config)==null?void 0:mn["transformers.js_config"])??{},ve=L.device??de.device;ve&&typeof ve!="string"&&(ve.hasOwnProperty(k)?ve=ve[k]:(console.warn(`device not specified for "${k}". Using the default device.`),ve=null));const _e=ve??(g.apis.IS_NODE_ENV?"cpu":"wasm"),Se=(0,s.deviceToExecutionProviders)(_e),ze=de.device_config??{};ze.hasOwnProperty(_e)&&(de={...de,...ze[_e]});let Qe=L.dtype??de.dtype;if(typeof Qe!="string"&&(Qe&&Qe.hasOwnProperty(k)?Qe=Qe[k]:(Qe=o.DEFAULT_DEVICE_DTYPE_MAPPING[_e]??o.DATA_TYPES.fp32,console.warn(`dtype not specified for "${k}". Using the default dtype (${Qe}) for this device (${_e}).`))),Qe===o.DATA_TYPES.auto){let Bt=de.dtype;typeof Bt!="string"&&(Bt=Bt==null?void 0:Bt[k]),Bt&&Bt!==o.DATA_TYPES.auto&&o.DATA_TYPES.hasOwnProperty(Bt)?Qe=Bt:Qe=o.DEFAULT_DEVICE_DTYPE_MAPPING[_e]??o.DATA_TYPES.fp32}const tt=Qe;if(o.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(tt)){if(tt===o.DATA_TYPES.fp16&&_e==="webgpu"&&!await(0,o.isWebGpuFp16Supported)())throw new Error(`The device (${_e}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${tt}. Should be one of: ${Object.keys(o.DATA_TYPES).join(", ")}`);const xt=de.kv_cache_dtype,St=xt?typeof xt=="string"?xt:xt[tt]??"float32":void 0;if(St&&!["float32","float16"].includes(St))throw new Error(`Invalid kv_cache_dtype: ${St}. Should be one of: float32, float16`);const At={dtype:tt,kv_cache_dtype:St,device:_e},Vt=o.DEFAULT_DTYPE_SUFFIX_MAPPING[tt],Et=`${k}${Vt}.onnx`,Dt=`${L.subfolder??""}/${Et}`,mt={...L.session_options};mt.executionProviders??(mt.executionProviders=Se);const zt=de.free_dimension_overrides;zt?mt.freeDimensionOverrides??(mt.freeDimensionOverrides=zt):_e.startsWith("webnn")&&!mt.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${_e}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const Zt=g.apis.IS_NODE_ENV&&g.env.useFSCache,hr=(0,l.getModelFile)(P,Dt,!0,L,Zt),_r=L.use_external_data_format??de.use_external_data_format;let br=[];if(_r){let Bt;typeof _r=="object"?_r.hasOwnProperty(Et)?Bt=_r[Et]:_r.hasOwnProperty(k)?Bt=_r[k]:Bt=!1:Bt=_r;const ln=+Bt;if(ln>l.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${ln}) exceeds the maximum allowed value (${l.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let fs=0;fs<ln;++fs){const Ta=`${Et}_data${fs===0?"":"_"+fs}`,Gn=`${L.subfolder??""}/${Ta}`;br.push(new Promise(async(Ls,jh)=>{const Ea=await(0,l.getModelFile)(P,Gn,!0,L,Zt);Ls(Ea instanceof Uint8Array?{path:Ta,data:Ea}:Ta)}))}}else mt.externalData!==void 0&&(br=mt.externalData.map(async Bt=>{if(typeof Bt.data=="string"){const ln=await(0,l.getModelFile)(P,Bt.data,!0,L);return{...Bt,data:ln}}return Bt}));if(br.length>0){const Bt=await Promise.all(br);g.apis.IS_NODE_ENV||(mt.externalData=Bt)}if(_e==="webgpu"){const Bt=(0,n.getCacheShapes)(L.config,{prefix:"present"});if(Object.keys(Bt).length>0&&!(0,s.isONNXProxy)()){const ln={};for(const fs in Bt)ln[fs]="gpu-buffer";mt.preferredOutputLocation=ln}}return{buffer_or_path:await hr,session_options:mt,session_config:At}}async function A(P,k,L){return Object.fromEntries(await Promise.all(Object.keys(k).map(async de=>{const{buffer_or_path:ve,session_options:_e,session_config:Se}=await S(P,k[de],L),ze=await(0,s.createInferenceSession)(ve,_e,Se);return[de,ze]})))}async function I(P,k,L){return Object.fromEntries(await Promise.all(Object.keys(k).map(async de=>{const ve=await(0,l.getModelJSON)(P,k[de],!1,L);return[de,ve]})))}function V(P,k){const L=Object.create(null),de=[];for(const Se of P.inputNames){const ze=k[Se];if(!(ze instanceof d.Tensor)){de.push(Se);continue}L[Se]=(0,s.isONNXProxy)()?ze.clone():ze}if(de.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${de.join(", ")}.`);const ve=Object.keys(k).length,_e=P.inputNames.length;if(ve>_e){let Se=Object.keys(k).filter(ze=>!P.inputNames.includes(ze));console.warn(`WARNING: Too many inputs were provided (${ve} > ${_e}). The following inputs will be ignored: "${Se.join(", ")}".`)}return L}async function N(P,k){const L=V(P,k);try{const de=Object.fromEntries(Object.entries(L).map(([_e,Se])=>[_e,Se.ort_tensor])),ve=await(0,s.runInferenceSession)(P,de);return z(ve)}catch(de){const ve=Object.fromEntries(Object.entries(L).map(([_e,Se])=>{const ze={type:Se.type,dims:Se.dims,location:Se.location};return ze.location!=="gpu-buffer"&&(ze.data=Se.data),[_e,ze]}));throw console.error(`An error occurred during model execution: "${de}".`),console.error("Inputs given to model:",ve),de}}function z(P){for(let k in P)(0,s.isONNXTensor)(P[k])?P[k]=new d.Tensor(P[k]):typeof P[k]=="object"&&z(P[k]);return P}function q(P){if(P instanceof d.Tensor)return P;if(P.length===0)throw Error("items must be non-empty");if(Array.isArray(P[0])){if(P.some(k=>k.length!==P[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new d.Tensor("int64",BigInt64Array.from(P.flat().map(k=>BigInt(k))),[P.length,P[0].length])}else return new d.Tensor("int64",BigInt64Array.from(P.map(k=>BigInt(k))),[1,P.length])}function G(P){return new d.Tensor("bool",[P],[1])}async function ee(P,k){let{encoder_outputs:L,input_ids:de,decoder_input_ids:ve,..._e}=k;if(!L){const ze=(0,a.pick)(k,P.sessions.model.inputNames);L=(await Y(P,ze)).last_hidden_state}return _e.input_ids=ve,_e.encoder_hidden_states=L,P.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(_e.encoder_attention_mask=k.attention_mask),await te(P,_e,!0)}async function Y(P,k){const L=P.sessions.model,de=(0,a.pick)(k,L.inputNames);if(L.inputNames.includes("inputs_embeds")&&!de.inputs_embeds){if(!k.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");de.inputs_embeds=await P.encode_text({input_ids:k.input_ids})}if(L.inputNames.includes("token_type_ids")&&!de.token_type_ids){if(!de.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");de.token_type_ids=(0,d.zeros_like)(de.input_ids)}if(L.inputNames.includes("pixel_mask")&&!de.pixel_mask){if(!de.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const ve=de.pixel_values.dims;de.pixel_mask=(0,d.ones)([ve[0],ve[2],ve[3]])}return await N(L,de)}async function W(P,k){const L=await P.encode(k);return await P.decode(L)}async function te(P,k,L=!1){const de=P.sessions[L?"decoder_model_merged":"model"],{past_key_values:ve,..._e}=k;if(de.inputNames.includes("use_cache_branch")&&(_e.use_cache_branch=G(!!ve)),de.inputNames.includes("position_ids")&&_e.attention_mask&&!_e.position_ids){const ze=["paligemma","gemma3_text","gemma3"].includes(P.config.model_type)?1:0;_e.position_ids=we(_e,ve,ze)}P.addPastKeyValues(_e,ve);const Se=(0,a.pick)(_e,de.inputNames);return await N(de,Se)}function le({modality_token_id:P,inputs_embeds:k,modality_features:L,input_ids:de,attention_mask:ve}){const _e=de.tolist().map(tt=>tt.reduce((xt,St,At)=>(St==P&&xt.push(At),xt),[])),Se=_e.reduce((tt,xt)=>tt+xt.length,0),ze=L.dims[0];if(Se!==ze)throw new Error(`Number of tokens and features do not match: tokens: ${Se}, features ${ze}`);let Qe=0;for(let tt=0;tt<_e.length;++tt){const xt=_e[tt],St=k[tt];for(let At=0;At<xt.length;++At)St[xt[At]].data.set(L[Qe++].data)}return{inputs_embeds:k,attention_mask:ve}}function oe({image_token_id:P,inputs_embeds:k,image_features:L,input_ids:de,attention_mask:ve}){return le({modality_token_id:P,inputs_embeds:k,modality_features:L,input_ids:de,attention_mask:ve})}function U({audio_token_id:P,inputs_embeds:k,audio_features:L,input_ids:de,attention_mask:ve}){return le({modality_token_id:P,inputs_embeds:k,modality_features:L,input_ids:de,attention_mask:ve})}async function R(P,{encode_function:k,merge_function:L,modality_input_name:de,modality_output_name:ve,input_ids:_e=null,attention_mask:Se=null,position_ids:ze=null,inputs_embeds:Qe=null,past_key_values:tt=null,generation_config:xt=null,logits_processor:St=null,...At}){const Vt=At[de];if(!Qe){if(Qe=await P.encode_text({input_ids:_e,...At}),Vt&&_e.dims[1]!==1){const Dt=await k({[de]:Vt,...At});({inputs_embeds:Qe,attention_mask:Se}=L({[ve]:Dt,inputs_embeds:Qe,input_ids:_e,attention_mask:Se}))}else if(tt&&Vt&&_e.dims[1]===1){const Dt=_e.dims[1],mt=Object.values(tt)[0].dims.at(-2);Se=(0,d.cat)([(0,d.ones)([_e.dims[0],mt]),Se.slice(null,[Se.dims[1]-Dt,Se.dims[1]])],1)}}if(!ze&&P.config.model_type==="qwen2_vl"){const{image_grid_thw:Dt,video_grid_thw:mt}=At;[ze]=P.get_rope_index(_e,Dt,mt,Se)}return await te(P,{inputs_embeds:Qe,past_key_values:tt,attention_mask:Se,position_ids:ze,generation_config:xt,logits_processor:St},!0)}async function X(P,k){return await R(P,{...k,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:P.encode_audio.bind(P),merge_function:P._merge_input_ids_with_audio_features.bind(P)})}async function ce(P,k){return await R(P,{...k,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:P.encode_image.bind(P),merge_function:P._merge_input_ids_with_image_features.bind(P)})}function ne(P,k=0){const[L,de]=P.dims,ve=P.data,_e=new BigInt64Array(ve.length);for(let Se=0;Se<L;++Se){const ze=Se*de;let Qe=BigInt(k);for(let tt=0;tt<de;++tt){const xt=ze+tt;ve[xt]===0n?_e[xt]=BigInt(1):(_e[xt]=Qe,Qe+=ve[xt])}}return{data:_e,dims:P.dims}}function we(P,k=null,L=0){const{input_ids:de,inputs_embeds:ve,attention_mask:_e}=P,{data:Se,dims:ze}=ne(_e,L);let Qe=new d.Tensor("int64",Se,ze);if(k){const tt=-(de??ve).dims.at(1);Qe=Qe.slice(null,[tt,null])}return Qe}function De(P,k,L,de){const ve=L.past_key_values?Object.values(L.past_key_values)[0].dims.at(-2):0;if(!L.attention_mask){let _e;for(const Se of["input_ids","inputs_embeds","position_ids"])if(L[Se]){_e=L[Se].dims;break}if(!_e)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");L.attention_mask=(0,d.ones)([_e[0],ve+_e[1]])}if(L.past_key_values){const{input_ids:_e,attention_mask:Se}=L;Se&&Se.dims[1]>_e.dims[1]||ve<_e.dims[1]&&(L.input_ids=_e.slice(null,[ve,null]))}return L}function Be(P,k,L,de){return L.past_key_values&&(k=k.map(ve=>[ve.at(-1)])),{...L,decoder_input_ids:q(k)}}function $e(P,...k){return P.config.is_encoder_decoder?Be(P,...k):De(P,...k)}function se(P,k,L,de){const ve=!!L.past_key_values;return de.guidance_scale!==null&&de.guidance_scale>1&&(ve?L.input_ids=(0,d.cat)([L.input_ids,L.input_ids],0):(L.input_ids=(0,d.cat)([L.input_ids,(0,d.full_like)(L.input_ids,BigInt(de.pad_token_id))],0),L.attention_mask=(0,d.cat)([L.attention_mask,(0,d.full_like)(L.attention_mask,0n)],0))),(ve||!L.pixel_values)&&(L.pixel_values=(0,d.full)([0,0,3,384,384],1)),ve&&(L.images_seq_mask=new d.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),L.images_emb_mask=new d.Tensor("bool",new Array(0).fill(!1),[1,1,0])),L}class F extends i.Callable{constructor(L,de,ve){super();ae(this,"main_input_name","input_ids");ae(this,"forward_params",["input_ids","attention_mask"]);this.config=L,this.sessions=de,this.configs=ve;const _e=T.get(this.constructor),Se=M.get(_e);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Se){case v.DecoderOnly:this.can_generate=!0,this._forward=te,this._prepare_inputs_for_generation=De;break;case v.Seq2Seq:case v.Vision2Seq:case v.Musicgen:this.can_generate=!0,this._forward=ee,this._prepare_inputs_for_generation=Be;break;case v.EncoderDecoder:this._forward=ee;break;case v.ImageTextToText:this.can_generate=!0,this._forward=ce,this._prepare_inputs_for_generation=$e;break;case v.AudioTextToText:this.can_generate=!0,this._forward=X,this._prepare_inputs_for_generation=$e;break;case v.Phi3V:case v.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=$e;break;case v.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=se;break;case v.AutoEncoder:this._forward=W;break;default:this._forward=Y;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){var de;const L=[];for(const ve of Object.values(this.sessions))(de=ve==null?void 0:ve.handler)!=null&&de.dispose&&L.push(ve.handler.dispose());return await Promise.all(L)}static async from_pretrained(L,{progress_callback:de=null,config:ve=null,cache_dir:_e=null,local_files_only:Se=!1,revision:ze="main",model_file_name:Qe=null,subfolder:tt="onnx",device:xt=null,dtype:St=null,use_external_data_format:At=null,session_options:Vt={}}={}){let Et={progress_callback:de,config:ve,cache_dir:_e,local_files_only:Se,revision:ze,model_file_name:Qe,subfolder:tt,device:xt,dtype:St,use_external_data_format:At,session_options:Vt};const Dt=T.get(this),mt=M.get(Dt);ve=Et.config=await n.AutoConfig.from_pretrained(L,Et);let zt;if(mt===v.DecoderOnly)zt=await Promise.all([A(L,{model:Et.model_file_name??"model"},Et),I(L,{generation_config:"generation_config.json"},Et)]);else if(mt===v.Seq2Seq||mt===v.Vision2Seq)zt=await Promise.all([A(L,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Et),I(L,{generation_config:"generation_config.json"},Et)]);else if(mt===v.MaskGeneration)zt=await Promise.all([A(L,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},Et)]);else if(mt===v.EncoderDecoder)zt=await Promise.all([A(L,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Et)]);else if(mt===v.ImageTextToText){const Zt={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};ve.is_encoder_decoder&&(Zt.model="encoder_model"),zt=await Promise.all([A(L,Zt,Et),I(L,{generation_config:"generation_config.json"},Et)])}else if(mt===v.AudioTextToText){const Zt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};zt=await Promise.all([A(L,Zt,Et),I(L,{generation_config:"generation_config.json"},Et)])}else if(mt===v.ImageAudioTextToText){const Zt={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};zt=await Promise.all([A(L,Zt,Et),I(L,{generation_config:"generation_config.json"},Et)])}else if(mt===v.Musicgen)zt=await Promise.all([A(L,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},Et),I(L,{generation_config:"generation_config.json"},Et)]);else if(mt===v.MultiModality)zt=await Promise.all([A(L,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},Et),I(L,{generation_config:"generation_config.json"},Et)]);else if(mt===v.Phi3V)zt=await Promise.all([A(L,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},Et),I(L,{generation_config:"generation_config.json"},Et)]);else if(mt===v.AutoEncoder)zt=await Promise.all([A(L,{encoder_model:"encoder_model",decoder_model:"decoder_model"},Et)]);else if(mt===v.Supertonic)zt=await Promise.all([A(L,{text_encoder:"text_encoder",latent_denoiser:"latent_denoiser",voice_decoder:"voice_decoder"},Et)]);else{if(mt!==v.EncoderOnly){const Zt=Dt??(ve==null?void 0:ve.model_type);Zt!=="custom"&&console.warn(`Model type for '${Zt}' not found, assuming encoder-only architecture. Please report this at ${u.GITHUB_ISSUE_URL}.`)}zt=await Promise.all([A(L,{model:Et.model_file_name??"model"},Et)])}return new this(ve,...zt)}async _call(L){return await this.forward(L)}async forward(L){return await this._forward(this,L)}get generation_config(){var L;return((L=this.configs)==null?void 0:L.generation_config)??null}_get_logits_processor(L,de,ve=null){const _e=new h.LogitsProcessorList;if(L.repetition_penalty!==null&&L.repetition_penalty!==1&&_e.push(new h.RepetitionPenaltyLogitsProcessor(L.repetition_penalty)),L.no_repeat_ngram_size!==null&&L.no_repeat_ngram_size>0&&_e.push(new h.NoRepeatNGramLogitsProcessor(L.no_repeat_ngram_size)),L.bad_words_ids!==null&&_e.push(new h.NoBadWordsLogitsProcessor(L.bad_words_ids,L.eos_token_id)),L.min_length!==null&&L.eos_token_id!==null&&L.min_length>0&&_e.push(new h.MinLengthLogitsProcessor(L.min_length,L.eos_token_id)),L.min_new_tokens!==null&&L.eos_token_id!==null&&L.min_new_tokens>0&&_e.push(new h.MinNewTokensLengthLogitsProcessor(de,L.min_new_tokens,L.eos_token_id)),L.forced_bos_token_id!==null&&_e.push(new h.ForcedBOSTokenLogitsProcessor(L.forced_bos_token_id)),L.forced_eos_token_id!==null&&_e.push(new h.ForcedEOSTokenLogitsProcessor(L.max_length,L.forced_eos_token_id)),L.begin_suppress_tokens!==null){const Se=de>1||L.forced_bos_token_id===null?de:de+1;_e.push(new h.SuppressTokensAtBeginLogitsProcessor(L.begin_suppress_tokens,Se))}return L.guidance_scale!==null&&L.guidance_scale>1&&_e.push(new h.ClassifierFreeGuidanceLogitsProcessor(L.guidance_scale)),L.temperature===0&&L.do_sample&&(console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),L.do_sample=!1),L.do_sample&&L.temperature!==null&&L.temperature!==1&&_e.push(new h.TemperatureLogitsWarper(L.temperature)),ve!==null&&_e.extend(ve),_e}_prepare_generation_config(L,de,ve=c.GenerationConfig){const _e={...this.config};for(const ze of["decoder","generator","text_config"])ze in _e&&Object.assign(_e,_e[ze]);const Se=new ve(_e);return Object.assign(Se,this.generation_config??{}),L&&Object.assign(Se,L),de&&Object.assign(Se,(0,a.pick)(de,Object.getOwnPropertyNames(Se))),Se}_get_stopping_criteria(L,de=null){const ve=new m.StoppingCriteriaList;return L.max_length!==null&&ve.push(new m.MaxLengthCriteria(L.max_length,this.config.max_position_embeddings??null)),L.eos_token_id!==null&&ve.push(new m.EosTokenCriteria(L.eos_token_id)),de&&ve.extend(de),ve}_validate_model_class(){if(!this.can_generate){const L=[Xg,Jg,Qg,qg],de=T.get(this.constructor),ve=new Set,_e=this.config.model_type;for(const ze of L){const Qe=ze.get(_e);Qe&&ve.add(Qe[0])}let Se=`The current model class (${de}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw ve.size>0&&(Se+=` Please use the following class instead: ${[...ve].join(", ")}`),Error(Se)}}prepare_inputs_for_generation(...L){return this._prepare_inputs_for_generation(this,...L)}_update_model_kwargs_for_generation({generated_input_ids:L,outputs:de,model_inputs:ve,is_encoder_decoder:_e}){return ve.past_key_values=this.getPastKeyValues(de,ve.past_key_values),ve.input_ids=new d.Tensor("int64",L.flat(),[L.length,1]),_e||(ve.attention_mask=(0,d.cat)([ve.attention_mask,(0,d.ones)([ve.attention_mask.dims[0],1])],1)),ve.position_ids=null,ve}_prepare_model_inputs({inputs:L,bos_token_id:de,model_kwargs:ve}){const _e=(0,a.pick)(ve,this.forward_params),Se=this.main_input_name;if(Se in _e){if(L)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else _e[Se]=L;return{inputs_tensor:_e[Se],model_inputs:_e,model_input_name:Se}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:L,model_inputs:de,model_input_name:ve,generation_config:_e}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!de.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:ze,pixel_values:Qe,attention_mask:tt,...xt}=de,St=await this._prepare_inputs_embeds(de);de={...xt,...(0,a.pick)(St,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Se}=await Y(this,de);if(_e.guidance_scale!==null&&_e.guidance_scale>1)Se=(0,d.cat)([Se,(0,d.full_like)(Se,0)],0),"attention_mask"in de&&(de.attention_mask=(0,d.cat)([de.attention_mask,(0,d.zeros_like)(de.attention_mask)],0));else if(de.decoder_input_ids){const ze=q(de.decoder_input_ids).dims[0];if(ze!==Se.dims[0]){if(Se.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Se.dims[0]}) than the decoder inputs (${ze}).`);Se=(0,d.cat)(Array.from({length:ze},()=>Se),0)}}return de.encoder_outputs=Se,de}_prepare_decoder_input_ids_for_generation({batch_size:L,model_input_name:de,model_kwargs:ve,decoder_start_token_id:_e,bos_token_id:Se,generation_config:ze}){let{decoder_input_ids:Qe,...tt}=ve;if(!(Qe instanceof d.Tensor)){if(Qe)Array.isArray(Qe[0])||(Qe=Array.from({length:L},()=>Qe));else if(_e??(_e=Se),this.config.model_type==="musicgen")Qe=Array.from({length:L*this.config.decoder.num_codebooks},()=>[_e]);else if(Array.isArray(_e)){if(_e.length!==L)throw new Error(`\`decoder_start_token_id\` expcted to have length ${L} but got ${_e.length}`);Qe=_e}else Qe=Array.from({length:L},()=>[_e]);Qe=q(Qe)}return ve.decoder_attention_mask=(0,d.ones_like)(Qe),{input_ids:Qe,model_inputs:tt}}async generate({inputs:L=null,generation_config:de=null,logits_processor:ve=null,stopping_criteria:_e=null,streamer:Se=null,...ze}){this._validate_model_class(),de=this._prepare_generation_config(de,ze);let{inputs_tensor:Qe,model_inputs:tt,model_input_name:xt}=this._prepare_model_inputs({inputs:L,model_kwargs:ze});const St=this.config.is_encoder_decoder;St&&("encoder_outputs"in tt||(tt=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:Qe,model_inputs:tt,model_input_name:xt,generation_config:de})));let At;St?{input_ids:At,model_inputs:tt}=this._prepare_decoder_input_ids_for_generation({batch_size:tt[xt].dims.at(0),model_input_name:xt,model_kwargs:tt,decoder_start_token_id:de.decoder_start_token_id,bos_token_id:de.bos_token_id,generation_config:de}):At=tt[xt];let Vt=At.dims.at(-1);de.max_new_tokens!==null&&(de.max_length=Vt+de.max_new_tokens);const Et=this._get_logits_processor(de,Vt,ve),Dt=this._get_stopping_criteria(de,_e),mt=tt[xt].dims.at(0),zt=b.LogitsSampler.getSampler(de),Zt=new Array(mt).fill(0),hr=At.tolist();Se&&Se.put(hr);let _r,br={};for(;;){if(tt=this.prepare_inputs_for_generation(hr,tt,de),_r=await this.forward(tt),de.output_attentions&&de.return_dict_in_generate){const Gn=this.getAttentions(_r);for(const Ls in Gn)Ls in br||(br[Ls]=[]),br[Ls].push(Gn[Ls])}const Bt=_r.logits.slice(null,-1,null),ln=Et(hr,Bt),fs=[];for(let Gn=0;Gn<ln.dims.at(0);++Gn){const Ls=ln[Gn],jh=await zt(Ls);for(const[Ea,zh]of jh){const Bh=BigInt(Ea);Zt[Gn]+=zh,hr[Gn].push(Bh),fs.push([Bh]);break}}if(Se&&Se.put(fs),Dt(hr).every(Gn=>Gn))break;tt=this._update_model_kwargs_for_generation({generated_input_ids:fs,outputs:_r,model_inputs:tt,is_encoder_decoder:St})}Se&&Se.end();const en=this.getPastKeyValues(_r,tt.past_key_values,!0),mn=new d.Tensor("int64",hr.flat(),[hr.length,hr[0].length]);if(de.return_dict_in_generate)return{sequences:mn,past_key_values:en,...br};for(const Bt of Object.values(_r))Bt.location==="gpu-buffer"&&Bt.dispose();return mn}getPastKeyValues(L,de,ve=!1){const _e=Object.create(null);for(const Se in L)if(Se.startsWith("present")){const ze=Se.replace("present_conv","past_conv").replace("present","past_key_values"),Qe=Se.includes("encoder");if(Qe&&de?_e[ze]=de[ze]:_e[ze]=L[Se],de&&(!Qe||ve)){const tt=de[ze];tt.location==="gpu-buffer"&&tt.dispose()}}return _e}getAttentions(L){const de={};for(const ve of["cross_attentions","encoder_attentions","decoder_attentions"])for(const _e in L)_e.startsWith(ve)&&(ve in de||(de[ve]=[]),de[ve].push(L[_e]));return de}addPastKeyValues(L,de){var ve,_e,Se;if(de)Object.assign(L,de);else{const ze=this.sessions.decoder_model_merged??this.sessions.model,Qe=((_e=(ve=L[this.main_input_name]??L.attention_mask)==null?void 0:ve.dims)==null?void 0:_e[0])??1,tt=((Se=ze==null?void 0:ze.config)==null?void 0:Se.kv_cache_dtype)??"float32",xt=tt==="float16"?d.DataTypeMap.float16:d.DataTypeMap.float32,St=(0,n.getCacheShapes)(this.config,{batch_size:Qe});for(const At in St){const Vt=St[At].reduce((Et,Dt)=>Et*Dt,1);L[At]=new d.Tensor(tt,new xt(Vt),St[At])}}}async encode_image({pixel_values:L}){return(await N(this.sessions.vision_encoder,{pixel_values:L})).image_features}async encode_text({input_ids:L}){return(await N(this.sessions.embed_tokens,{input_ids:L})).inputs_embeds}async encode_audio({audio_values:L}){return(await N(this.sessions.audio_encoder,{audio_values:L})).audio_features}}class pe{}class Ee extends pe{constructor({last_hidden_state:k,hidden_states:L=null,attentions:de=null}){super(),this.last_hidden_state=k,this.hidden_states=L,this.attentions=de}}class Me extends F{}class Pe extends Me{}class ye extends Me{async _call(k){return new pn(await super._call(k))}}class ke extends Me{async _call(k){return new Rt(await super._call(k))}}class be extends Me{async _call(k){return new an(await super._call(k))}}class Oe extends Me{async _call(k){return new Sn(await super._call(k))}}class je extends F{}class Je extends je{}class Te extends je{async _call(k){return new pn(await super._call(k))}}class ot extends je{async _call(k){return new Rt(await super._call(k))}}class Ze extends je{async _call(k){return new an(await super._call(k))}}class it extends je{async _call(k){return new Sn(await super._call(k))}}class nt extends F{}class Ne extends nt{}class qe extends nt{async _call(k){return new pn(await super._call(k))}}class Mt extends nt{async _call(k){return new Rt(await super._call(k))}}class bt extends nt{async _call(k){return new an(await super._call(k))}}class jt extends F{}class yt extends jt{}class pr extends jt{}class Hr extends F{}class Rr extends Hr{}class wn extends F{}class mr extends wn{}class Kr extends wn{async _call(k){return new pn(await super._call(k))}}class Qs extends wn{async _call(k){return new Rt(await super._call(k))}}class ko extends wn{async _call(k){return new an(await super._call(k))}}class Cs extends wn{async _call(k){return new Sn(await super._call(k))}}class Yr extends F{}class Xs extends Yr{}class Ge extends Yr{async _call(k){return new pn(await super._call(k))}}class Ht extends Yr{async _call(k){return new Rt(await super._call(k))}}class ct extends Yr{async _call(k){return new an(await super._call(k))}}class Wt extends Yr{async _call(k){return new Sn(await super._call(k))}}class $ extends F{}class re extends ${}class B extends ${async _call(k){return new pn(await super._call(k))}}class Z extends ${async _call(k){return new Rt(await super._call(k))}}class ue extends ${async _call(k){return new an(await super._call(k))}}class xe extends ${async _call(k){return new Sn(await super._call(k))}}class Re extends F{}class dt extends Re{}class Ct extends Re{async _call(k){return new pn(await super._call(k))}}class Tt extends Re{async _call(k){return new Rt(await super._call(k))}}class Ot extends Re{async _call(k){return new an(await super._call(k))}}class lt extends Re{async _call(k){return new Sn(await super._call(k))}}class Kt extends F{}class ur extends Kt{}class In extends Kt{async _call(k){return new pn(await super._call(k))}}class Vn extends Kt{async _call(k){return new Rt(await super._call(k))}}class Lr extends Kt{async _call(k){return new an(await super._call(k))}}class Zr extends Kt{async _call(k){return new Sn(await super._call(k))}}class Nr extends F{}class ks extends Nr{}class $s extends Nr{async _call(k){return new pn(await super._call(k))}}class fn extends Nr{async _call(k){return new Rt(await super._call(k))}}class $o extends Nr{async _call(k){return new an(await super._call(k))}}class Ao extends Nr{async _call(k){return new Sn(await super._call(k))}}class rn extends F{}class As extends rn{}class rs extends rn{async _call(k){return new Rt(await super._call(k))}}class Pn extends rn{async _call(k){return new an(await super._call(k))}}class Is extends rn{async _call(k){return new Sn(await super._call(k))}}class qr extends rn{async _call(k){return new pn(await super._call(k))}}class $r extends F{}class Os extends $r{}class Ko extends $r{async _call(k){return new pn(await super._call(k))}}class On extends $r{async _call(k){return new Rt(await super._call(k))}}class Ve extends $r{async _call(k){return new an(await super._call(k))}}class We extends F{}class ut extends We{}class cr extends We{async _call(k){return new pn(await super._call(k))}}class qo extends We{async _call(k){return new Rt(await super._call(k))}}class Js extends We{async _call(k){return new Sn(await super._call(k))}}class ds extends F{}class da extends ds{}class ha extends ds{async _call(k){return new pn(await super._call(k))}}class fa extends ds{async _call(k){return new Rt(await super._call(k))}}class pa extends ds{async _call(k){return new an(await super._call(k))}}class ma extends ds{async _call(k){return new Sn(await super._call(k))}}class ge extends F{}class O extends ge{}class H extends ge{async _call(k){return new pn(await super._call(k))}}class ie extends ge{async _call(k){return new Rt(await super._call(k))}}class he extends ge{async _call(k){return new Sn(await super._call(k))}}class me extends F{}class Ie extends me{}class He extends me{async _call(k){return new Rt(await super._call(k))}}class st extends me{async _call(k){return new Sn(await super._call(k))}}class Ye extends me{async _call(k){return new pn(await super._call(k))}}class at extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class $t extends at{}class qt extends at{}class Yt extends F{}class Ar extends Yt{}class ar extends Yt{}class Er extends F{}class Ir extends Er{}class Pr extends Er{}class Wn extends F{}class nn extends Wn{}class Ys extends Wn{}class gr extends Wn{async _call(k){return new Rt(await super._call(k))}}class jr extends F{}class bn extends jr{}class Ds extends jr{}class Fs extends jr{async _call(k){return new Rt(await super._call(k))}}class xn extends jr{}class Dn extends F{}class sn extends Dn{}class zr extends Dn{}class wr extends F{}class Qr extends wr{}class Fn extends wr{}class Rs extends F{}class gl extends Rs{}class Qd extends Rs{async _call(k){return new pn(await super._call(k))}}class qu extends Rs{async _call(k){return new Rt(await super._call(k))}}class Xd extends Rs{async _call(k){return new an(await super._call(k))}}class Jd extends Rs{async _call(k){return new Sn(await super._call(k))}}class yi extends F{}class Yd extends yi{}class Zd extends yi{async _call(k){return new pn(await super._call(k))}}class eh extends yi{async _call(k){return new Rt(await super._call(k))}}class th extends yi{async _call(k){return new an(await super._call(k))}}class rh extends yi{async _call(k){return new Sn(await super._call(k))}}class vi extends F{}class nh extends vi{}class sh extends vi{async _call(k){return new pn(await super._call(k))}}class oh extends vi{async _call(k){return new Rt(await super._call(k))}}class Qu extends vi{async _call(k){return new an(await super._call(k))}}class Xu extends vi{async _call(k){return new Sn(await super._call(k))}}class _l extends F{}class ih extends _l{}class ah extends _l{}class yl extends F{constructor(){super(...arguments);ae(this,"requires_attention_mask",!1);ae(this,"main_input_name","input_features");ae(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class Ju extends yl{}class Qo extends yl{_prepare_generation_config(k,L){return super._prepare_generation_config(k,L,_.WhisperGenerationConfig)}_retrieve_init_tokens(k){const L=[k.decoder_start_token_id];let de=k.language;const ve=k.task;if(k.is_multilingual){de||(console.warn("No language specified - defaulting to English (en)."),de="en");const Se=`<|${(0,y.whisper_language_to_code)(de)}|>`;L.push(k.lang_to_id[Se]),L.push(k.task_to_id[ve??"transcribe"])}else if(de||ve)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!k.return_timestamps&&k.no_timestamps_token_id&&L.at(-1)!==k.no_timestamps_token_id?L.push(k.no_timestamps_token_id):k.return_timestamps&&L.at(-1)===k.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),L.pop()),L.filter(_e=>_e!=null)}async generate({inputs:k=null,generation_config:L=null,logits_processor:de=null,stopping_criteria:ve=null,..._e}){L=this._prepare_generation_config(L,_e);const Se=_e.decoder_input_ids??this._retrieve_init_tokens(L);if(L.return_timestamps&&(de??(de=new h.LogitsProcessorList),de.push(new h.WhisperTimeStampLogitsProcessor(L,Se))),L.begin_suppress_tokens&&(de??(de=new h.LogitsProcessorList),de.push(new h.SuppressTokensAtBeginLogitsProcessor(L.begin_suppress_tokens,Se.length))),L.return_token_timestamps){if(!L.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");L.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),L.output_attentions=!0,L.return_dict_in_generate=!0}const ze=await super.generate({inputs:k,generation_config:L,logits_processor:de,decoder_input_ids:Se,..._e});return L.return_token_timestamps&&(ze.token_timestamps=this._extract_token_timestamps(ze,L.alignment_heads,L.num_frames)),ze}_extract_token_timestamps(k,L,de=null,ve=.02){if(!k.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");de==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let _e=this.config.median_filter_width;_e===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),_e=7);const Se=k.cross_attentions,ze=Array.from({length:this.config.decoder_layers},(Dt,mt)=>(0,d.cat)(Se.map(zt=>zt[mt]),2)),Qe=(0,d.stack)(L.map(([Dt,mt])=>{if(Dt>=ze.length)throw new Error(`Layer index ${Dt} is out of bounds for cross attentions (length ${ze.length}).`);return de?ze[Dt].slice(null,mt,null,[0,de]):ze[Dt].slice(null,mt)})).transpose(1,0,2,3),[tt,xt]=(0,d.std_mean)(Qe,-2,0,!0),St=Qe.clone();for(let Dt=0;Dt<St.dims[0];++Dt){const mt=St[Dt];for(let zt=0;zt<mt.dims[0];++zt){const Zt=mt[zt],hr=tt[Dt][zt][0].data,_r=xt[Dt][zt][0].data;for(let br=0;br<Zt.dims[0];++br){let en=Zt[br].data;for(let mn=0;mn<en.length;++mn)en[mn]=(en[mn]-_r[mn])/hr[mn];en.set((0,p.medianFilter)(en,_e))}}}const At=[(0,d.mean)(St,1)],Vt=k.sequences.dims,Et=new d.Tensor("float32",new Float32Array(Vt[0]*Vt[1]),Vt);for(let Dt=0;Dt<Vt[0];++Dt){const mt=At[Dt].neg().squeeze_(0),[zt,Zt]=(0,p.dynamic_time_warping)(mt.tolist()),hr=Array.from({length:zt.length-1},(en,mn)=>zt[mn+1]-zt[mn]),_r=(0,a.mergeArrays)([1],hr).map(en=>!!en),br=[];for(let en=0;en<_r.length;++en)_r[en]&&br.push(Zt[en]*ve);Et[Dt].data.set(br,1)}return Et}}class lh extends Qo{}class vl extends F{constructor(){super(...arguments);ae(this,"requires_attention_mask",!1);ae(this,"main_input_name","input_values");ae(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class Dm extends vl{}class uh extends vl{}class Yu extends F{constructor(){super(...arguments);ae(this,"main_input_name","pixel_values");ae(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class ga extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class _a extends ga{_merge_input_ids_with_image_features(k){const L=k.image_features.dims.at(-1),de=k.image_features.view(-1,L);return oe({image_token_id:this.config.image_token_index,...k,image_features:de})}}class ch extends _a{}class dh extends _a{}class hh extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);ae(this,"main_input_name","inputs_embeds")}}class fh extends hh{_merge_input_ids_with_image_features({inputs_embeds:k,image_features:L,input_ids:de,attention_mask:ve}){return{inputs_embeds:(0,d.cat)([L,k],1),attention_mask:(0,d.cat)([(0,d.ones)(L.dims.slice(0,2)),ve],1)}}async _prepare_inputs_embeds({input_ids:k,pixel_values:L,inputs_embeds:de,attention_mask:ve}){if(!k&&!L)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let _e,Se;return k&&(_e=await this.encode_text({input_ids:k})),L&&(Se=await this.encode_image({pixel_values:L})),_e&&Se?{inputs_embeds:de,attention_mask:ve}=this._merge_input_ids_with_image_features({inputs_embeds:_e,image_features:Se,input_ids:k,attention_mask:ve}):de=_e||Se,{inputs_embeds:de,attention_mask:ve}}async forward({input_ids:k,pixel_values:L,attention_mask:de,decoder_input_ids:ve,decoder_attention_mask:_e,encoder_outputs:Se,past_key_values:ze,inputs_embeds:Qe,decoder_inputs_embeds:tt}){if(Qe||({inputs_embeds:Qe,attention_mask:de}=await this._prepare_inputs_embeds({input_ids:k,pixel_values:L,inputs_embeds:Qe,attention_mask:de})),!Se){let{last_hidden_state:At}=await Y(this,{inputs_embeds:Qe,attention_mask:de});Se=At}if(!tt){if(!ve)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");tt=await this.encode_text({input_ids:ve})}return await te(this,{inputs_embeds:tt,attention_mask:_e,encoder_attention_mask:de,encoder_hidden_states:Se,past_key_values:ze},!0)}}class ph extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class mh extends ph{_merge_input_ids_with_image_features(k){const L=k.image_features.dims.at(-1),de=k.image_features.view(-1,L);return oe({image_token_id:this.config.image_token_index,...k,image_features:de})}}class gh extends ga{_merge_input_ids_with_image_features(k){const L=k.image_features.dims.at(-1),de=k.image_features.view(-1,L);return oe({image_token_id:this.config.image_token_index,...k,image_features:de})}}class _h extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"])}}class Zu extends _h{async forward({input_ids:k=null,attention_mask:L=null,pixel_values:de=null,input_features:ve=null,input_features_mask:_e=null,position_ids:Se=null,inputs_embeds:ze=null,per_layer_inputs:Qe=null,past_key_values:tt=null,generation_config:xt=null,logits_processor:St=null,...At}){if((!ze||!Qe)&&({inputs_embeds:ze,per_layer_inputs:Qe}=await N(this.sessions.embed_tokens,{input_ids:k}),k.dims[1]!==1)){if(de){const{image_features:Et}=await N(this.sessions.vision_encoder,{pixel_values:de});({inputs_embeds:ze,attention_mask:L}=this._merge_input_ids_with_image_features({image_features:Et,inputs_embeds:ze,input_ids:k,attention_mask:L}))}if(ve){const{audio_features:Et}=await N(this.sessions.audio_encoder,{input_features:ve,input_features_mask:_e});({inputs_embeds:ze,attention_mask:L}=this._merge_input_ids_with_audio_features({audio_features:Et,inputs_embeds:ze,input_ids:k,attention_mask:L}))}}return await te(this,{inputs_embeds:ze,per_layer_inputs:Qe,past_key_values:tt,attention_mask:L,position_ids:Se,generation_config:xt,logits_processor:St},!0)}_merge_input_ids_with_image_features(k){const L=k.image_features.dims.at(-1),de=k.image_features.view(-1,L);return oe({image_token_id:this.config.image_token_id,...k,image_features:de})}_merge_input_ids_with_audio_features(k){const L=k.audio_features.dims.at(-1),de=k.audio_features.view(-1,L);return U({audio_token_id:this.config.audio_token_id,...k,audio_features:de})}}class ya extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class Io extends ya{async encode_image({pixel_values:k,pixel_attention_mask:L}){return(await N(this.sessions.vision_encoder,{pixel_values:k,pixel_attention_mask:L})).image_features}_merge_input_ids_with_image_features(k){const L=k.image_features.dims.at(-1),de=k.image_features.view(-1,L);return oe({image_token_id:this.config.image_token_id,...k,image_features:de})}}class wl extends Io{}class yh extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class ec extends yh{async forward({input_ids:k=null,attention_mask:L=null,pixel_values:de=null,image_sizes:ve=null,position_ids:_e=null,inputs_embeds:Se=null,past_key_values:ze=null,generation_config:Qe=null,logits_processor:tt=null,...xt}){if(!Se){let At;if(de&&k.dims[1]!==1){if(!ve)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:At}=await N(this.sessions.vision_encoder,{pixel_values:de,image_sizes:ve}))}else{const Vt=this.config.normalized_config.hidden_size;At=new d.Tensor("float32",[],[0,Vt])}({inputs_embeds:Se}=await N(this.sessions.prepare_inputs_embeds,{input_ids:k,image_features:At}))}return await te(this,{inputs_embeds:Se,past_key_values:ze,attention_mask:L,position_ids:_e,generation_config:Qe,logits_processor:tt},!1)}}class Zs extends F{}class bl extends Zs{}class vh extends Zs{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"text_model"})}}class tc extends Zs{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"text_model"})}}class wh extends Zs{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"vision_model"})}}class rc extends Zs{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"vision_model"})}}class xl extends F{}class nc extends xl{}class bh extends xl{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"text_model"})}}class sc extends Zs{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"vision_model"})}}class oc extends F{}class va extends oc{}class vt extends F{}class xh extends vt{async forward(k){const L=!k.input_ids,de=!k.pixel_values;if(L&&de)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(L&&(k.input_ids=(0,d.ones)([k.pixel_values.dims[0],1])),de){const{image_size:tt}=this.config.vision_config;k.pixel_values=(0,d.full)([0,3,tt,tt],0)}const{text_embeddings:ve,image_embeddings:_e,l2norm_text_embeddings:Se,l2norm_image_embeddings:ze}=await super.forward(k),Qe={};return L||(Qe.text_embeddings=ve,Qe.l2norm_text_embeddings=Se),de||(Qe.image_embeddings=_e,Qe.l2norm_image_embeddings=ze),Qe}}class ic extends vt{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"text_model"})}}class ac extends vt{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"vision_model"})}}class wi extends F{}class hs extends wi{}class wa extends wi{}class ba extends F{}class lc extends ba{}class uc extends ba{}class Ml extends F{}class Tl extends Ml{}class cc extends Ml{}class El extends F{}class dc extends El{}class xa extends El{}class Ma extends F{}class Pl extends Ma{}class hc extends Ma{}class Sl extends F{}class fc extends Sl{}class pc extends Sl{}class Cl extends F{}class mc extends Cl{}class w extends Cl{}class C extends F{}class D extends C{}class j extends C{}class K extends F{}class fe extends K{}class Ae extends K{}class Ue extends F{}class et extends Ue{}class ht extends F{}class Ft extends ht{}class Qt extends ht{}class rr extends F{}class on extends rr{}class Xo extends rr{}class gc extends F{}class Gb extends gc{}class Hb extends gc{}class Fm extends F{}class Kb extends Fm{}class qb extends Fm{}class Rm extends F{}class Qb extends Rm{}class Xb extends Rm{}class Lm extends F{}class Jb extends Lm{}class Yb extends Lm{}class Nm extends F{}class Zb extends Nm{}class ex extends Nm{}class jm extends F{}class tx extends jm{}class rx extends jm{}class zm extends F{}class nx extends zm{}class sx extends zm{}class Bm extends F{}class ox extends Bm{}class ix extends Bm{}class Um extends F{}class ax extends Um{}class lx extends Um{}class Vm extends F{}class ux extends Vm{}class cx extends Vm{}class Wm extends F{}class dx extends Wm{}class hx extends Wm{}class Gm extends F{}class fx extends Gm{}class px extends Gm{}class Hm extends F{}class mx extends Hm{}class gx extends Hm{}class Km extends F{}class _x extends Km{}class yx extends Km{}class qm extends F{}class vx extends qm{}class wx extends qm{}class Qm extends F{}class bx extends Qm{}class xx extends Qm{}class Xm extends F{}class Mx extends Xm{}class Tx extends Xm{}class Jm extends F{}class Ex extends Jm{}class Px extends Jm{}class Sx extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class Cx extends Sx{get_rope_index(k,L,de,ve){const{vision_config:_e,image_token_id:Se,video_token_id:ze,vision_start_token_id:Qe}=this.config,tt=_e.spatial_merge_size??2,xt=[];if(L||de){let St=k.tolist();ve||(ve=(0,d.ones_like)(k));const At=ve.tolist(),Vt=Array.from({length:3},Zt=>Array.from({length:k.dims[0]},hr=>Array.from({length:k.dims[1]},_r=>1))),Et=L?L.tolist():[],Dt=de?de.tolist():[];let mt=0,zt=0;for(let Zt=0;Zt<St.length;++Zt){const hr=St[Zt].filter((xr,un)=>At[Zt][un]==1),br=hr.reduce((xr,un,Mi)=>(un==Qe&&xr.push(Mi),xr),[]).map(xr=>hr[xr+1]),en=br.filter(xr=>xr==Se).length,mn=br.filter(xr=>xr==ze).length;let Bt=[],ln=0,fs=en,Ta=mn;for(let xr=0;xr<br.length;++xr){const un=hr.findIndex((Sa,eo)=>eo>ln&&Sa==Se),Mi=hr.findIndex((Sa,eo)=>eo>ln&&Sa==ze),Pa=fs>0&&un!==-1?un:hr.length+1,Al=Ta>0&&Mi!==-1?Mi:hr.length+1;let Uh,Zg,e_,t_;Pa<Al?([Zg,e_,t_]=Et[mt],++mt,--fs,Uh=Pa):([Zg,e_,t_]=Dt[zt],++zt,--Ta,Uh=Al);const[Tz,r_,Vh]=[Number(Zg),Math.floor(Number(e_)/tt),Math.floor(Number(t_)/tt)],n_=Uh-ln,xP=Bt.length>0?(0,p.max)(Bt.at(-1))[0]+1:0;Bt.push(Array.from({length:3*n_},(Sa,eo)=>xP+eo%n_));const s_=n_+xP,Wh=Tz*r_*Vh,Ez=Array.from({length:Wh},(Sa,eo)=>s_+Math.floor(eo/(r_*Vh))),Pz=Array.from({length:Wh},(Sa,eo)=>s_+Math.floor(eo/Vh)%r_),Sz=Array.from({length:Wh},(Sa,eo)=>s_+eo%Vh);Bt.push([Ez,Pz,Sz].flat()),ln=Uh+Wh}if(ln<hr.length){const xr=Bt.length>0?(0,p.max)(Bt.at(-1))[0]+1:0,un=hr.length-ln;Bt.push(Array.from({length:3*un},(Mi,Pa)=>xr+Pa%un))}const Gn=Bt.reduce((xr,un)=>xr+un.length,0),Ls=new Array(Gn);let jh=0;for(let xr=0;xr<3;++xr)for(let un=0;un<Bt.length;++un){const Mi=Bt[un],Pa=Mi.length/3;for(let Al=xr*Pa;Al<(xr+1)*Pa;++Al)Ls[jh++]=Mi[Al]}let Ea=0;const zh=At[Zt];for(let xr=0;xr<zh.length;++xr)if(zh[xr]==1){for(let un=0;un<3;++un)Vt[un][Zt][xr]=Ls[un*Gn/3+Ea];++Ea}const Bh=(0,p.max)(Ls)[0];xt.push(Bh+1-St[Zt].length)}return[new d.Tensor("int64",Vt.flat(1/0),[3,k.dims[0],k.dims[1]]),new d.Tensor("int64",xt,[xt.length,1])]}else if(ve){const{data:St,dims:At}=ne(ve),Vt=BigInt64Array.from({length:3*St.length},(Dt,mt)=>St[mt%St.length]),Et=Array.from({length:At[0]},(Dt,mt)=>(0,p.max)(St.subarray(At[1]*mt,At[1]*(mt+1)))[0]+1n+BigInt(At[1]));return[new d.Tensor("int64",Vt,[3,...At]),new d.Tensor("int64",Et,[Et.length,1])]}else{const[St,At]=k.dims,Vt=BigInt64Array.from({length:3*St*At},(Et,Dt)=>BigInt(Math.floor(Dt%At/St)));return[new d.Tensor("int64",Vt,[3,...k.dims]),(0,d.zeros)([St,1])]}}async encode_image({pixel_values:k,image_grid_thw:L}){return(await N(this.sessions.vision_encoder,{pixel_values:k,grid_thw:L})).image_features}_merge_input_ids_with_image_features(k){return oe({image_token_id:this.config.image_token_id,...k})}prepare_inputs_for_generation(k,L,de){if(L.attention_mask&&!L.position_ids)if(!L.past_key_values)[L.position_ids,L.rope_deltas]=this.get_rope_index(L.input_ids,L.image_grid_thw,L.video_grid_thw,L.attention_mask);else{L.pixel_values=null;const ve=BigInt(Object.values(L.past_key_values)[0].dims.at(-2)),_e=L.rope_deltas.map(Se=>ve+Se);L.position_ids=(0,d.stack)([_e,_e,_e],0)}return L}}class Ym extends F{}class kx extends Ym{}class $x extends Ym{}class Zm extends F{}class Ax extends Zm{}class Ix extends Zm{}class eg extends F{}class Ox extends eg{}class Dx extends eg{}class tg extends F{}class Fx extends tg{}class Rx extends tg{}class rg extends F{}class Lx extends rg{}class Nx extends rg{}class ng extends F{}class jx extends ng{}class zx extends ng{async _call(k){return new Rt(await super._call(k))}}class sg extends F{}class Bx extends sg{}class Ux extends sg{async _call(k){return new Rt(await super._call(k))}}class Vx extends F{}class Wx extends Vx{}class og extends F{}class Gx extends og{}class Hx extends og{async _call(k){return new Rt(await super._call(k))}}class Kx extends F{}class qx extends Kx{}class ig extends F{}class Qx extends ig{}class Xx extends ig{async _call(k){return new Rt(await super._call(k))}}class Jx extends F{}class Yx extends Jx{}class ag extends F{}class Zx extends ag{}class e1 extends ag{async _call(k){return new Rt(await super._call(k))}}class t1 extends F{}class r1 extends t1{async _call(k){return new wP(await super._call(k))}}class lg extends F{}class n1 extends lg{}class s1 extends lg{async _call(k){return new Rt(await super._call(k))}}class ug extends F{}class o1 extends ug{}class i1 extends ug{async _call(k){return new Rt(await super._call(k))}}class cg extends F{}class a1 extends cg{}class l1 extends cg{}class dg extends F{}class u1 extends dg{}class c1 extends dg{}class hg extends F{}class d1 extends hg{}class h1 extends hg{async _call(k){return new Rt(await super._call(k))}}class Mh extends F{}class f1 extends Mh{}class p1 extends Mh{async _call(k){return new pg(await super._call(k))}}class fg extends Mh{async _call(k){return new m1(await super._call(k))}}class pg extends pe{constructor({logits:k,pred_boxes:L}){super(),this.logits=k,this.pred_boxes=L}}class m1 extends pe{constructor({logits:k,pred_boxes:L,pred_masks:de}){super(),this.logits=k,this.pred_boxes=L,this.pred_masks=de}}class mg extends F{}class g1 extends mg{}class _1 extends mg{async _call(k){return new _c(await super._call(k))}}class _c extends pe{constructor({logits:k,pred_boxes:L}){super(),this.logits=k,this.pred_boxes=L}}class gg extends F{}class y1 extends gg{}class v1 extends gg{async _call(k){return new w1(await super._call(k))}}class w1 extends _c{}class _g extends F{}class b1 extends _g{}class x1 extends _g{async _call(k){return new M1(await super._call(k))}}class M1 extends _c{}class yg extends F{}class T1 extends yg{}class E1 extends yg{async _call(k){return new _c(await super._call(k))}}class vg extends F{}class P1 extends vg{}class S1 extends vg{async _call(k){return new C1(await super._call(k))}}class C1 extends pg{}class wg extends F{}class k1 extends wg{}class $1 extends wg{async _call(k){return new Rt(await super._call(k))}}class bg extends F{}class A1 extends bg{}class I1 extends bg{async _call(k){return new Rt(await super._call(k))}}class xg extends F{}class O1 extends xg{}class D1 extends xg{async _call(k){return new Rt(await super._call(k))}}class Th extends F{}class F1 extends Th{}class R1 extends Th{async _call(k){return new Rt(await super._call(k))}}class L1 extends Th{}class Mg extends F{}class N1 extends Mg{}class j1 extends Mg{}class Tg extends F{}class z1 extends Tg{}class B1 extends Tg{}class U1 extends F{}class V1 extends U1{}class Eh extends F{}class W1 extends Eh{}class G1 extends Eh{}class H1 extends Eh{}class K1 extends F{}class q1 extends K1{}class Q1 extends F{}class X1 extends Q1{}class J1 extends F{}class Y1 extends J1{}class Eg extends F{}class Z1 extends Eg{}class eM extends Eg{}class Pg extends F{}class tM extends Pg{}class rM extends Pg{}class nM extends F{}class sM extends nM{}class Sg extends F{}class oM extends Sg{}class iM extends Sg{async _call(k){return new Rt(await super._call(k))}}class Cg extends F{}class aM extends Cg{}class lM extends Cg{async _call(k){return new Rt(await super._call(k))}}class kg extends F{}class uM extends kg{}class cM extends kg{async _call(k){return new Rt(await super._call(k))}}class $g extends F{}class dM extends $g{}class hM extends $g{async _call(k){return new Rt(await super._call(k))}}class fM extends F{}class pM extends fM{}class mM extends F{}class gM extends mM{}class _M extends F{}class yM extends _M{}class Ag extends F{}class vM extends Ag{}class wM extends Ag{async _call(k){return new bM(await super._call(k))}}class bM extends pe{constructor({logits:k,pred_boxes:L}){super(),this.logits=k,this.pred_boxes=L}}class xM extends F{}class MM extends xM{async get_image_embeddings({pixel_values:k}){return await Y(this,{pixel_values:k})}async forward(k){!k.image_embeddings||!k.image_positional_embeddings?k={...k,...await this.get_image_embeddings(k)}:k={...k},k.input_labels??(k.input_labels=(0,d.ones)(k.input_points.dims.slice(0,-1)));const L={image_embeddings:k.image_embeddings,image_positional_embeddings:k.image_positional_embeddings};return k.input_points&&(L.input_points=k.input_points),k.input_labels&&(L.input_labels=k.input_labels),k.input_boxes&&(L.input_boxes=k.input_boxes),await N(this.sessions.prompt_encoder_mask_decoder,L)}async _call(k){return new TM(await super._call(k))}}class TM extends pe{constructor({iou_scores:k,pred_masks:L}){super(),this.iou_scores=k,this.pred_masks=L}}class EM extends pe{constructor({iou_scores:k,pred_masks:L,object_score_logits:de}){super(),this.iou_scores=k,this.pred_masks=L,this.object_score_logits=de}}class PM extends F{}class Ph extends PM{async get_image_embeddings({pixel_values:k}){return await Y(this,{pixel_values:k})}async forward(k){const{num_feature_levels:L}=this.config.vision_config;if(Array.from({length:L},(Se,ze)=>`image_embeddings.${ze}`).some(Se=>!k[Se])?k={...k,...await this.get_image_embeddings(k)}:k={...k},k.input_points){if(k.input_boxes&&k.input_boxes.dims[1]!==1)throw new Error("When both `input_points` and `input_boxes` are provided, the number of boxes per image must be 1.");const Se=k.input_points.dims;k.input_labels??(k.input_labels=(0,d.ones)(Se.slice(0,-1))),k.input_boxes??(k.input_boxes=(0,d.full)([Se[0],0,4],0))}else if(k.input_boxes){const Se=k.input_boxes.dims;k.input_labels=(0,d.full)([Se[0],Se[1],0],-1n),k.input_points=(0,d.full)([Se[0],1,0,2],0)}else throw new Error("At least one of `input_points` or `input_boxes` must be provided.");const ve=this.sessions.prompt_encoder_mask_decoder,_e=(0,a.pick)(k,ve.inputNames);return await N(ve,_e)}async _call(k){return new EM(await super._call(k))}}class SM extends Ph{}class CM extends Ph{}class Ig extends F{}class kM extends Ig{}class $M extends Ig{}class Og extends F{}class AM extends Og{}class IM extends Og{}class bi extends F{}class OM extends bi{}class DM extends bi{async _call(k){return new xi(await super._call(k))}}class FM extends bi{async _call(k){return new Rt(await super._call(k))}}class RM extends bi{async _call(k){return new an(await super._call(k))}}class LM extends F{}class NM extends LM{async _call(k){return new xi(await super._call(k))}}class Dg extends F{}class jM extends Dg{}class zM extends Dg{async _call(k){return new an(await super._call(k))}}class BM extends F{}class UM extends BM{}class Sh extends F{}class VM extends Sh{}class WM extends Sh{async _call(k){return new xi(await super._call(k))}}class GM extends Sh{async _call(k){return new Rt(await super._call(k))}}class yc extends F{}class HM extends yc{}class KM extends yc{async _call(k){return new xi(await super._call(k))}}class qM extends yc{async _call(k){return new Rt(await super._call(k))}}class QM extends yc{async _call(k){return new an(await super._call(k))}}class Ch extends F{}class XM extends Ch{}class JM extends Ch{async _call(k){return new xi(await super._call(k))}}class YM extends Ch{async _call(k){return new Rt(await super._call(k))}}class uz extends F{}class ZM extends bi{}class eT extends bi{async _call(k){return new xi(await super._call(k))}}class tT extends bi{async _call(k){return new Rt(await super._call(k))}}class kl extends F{}class rT extends kl{}class nT extends kl{async _call(k){return new xi(await super._call(k))}}class sT extends kl{async _call(k){return new Rt(await super._call(k))}}class oT extends kl{async _call(k){return new vP(await super._call(k))}}class iT extends kl{async _call(k){return new an(await super._call(k))}}class aT extends F{}class lT extends aT{}class kh extends F{}class cz extends kh{}class uT extends kh{}class cT extends kh{async generate_speech(k,L,{threshold:de=.5,minlenratio:ve=0,maxlenratio:_e=20,vocoder:Se=null}={}){const ze={input_ids:k},{encoder_outputs:Qe,encoder_attention_mask:tt}=await Y(this,ze),xt=Qe.dims[1]/this.config.reduction_factor,St=Math.floor(xt*_e),At=Math.floor(xt*ve),Vt=this.config.num_mel_bins;let Et=[],Dt=null,mt=null,zt=0;for(;;){++zt;const _r=G(!!mt);let br;mt?br=mt.output_sequence_out:br=new d.Tensor("float32",new Float32Array(Vt),[1,1,Vt]);let en={use_cache_branch:_r,output_sequence:br,encoder_attention_mask:tt,speaker_embeddings:L,encoder_hidden_states:Qe};this.addPastKeyValues(en,Dt),mt=await N(this.sessions.decoder_model_merged,en),Dt=this.getPastKeyValues(mt,Dt);const{prob:mn,spectrum:Bt}=mt;if(Et.push(Bt),zt>=At&&(Array.from(mn.data).filter(ln=>ln>=de).length>0||zt>=St))break}const Zt=(0,d.cat)(Et),{waveform:hr}=await N(Se.sessions.model,{spectrogram:Zt});return{spectrogram:Zt,waveform:hr}}}class dT extends F{constructor(){super(...arguments);ae(this,"main_input_name","spectrogram")}}class hT extends F{}class Fg extends hT{async generate_speech({input_ids:k,attention_mask:L,style:de,num_inference_steps:ve=5,speed:_e=1.05}){const{sampling_rate:Se,chunk_compress_factor:ze,base_chunk_size:Qe,latent_dim:tt}=this.config,{last_hidden_state:xt,durations:St}=await N(this.sessions.text_encoder,{input_ids:k,attention_mask:L,style:de});St.div_(_e);const At=St.max().item()*Se,Vt=Qe*ze,Et=Math.floor((At+Vt-1)/Vt),Dt=k.dims[0],mt=(0,d.ones)([Dt,Et]),zt=(0,d.full)([Dt],ve);let Zt=(0,d.randn)([Dt,tt*ze,Et]);for(let _r=0;_r<ve;++_r){const br=(0,d.full)([Dt],_r);({denoised_latents:Zt}=await N(this.sessions.latent_denoiser,{style:de,noisy_latents:Zt,latent_mask:mt,encoder_outputs:xt,attention_mask:L,timestep:br,num_inference_steps:zt}))}const{waveform:hr}=await N(this.sessions.voice_decoder,{latents:Zt});return{waveform:hr,durations:St}}}class fT extends F{}class pT extends fT{}class Rg extends F{}class mT extends Rg{}class gT extends Rg{}class Lg extends F{}class _T extends Lg{}class yT extends Lg{}class Ng extends F{}class vT extends Ng{}class wT extends Ng{}class jg extends F{}class bT extends jg{}class xT extends jg{}class $h extends F{}class MT extends $h{}class TT extends $h{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"text_model"})}}class ET extends $h{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"audio_model"})}}class PT extends F{}class zg extends PT{async _call(k){return new bP(await super._call(k))}}class Ah extends F{}class dz extends Ah{}class ST extends Ah{}class CT extends Ah{}class Bg extends F{}class kT extends Bg{}class $T extends Bg{}class Ug extends F{}class AT extends Ug{}class IT extends Ug{async _call(k){return new Rt(await super._call(k))}}class Vg extends F{}class hz extends Vg{}class fz extends Vg{}class Wg extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(L){const[de,ve]=L.dims,_e=this.config.decoder.num_codebooks,Se=ve-_e;let ze=0;for(let xt=0;xt<L.size;++xt){if(L.data[xt]===this.config.decoder.pad_token_id)continue;const St=xt%ve,At=Math.floor(xt/ve)%_e,Vt=St-At;Vt>0&&Vt<=Se&&(L.data[ze++]=L.data[xt])}const Qe=Math.floor(de/_e),tt=ze/(Qe*_e);return new d.Tensor(L.type,L.data.slice(0,ze),[Qe,_e,tt])}prepare_inputs_for_generation(L,de,ve){let _e=structuredClone(L);for(let ze=0;ze<_e.length;++ze)for(let Qe=0;Qe<_e[ze].length;++Qe)ze%this.config.decoder.num_codebooks>=Qe&&(_e[ze][Qe]=BigInt(this.config.decoder.pad_token_id));return ve.guidance_scale!==null&&ve.guidance_scale>1&&(_e=_e.concat(_e)),super.prepare_inputs_for_generation(_e,de,ve)}async generate(L){const de=await super.generate(L),ve=this._apply_and_filter_by_delay_pattern_mask(de).unsqueeze_(0),{audio_values:_e}=await N(this.sessions.encodec_decode,{audio_codes:ve});return _e}}class Ih extends F{}class OT extends Ih{}class DT extends Ih{async _call(k){return new Rt(await super._call(k))}}class FT extends Ih{}class Oh extends F{}class RT extends Oh{}class LT extends Oh{async _call(k){return new Rt(await super._call(k))}}class NT extends Oh{}class Dh extends F{}class jT extends Dh{}class zT extends Dh{async _call(k){return new Rt(await super._call(k))}}class BT extends Dh{}class Fh extends F{}class UT extends Fh{}class VT extends Fh{async _call(k){return new Rt(await super._call(k))}}class WT extends Fh{}class GT extends F{}class HT extends GT{}class KT extends F{}class qT extends KT{constructor(...L){super(...L);ae(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(L){const de=this._generation_mode??"text";let ve;if(de==="text"||!L.past_key_values){const tt=this.sessions.prepare_inputs_embeds,xt=(0,a.pick)(L,tt.inputNames);ve=await N(tt,xt)}else{const tt=this.sessions.gen_img_embeds,xt=(0,a.pick)({image_ids:L.input_ids},tt.inputNames);ve=await N(tt,xt)}const _e={...L,...ve},Se=await te(this,_e),ze=this.sessions[de==="text"?"lm_head":"gen_head"];if(!ze)throw new Error(`Unable to find "${ze}" generation head`);const Qe=await N(ze,(0,a.pick)(Se,ze.inputNames));return{...ve,...Se,...Qe}}async generate(L){return this._generation_mode="text",super.generate(L)}async generate_images(L){this._generation_mode="image";const de=(L.inputs??L[this.main_input_name]).dims[1],_e=(await super.generate(L)).slice(null,[de,null]),Se=this.sessions.image_decode,{decoded_image:ze}=await N(Se,{generated_tokens:_e}),Qe=ze.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),tt=[];for(const xt of Qe){const St=f.RawImage.fromTensor(xt);tt.push(St)}return tt}}class QT extends pe{constructor({char_logits:k,bpe_logits:L,wp_logits:de}){super(),this.char_logits=k,this.bpe_logits=L,this.wp_logits=de}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class XT extends F{}class JT extends XT{async _call(k){return new QT(await super._call(k))}}class Gg extends F{}class YT extends Gg{}class ZT extends Gg{}class Hg extends F{}class eE extends Hg{}class tE extends Hg{}class rE extends F{constructor(){super(...arguments);ae(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class Kg extends rE{_merge_input_ids_with_audio_features(k){const L=k.audio_features.dims.at(-1),de=k.audio_features.view(-1,L);return U({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...k,audio_features:de})}}class nE extends Kg{}class Rh extends F{constructor(){super(...arguments);ae(this,"main_input_name","input_values");ae(this,"forward_params",["input_values"])}}class sE extends pe{constructor({audio_codes:k}){super(),this.audio_codes=k}}class oE extends pe{constructor({audio_values:k}){super(),this.audio_values=k}}class iE extends Rh{async encode(k){return new sE(await N(this.sessions.encoder_model,k))}async decode(k){return new oE(await N(this.sessions.decoder_model,k))}}class aE extends Rh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"encoder_model"})}}class lE extends Rh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"decoder_model"})}}class Lh extends F{constructor(){super(...arguments);ae(this,"main_input_name","input_values");ae(this,"forward_params",["input_values"])}}class uE extends pe{constructor({audio_codes:k}){super(),this.audio_codes=k}}class cE extends pe{constructor({audio_values:k}){super(),this.audio_values=k}}class dE extends Lh{async encode(k){return new uE(await N(this.sessions.encoder_model,k))}async decode(k){return new cE(await N(this.sessions.decoder_model,k))}}class hE extends Lh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"encoder_model"})}}class fE extends Lh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"decoder_model"})}}class Nh extends F{constructor(){super(...arguments);ae(this,"main_input_name","input_values");ae(this,"forward_params",["input_values"])}}class pE extends Nh{async encode(k){return await N(this.sessions.encoder_model,k)}async decode(k){return await N(this.sessions.decoder_model,k)}}class mE extends Nh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"encoder_model"})}}class gE extends Nh{static async from_pretrained(k,L={}){return super.from_pretrained(k,{...L,model_file_name:L.model_file_name??"decoder_model"})}}class er{static async from_pretrained(k,{progress_callback:L=null,config:de=null,cache_dir:ve=null,local_files_only:_e=!1,revision:Se="main",model_file_name:ze=null,subfolder:Qe="onnx",device:tt=null,dtype:xt=null,use_external_data_format:St=null,session_options:At={}}={}){const Vt={progress_callback:L,config:de,cache_dir:ve,local_files_only:_e,revision:Se,model_file_name:ze,subfolder:Qe,device:tt,dtype:xt,use_external_data_format:St,session_options:At};if(Vt.config=await n.AutoConfig.from_pretrained(k,Vt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const Et=Vt.config.model_type;for(const Dt of this.MODEL_CLASS_MAPPINGS){let mt=Dt.get(Et);if(!mt){for(const zt of Dt.values())if(zt[0]===Et){mt=zt;break}if(!mt)continue}return await mt[1].from_pretrained(k,Vt)}if(this.BASE_IF_FAIL)return UE.has(Et)||console.warn(`Unknown model class "${Et}", attempting to construct from base class.`),await F.from_pretrained(k,Vt);throw Error(`Unsupported model type: ${Et}`)}}ae(er,"MODEL_CLASS_MAPPINGS",null),ae(er,"BASE_IF_FAIL",!1);const pz=new Map([["bert",["BertModel",Pe]],["neobert",["NeoBertModel",Je]],["modernbert",["ModernBertModel",Ne]],["nomic_bert",["NomicBertModel",Rr]],["roformer",["RoFormerModel",mr]],["electra",["ElectraModel",re]],["esm",["EsmModel",Os]],["convbert",["ConvBertModel",Xs]],["camembert",["CamembertModel",dt]],["deberta",["DebertaModel",ur]],["deberta-v2",["DebertaV2Model",ks]],["mpnet",["MPNetModel",da]],["albert",["AlbertModel",Ie]],["distilbert",["DistilBertModel",As]],["roberta",["RobertaModel",gl]],["xlm",["XLMModel",Yd]],["xlm-roberta",["XLMRobertaModel",nh]],["clap",["ClapModel",MT]],["clip",["CLIPModel",bl]],["clipseg",["CLIPSegModel",hs]],["chinese_clip",["ChineseCLIPModel",va]],["siglip",["SiglipModel",nc]],["jina_clip",["JinaCLIPModel",xh]],["mobilebert",["MobileBertModel",ut]],["squeezebert",["SqueezeBertModel",O]],["wav2vec2",["Wav2Vec2Model",OM]],["wav2vec2-bert",["Wav2Vec2BertModel",XM]],["unispeech",["UniSpeechModel",VM]],["unispeech-sat",["UniSpeechSatModel",HM]],["hubert",["HubertModel",ZM]],["wavlm",["WavLMModel",rT]],["audio-spectrogram-transformer",["ASTModel",ih]],["vits",["VitsModel",zg]],["pyannote",["PyAnnoteModel",jM]],["wespeaker-resnet",["WeSpeakerResNetModel",UM]],["detr",["DetrModel",f1]],["rt_detr",["RTDetrModel",g1]],["rt_detr_v2",["RTDetrV2Model",y1]],["rf_detr",["RFDetrModel",b1]],["d_fine",["DFineModel",T1]],["table-transformer",["TableTransformerModel",P1]],["vit",["ViTModel",jx]],["ijepa",["IJepaModel",Bx]],["pvt",["PvtModel",Gx]],["vit_msn",["ViTMSNModel",Qx]],["vit_mae",["ViTMAEModel",qx]],["groupvit",["GroupViTModel",Yx]],["fastvit",["FastViTModel",Zx]],["mobilevit",["MobileViTModel",n1]],["mobilevitv2",["MobileViTV2Model",o1]],["owlvit",["OwlViTModel",a1]],["owlv2",["Owlv2Model",u1]],["beit",["BeitModel",d1]],["deit",["DeiTModel",k1]],["hiera",["HieraModel",A1]],["convnext",["ConvNextModel",oM]],["convnextv2",["ConvNextV2Model",aM]],["dinov2",["Dinov2Model",uM]],["dinov2_with_registers",["Dinov2WithRegistersModel",dM]],["dinov3_vit",["DINOv3ViTModel",pM]],["dinov3_convnext",["DINOv3ConvNextModel",gM]],["resnet",["ResNetModel",O1]],["swin",["SwinModel",F1]],["swin2sr",["Swin2SRModel",N1]],["donut-swin",["DonutSwinModel",sM]],["yolos",["YolosModel",vM]],["dpt",["DPTModel",z1]],["glpn",["GLPNModel",tM]],["hifigan",["SpeechT5HifiGan",dT]],["efficientnet",["EfficientNetModel",AT]],["decision_transformer",["DecisionTransformerModel",HT]],["patchtst",["PatchTSTForPrediction",YT]],["patchtsmixer",["PatchTSMixerForPrediction",eE]],["mobilenet_v1",["MobileNetV1Model",OT]],["mobilenet_v2",["MobileNetV2Model",RT]],["mobilenet_v3",["MobileNetV3Model",jT]],["mobilenet_v4",["MobileNetV4Model",UT]],["maskformer",["MaskFormerModel",Z1]],["mgp-str",["MgpstrForSceneTextRecognition",JT]],["style_text_to_speech_2",["StyleTextToSpeech2Model",lT]]]),mz=new Map([["t5",["T5Model",$t]],["longt5",["LongT5Model",Ar]],["mt5",["MT5Model",Ir]],["bart",["BartModel",nn]],["mbart",["MBartModel",bn]],["marian",["MarianModel",kM]],["whisper",["WhisperModel",Ju]],["m2m_100",["M2M100Model",AM]],["blenderbot",["BlenderbotModel",sn]],["blenderbot-small",["BlenderbotSmallModel",Qr]]]),gz=new Map([["mimi",["MimiModel",iE]],["dac",["DacModel",dE]],["snac",["SnacModel",pE]]]),_z=new Map([["bloom",["BloomModel",Ox]],["jais",["JAISModel",Tl]],["gpt2",["GPT2Model",lc]],["gptj",["GPTJModel",fc]],["gpt_bigcode",["GPTBigCodeModel",mc]],["gpt_neo",["GPTNeoModel",dc]],["gpt_neox",["GPTNeoXModel",Pl]],["codegen",["CodeGenModel",D]],["llama",["LlamaModel",fe]],["nanochat",["NanoChatModel",Ft]],["arcee",["ArceeModel",on]],["lfm2",["Lfm2Model",Gb]],["smollm3",["SmolLM3Model",Kb]],["exaone",["ExaoneModel",Zb]],["olmo",["OlmoModel",nx]],["olmo2",["Olmo2Model",ox]],["mobilellm",["MobileLLMModel",tx]],["granite",["GraniteModel",ax]],["granitemoehybrid",["GraniteMoeHybridModel",ux]],["cohere",["CohereModel",dx]],["gemma",["GemmaModel",fx]],["gemma2",["Gemma2Model",mx]],["vaultgemma",["VaultGemmaModel",_x]],["gemma3_text",["Gemma3Model",vx]],["helium",["HeliumModel",Qb]],["glm",["GlmModel",Jb]],["openelm",["OpenELMModel",bx]],["qwen2",["Qwen2Model",Mx]],["qwen3",["Qwen3Model",Ex]],["phi",["PhiModel",kx]],["phi3",["Phi3Model",Ax]],["mpt",["MptModel",Fx]],["opt",["OPTModel",Lx]],["mistral",["MistralModel",mT]],["ernie4_5",["Ernie4_5_Model",_T]],["starcoder2",["Starcoder2Model",vT]],["falcon",["FalconModel",bT]],["stablelm",["StableLmModel",kT]],["modernbert-decoder",["ModernBertDecoderModel",yt]]]),qg=new Map([["speecht5",["SpeechT5ForSpeechToText",uT]],["whisper",["WhisperForConditionalGeneration",Qo]],["lite-whisper",["LiteWhisperForConditionalGeneration",lh]],["moonshine",["MoonshineForConditionalGeneration",uh]]]),_E=new Map([["speecht5",["SpeechT5ForTextToSpeech",cT]]]),yE=new Map([["vits",["VitsModel",zg]],["musicgen",["MusicgenForConditionalGeneration",Wg]],["supertonic",["SupertonicForConditionalGeneration",Fg]]]),vE=new Map([["bert",["BertForSequenceClassification",ke]],["neobert",["NeoBertForSequenceClassification",ot]],["modernbert",["ModernBertForSequenceClassification",Mt]],["roformer",["RoFormerForSequenceClassification",Qs]],["electra",["ElectraForSequenceClassification",Z]],["esm",["EsmForSequenceClassification",On]],["convbert",["ConvBertForSequenceClassification",Ht]],["camembert",["CamembertForSequenceClassification",Tt]],["deberta",["DebertaForSequenceClassification",Vn]],["deberta-v2",["DebertaV2ForSequenceClassification",fn]],["mpnet",["MPNetForSequenceClassification",fa]],["albert",["AlbertForSequenceClassification",He]],["distilbert",["DistilBertForSequenceClassification",rs]],["roberta",["RobertaForSequenceClassification",qu]],["xlm",["XLMForSequenceClassification",eh]],["xlm-roberta",["XLMRobertaForSequenceClassification",oh]],["bart",["BartForSequenceClassification",gr]],["mbart",["MBartForSequenceClassification",Fs]],["mobilebert",["MobileBertForSequenceClassification",qo]],["squeezebert",["SqueezeBertForSequenceClassification",ie]]]),wE=new Map([["bert",["BertForTokenClassification",be]],["neobert",["NeoBertForTokenClassification",Ze]],["modernbert",["ModernBertForTokenClassification",bt]],["roformer",["RoFormerForTokenClassification",ko]],["electra",["ElectraForTokenClassification",ue]],["esm",["EsmForTokenClassification",Ve]],["convbert",["ConvBertForTokenClassification",ct]],["camembert",["CamembertForTokenClassification",Ot]],["deberta",["DebertaForTokenClassification",Lr]],["deberta-v2",["DebertaV2ForTokenClassification",$o]],["mpnet",["MPNetForTokenClassification",pa]],["distilbert",["DistilBertForTokenClassification",Pn]],["roberta",["RobertaForTokenClassification",Xd]],["xlm",["XLMForTokenClassification",th]],["xlm-roberta",["XLMRobertaForTokenClassification",Qu]]]),Qg=new Map([["t5",["T5ForConditionalGeneration",qt]],["longt5",["LongT5ForConditionalGeneration",ar]],["mt5",["MT5ForConditionalGeneration",Pr]],["bart",["BartForConditionalGeneration",Ys]],["mbart",["MBartForConditionalGeneration",Ds]],["marian",["MarianMTModel",$M]],["m2m_100",["M2M100ForConditionalGeneration",IM]],["blenderbot",["BlenderbotForConditionalGeneration",zr]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Fn]]]),Xg=new Map([["bloom",["BloomForCausalLM",Dx]],["gpt2",["GPT2LMHeadModel",uc]],["jais",["JAISLMHeadModel",cc]],["gptj",["GPTJForCausalLM",pc]],["gpt_bigcode",["GPTBigCodeForCausalLM",w]],["gpt_neo",["GPTNeoForCausalLM",xa]],["gpt_neox",["GPTNeoXForCausalLM",hc]],["codegen",["CodeGenForCausalLM",j]],["llama",["LlamaForCausalLM",Ae]],["nanochat",["NanoChatForCausalLM",Qt]],["llama4_text",["Llama4ForCausalLM",et]],["arcee",["ArceeForCausalLM",Xo]],["lfm2",["Lfm2ForCausalLM",Hb]],["smollm3",["SmolLM3ForCausalLM",qb]],["exaone",["ExaoneForCausalLM",ex]],["olmo",["OlmoForCausalLM",sx]],["olmo2",["Olmo2ForCausalLM",ix]],["mobilellm",["MobileLLMForCausalLM",rx]],["granite",["GraniteForCausalLM",lx]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",cx]],["cohere",["CohereForCausalLM",hx]],["gemma",["GemmaForCausalLM",px]],["gemma2",["Gemma2ForCausalLM",gx]],["vaultgemma",["VaultGemmaForCausalLM",yx]],["gemma3_text",["Gemma3ForCausalLM",wx]],["helium",["HeliumForCausalLM",Xb]],["glm",["GlmForCausalLM",Yb]],["openelm",["OpenELMForCausalLM",xx]],["qwen2",["Qwen2ForCausalLM",Tx]],["qwen3",["Qwen3ForCausalLM",Px]],["phi",["PhiForCausalLM",$x]],["phi3",["Phi3ForCausalLM",Ix]],["mpt",["MptForCausalLM",Rx]],["opt",["OPTForCausalLM",Nx]],["mbart",["MBartForCausalLM",xn]],["mistral",["MistralForCausalLM",gT]],["ernie4_5",["Ernie4_5_ForCausalLM",yT]],["starcoder2",["Starcoder2ForCausalLM",wT]],["falcon",["FalconForCausalLM",xT]],["trocr",["TrOCRForCausalLM",pT]],["stablelm",["StableLmForCausalLM",$T]],["modernbert-decoder",["ModernBertDecoderForCausalLM",pr]],["phi3_v",["Phi3VForCausalLM",ec]]]),yz=new Map([["multi_modality",["MultiModalityCausalLM",qT]]]),bE=new Map([["bert",["BertForMaskedLM",ye]],["neobert",["NeoBertForMaskedLM",Te]],["modernbert",["ModernBertForMaskedLM",qe]],["roformer",["RoFormerForMaskedLM",Kr]],["electra",["ElectraForMaskedLM",B]],["esm",["EsmForMaskedLM",Ko]],["convbert",["ConvBertForMaskedLM",Ge]],["camembert",["CamembertForMaskedLM",Ct]],["deberta",["DebertaForMaskedLM",In]],["deberta-v2",["DebertaV2ForMaskedLM",$s]],["mpnet",["MPNetForMaskedLM",ha]],["albert",["AlbertForMaskedLM",Ye]],["distilbert",["DistilBertForMaskedLM",qr]],["roberta",["RobertaForMaskedLM",Qd]],["xlm",["XLMWithLMHeadModel",Zd]],["xlm-roberta",["XLMRobertaForMaskedLM",sh]],["mobilebert",["MobileBertForMaskedLM",cr]],["squeezebert",["SqueezeBertForMaskedLM",H]]]),xE=new Map([["bert",["BertForQuestionAnswering",Oe]],["neobert",["NeoBertForQuestionAnswering",it]],["roformer",["RoFormerForQuestionAnswering",Cs]],["electra",["ElectraForQuestionAnswering",xe]],["convbert",["ConvBertForQuestionAnswering",Wt]],["camembert",["CamembertForQuestionAnswering",lt]],["deberta",["DebertaForQuestionAnswering",Zr]],["deberta-v2",["DebertaV2ForQuestionAnswering",Ao]],["mpnet",["MPNetForQuestionAnswering",ma]],["albert",["AlbertForQuestionAnswering",st]],["distilbert",["DistilBertForQuestionAnswering",Is]],["roberta",["RobertaForQuestionAnswering",Jd]],["xlm",["XLMForQuestionAnswering",rh]],["xlm-roberta",["XLMRobertaForQuestionAnswering",Xu]],["mobilebert",["MobileBertForQuestionAnswering",Js]],["squeezebert",["SqueezeBertForQuestionAnswering",he]]]),Jg=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Yu]],["idefics3",["Idefics3ForConditionalGeneration",Io]],["smolvlm",["SmolVLMForConditionalGeneration",wl]]]),ME=new Map([["llava",["LlavaForConditionalGeneration",_a]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",ch]],["moondream1",["Moondream1ForConditionalGeneration",dh]],["florence2",["Florence2ForConditionalGeneration",fh]],["qwen2-vl",["Qwen2VLForConditionalGeneration",Cx]],["idefics3",["Idefics3ForConditionalGeneration",Io]],["smolvlm",["SmolVLMForConditionalGeneration",wl]],["paligemma",["PaliGemmaForConditionalGeneration",mh]],["llava_qwen2",["LlavaQwen2ForCausalLM",gh]],["gemma3n",["Gemma3nForConditionalGeneration",Zu]]]),TE=new Map([["ultravox",["UltravoxModel",Kg]],["voxtral",["VoxtralForConditionalGeneration",nE]]]),vz=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Yu]]]),EE=new Map([["vit",["ViTForImageClassification",zx]],["ijepa",["IJepaForImageClassification",Ux]],["pvt",["PvtForImageClassification",Hx]],["vit_msn",["ViTMSNForImageClassification",Xx]],["fastvit",["FastViTForImageClassification",e1]],["mobilevit",["MobileViTForImageClassification",s1]],["mobilevitv2",["MobileViTV2ForImageClassification",i1]],["beit",["BeitForImageClassification",h1]],["deit",["DeiTForImageClassification",$1]],["hiera",["HieraForImageClassification",I1]],["convnext",["ConvNextForImageClassification",iM]],["convnextv2",["ConvNextV2ForImageClassification",lM]],["dinov2",["Dinov2ForImageClassification",cM]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",hM]],["resnet",["ResNetForImageClassification",D1]],["swin",["SwinForImageClassification",R1]],["segformer",["SegformerForImageClassification",ST]],["efficientnet",["EfficientNetForImageClassification",IT]],["mobilenet_v1",["MobileNetV1ForImageClassification",DT]],["mobilenet_v2",["MobileNetV2ForImageClassification",LT]],["mobilenet_v3",["MobileNetV3ForImageClassification",zT]],["mobilenet_v4",["MobileNetV4ForImageClassification",VT]]]),PE=new Map([["detr",["DetrForObjectDetection",p1]],["rt_detr",["RTDetrForObjectDetection",_1]],["rt_detr_v2",["RTDetrV2ForObjectDetection",v1]],["rf_detr",["RFDetrForObjectDetection",x1]],["d_fine",["DFineForObjectDetection",E1]],["table-transformer",["TableTransformerForObjectDetection",S1]],["yolos",["YolosForObjectDetection",wM]]]),SE=new Map([["owlvit",["OwlViTForObjectDetection",l1]],["owlv2",["Owlv2ForObjectDetection",c1]],["grounding-dino",["GroundingDinoForObjectDetection",yM]]]),$l=new Map([["detr",["DetrForSegmentation",fg]],["clipseg",["CLIPSegForImageSegmentation",wa]]]),CE=new Map([["segformer",["SegformerForSemanticSegmentation",CT]],["sapiens",["SapiensForSemanticSegmentation",W1]],["swin",["SwinForSemanticSegmentation",L1]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",FT]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",NT]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",BT]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",WT]]]),kE=new Map([["detr",["DetrForSegmentation",fg]],["maskformer",["MaskFormerForInstanceSegmentation",eM]]]),$E=new Map([["sam",["SamModel",MM]],["sam2",["Sam2Model",Ph]],["edgetam",["EdgeTamModel",SM]],["sam3_tracker",["Sam3TrackerModel",CM]]]),AE=new Map([["wav2vec2",["Wav2Vec2ForCTC",DM]],["wav2vec2-bert",["Wav2Vec2BertForCTC",JM]],["unispeech",["UniSpeechForCTC",WM]],["unispeech-sat",["UniSpeechSatForCTC",KM]],["wavlm",["WavLMForCTC",nT]],["hubert",["HubertForCTC",eT]],["parakeet_ctc",["ParakeetForCTC",NM]]]),IE=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",FM]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",YM]],["unispeech",["UniSpeechForSequenceClassification",GM]],["unispeech-sat",["UniSpeechSatForSequenceClassification",qM]],["wavlm",["WavLMForSequenceClassification",sT]],["hubert",["HubertForSequenceClassification",tT]],["audio-spectrogram-transformer",["ASTForAudioClassification",ah]]]),OE=new Map([["wavlm",["WavLMForXVector",oT]]]),DE=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",QM]],["wavlm",["WavLMForAudioFrameClassification",iT]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",RM]],["pyannote",["PyAnnoteForAudioFrameClassification",zM]]]),FE=new Map([["vitmatte",["VitMatteForImageMatting",r1]]]),wz=new Map([["patchtst",["PatchTSTForPrediction",ZT]],["patchtsmixer",["PatchTSMixerForPrediction",tE]]]),RE=new Map([["swin2sr",["Swin2SRForImageSuperResolution",j1]]]),LE=new Map([["dpt",["DPTForDepthEstimation",B1]],["depth_anything",["DepthAnythingForDepthEstimation",V1]],["glpn",["GLPNForDepthEstimation",rM]],["sapiens",["SapiensForDepthEstimation",G1]],["depth_pro",["DepthProForDepthEstimation",q1]],["metric3d",["Metric3DForDepthEstimation",X1]],["metric3dv2",["Metric3Dv2ForDepthEstimation",Y1]]]),NE=new Map([["sapiens",["SapiensForNormalEstimation",H1]]]),jE=new Map([["vitpose",["VitPoseForPoseEstimation",Wx]]]),zE=new Map([["clip",["CLIPVisionModelWithProjection",rc]],["siglip",["SiglipVisionModel",sc]],["jina_clip",["JinaCLIPVisionModel",ac]]]),BE=[[pz,v.EncoderOnly],[mz,v.EncoderDecoder],[_z,v.DecoderOnly],[gz,v.AutoEncoder],[vE,v.EncoderOnly],[wE,v.EncoderOnly],[Qg,v.Seq2Seq],[qg,v.Seq2Seq],[Xg,v.DecoderOnly],[yz,v.MultiModality],[bE,v.EncoderOnly],[xE,v.EncoderOnly],[Jg,v.Vision2Seq],[ME,v.ImageTextToText],[TE,v.AudioTextToText],[EE,v.EncoderOnly],[$l,v.EncoderOnly],[kE,v.EncoderOnly],[CE,v.EncoderOnly],[FE,v.EncoderOnly],[wz,v.EncoderOnly],[RE,v.EncoderOnly],[LE,v.EncoderOnly],[NE,v.EncoderOnly],[jE,v.EncoderOnly],[PE,v.EncoderOnly],[SE,v.EncoderOnly],[$E,v.MaskGeneration],[AE,v.EncoderOnly],[IE,v.EncoderOnly],[_E,v.Seq2Seq],[yE,v.EncoderOnly],[OE,v.EncoderOnly],[DE,v.EncoderOnly],[zE,v.EncoderOnly]];for(const[P,k]of BE)for(const[L,de]of P.values())M.set(L,k),T.set(de,L),E.set(L,de);const bz=[["MusicgenForConditionalGeneration",Wg,v.Musicgen],["Phi3VForCausalLM",ec,v.Phi3V],["CLIPTextModelWithProjection",tc,v.EncoderOnly],["SiglipTextModel",bh,v.EncoderOnly],["JinaCLIPTextModel",ic,v.EncoderOnly],["ClapTextModelWithProjection",TT,v.EncoderOnly],["ClapAudioModelWithProjection",ET,v.EncoderOnly],["DacEncoderModel",hE,v.EncoderOnly],["DacDecoderModel",fE,v.EncoderOnly],["MimiEncoderModel",aE,v.EncoderOnly],["MimiDecoderModel",lE,v.EncoderOnly],["SnacEncoderModel",mE,v.EncoderOnly],["SnacDecoderModel",gE,v.EncoderOnly],["Gemma3nForConditionalGeneration",Zu,v.ImageAudioTextToText],["SupertonicForConditionalGeneration",Fg,v.Supertonic]];for(const[P,k,L]of bz)M.set(P,L),T.set(k,P),E.set(P,k);const UE=new Map([["modnet",$l],["birefnet",$l],["isnet",$l],["ben",$l]]);for(const[P,k]of UE.entries())k.set(P,["PreTrainedModel",F]),M.set(P,v.EncoderOnly),T.set(F,P),E.set(P,F);class Yg extends er{}ae(Yg,"MODEL_CLASS_MAPPINGS",BE.map(k=>k[0])),ae(Yg,"BASE_IF_FAIL",!0);class VE extends er{}ae(VE,"MODEL_CLASS_MAPPINGS",[vE]);class WE extends er{}ae(WE,"MODEL_CLASS_MAPPINGS",[wE]);class GE extends er{}ae(GE,"MODEL_CLASS_MAPPINGS",[Qg]);class HE extends er{}ae(HE,"MODEL_CLASS_MAPPINGS",[qg]);class KE extends er{}ae(KE,"MODEL_CLASS_MAPPINGS",[_E]);class qE extends er{}ae(qE,"MODEL_CLASS_MAPPINGS",[yE]);class QE extends er{}ae(QE,"MODEL_CLASS_MAPPINGS",[Xg]);class XE extends er{}ae(XE,"MODEL_CLASS_MAPPINGS",[bE]);class JE extends er{}ae(JE,"MODEL_CLASS_MAPPINGS",[xE]);class YE extends er{}ae(YE,"MODEL_CLASS_MAPPINGS",[Jg]);class ZE extends er{}ae(ZE,"MODEL_CLASS_MAPPINGS",[EE]);class eP extends er{}ae(eP,"MODEL_CLASS_MAPPINGS",[$l]);class tP extends er{}ae(tP,"MODEL_CLASS_MAPPINGS",[CE]);class rP extends er{}ae(rP,"MODEL_CLASS_MAPPINGS",[kE]);class nP extends er{}ae(nP,"MODEL_CLASS_MAPPINGS",[PE]);class sP extends er{}ae(sP,"MODEL_CLASS_MAPPINGS",[SE]);class oP extends er{}ae(oP,"MODEL_CLASS_MAPPINGS",[$E]);class iP extends er{}ae(iP,"MODEL_CLASS_MAPPINGS",[AE]);class aP extends er{}ae(aP,"MODEL_CLASS_MAPPINGS",[IE]);class lP extends er{}ae(lP,"MODEL_CLASS_MAPPINGS",[OE]);class uP extends er{}ae(uP,"MODEL_CLASS_MAPPINGS",[DE]);class cP extends er{}ae(cP,"MODEL_CLASS_MAPPINGS",[vz]);class dP extends er{}ae(dP,"MODEL_CLASS_MAPPINGS",[FE]);class hP extends er{}ae(hP,"MODEL_CLASS_MAPPINGS",[RE]);class fP extends er{}ae(fP,"MODEL_CLASS_MAPPINGS",[LE]);class pP extends er{}ae(pP,"MODEL_CLASS_MAPPINGS",[NE]);class mP extends er{}ae(mP,"MODEL_CLASS_MAPPINGS",[jE]);class gP extends er{}ae(gP,"MODEL_CLASS_MAPPINGS",[zE]);class _P extends er{}ae(_P,"MODEL_CLASS_MAPPINGS",[ME]);class yP extends er{}ae(yP,"MODEL_CLASS_MAPPINGS",[TE]);class xz extends pe{constructor({logits:k,past_key_values:L,encoder_outputs:de,decoder_attentions:ve=null,cross_attentions:_e=null}){super(),this.logits=k,this.past_key_values=L,this.encoder_outputs=de,this.decoder_attentions=ve,this.cross_attentions=_e}}class Rt extends pe{constructor({logits:k,...L}){super(),this.logits=k;const de=Object.values(L);de.length>0&&(this.attentions=de)}}class vP extends pe{constructor({logits:k,embeddings:L}){super(),this.logits=k,this.embeddings=L}}class an extends pe{constructor({logits:k}){super(),this.logits=k}}class pn extends pe{constructor({logits:k}){super(),this.logits=k}}class Sn extends pe{constructor({start_logits:k,end_logits:L}){super(),this.start_logits=k,this.end_logits=L}}class xi extends pe{constructor({logits:k}){super(),this.logits=k}}class Mz extends pe{constructor({logits:k,past_key_values:L}){super(),this.logits=k,this.past_key_values=L}}class wP extends pe{constructor({alphas:k}){super(),this.alphas=k}}class bP extends pe{constructor({waveform:k,spectrogram:L}){super(),this.waveform=k,this.spectrogram=L}}},"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":(e,t,r)=>{r.r(t),r.d(t,{ASTFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class o extends n.FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,u=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=u,this.window=(0,s.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(a,l){return(0,s.spectrogram)(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:l,transpose:!0})}async _call(a){(0,n.validate_audio_inputs)(a,"ASTFeatureExtractor");const l=await this._extract_fbank_features(a,this.config.max_length);if(this.config.do_normalize){const u=this.std*2,h=l.data;for(let c=0;c<h.length;++c)h[c]=(h[c]-this.mean)/u}return{input_values:l.unsqueeze_(0)}}}},"./src/models/auto/feature_extraction_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoFeatureExtractor:()=>i});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js");r("./src/base/feature_extraction_utils.js");var o=r("./src/models/feature_extractors.js");class i{static async from_pretrained(l,u={}){const h=await(0,s.getModelJSON)(l,n.FEATURE_EXTRACTOR_NAME,!0,u),c=h.feature_extractor_type,d=o[c];if(!d)throw new Error(`Unknown feature_extractor_type: '${c}'. Please report this at ${n.GITHUB_ISSUE_URL}.`);return new d(h)}}},"./src/models/auto/image_processing_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoImageProcessor:()=>a});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),o=r("./src/base/image_processors_utils.js"),i=r("./src/models/image_processors.js");class a{static async from_pretrained(u,h={}){const c=await(0,s.getModelJSON)(u,n.IMAGE_PROCESSOR_NAME,!0,h),d=c.image_processor_type??c.feature_extractor_type;let f=i[d==null?void 0:d.replace(/Fast$/,"")];return f||(d!==void 0&&console.warn(`Image processor type '${d}' not found, assuming base ImageProcessor. Please report this at ${n.GITHUB_ISSUE_URL}.`),f=o.ImageProcessor),new f(c)}}},"./src/models/auto/processing_auto.js":(e,t,r)=>{r.r(t),r.d(t,{AutoProcessor:()=>u});var n=r("./src/utils/constants.js"),s=r("./src/utils/hub.js"),o=r("./src/base/processing_utils.js"),i=r("./src/models/processors.js"),a=r("./src/models/image_processors.js"),l=r("./src/models/feature_extractors.js");class u{static async from_pretrained(c,d={}){const f=await(0,s.getModelJSON)(c,n.IMAGE_PROCESSOR_NAME,!0,d),{image_processor_type:p,feature_extractor_type:m,processor_class:b}=f;if(b&&i[b])return i[b].from_pretrained(c,d);if(!p&&!m)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const g={};if(p){const y=a[p.replace(/Fast$/,"")];if(!y)throw new Error(`Unknown image_processor_type: '${p}'.`);g.image_processor=new y(f)}if(m){const y=a[m];if(y)g.image_processor=new y(f);else{const v=l[m];if(!v)throw new Error(`Unknown feature_extractor_type: '${m}'.`);g.feature_extractor=new v(f)}}const _={};return new o.Processor(_,g,null)}}},"./src/models/beit/image_processing_beit.js":(e,t,r)=>{r.r(t),r.d(t,{BeitFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/bit/image_processing_bit.js":(e,t,r)=>{r.r(t),r.d(t,{BitImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/chinese_clip/image_processing_chinese_clip.js":(e,t,r)=>{r.r(t),r.d(t,{ChineseCLIPFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/clap/feature_extraction_clap.js":(e,t,r)=>{r.r(t),r.d(t,{ClapFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class o extends n.FeatureExtractor{constructor(a){super(a),this.mel_filters=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,s.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,s.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(a,l,u,h){let c;const d=a.length-l;if(d>0)if(u==="rand_trunc"){const f=Math.floor(Math.random()*(d+1));a=a.subarray(f,f+l),c=await this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${u}" not implemented`);else{if(d<0){let f=new Float64Array(l);if(f.set(a),h==="repeat")for(let p=a.length;p<l;p+=a.length)f.set(a.subarray(0,Math.min(a.length,l-p)),p);else if(h==="repeatpad")for(let p=a.length;p<-d;p+=a.length)f.set(a,p);a=f}if(u==="fusion")throw new Error(`Truncation strategy "${u}" not implemented`);c=await this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples)}return c.unsqueeze_(0)}async _extract_fbank_features(a,l,u=null){return(0,s.spectrogram)(a,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:l,log_mel:"dB",max_num_frames:u,do_pad:!1,transpose:!0})}async _call(a,{max_length:l=null}={}){return(0,n.validate_audio_inputs)(a,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(a,l??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}},"./src/models/clip/image_processing_clip.js":(e,t,r)=>{r.r(t),r.d(t,{CLIPFeatureExtractor:()=>o,CLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/convnext/image_processing_convnext.js":(e,t,r)=>{r.r(t),r.d(t,{ConvNextFeatureExtractor:()=>o,ConvNextImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(a){super(a),this.crop_pct=this.config.crop_pct??224/256}async resize(a){var u;const l=(u=this.size)==null?void 0:u.shortest_edge;if(l===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(l<384){const h=Math.floor(l/this.crop_pct),[c,d]=this.get_resize_output_image_size(a,{shortest_edge:h});a=await a.resize(c,d,{resample:this.resample}),a=await a.center_crop(l,l)}else a=await a.resize(l,l,{resample:this.resample});return a}}class o extends s{}},"./src/models/dac/feature_extraction_dac.js":(e,t,r)=>{r.r(t),r.d(t,{DacFeatureExtractor:()=>s});var n=r("./src/models/encodec/feature_extraction_encodec.js");class s extends n.EncodecFeatureExtractor{}},"./src/models/deit/image_processing_deit.js":(e,t,r)=>{r.r(t),r.d(t,{DeiTFeatureExtractor:()=>o,DeiTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/detr/image_processing_detr.js":(e,t,r)=>{r.r(t),r.d(t,{DetrFeatureExtractor:()=>i,DetrImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class o extends n.ImageProcessor{async _call(l){const u=await super._call(l),h=[u.pixel_values.dims[0],64,64],c=(0,s.full)(h,1n);return{...u,pixel_mask:c}}post_process_object_detection(...l){return(0,n.post_process_object_detection)(...l)}post_process_panoptic_segmentation(...l){return(0,n.post_process_panoptic_segmentation)(...l)}post_process_instance_segmentation(...l){return(0,n.post_process_instance_segmentation)(...l)}}class i extends o{}},"./src/models/dinov3_vit/image_processing_dinov3_vit.js":(e,t,r)=>{r.r(t),r.d(t,{DINOv3ViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/donut/image_processing_donut.js":(e,t,r)=>{r.r(t),r.d(t,{DonutFeatureExtractor:()=>o,DonutImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(a,l,u,h={}){const[c,d,f]=l;let p=this.image_mean;Array.isArray(this.image_mean)||(p=new Array(f).fill(p));let m=this.image_std;Array.isArray(m)||(m=new Array(f).fill(p));const b=p.map((g,_)=>-g/m[_]);return super.pad_image(a,l,u,{center:!0,constant_values:b,...h})}}class o extends s{}},"./src/models/dpt/image_processing_dpt.js":(e,t,r)=>{r.r(t),r.d(t,{DPTFeatureExtractor:()=>o,DPTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/efficientnet/image_processing_efficientnet.js":(e,t,r)=>{r.r(t),r.d(t,{EfficientNetImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(i){super(i),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(a=>a*a))}}},"./src/models/encodec/feature_extraction_encodec.js":(e,t,r)=>{r.r(t),r.d(t,{EncodecFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class o extends n.FeatureExtractor{async _call(a){(0,n.validate_audio_inputs)(a,"EncodecFeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));const l=this.config.feature_size;if(a.length%l!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${l}).`);const u=[1,l,a.length/l];return{input_values:new s.Tensor("float32",a,u)}}}},"./src/models/feature_extractors.js":(e,t,r)=>{r.r(t),r.d(t,{ASTFeatureExtractor:()=>n.ASTFeatureExtractor,ClapFeatureExtractor:()=>o.ClapFeatureExtractor,DacFeatureExtractor:()=>i.DacFeatureExtractor,EncodecFeatureExtractor:()=>s.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>a.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>g.ImageProcessor,MoonshineFeatureExtractor:()=>l.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>u.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>h.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>c.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>d.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>f.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>p.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>m.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>b.WhisperFeatureExtractor});var n=r("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),s=r("./src/models/encodec/feature_extraction_encodec.js"),o=r("./src/models/clap/feature_extraction_clap.js"),i=r("./src/models/dac/feature_extraction_dac.js"),a=r("./src/models/gemma3n/feature_extraction_gemma3n.js"),l=r("./src/models/moonshine/feature_extraction_moonshine.js"),u=r("./src/models/parakeet/feature_extraction_parakeet.js"),h=r("./src/models/pyannote/feature_extraction_pyannote.js"),c=r("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),d=r("./src/models/snac/feature_extraction_snac.js"),f=r("./src/models/speecht5/feature_extraction_speecht5.js"),p=r("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),m=r("./src/models/wespeaker/feature_extraction_wespeaker.js"),b=r("./src/models/whisper/feature_extraction_whisper.js"),g=r("./src/base/image_processors_utils.js")},"./src/models/florence2/processing_florence2.js":(e,t,r)=>{r.r(t),r.d(t,{Florence2Processor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");class i extends n.Processor{constructor(l,u,h){super(l,u,h);const{tasks_answer_post_processing_type:c,task_prompts_without_inputs:d,task_prompts_with_input:f}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(c??{})),this.task_prompts_without_inputs=new Map(Object.entries(d??{})),this.task_prompts_with_input=new Map(Object.entries(f??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(l){typeof l=="string"&&(l=[l]);const u=[];for(const h of l)if(this.task_prompts_without_inputs.has(h))u.push(this.task_prompts_without_inputs.get(h));else{for(const[c,d]of this.task_prompts_with_input)if(h.includes(c)){u.push(d.replaceAll("{input}",h).replaceAll(c,""));break}u.length!==l.length&&u.push(h)}return u}post_process_generation(l,u,h){const c=this.tasks_answer_post_processing_type.get(u)??"pure_text";l=l.replaceAll("<s>","").replaceAll("</s>","");let d;switch(c){case"pure_text":d=l;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const f=c==="ocr"?"quad_boxes":"bboxes",p=l.matchAll(this.regexes[f]),m=[],b=[];for(const[g,_,...y]of p)m.push(_?_.trim():m.at(-1)??""),b.push(y.map((v,M)=>(Number(v)+.5)/this.size_per_bin*h[M%2]));d={labels:m,[f]:b};break;default:throw new Error(`Task "${u}" (of type "${c}") not yet implemented.`)}return{[u]:d}}async _call(l,u=null,h={}){if(!l&&!u)throw new Error("Either text or images must be provided");const c=await this.image_processor(l,h),d=u?this.tokenizer(this.construct_prompts(u),h):{};return{...c,...d}}}ae(i,"tokenizer_class",o.AutoTokenizer),ae(i,"image_processor_class",s.AutoImageProcessor)},"./src/models/gemma3n/feature_extraction_gemma3n.js":(e,t,r)=>{r.r(t),r.d(t,{Gemma3nAudioFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(l){super(l);const{fft_length:u,feature_size:h,min_frequency:c,max_frequency:d,sampling_rate:f,frame_length:p}=this.config,m=(0,o.mel_filter_bank)(Math.floor(1+u/2),h,c,d,f,null,"htk",!1);this.mel_filters=m,this.window=(0,o.window_function)(p,"hann")}async _extract_fbank_features(l,u){return(0,o.spectrogram)(l,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(l,{max_length:u=48e4,truncation:h=!0,padding:c=!0,pad_to_multiple_of:d=128}={}){if((0,n.validate_audio_inputs)(l,"Gemma3nAudioFeatureExtractor"),h&&l.length>u&&(l=l.slice(0,u)),c&&l.length%d!==0){const m=d-l.length%d,b=new Float64Array(l.length+m);b.set(l),this.config.padding_value!==0&&b.fill(this.config.padding_value,l.length),l=b}const f=await this._extract_fbank_features(l,this.config.max_length),p=(0,s.full)([1,f.dims[0]],!0);return{input_features:f.unsqueeze_(0),input_features_mask:p}}}},"./src/models/gemma3n/processing_gemma3n.js":(e,t,r)=>{r.r(t),r.d(t,{Gemma3nProcessor:()=>a});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/models/auto/feature_extraction_auto.js"),i=r("./src/tokenizers.js");r("./src/utils/image.js"),r("./src/utils/audio.js");class a extends n.Processor{constructor(u,h,c){super(u,h,c),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:d,boa_token:f,audio_token:p,eoa_token:m,image_token_id:b,boi_token:g,image_token:_,eoi_token:y}=this.tokenizer.config;this.audio_token_id=d,this.boa_token=f,this.audio_token=p;const v=p.repeat(this.audio_seq_length);this.full_audio_sequence=`

${f}${v}${m}

`,this.image_token_id=b,this.boi_token=g,this.image_token=_;const M=_.repeat(this.image_seq_length);this.full_image_sequence=`

${g}${M}${y}

`}async _call(u,h=null,c=null,d={}){typeof u=="string"&&(u=[u]);let f;c&&(f=await this.feature_extractor(c,d),u=u.map(b=>b.replaceAll(this.audio_token,this.full_audio_sequence)));let p;return h&&(p=await this.image_processor(h,d),u=u.map(b=>b.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(u,d),...p,...f}}}ae(a,"image_processor_class",s.AutoImageProcessor),ae(a,"feature_extractor_class",o.AutoFeatureExtractor),ae(a,"tokenizer_class",i.AutoTokenizer),ae(a,"uses_processor_config",!0),ae(a,"uses_chat_template_file",!0)},"./src/models/glpn/image_processing_glpn.js":(e,t,r)=>{r.r(t),r.d(t,{GLPNFeatureExtractor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/grounding_dino/image_processing_grounding_dino.js":(e,t,r)=>{r.r(t),r.d(t,{GroundingDinoImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class o extends n.ImageProcessor{async _call(a){const l=await super._call(a),u=l.pixel_values.dims,h=(0,s.ones)([u[0],u[2],u[3]]);return{...l,pixel_mask:h}}}},"./src/models/grounding_dino/processing_grounding_dino.js":(e,t,r)=>{r.r(t),r.d(t,{GroundingDinoProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js"),i=r("./src/base/image_processors_utils.js");function a(u,h){const d=u.dims.at(-1)-1,f=u.tolist();f.fill(!1,0,1),f.fill(!1,d);const p=h.tolist();return f.map((m,b)=>m?b:null).filter(m=>m!==null).map(m=>p[m])}class l extends n.Processor{async _call(h,c,d={}){const f=h?await this.image_processor(h,d):{};return{...c?this.tokenizer(c,d):{},...f}}post_process_grounded_object_detection(h,c,{box_threshold:d=.25,text_threshold:f=.25,target_sizes:p=null}={}){const{logits:m,pred_boxes:b}=h,g=m.dims[0];if(p!==null&&p.length!==g)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const _=m.dims.at(1),y=m.sigmoid(),v=y.max(-1).tolist(),M=b.tolist().map(T=>T.map(S=>(0,i.center_to_corners_format)(S))),E=[];for(let T=0;T<g;++T){const S=p!==null?p[T]:null;S!==null&&(M[T]=M[T].map(z=>z.map((q,G)=>q*S[(G+1)%2])));const A=v[T],I=[],V=[],N=[];for(let z=0;z<_;++z){const q=A[z];if(q<=d)continue;const G=M[T][z],ee=y[T][z];I.push(q),N.push(G);const Y=a(ee.gt(f),c[T]);V.push(Y)}E.push({scores:I,boxes:N,labels:this.batch_decode(V)})}return E}}ae(l,"tokenizer_class",o.AutoTokenizer),ae(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/idefics3/image_processing_idefics3.js":(e,t,r)=>{r.r(t),r.d(t,{Idefics3ImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class o extends n.ImageProcessor{constructor(a){super(a),this.do_image_splitting=a.do_image_splitting??!0,this.max_image_size=a.max_image_size}get_resize_for_vision_encoder(a,l){let[u,h]=a.dims.slice(-2);const c=h/u;return h>=u?(h=Math.ceil(h/l)*l,u=Math.floor(h/c),u=Math.ceil(u/l)*l):(u=Math.ceil(u/l)*l,h=Math.floor(u*c),h=Math.ceil(h/l)*l),{height:u,width:h}}async _call(a,{do_image_splitting:l=null,return_row_col_info:u=!1}={}){let h;if(!Array.isArray(a))h=[[a]];else{if(a.length===0||!a[0])throw new Error("No images provided.");Array.isArray(a[0])?h=a:h=[a]}let c=[],d=[],f=[];const p=[],m=[];for(const T of h){let S=await Promise.all(T.map(V=>this.preprocess(V)));p.push(...S.map(V=>V.original_size)),m.push(...S.map(V=>V.reshaped_input_size)),S.forEach(V=>V.pixel_values.unsqueeze_(0));const{longest_edge:A}=this.max_image_size;let I;if(l??this.do_image_splitting){let V=new Array(S.length),N=new Array(S.length);I=await Promise.all(S.map(async(z,q)=>{const G=this.get_resize_for_vision_encoder(z.pixel_values,A),ee=await(0,s.interpolate_4d)(z.pixel_values,{size:[G.height,G.width]}),{frames:Y,num_splits_h:W,num_splits_w:te}=await this.split_image(ee,this.max_image_size);return V[q]=W,N[q]=te,(0,s.cat)(Y,0)})),d.push(V),f.push(N)}else{const V=[A,A];I=await Promise.all(S.map(N=>(0,s.interpolate_4d)(N.pixel_values,{size:V}))),d.push(new Array(S.length).fill(0)),f.push(new Array(S.length).fill(0))}c.push((0,s.cat)(I,0))}const b=c.length,[g,_,y,v]=c[0].dims;let M,E;if(b===1)M=c[0].unsqueeze_(0),E=(0,s.full)([b,g,y,v],!0);else{const T=Math.max(...c.map(I=>I.dims.at(0)));E=(0,s.full)([b,T,y,v],!0);const S=E.data,A=T*y*v;for(let I=0;I<b;++I){const V=c[I].dims[0];if(V<T){c[I]=(0,s.cat)([c[I],(0,s.full)([T-V,_,y,v],0)],0);const N=I*A+V*y*v,z=(I+1)*A;S.fill(!1,N,z)}}M=(0,s.stack)(c,0)}return{pixel_values:M,pixel_attention_mask:E,original_sizes:p,reshaped_input_sizes:m,...u?{rows:d,cols:f}:{}}}async split_image(a,{longest_edge:l}){const u=l,h=l,c=[],[d,f]=a.dims.slice(-2);let p=0,m=0;if(d>u||f>h){p=Math.ceil(d/u),m=Math.ceil(f/h);const b=Math.ceil(d/p),g=Math.ceil(f/m);for(let v=0;v<p;++v)for(let M=0;M<m;++M){let E,T,S,A;v===p-1?(T=d-b,A=d):(T=v*b,A=(v+1)*b),M===m-1?(E=f-g,S=f):(E=M*g,S=(M+1)*g);const I=[T,E],V=[A,S],N=await(0,s.slice)(a,I,V,[2,3]);c.push(N)}const _=u,y=h;(d!==_||f!==y)&&(a=await(0,s.interpolate_4d)(a,{size:[_,y]}))}return c.push(a),{frames:c,num_splits_h:p,num_splits_w:m}}}},"./src/models/idefics3/processing_idefics3.js":(e,t,r)=>{r.r(t),r.d(t,{Idefics3Processor:()=>h});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");r("./src/utils/image.js");var i=r("./src/utils/core.js");function a(c,d,f,p,m,b){let g="";for(let _=0;_<d;++_){for(let y=0;y<f;++y)g+=p+`<row_${_+1}_col_${y+1}>`+m.repeat(c);g+=`
`}return g+=`
${p}${b}`+m.repeat(c)+`${p}`,g}function l(c,d,f,p){return`${d}${p}`+f.repeat(c)+`${d}`}function u(c,d,f,p,m,b){return c===0&&d===0?l(f,p,m,b):a(f,c,d,p,m,b)}class h extends n.Processor{constructor(){super(...arguments);ae(this,"fake_image_token","<fake_token_around_image>");ae(this,"image_token","<image>");ae(this,"global_img_token","<global-img>")}async _call(f,p=null,m={}){m.return_row_col_info??(m.return_row_col_info=!0);let b;p&&(b=await this.image_processor(p,m)),Array.isArray(f)||(f=[f]);const g=b.rows??[new Array(f.length).fill(0)],_=b.cols??[new Array(f.length).fill(0)],y=this.config.image_seq_len,v=[],M=[];for(let T=0;T<f.length;++T){const S=f[T],A=g[T],I=_[T];v.push((0,i.count)(S,this.image_token));const V=A.map((q,G)=>u(q,I[G],y,this.fake_image_token,this.image_token,this.global_img_token)),N=S.split(this.image_token);if(N.length===0)throw new Error("The image token should be present in the text.");let z=N[0];for(let q=0;q<V.length;++q)z+=V[q]+N[q+1];M.push(z)}return{...this.tokenizer(M),...b}}}ae(h,"image_processor_class",s.AutoImageProcessor),ae(h,"tokenizer_class",o.AutoTokenizer),ae(h,"uses_processor_config",!0)},"./src/models/image_processors.js":(e,t,r)=>{r.r(t),r.d(t,{BeitFeatureExtractor:()=>n.BeitFeatureExtractor,BitImageProcessor:()=>s.BitImageProcessor,CLIPFeatureExtractor:()=>i.CLIPFeatureExtractor,CLIPImageProcessor:()=>i.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>o.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>a.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>a.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>h.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>d.DPTFeatureExtractor,DPTImageProcessor:()=>d.DPTImageProcessor,DeiTFeatureExtractor:()=>l.DeiTFeatureExtractor,DeiTImageProcessor:()=>l.DeiTImageProcessor,DetrFeatureExtractor:()=>u.DetrFeatureExtractor,DetrImageProcessor:()=>u.DetrImageProcessor,DonutFeatureExtractor:()=>c.DonutFeatureExtractor,DonutImageProcessor:()=>c.DonutImageProcessor,EfficientNetImageProcessor:()=>f.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>p.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>m.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>b.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>_.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>y.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>v.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>M.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>M.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>E.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>E.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>T.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>T.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>S.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>S.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>A.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>A.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>I.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>I.MobileViTImageProcessor,NougatImageProcessor:()=>V.NougatImageProcessor,OwlViTFeatureExtractor:()=>z.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>z.OwlViTImageProcessor,Owlv2ImageProcessor:()=>N.Owlv2ImageProcessor,Phi3VImageProcessor:()=>q.Phi3VImageProcessor,PvtImageProcessor:()=>G.PvtImageProcessor,Qwen2VLImageProcessor:()=>ee.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>Y.RTDetrImageProcessor,Sam2ImageProcessor:()=>te.Sam2ImageProcessor,Sam3ImageProcessor:()=>le.Sam3ImageProcessor,SamImageProcessor:()=>W.SamImageProcessor,SegformerFeatureExtractor:()=>oe.SegformerFeatureExtractor,SegformerImageProcessor:()=>oe.SegformerImageProcessor,SiglipImageProcessor:()=>U.SiglipImageProcessor,SmolVLMImageProcessor:()=>R.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>X.Swin2SRImageProcessor,VLMImageProcessor:()=>g.VLMImageProcessor,ViTFeatureExtractor:()=>ce.ViTFeatureExtractor,ViTImageProcessor:()=>ce.ViTImageProcessor,VitMatteImageProcessor:()=>ne.VitMatteImageProcessor,VitPoseImageProcessor:()=>we.VitPoseImageProcessor,YolosFeatureExtractor:()=>De.YolosFeatureExtractor,YolosImageProcessor:()=>De.YolosImageProcessor});var n=r("./src/models/beit/image_processing_beit.js"),s=r("./src/models/bit/image_processing_bit.js"),o=r("./src/models/chinese_clip/image_processing_chinese_clip.js"),i=r("./src/models/clip/image_processing_clip.js"),a=r("./src/models/convnext/image_processing_convnext.js"),l=r("./src/models/deit/image_processing_deit.js"),u=r("./src/models/detr/image_processing_detr.js"),h=r("./src/models/dinov3_vit/image_processing_dinov3_vit.js"),c=r("./src/models/donut/image_processing_donut.js"),d=r("./src/models/dpt/image_processing_dpt.js"),f=r("./src/models/efficientnet/image_processing_efficientnet.js"),p=r("./src/models/glpn/image_processing_glpn.js"),m=r("./src/models/grounding_dino/image_processing_grounding_dino.js"),b=r("./src/models/idefics3/image_processing_idefics3.js"),g=r("./src/models/janus/image_processing_janus.js"),_=r("./src/models/jina_clip/image_processing_jina_clip.js"),y=r("./src/models/llava_onevision/image_processing_llava_onevision.js"),v=r("./src/models/mask2former/image_processing_mask2former.js"),M=r("./src/models/maskformer/image_processing_maskformer.js"),E=r("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),T=r("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),S=r("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),A=r("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),I=r("./src/models/mobilevit/image_processing_mobilevit.js"),V=r("./src/models/nougat/image_processing_nougat.js"),N=r("./src/models/owlv2/image_processing_owlv2.js"),z=r("./src/models/owlvit/image_processing_owlvit.js"),q=r("./src/models/phi3_v/image_processing_phi3_v.js"),G=r("./src/models/pvt/image_processing_pvt.js"),ee=r("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),Y=r("./src/models/rt_detr/image_processing_rt_detr.js"),W=r("./src/models/sam/image_processing_sam.js"),te=r("./src/models/sam2/image_processing_sam2.js"),le=r("./src/models/sam3/image_processing_sam3.js"),oe=r("./src/models/segformer/image_processing_segformer.js"),U=r("./src/models/siglip/image_processing_siglip.js"),R=r("./src/models/smolvlm/image_processing_smolvlm.js"),X=r("./src/models/swin2sr/image_processing_swin2sr.js"),ce=r("./src/models/vit/image_processing_vit.js"),ne=r("./src/models/vitmatte/image_processing_vitmatte.js"),we=r("./src/models/vitpose/image_processing_vitpose.js"),De=r("./src/models/yolos/image_processing_yolos.js")},"./src/models/janus/image_processing_janus.js":(e,t,r)=>{r.r(t),r.d(t,{VLMImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(i){super({do_pad:!0,pad_size:{width:i.image_size,height:i.image_size},...i}),this.constant_values=this.config.background_color.map(a=>a*this.rescale_factor)}pad_image(i,a,l,u){return super.pad_image(i,a,l,{constant_values:this.constant_values,center:!0,...u})}}},"./src/models/janus/processing_janus.js":(e,t,r)=>{r.r(t),r.d(t,{VLChatProcessor:()=>u});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js"),i=r("./src/utils/core.js"),a=r("./src/utils/tensor.js"),l=r("./src/utils/image.js");class u extends n.Processor{constructor(c,d,f){super(c,d,f),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(c,{images:d=null,chat_template:f="default"}={}){d?Array.isArray(d)||(d=[d]):d=await Promise.all(c.filter(I=>I.images).flatMap(I=>I.images).map(I=>l.RawImage.read(I)));const p=this.tokenizer,m=p.apply_chat_template(c,{tokenize:!1,add_generation_prompt:!0,chat_template:f}),b=I=>p.encode(I,{add_special_tokens:!1}),g=m.split(this.image_tag),_=g.length-1;if(d.length!==_)throw new Error(`Number of images provided (${d.length}) does not match number of "${this.image_tag}" image tags (${_})`);const[y,v,M]=p.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let E=b(g[0]),T=new Array(E.length).fill(!1);for(let I=1;I<g.length;++I){const V=new Array(this.num_image_tokens).fill(y),N=b(g[I]);E=(0,i.mergeArrays)(E,[v],V,[M],N);const z=new Array(this.num_image_tokens).fill(!0);T=(0,i.mergeArrays)(T,[!1],z,[!1],new Array(N.length).fill(!1))}const S=[1,E.length],A={input_ids:new a.Tensor("int64",E,S),attention_mask:new a.Tensor("int64",new Array(E.length).fill(1),S),images_seq_mask:new a.Tensor("bool",T,S),images_emb_mask:new a.Tensor("bool",new Array(_*this.num_image_tokens).fill(!0),[1,_,this.num_image_tokens])};if(d&&d.length>0){const I=await this.image_processor(d);return I.pixel_values.unsqueeze_(0),{...A,...I}}return A}}ae(u,"image_processor_class",s.AutoImageProcessor),ae(u,"tokenizer_class",o.AutoTokenizer),ae(u,"uses_processor_config",!0)},"./src/models/jina_clip/image_processing_jina_clip.js":(e,t,r)=>{r.r(t),r.d(t,{JinaCLIPImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{constructor(i){const{resize_mode:a,fill_color:l,interpolation:u,size:h,...c}=i,d=a==="squash"?{width:h,height:h}:a==="shortest"?{shortest_edge:h}:{longest_edge:h},f=u==="bicubic"?3:2;super({...c,size:d,resample:f,do_center_crop:!0,crop_size:h,do_normalize:!0})}}},"./src/models/jina_clip/processing_jina_clip.js":(e,t,r)=>{r.r(t),r.d(t,{JinaCLIPProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");class i extends n.Processor{async _call(l=null,u=null,h={}){if(!l&&!u)throw new Error("Either text or images must be provided");const c=l?this.tokenizer(l,h):{},d=u?await this.image_processor(u,h):{};return{...c,...d}}}ae(i,"tokenizer_class",o.AutoTokenizer),ae(i,"image_processor_class",s.AutoImageProcessor)},"./src/models/llava/processing_llava.js":(e,t,r)=>{r.r(t),r.d(t,{LlavaProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");class i extends n.Processor{async _call(l,u=null,h={}){const c=await this.image_processor(l,h);if(u){const[f,p]=c.pixel_values.dims.slice(-2),{image_token:m,patch_size:b,num_additional_image_tokens:g}=this.config,_=Math.floor(f/b)*Math.floor(p/b)+g;u=structuredClone(u),Array.isArray(u)||(u=[u]);for(let y=0;y<u.length;++y)u[y]=u[y].replace(m,m.repeat(_))}const d=u?this.tokenizer(u,h):{};return{...c,...d}}}ae(i,"tokenizer_class",o.AutoTokenizer),ae(i,"image_processor_class",s.AutoImageProcessor),ae(i,"uses_processor_config",!0)},"./src/models/llava_onevision/image_processing_llava_onevision.js":(e,t,r)=>{r.r(t),r.d(t,{LlavaOnevisionImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/mask2former/image_processing_mask2former.js":(e,t,r)=>{r.r(t),r.d(t,{Mask2FormerImageProcessor:()=>s});var n=r("./src/models/maskformer/image_processing_maskformer.js");class s extends n.MaskFormerImageProcessor{}},"./src/models/maskformer/image_processing_maskformer.js":(e,t,r)=>{r.r(t),r.d(t,{MaskFormerFeatureExtractor:()=>o,MaskFormerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_panoptic_segmentation(...a){return(0,n.post_process_panoptic_segmentation)(...a)}post_process_instance_segmentation(...a){return(0,n.post_process_instance_segmentation)(...a)}}class o extends s{}},"./src/models/mgp_str/processing_mgp_str.js":(e,t,r)=>{r.r(t),r.d(t,{MgpstrProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js"),i=r("./src/utils/maths.js");const a={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class l extends n.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(h,c){if(!a.hasOwnProperty(c))throw new Error(`Format ${c} is not supported.`);const[d,f]=a[c],p=this[d].bind(this),[m,b]=h.dims,g=[],_=[],y=h.tolist();for(let M=0;M<m;++M){const E=y[M],T=[],S=[];for(let I=1;I<b;++I){const[V,N]=(0,i.max)((0,i.softmax)(E[I]));if(S.push(V),N==f)break;T.push(N)}const A=S.length>0?S.reduce((I,V)=>I*V,1):0;_.push(T),g.push(A)}return[p(_),g]}char_decode(h){return this.char_tokenizer.batch_decode(h).map(c=>c.replaceAll(" ",""))}bpe_decode(h){return this.bpe_tokenizer.batch_decode(h)}wp_decode(h){return this.wp_tokenizer.batch_decode(h).map(c=>c.replaceAll(" ",""))}batch_decode([h,c,d]){const[f,p]=this._decode_helper(h,"char"),[m,b]=this._decode_helper(c,"bpe"),[g,_]=this._decode_helper(d,"wp"),y=[],v=[];for(let M=0;M<f.length;++M){const[E,T]=(0,i.max)([p[M],b[M],_[M]]);y.push([f[M],m[M],g[M]][T]),v.push(E)}return{generated_text:y,scores:v,char_preds:f,bpe_preds:m,wp_preds:g}}static async from_pretrained(...h){const c=await super.from_pretrained(...h),d=await o.AutoTokenizer.from_pretrained("Xenova/gpt2"),f=await o.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return c.components={image_processor:c.image_processor,char_tokenizer:c.tokenizer,bpe_tokenizer:d,wp_tokenizer:f},c}async _call(h,c=null){const d=await this.image_processor(h);return c&&(d.labels=this.tokenizer(c).input_ids),d}}ae(l,"tokenizer_class",o.AutoTokenizer),ae(l,"image_processor_class",s.AutoImageProcessor)},"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV1FeatureExtractor:()=>o,MobileNetV1ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV2FeatureExtractor:()=>o,MobileNetV2ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV3FeatureExtractor:()=>o,MobileNetV3ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":(e,t,r)=>{r.r(t),r.d(t,{MobileNetV4FeatureExtractor:()=>o,MobileNetV4ImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/mobilevit/image_processing_mobilevit.js":(e,t,r)=>{r.r(t),r.d(t,{MobileViTFeatureExtractor:()=>o,MobileViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/moonshine/feature_extraction_moonshine.js":(e,t,r)=>{r.r(t),r.d(t,{MoonshineFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class o extends n.FeatureExtractor{async _call(a){(0,n.validate_audio_inputs)(a,"MoonshineFeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));const l=[1,a.length];return{input_values:new s.Tensor("float32",a,l)}}}},"./src/models/moonshine/processing_moonshine.js":(e,t,r)=>{r.r(t),r.d(t,{MoonshineProcessor:()=>i});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),o=r("./src/base/processing_utils.js");class i extends o.Processor{async _call(l){return await this.feature_extractor(l)}}ae(i,"tokenizer_class",s.AutoTokenizer),ae(i,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/nougat/image_processing_nougat.js":(e,t,r)=>{r.r(t),r.d(t,{NougatImageProcessor:()=>s});var n=r("./src/models/donut/image_processing_donut.js");class s extends n.DonutImageProcessor{}},"./src/models/owlv2/image_processing_owlv2.js":(e,t,r)=>{r.r(t),r.d(t,{Owlv2ImageProcessor:()=>s});var n=r("./src/models/owlvit/image_processing_owlvit.js");class s extends n.OwlViTImageProcessor{}},"./src/models/owlvit/image_processing_owlvit.js":(e,t,r)=>{r.r(t),r.d(t,{OwlViTFeatureExtractor:()=>o,OwlViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...a){return(0,n.post_process_object_detection)(...a)}}class o extends s{}},"./src/models/owlvit/processing_owlvit.js":(e,t,r)=>{r.r(t),r.d(t,{OwlViTProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");class i extends n.Processor{}ae(i,"tokenizer_class",o.AutoTokenizer),ae(i,"image_processor_class",s.AutoImageProcessor)},"./src/models/paligemma/processing_paligemma.js":(e,t,r)=>{r.r(t),r.d(t,{PaliGemmaProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");const i="<image>";function a(u,h,c,d,f){return`${d.repeat(c*f)}${h}${u}
`}class l extends n.Processor{async _call(h,c=null,d={}){c||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),c=""),Array.isArray(h)||(h=[h]),Array.isArray(c)||(c=[c]);const f=this.tokenizer.bos_token,p=this.image_processor.config.image_seq_length;let m;c.some(_=>_.includes(i))?m=c.map(_=>{const y=_.replaceAll(i,i.repeat(p)),v=y.lastIndexOf(i),M=v===-1?0:v+i.length;return y.slice(0,M)+f+y.slice(M)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),m=c.map(_=>a(_,f,p,i,h.length)));const b=this.tokenizer(m,d);return{...await this.image_processor(h,d),...b}}}ae(l,"tokenizer_class",o.AutoTokenizer),ae(l,"image_processor_class",s.AutoImageProcessor),ae(l,"uses_processor_config",!1)},"./src/models/parakeet/feature_extraction_parakeet.js":(e,t,r)=>{r.r(t),r.d(t,{ParakeetFeatureExtractor:()=>a});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/audio.js");const i=1e-5;class a extends n.FeatureExtractor{constructor(u){var d;super(u),(d=this.config).mel_filters??(d.mel_filters=(0,o.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney"));const h=(0,o.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);const c=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(h,c)}async _extract_fbank_features(u){const h=this.config.preemphasis;u=new Float64Array(u);for(let d=u.length-1;d>=1;--d)u[d]-=h*u[d-1];return await(0,o.spectrogram)(u,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:2**-24})}async _call(u){(0,n.validate_audio_inputs)(u,"ParakeetFeatureExtractor");const h=await this._extract_fbank_features(u),c=Math.floor((u.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),d=h.data;d.fill(0,c*h.dims[1]);const[f,p]=h.dims,m=new Float64Array(p),b=new Float64Array(p);for(let y=0;y<c;++y){const v=y*p;for(let M=0;M<p;++M){const E=d[v+M];m[M]+=E,b[M]+=E*E}}const g=c>1?c-1:1;for(let y=0;y<p;++y){const v=m[y]/c,M=(b[y]-c*v*v)/g,T=1/(Math.sqrt(M)+i);for(let S=0;S<c;++S){const A=S*p+y;d[A]=(d[A]-v)*T}}const _=new BigInt64Array(f);return _.fill(1n,0,c),{input_features:h.unsqueeze_(0),attention_mask:new s.Tensor("int64",_,[1,f])}}}},"./src/models/phi3_v/image_processing_phi3_v.js":(e,t,r)=>{r.r(t),r.d(t,{Phi3VImageProcessor:()=>h});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");const o=336,i=[2,3],{ceil:a,floor:l,sqrt:u}=Math;class h extends n.ImageProcessor{constructor(d){super({...d,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=d.num_crops}calc_num_image_tokens_from_image_size(d,f){const{num_img_tokens:p}=this.config;return l((l(f/o)*l(d/o)+1)*p+1+(l(f/o)+1)*u(p))}get_resize_output_image_size(d,f){const p=this._num_crops,[m,b]=d.size;let g=m/b,_=1;for(;_*Math.ceil(_/g)<=p;)_+=1;_-=1;const y=Math.floor(_*336),v=Math.floor(y/g);return[y,v]}pad_image(d,f,p,m={}){const[b,g]=f,_=o*a(b/o),y=o*a(g/o),v=[1,1,1].map((M,E)=>(M-this.image_mean[E])/this.image_std[E]);return super.pad_image(d,f,{width:y,height:_},{center:!0,constant_values:v,...m})}async _call(d,{num_crops:f=null}={}){if(this._num_crops=f??(f=this.config.num_crops),f<4||u(f)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(d)||(d=[d]);const p=d.length,m=await Promise.all(d.map(T=>this.preprocess(T))),b=m.map(T=>T.original_size),g=m.map(T=>T.reshaped_input_size),_=[];for(const{pixel_values:T}of m){T.unsqueeze_(0);const[S,A]=T.dims.slice(-2),I=await(0,s.interpolate_4d)(T,{size:[o,o],mode:"bicubic"});if(f>0){const V=[],N=u(f),z=l(A/N),q=l(S/N);for(let ee=0;ee<N;++ee)for(let Y=0;Y<N;++Y){let W,te,le,oe;ee===N-1?(te=S-q,oe=S):(te=ee*q,oe=(ee+1)*q),Y===N-1?(W=A-z,le=A):(W=Y*z,le=(Y+1)*z);const U=[te,W],R=[oe,le],X=await(0,s.slice)(T,U,R,i);V.push(X)}const G=await(0,s.interpolate_4d)((0,s.cat)(V,0),{size:[o,o],mode:"bicubic"});_.push((0,s.cat)([I,G],0))}else _.push(I)}const y=(0,s.stack)(_,0),v=g.map(T=>T.map(S=>o*a(S/o))),M=new s.Tensor("int64",v.flat(),[p,2]),E=v.map(([T,S])=>this.calc_num_image_tokens_from_image_size(S,T));return{pixel_values:y,original_sizes:b,reshaped_input_sizes:g,image_sizes:M,num_img_tokens:E}}}},"./src/models/phi3_v/processing_phi3_v.js":(e,t,r)=>{r.r(t),r.d(t,{Phi3VProcessor:()=>l});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");r("./src/utils/image.js");const i="<|image|>",a=/<\|image_\d+\|>/g;class l extends n.Processor{async _call(h,c=null,{padding:d=!0,truncation:f=!0,num_crops:p=null}={}){Array.isArray(h)||(h=[h]);let m,b;if(c){b=await this.image_processor(c,{num_crops:p});const{num_img_tokens:g}=b,_=h.map((v,M)=>v.split(a).join(i.repeat(g[M])));m=this.tokenizer(_,{padding:d,truncation:f});const y=this.tokenizer.model.convert_tokens_to_ids([i])[0];m.input_ids.map_(v=>v==y?-v:v)}else m=this.tokenizer(h);return{...m,...b}}}ae(l,"image_processor_class",s.AutoImageProcessor),ae(l,"tokenizer_class",o.AutoTokenizer)},"./src/models/processors.js":(e,t,r)=>{r.r(t),r.d(t,{Florence2Processor:()=>n.Florence2Processor,Gemma3nProcessor:()=>s.Gemma3nProcessor,GroundingDinoProcessor:()=>o.GroundingDinoProcessor,Idefics3Processor:()=>i.Idefics3Processor,JinaCLIPProcessor:()=>l.JinaCLIPProcessor,LlavaProcessor:()=>u.LlavaProcessor,MgpstrProcessor:()=>h.MgpstrProcessor,MoonshineProcessor:()=>c.MoonshineProcessor,OwlViTProcessor:()=>d.OwlViTProcessor,PaliGemmaProcessor:()=>p.PaliGemmaProcessor,Phi3VProcessor:()=>f.Phi3VProcessor,PyAnnoteProcessor:()=>m.PyAnnoteProcessor,Qwen2VLProcessor:()=>b.Qwen2VLProcessor,Sam2Processor:()=>_.Sam2Processor,Sam2VideoProcessor:()=>_.Sam2VideoProcessor,SamProcessor:()=>g.SamProcessor,SmolVLMProcessor:()=>y.SmolVLMProcessor,SpeechT5Processor:()=>v.SpeechT5Processor,UltravoxProcessor:()=>M.UltravoxProcessor,VLChatProcessor:()=>a.VLChatProcessor,VoxtralProcessor:()=>E.VoxtralProcessor,Wav2Vec2Processor:()=>T.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>S.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>A.WhisperProcessor});var n=r("./src/models/florence2/processing_florence2.js"),s=r("./src/models/gemma3n/processing_gemma3n.js"),o=r("./src/models/grounding_dino/processing_grounding_dino.js"),i=r("./src/models/idefics3/processing_idefics3.js"),a=r("./src/models/janus/processing_janus.js"),l=r("./src/models/jina_clip/processing_jina_clip.js"),u=r("./src/models/llava/processing_llava.js"),h=r("./src/models/mgp_str/processing_mgp_str.js"),c=r("./src/models/moonshine/processing_moonshine.js"),d=r("./src/models/owlvit/processing_owlvit.js"),f=r("./src/models/phi3_v/processing_phi3_v.js"),p=r("./src/models/paligemma/processing_paligemma.js"),m=r("./src/models/pyannote/processing_pyannote.js"),b=r("./src/models/qwen2_vl/processing_qwen2_vl.js"),g=r("./src/models/sam/processing_sam.js"),_=r("./src/models/sam2/processing_sam2.js"),y=r("./src/models/smolvlm/processing_smolvlm.js"),v=r("./src/models/speecht5/processing_speecht5.js"),M=r("./src/models/ultravox/processing_ultravox.js"),E=r("./src/models/voxtral/processing_voxtral.js"),T=r("./src/models/wav2vec2/processing_wav2vec2.js"),S=r("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),A=r("./src/models/whisper/processing_whisper.js")},"./src/models/pvt/image_processing_pvt.js":(e,t,r)=>{r.r(t),r.d(t,{PvtImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/pyannote/feature_extraction_pyannote.js":(e,t,r)=>{r.r(t),r.d(t,{PyAnnoteFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/maths.js");class i extends n.FeatureExtractor{async _call(l){(0,n.validate_audio_inputs)(l,"PyAnnoteFeatureExtractor"),l instanceof Float64Array&&(l=new Float32Array(l));const u=[1,1,l.length];return{input_values:new s.Tensor("float32",l,u)}}samples_to_frames(l){return(l-this.config.offset)/this.config.step}post_process_speaker_diarization(l,u){const h=u/this.samples_to_frames(u)/this.config.sampling_rate,c=[];for(const d of l.tolist()){const f=[];let p=-1;for(let m=0;m<d.length;++m){const b=(0,o.softmax)(d[m]),[g,_]=(0,o.max)(b),[y,v]=[m,m+1];_!==p?(p=_,f.push({id:_,start:y,end:v,score:g})):(f.at(-1).end=v,f.at(-1).score+=g)}c.push(f.map(({id:m,start:b,end:g,score:_})=>({id:m,start:b*h,end:g*h,confidence:_/(g-b)})))}return c}}},"./src/models/pyannote/processing_pyannote.js":(e,t,r)=>{r.r(t),r.d(t,{PyAnnoteProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/pyannote/feature_extraction_pyannote.js");class o extends n.Processor{async _call(a){return await this.feature_extractor(a)}post_process_speaker_diarization(...a){return this.feature_extractor.post_process_speaker_diarization(...a)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}ae(o,"feature_extractor_class",s.PyAnnoteFeatureExtractor)},"./src/models/qwen2_vl/image_processing_qwen2_vl.js":(e,t,r)=>{r.r(t),r.d(t,{Qwen2VLImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class o extends n.ImageProcessor{async _call(a,...l){const{pixel_values:u,original_sizes:h,reshaped_input_sizes:c}=await super._call(a,...l);let d=u;const{temporal_patch_size:f,merge_size:p,patch_size:m}=this.config;d.dims[0]===1&&(d=(0,s.cat)(Array.from({length:f},()=>d),0));const b=d.dims[0]/f,g=d.dims[1],_=Math.floor(d.dims[2]/m),y=Math.floor(d.dims[3]/m),v=d.view(b,f,g,Math.floor(_/p),p,m,Math.floor(y/p),p,m).permute(0,3,6,4,7,2,1,5,8).view(b*_*y,g*f*m*m),M=new s.Tensor("int64",[b,_,y],[1,3]);return{pixel_values:v,image_grid_thw:M,original_sizes:h,reshaped_input_sizes:c}}}},"./src/models/qwen2_vl/processing_qwen2_vl.js":(e,t,r)=>{r.r(t),r.d(t,{Qwen2VLProcessor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js"),o=r("./src/tokenizers.js");r("./src/utils/image.js");class i extends n.Processor{async _call(l,u=null,...h){Array.isArray(l)||(l=[l]);let c,d;if(u&&(c=await this.image_processor(u),d=c.image_grid_thw),d){let p=this.image_processor.config.merge_size**2,m=0;const b=d.tolist();l=l.map(g=>{for(;g.includes("<|image_pad|>");){const _=Number(b[m++].reduce((y,v)=>y*v,1n));g=g.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(_/p)))}return g.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(l),...c}}}ae(i,"image_processor_class",s.AutoImageProcessor),ae(i,"tokenizer_class",o.AutoTokenizer)},"./src/models/rt_detr/image_processing_rt_detr.js":(e,t,r)=>{r.r(t),r.d(t,{RTDetrImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...i){return(0,n.post_process_object_detection)(...i)}}},"./src/models/sam/image_processing_sam.js":(e,t,r)=>{r.r(t),r.d(t,{SamImageProcessor:()=>i});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/core.js"),o=r("./src/utils/tensor.js");class i extends n.ImageProcessor{reshape_input_points(l,u,h,c=!1){l=structuredClone(l);let d=(0,s.calculateDimensions)(l);if(d.length===3)c||(d=[1,...d]),l=[l];else if(d.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let f=0;f<l.length;++f){const[p,m]=u[f],[b,g]=h[f],_=[g/m,b/p];for(let y=0;y<l[f].length;++y)for(let v=0;v<l[f][y].length;++v)for(let M=0;M<l[f][y][v].length;++M)l[f][y][v][M]*=_[M%2]}return new o.Tensor("float32",Float32Array.from(l.flat(1/0)),d)}add_input_labels(l,u){let h=(0,s.calculateDimensions)(l);if(h.length===2)h=[1,...h],l=[l];else if(h.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(h.some((c,d)=>c!==u.dims[d]))throw Error(`The first ${h.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new o.Tensor("int64",l.flat(1/0).map(BigInt),h)}async _call(l,{input_points:u=null,input_labels:h=null,input_boxes:c=null}={}){const d=await super._call(l);if(u&&(d.input_points=this.reshape_input_points(u,d.original_sizes,d.reshaped_input_sizes)),h){if(!d.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");d.input_labels=this.add_input_labels(h,d.input_points)}return c&&(d.input_boxes=this.reshape_input_points(c,d.original_sizes,d.reshaped_input_sizes,!0)),d}async post_process_masks(l,u,h,{mask_threshold:c=0,binarize:d=!0,pad_size:f=null}={}){const p=[];f=f??this.pad_size??this.size;const m=[f.height,f.width];for(let b=0;b<u.length;++b){const g=u[b],_=h[b];let y=await(0,o.interpolate_4d)(l[b],{mode:"bilinear",size:m});if(y=y.slice(null,null,[0,_[0]],[0,_[1]]),y=await(0,o.interpolate_4d)(y,{mode:"bilinear",size:g}),d){const v=y.data,M=new Uint8Array(v.length);for(let E=0;E<v.length;++E)v[E]>c&&(M[E]=1);y=new o.Tensor("bool",M,y.dims)}p.push(y)}return p}generate_crop_boxes(l,u,{crop_n_layers:h=0,overlap_ratio:c=512/1500,points_per_crop:d=32,crop_n_points_downscale_factor:f=1}={}){}}},"./src/models/sam/processing_sam.js":(e,t,r)=>{r.r(t),r.d(t,{SamProcessor:()=>o});var n=r("./src/base/processing_utils.js"),s=r("./src/models/auto/image_processing_auto.js");class o extends n.Processor{async _call(...a){return await this.image_processor(...a)}post_process_masks(...a){return this.image_processor.post_process_masks(...a)}reshape_input_points(...a){return this.image_processor.reshape_input_points(...a)}}ae(o,"image_processor_class",s.AutoImageProcessor)},"./src/models/sam2/image_processing_sam2.js":(e,t,r)=>{r.r(t),r.d(t,{Sam2ImageProcessor:()=>n.SamImageProcessor});var n=r("./src/models/sam/image_processing_sam.js")},"./src/models/sam2/processing_sam2.js":(e,t,r)=>{r.r(t),r.d(t,{Sam2Processor:()=>s,Sam2VideoProcessor:()=>o});var n=r("./src/models/sam/processing_sam.js");class s extends n.SamProcessor{}class o extends s{}},"./src/models/sam3/image_processing_sam3.js":(e,t,r)=>{r.r(t),r.d(t,{Sam3ImageProcessor:()=>n.Sam2ImageProcessor});var n=r("./src/models/sam2/image_processing_sam2.js")},"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":(e,t,r)=>{r.r(t),r.d(t,{SeamlessM4TFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js"),o=r("./src/utils/audio.js");class i extends n.FeatureExtractor{constructor(l){super(l);const u=this.config.sampling_rate,h=(0,o.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(u/2),u,null,"kaldi",!0);this.mel_filters=h,this.window=(0,o.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(l,u){return l=l.map(h=>h*32768),(0,o.spectrogram)(l,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:u,transpose:!0})}async _call(l,{padding:u=!0,pad_to_multiple_of:h=2,do_normalize_per_mel_bins:c=!0,return_attention_mask:d=!0}={}){(0,n.validate_audio_inputs)(l,"SeamlessM4TFeatureExtractor");let f=await this._extract_fbank_features(l,this.config.max_length);if(c){const[M,E]=f.dims,T=f.data;for(let S=0;S<E;++S){let A=0;for(let z=0;z<M;++z)A+=T[z*E+S];const I=A/M;let V=0;for(let z=0;z<M;++z)V+=(T[z*E+S]-I)**2;V/=M-1;const N=Math.sqrt(V+1e-7);for(let z=0;z<M;++z){const q=z*E+S;T[q]=(T[q]-I)/N}}}let p;if(u){const[M,E]=f.dims,T=f.data,S=M%h;if(S>0){const A=new Float32Array(E*(M+S));A.set(T),A.fill(this.config.padding_value,T.length);const I=M+S;f=new s.Tensor(f.type,A,[I,E]),d&&(p=new s.Tensor("int64",new BigInt64Array(I),[1,I]),p.data.fill(1n,0,M))}}const[m,b]=f.dims,g=this.config.stride;if(m%g!==0)throw new Error(`The number of frames (${m}) must be a multiple of the stride (${g}).`);const y=f.view(1,Math.floor(m/g),b*g),v={input_features:y};if(d){const M=y.dims[1],E=new BigInt64Array(M);if(p){const T=p.data;for(let S=1,A=0;S<m;S+=g,++A)E[A]=T[S]}else E.fill(1n);v.attention_mask=new s.Tensor("int64",E,[1,M])}return v}}},"./src/models/segformer/image_processing_segformer.js":(e,t,r)=>{r.r(t),r.d(t,{SegformerFeatureExtractor:()=>o,SegformerImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_semantic_segmentation(...a){return(0,n.post_process_semantic_segmentation)(...a)}}class o extends s{}},"./src/models/siglip/image_processing_siglip.js":(e,t,r)=>{r.r(t),r.d(t,{SiglipImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}},"./src/models/smolvlm/image_processing_smolvlm.js":(e,t,r)=>{r.r(t),r.d(t,{SmolVLMImageProcessor:()=>n.Idefics3ImageProcessor});var n=r("./src/models/idefics3/image_processing_idefics3.js")},"./src/models/smolvlm/processing_smolvlm.js":(e,t,r)=>{r.r(t),r.d(t,{SmolVLMProcessor:()=>n.Idefics3Processor});var n=r("./src/models/idefics3/processing_idefics3.js")},"./src/models/snac/feature_extraction_snac.js":(e,t,r)=>{r.r(t),r.d(t,{SnacFeatureExtractor:()=>s});var n=r("./src/models/dac/feature_extraction_dac.js");class s extends n.DacFeatureExtractor{}},"./src/models/speecht5/feature_extraction_speecht5.js":(e,t,r)=>{r.r(t),r.d(t,{SpeechT5FeatureExtractor:()=>s});var n=r("./src/base/feature_extraction_utils.js");class s extends n.FeatureExtractor{}},"./src/models/speecht5/processing_speecht5.js":(e,t,r)=>{r.r(t),r.d(t,{SpeechT5Processor:()=>i});var n=r("./src/base/processing_utils.js"),s=r("./src/tokenizers.js"),o=r("./src/models/auto/feature_extraction_auto.js");class i extends n.Processor{async _call(l){return await this.feature_extractor(l)}}ae(i,"tokenizer_class",s.AutoTokenizer),ae(i,"feature_extractor_class",o.AutoFeatureExtractor)},"./src/models/swin2sr/image_processing_swin2sr.js":(e,t,r)=>{r.r(t),r.d(t,{Swin2SRImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{pad_image(i,a,l,u={}){const[h,c,d]=a;return super.pad_image(i,a,{width:c+(l-c%l)%l,height:h+(l-h%l)%l},{mode:"symmetric",center:!1,constant_values:-1,...u})}}},"./src/models/ultravox/processing_ultravox.js":(e,t,r)=>{r.r(t),r.d(t,{UltravoxProcessor:()=>i});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),o=r("./src/base/processing_utils.js");class i extends o.Processor{async _call(l,u=null,h={}){if(Array.isArray(l))throw new Error("Batched inputs are not supported yet.");let c={};if(u){const f=u.length,{input_features:p}=await this.feature_extractor(u,{...h,max_length:f}),m=Math.round(f/this.config.encoder_ds_factor+1e-4),b=1+Math.ceil(m/this.config.stack_factor);c.audio_token_len=[b],c.audio_values=p;const g=this.config.audio_placeholder;if(!l.includes(g))throw new Error(`The input text does not contain the image token ${g}.`);l=l.replaceAll(g,g.repeat(b))}return{...this.tokenizer(l,{add_special_tokens:!1,...h}),...c}}}ae(i,"tokenizer_class",s.AutoTokenizer),ae(i,"feature_extractor_class",n.AutoFeatureExtractor),ae(i,"uses_processor_config",!0)},"./src/models/vit/image_processing_vit.js":(e,t,r)=>{r.r(t),r.d(t,{ViTFeatureExtractor:()=>o,ViTImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{}class o extends s{}},"./src/models/vitmatte/image_processing_vitmatte.js":(e,t,r)=>{r.r(t),r.d(t,{VitMatteImageProcessor:()=>o});var n=r("./src/base/image_processors_utils.js"),s=r("./src/utils/tensor.js");class o extends n.ImageProcessor{async _call(a,l){Array.isArray(a)||(a=[a]),Array.isArray(l)||(l=[l]);const u=await Promise.all(a.map(d=>this.preprocess(d))),h=await Promise.all(l.map(d=>this.preprocess(d,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,s.stack)(u.map((d,f)=>(0,s.cat)([d.pixel_values,h[f].pixel_values],0)),0),original_sizes:u.map(d=>d.original_size),reshaped_input_sizes:u.map(d=>d.reshaped_input_size)}}}},"./src/models/vitpose/image_processing_vitpose.js":(e,t,r)=>{r.r(t),r.d(t,{VitPoseImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_pose_estimation(i,a,{threshold:l=null}={}){const u=i.tolist(),[h,c,d,f]=i.dims,p=[];for(let m=0;m<h;++m){const b=u[m],g=a[m],_=[];for(let y=0;y<g.length;++y){const v=g[y],M=[],E=[],T=[],S=v.at(-2)/f,A=v.at(-1)/d;for(let I=0;I<b.length;++I){let[V,N]=[0,0],z=0,q=-1/0;const G=b[I];for(let Y=0;Y<G.length;++Y){const W=G[Y];for(let te=0;te<W.length;++te){const le=W[te];z+=le,q=Math.max(q,le),V+=(te+.5)*le,N+=Y*le}}if(l!=null&&q<l)continue;const ee=[S*V/z,A*N/z];M.push(ee),T.push(I),E.push(q)}_.push({bbox:v,scores:E,labels:T,keypoints:M})}p.push(_)}return p}}},"./src/models/voxtral/processing_voxtral.js":(e,t,r)=>{r.r(t),r.d(t,{VoxtralProcessor:()=>c});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),o=r("./src/base/processing_utils.js"),i=r("./src/utils/tensor.js");const a="[AUDIO]",l="[BEGIN_AUDIO]",u=375;function h(d,f){const p=[];for(let m=0;m<d.length;m+=f)p.push(d.subarray(m,Math.min(m+f,d.length)));return p}class c extends o.Processor{async _call(f,p=null,m={}){if(Array.isArray(f))throw new Error("Batched inputs are not supported yet.");const b={};if(p){if(!f.includes(a))throw new Error(`The input text does not contain the audio token ${a}.`);Array.isArray(p)||(p=[p]);const _=f.split(a),y=_.length-1;if(y!==p.length)throw new Error(`The number of audio inputs (${p.length}) does not match the number of audio tokens in the text (${y}).`);const v=this.feature_extractor.config.n_samples,M=p.map(I=>h(I,v)),E=M.map(I=>I.length),T=M.flat(),S=(await Promise.all(T.map(I=>this.feature_extractor(I,m)))).map(I=>I.input_features);b.audio_values=S.length>1?(0,i.cat)(S,0):S[0];let A=_[0];for(let I=0;I<E.length;++I){A+=l;for(let V=0;V<E[I];++V)A+=a.repeat(u);A+=_[I+1]}f=A}return{...this.tokenizer(f,{add_special_tokens:!1,...m}),...b}}}ae(c,"tokenizer_class",s.AutoTokenizer),ae(c,"feature_extractor_class",n.AutoFeatureExtractor),ae(c,"uses_processor_config",!1)},"./src/models/wav2vec2/feature_extraction_wav2vec2.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2FeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js"),s=r("./src/utils/tensor.js");class o extends n.FeatureExtractor{_zero_mean_unit_var_norm(a){const u=a.reduce((c,d)=>c+d,0)/a.length,h=a.reduce((c,d)=>c+(d-u)**2,0)/a.length;return a.map(c=>(c-u)/Math.sqrt(h+1e-7))}async _call(a){(0,n.validate_audio_inputs)(a,"Wav2Vec2FeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));let l=a;this.config.do_normalize&&(l=this._zero_mean_unit_var_norm(l));const u=[1,l.length];return{input_values:new s.Tensor("float32",l,u),attention_mask:new s.Tensor("int64",new BigInt64Array(l.length).fill(1n),u)}}}},"./src/models/wav2vec2/processing_wav2vec2.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2Processor:()=>i});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),o=r("./src/base/processing_utils.js");class i extends o.Processor{async _call(l){return await this.feature_extractor(l)}}ae(i,"tokenizer_class",n.AutoTokenizer),ae(i,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":(e,t,r)=>{r.r(t),r.d(t,{Wav2Vec2ProcessorWithLM:()=>i});var n=r("./src/tokenizers.js"),s=r("./src/models/auto/feature_extraction_auto.js"),o=r("./src/base/processing_utils.js");class i extends o.Processor{async _call(l){return await this.feature_extractor(l)}}ae(i,"tokenizer_class",n.AutoTokenizer),ae(i,"feature_extractor_class",s.AutoFeatureExtractor)},"./src/models/wespeaker/feature_extraction_wespeaker.js":(e,t,r)=>{r.r(t),r.d(t,{WeSpeakerFeatureExtractor:()=>o});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js");class o extends n.FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,u=(0,s.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);this.mel_filters=u,this.window=(0,s.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(a){return a=a.map(l=>l*32768),(0,s.spectrogram)(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(a){(0,n.validate_audio_inputs)(a,"WeSpeakerFeatureExtractor");const l=(await this._extract_fbank_features(a)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const u=l.mean(1).data,h=l.data,[c,d,f]=l.dims;for(let p=0;p<c;++p){const m=p*d*f,b=p*f;for(let g=0;g<d;++g){const _=m+g*f;for(let y=0;y<f;++y)h[_+y]-=u[b+y]}}}return{input_features:l}}}},"./src/models/whisper/common_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WHISPER_LANGUAGE_MAPPING:()=>s,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>o,whisper_language_to_code:()=>i});const n=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],s=new Map(n),o=new Map([...n.map(([a,l])=>[l,a]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function i(a){a=a.toLowerCase();let l=o.get(a);if(l===void 0){const u=a.match(/^<\|([a-z]{2})\|>$/);if(u&&(a=u[1]),s.has(a))l=a;else{const c=a.length===2?s.keys():s.values();throw new Error(`Language "${a}" is not supported. Must be one of: ${JSON.stringify(Array.from(c))}`)}}return l}},"./src/models/whisper/feature_extraction_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperFeatureExtractor:()=>i});var n=r("./src/base/feature_extraction_utils.js");r("./src/utils/tensor.js");var s=r("./src/utils/audio.js"),o=r("./src/utils/maths.js");class i extends n.FeatureExtractor{constructor(l){var u;super(l),(u=this.config).mel_filters??(u.mel_filters=(0,s.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,s.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(l){const u=await(0,s.spectrogram)(l,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(l.length/this.config.hop_length),this.config.nb_max_frames)}),h=u.data,c=(0,o.max)(h)[0];for(let d=0;d<h.length;++d)h[d]=(Math.max(h[d],c-8)+4)/4;return u}async _call(l,{max_length:u=null}={}){(0,n.validate_audio_inputs)(l,"WhisperFeatureExtractor");let h;const c=u??this.config.n_samples;return l.length>c?(l.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),h=l.slice(0,c)):(h=new Float32Array(c),h.set(l)),{input_features:(await this._extract_fbank_features(h)).unsqueeze_(0)}}}},"./src/models/whisper/generation_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperGenerationConfig:()=>s});var n=r("./src/generation/configuration_utils.js");class s extends n.GenerationConfig{constructor(){super(...arguments);ae(this,"return_timestamps",null);ae(this,"return_token_timestamps",null);ae(this,"num_frames",null);ae(this,"alignment_heads",null);ae(this,"task",null);ae(this,"language",null);ae(this,"no_timestamps_token_id",null);ae(this,"prompt_ids",null);ae(this,"is_multilingual",null);ae(this,"lang_to_id",null);ae(this,"task_to_id",null);ae(this,"max_initial_timestamp_index",1)}}},"./src/models/whisper/processing_whisper.js":(e,t,r)=>{r.r(t),r.d(t,{WhisperProcessor:()=>i});var n=r("./src/models/auto/feature_extraction_auto.js"),s=r("./src/tokenizers.js"),o=r("./src/base/processing_utils.js");class i extends o.Processor{async _call(l){return await this.feature_extractor(l)}}ae(i,"tokenizer_class",s.AutoTokenizer),ae(i,"feature_extractor_class",n.AutoFeatureExtractor)},"./src/models/yolos/image_processing_yolos.js":(e,t,r)=>{r.r(t),r.d(t,{YolosFeatureExtractor:()=>o,YolosImageProcessor:()=>s});var n=r("./src/base/image_processors_utils.js");class s extends n.ImageProcessor{post_process_object_detection(...a){return(0,n.post_process_object_detection)(...a)}}class o extends s{}},"./src/ops/registry.js":(e,t,r)=>{r.r(t),r.d(t,{TensorOpRegistry:()=>i});var n=r("./src/backends/onnx.js"),s=r("./src/utils/tensor.js");const o=async(a,l,u)=>{const h=await(0,n.createInferenceSession)(new Uint8Array(a),l);return async c=>{const d=(0,n.isONNXProxy)(),f=Object.fromEntries(Object.entries(c).map(([m,b])=>[m,(d?b.clone():b).ort_tensor])),p=await(0,n.runInferenceSession)(h,f);return Array.isArray(u)?u.map(m=>new s.Tensor(p[m])):new s.Tensor(p[u])}};class i{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=o([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=o([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=o([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=o([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=o([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=o([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=o([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=o([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}ae(i,"session_options",{})},"./src/pipelines.js":(e,t,r)=>{r.r(t),r.d(t,{AudioClassificationPipeline:()=>N,AutomaticSpeechRecognitionPipeline:()=>q,BackgroundRemovalPipeline:()=>W,DepthEstimationPipeline:()=>ce,DocumentQuestionAnsweringPipeline:()=>U,FeatureExtractionPipeline:()=>I,FillMaskPipeline:()=>y,ImageClassificationPipeline:()=>ee,ImageFeatureExtractionPipeline:()=>V,ImageSegmentationPipeline:()=>Y,ImageToImagePipeline:()=>X,ImageToTextPipeline:()=>G,ObjectDetectionPipeline:()=>le,Pipeline:()=>m,QuestionAnsweringPipeline:()=>_,SummarizationPipeline:()=>M,Text2TextGenerationPipeline:()=>v,TextClassificationPipeline:()=>b,TextGenerationPipeline:()=>S,TextToAudioPipeline:()=>R,TokenClassificationPipeline:()=>g,TranslationPipeline:()=>E,ZeroShotAudioClassificationPipeline:()=>z,ZeroShotClassificationPipeline:()=>A,ZeroShotImageClassificationPipeline:()=>te,ZeroShotObjectDetectionPipeline:()=>oe,pipeline:()=>De});var n=r("./src/tokenizers.js"),s=r("./src/models.js"),o=r("./src/models/auto/processing_auto.js");r("./src/base/processing_utils.js");var i=r("./src/utils/generic.js"),a=r("./src/utils/core.js"),l=r("./src/utils/maths.js"),u=r("./src/utils/audio.js"),h=r("./src/utils/tensor.js"),c=r("./src/utils/image.js");async function d($e){return Array.isArray($e)||($e=[$e]),await Promise.all($e.map(se=>c.RawImage.read(se)))}async function f($e,se){return Array.isArray($e)||($e=[$e]),await Promise.all($e.map(F=>typeof F=="string"||F instanceof URL?(0,u.read_audio)(F,se):F instanceof Float64Array?new Float32Array(F):F))}function p($e,se){se&&($e=$e.map(Pe=>Pe|0));const[F,pe,Ee,Me]=$e;return{xmin:F,ymin:pe,xmax:Ee,ymax:Me}}class m extends i.Callable{constructor({task:se,model:F,tokenizer:pe=null,processor:Ee=null}){super(),this.task=se,this.model=F,this.tokenizer=pe,this.processor=Ee}async dispose(){await this.model.dispose()}}class b extends m{constructor(se){super(se)}async _call(se,{top_k:F=1}={}){const pe=this.tokenizer(se,{padding:!0,truncation:!0}),Ee=await this.model(pe),Me=this.model.config.problem_type==="multi_label_classification"?ke=>ke.sigmoid():ke=>new h.Tensor("float32",(0,l.softmax)(ke.data),ke.dims),Pe=this.model.config.id2label,ye=[];for(const ke of Ee.logits){const be=Me(ke),Oe=await(0,h.topk)(be,F),je=Oe[0].tolist(),Te=Oe[1].tolist().map((ot,Ze)=>({label:Pe?Pe[ot]:`LABEL_${ot}`,score:je[Ze]}));F===1?ye.push(...Te):ye.push(Te)}return Array.isArray(se)||F===1?ye:ye[0]}}class g extends m{constructor(se){super(se)}async _call(se,{ignore_labels:F=["O"]}={}){const pe=Array.isArray(se),Ee=this.tokenizer(pe?se:[se],{padding:!0,truncation:!0}),Pe=(await this.model(Ee)).logits,ye=this.model.config.id2label,ke=[];for(let be=0;be<Pe.dims[0];++be){const Oe=Ee.input_ids[be],je=Pe[be],Je=[];for(let Te=0;Te<je.dims[0];++Te){const ot=je[Te],Ze=(0,l.max)(ot.data)[1],it=ye?ye[Ze]:`LABEL_${Ze}`;if(F.includes(it))continue;const nt=this.tokenizer.decode([Oe[Te].item()],{skip_special_tokens:!0});if(nt==="")continue;const Ne=(0,l.softmax)(ot.data);Je.push({entity:it,score:Ne[Ze],index:Te,word:nt})}ke.push(Je)}return pe?ke:ke[0]}}class _ extends m{constructor(se){super(se)}async _call(se,F,{top_k:pe=1}={}){const Ee=this.tokenizer(se,{text_pair:F,padding:!0,truncation:!0}),{start_logits:Me,end_logits:Pe}=await this.model(Ee),ye=Ee.input_ids.tolist(),ke=Ee.attention_mask.tolist(),be=this.tokenizer.all_special_ids,Oe=[];for(let je=0;je<Me.dims[0];++je){const Je=ye[je],Te=Je.findIndex(qe=>qe==this.tokenizer.sep_token_id);ke[je].map((qe,Mt)=>qe==1&&(Mt===0||Mt>Te&&be.findIndex(bt=>bt==Je[Mt])===-1));const ot=Me[je].tolist(),Ze=Pe[je].tolist();for(let qe=1;qe<ot.length;++qe)(ke[je]==0||qe<=Te||be.findIndex(Mt=>Mt==Je[qe])!==-1)&&(ot[qe]=-1/0,Ze[qe]=-1/0);const it=(0,l.softmax)(ot).map((qe,Mt)=>[qe,Mt]),nt=(0,l.softmax)(Ze).map((qe,Mt)=>[qe,Mt]);it[0][0]=0,nt[0][0]=0;const Ne=(0,a.product)(it,nt).filter(qe=>qe[0][1]<=qe[1][1]).map(qe=>[qe[0][1],qe[1][1],qe[0][0]*qe[1][0]]).sort((qe,Mt)=>Mt[2]-qe[2]);for(let qe=0;qe<Math.min(Ne.length,pe);++qe){const[Mt,bt,jt]=Ne[qe],yt=Je.slice(Mt,bt+1),pr=this.tokenizer.decode(yt,{skip_special_tokens:!0});Oe.push({answer:pr,score:jt})}}return pe===1?Oe[0]:Oe}}class y extends m{constructor(se){super(se)}async _call(se,{top_k:F=5}={}){const pe=this.tokenizer(se,{padding:!0,truncation:!0}),{logits:Ee}=await this.model(pe),Me=[],Pe=pe.input_ids.tolist();for(let ye=0;ye<Pe.length;++ye){const ke=Pe[ye],be=ke.findIndex(ot=>ot==this.tokenizer.mask_token_id);if(be===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const Oe=Ee[ye][be],je=await(0,h.topk)(new h.Tensor("float32",(0,l.softmax)(Oe.data),Oe.dims),F),Je=je[0].tolist(),Te=je[1].tolist();Me.push(Te.map((ot,Ze)=>{const it=ke.slice();return it[be]=ot,{score:Je[Ze],token:Number(ot),token_str:this.tokenizer.decode([ot]),sequence:this.tokenizer.decode(it,{skip_special_tokens:!0})}}))}return Array.isArray(se)?Me:Me[0]}}class v extends m{constructor(F){super(F);ae(this,"_key","generated_text")}async _call(F,pe={}){Array.isArray(F)||(F=[F]),this.model.config.prefix&&(F=F.map(be=>this.model.config.prefix+be));const Ee=this.model.config.task_specific_params;Ee&&Ee[this.task]&&Ee[this.task].prefix&&(F=F.map(be=>Ee[this.task].prefix+be));const Me=this.tokenizer,Pe={padding:!0,truncation:!0};let ye;this instanceof E&&"_build_translation_inputs"in Me?ye=Me._build_translation_inputs(F,Pe,pe):ye=Me(F,Pe);const ke=await this.model.generate({...ye,...pe});return Me.batch_decode(ke,{skip_special_tokens:!0}).map(be=>({[this._key]:be}))}}class M extends v{constructor(F){super(F);ae(this,"_key","summary_text")}}class E extends v{constructor(F){super(F);ae(this,"_key","translation_text")}}function T($e){return Array.isArray($e)&&$e.every(se=>"role"in se&&"content"in se)}class S extends m{constructor(se){super(se)}async _call(se,F={}){let pe=!1,Ee=!1,Me=F.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,Pe;if(typeof se=="string")Pe=se=[se];else if(Array.isArray(se)&&se.every(Te=>typeof Te=="string"))pe=!0,Pe=se;else{if(T(se))se=[se];else if(Array.isArray(se)&&se.every(T))pe=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");Ee=!0,Pe=se.map(Te=>this.tokenizer.apply_chat_template(Te,{tokenize:!1,add_generation_prompt:!0})),Me=!1}const ye=Ee?!1:F.return_full_text??!0;this.tokenizer.padding_side="left";const ke=this.tokenizer(Pe,{add_special_tokens:Me,padding:!0,truncation:!0}),be=await this.model.generate({...ke,...F}),Oe=this.tokenizer.batch_decode(be,{skip_special_tokens:!0});let je;!ye&&ke.input_ids.dims.at(-1)>0&&(je=this.tokenizer.batch_decode(ke.input_ids,{skip_special_tokens:!0}).map(Te=>Te.length));const Je=Array.from({length:se.length},Te=>[]);for(let Te=0;Te<Oe.length;++Te){const ot=Math.floor(Te/be.dims[0]*se.length);je&&(Oe[Te]=Oe[Te].slice(je[ot])),Je[ot].push({generated_text:Ee?[...se[ot],{role:"assistant",content:Oe[Te]}]:Oe[Te]})}return!pe&&Je.length===1?Je[0]:Je}}class A extends m{constructor(se){super(se),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([F,pe])=>[F.toLowerCase(),pe])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(se,F,{hypothesis_template:pe="This example is {}.",multi_label:Ee=!1}={}){const Me=Array.isArray(se);Me||(se=[se]),Array.isArray(F)||(F=[F]);const Pe=F.map(be=>pe.replace("{}",be)),ye=Ee||F.length===1,ke=[];for(const be of se){const Oe=[];for(const Te of Pe){const ot=this.tokenizer(be,{text_pair:Te,padding:!0,truncation:!0}),Ze=await this.model(ot);ye?Oe.push([Ze.logits.data[this.contradiction_id],Ze.logits.data[this.entailment_id]]):Oe.push(Ze.logits.data[this.entailment_id])}const Je=(ye?Oe.map(Te=>(0,l.softmax)(Te)[1]):(0,l.softmax)(Oe)).map((Te,ot)=>[Te,ot]).sort((Te,ot)=>ot[0]-Te[0]);ke.push({sequence:be,labels:Je.map(Te=>F[Te[1]]),scores:Je.map(Te=>Te[0])})}return Me?ke:ke[0]}}class I extends m{constructor(se){super(se)}async _call(se,{pooling:F="none",normalize:pe=!1,quantize:Ee=!1,precision:Me="binary"}={}){const Pe=this.tokenizer(se,{padding:!0,truncation:!0}),ye=await this.model(Pe);let ke=ye.last_hidden_state??ye.logits??ye.token_embeddings;switch(F){case"none":break;case"mean":ke=(0,h.mean_pooling)(ke,Pe.attention_mask);break;case"first_token":case"cls":ke=ke.slice(null,0);break;case"last_token":case"eos":ke=ke.slice(null,-1);break;default:throw Error(`Pooling method '${F}' not supported.`)}return pe&&(ke=ke.normalize(2,-1)),Ee&&(ke=(0,h.quantize_embeddings)(ke,Me)),ke}}class V extends m{constructor(se){super(se)}async _call(se,{pool:F=null}={}){const pe=await d(se),{pixel_values:Ee}=await this.processor(pe),Me=await this.model({pixel_values:Ee});let Pe;if(F){if(!("pooler_output"in Me))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");Pe=Me.pooler_output}else Pe=Me.last_hidden_state??Me.logits??Me.image_embeds;return Pe}}class N extends m{constructor(se){super(se)}async _call(se,{top_k:F=5}={}){const pe=this.processor.feature_extractor.config.sampling_rate,Ee=await f(se,pe),Me=this.model.config.id2label,Pe=[];for(const ye of Ee){const ke=await this.processor(ye),Oe=(await this.model(ke)).logits[0],je=await(0,h.topk)(new h.Tensor("float32",(0,l.softmax)(Oe.data),Oe.dims),F),Je=je[0].tolist(),ot=je[1].tolist().map((Ze,it)=>({label:Me?Me[Ze]:`LABEL_${Ze}`,score:Je[it]}));Pe.push(ot)}return Array.isArray(se)?Pe:Pe[0]}}class z extends m{constructor(se){super(se)}async _call(se,F,{hypothesis_template:pe="This is a sound of {}."}={}){const Ee=!Array.isArray(se);Ee&&(se=[se]);const Me=F.map(Oe=>pe.replace("{}",Oe)),Pe=this.tokenizer(Me,{padding:!0,truncation:!0}),ye=this.processor.feature_extractor.config.sampling_rate,ke=await f(se,ye),be=[];for(const Oe of ke){const je=await this.processor(Oe),Je=await this.model({...Pe,...je}),Te=(0,l.softmax)(Je.logits_per_audio.data);be.push([...Te].map((ot,Ze)=>({score:ot,label:F[Ze]})))}return Ee?be[0]:be}}class q extends m{constructor(se){super(se)}async _call(se,F={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(se,F);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(se,F);case"moonshine":return this._call_moonshine(se,F);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(se,F){F.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),F.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const pe=!Array.isArray(se);pe&&(se=[se]);const Ee=this.processor.feature_extractor.config.sampling_rate,Me=await f(se,Ee),Pe=[];for(const ye of Me){const ke=await this.processor(ye),Oe=(await this.model(ke)).logits[0],je=[];for(const Te of Oe)je.push((0,l.max)(Te.data)[1]);const Je=this.tokenizer.decode(je,{skip_special_tokens:!0}).trim();Pe.push({text:Je})}return pe?Pe[0]:Pe}async _call_whisper(se,F){const pe=F.return_timestamps??!1,Ee=F.chunk_length_s??0,Me=F.force_full_sequences??!1;let Pe=F.stride_length_s??null;const ye={...F};pe==="word"&&(ye.return_token_timestamps=!0,ye.return_timestamps=!1);const ke=!Array.isArray(se);ke&&(se=[se]);const be=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,Oe=this.processor.feature_extractor.config.hop_length,je=this.processor.feature_extractor.config.sampling_rate,Je=await f(se,je),Te=[];for(const ot of Je){let Ze=[];if(Ee>0){if(Pe===null)Pe=Ee/6;else if(Ee<=Pe)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const Ne=je*Ee,qe=je*Pe,Mt=Ne-2*qe;let bt=0;for(;;){const jt=bt+Ne,yt=ot.subarray(bt,jt),pr=await this.processor(yt),Hr=bt===0,Rr=jt>=ot.length;if(Ze.push({stride:[yt.length,Hr?0:qe,Rr?0:qe],input_features:pr.input_features,is_last:Rr}),Rr)break;bt+=Mt}}else Ze=[{stride:[ot.length,0,0],input_features:(await this.processor(ot)).input_features,is_last:!0}];for(const Ne of Ze){ye.num_frames=Math.floor(Ne.stride[0]/Oe);const qe=await this.model.generate({inputs:Ne.input_features,...ye});pe==="word"?(Ne.tokens=qe.sequences.tolist()[0],Ne.token_timestamps=qe.token_timestamps.tolist()[0].map(Mt=>(0,l.round)(Mt,2))):Ne.tokens=qe[0].tolist(),Ne.stride=Ne.stride.map(Mt=>Mt/je)}const[it,nt]=this.tokenizer._decode_asr(Ze,{time_precision:be,return_timestamps:pe,force_full_sequences:Me});Te.push({text:it,...nt})}return ke?Te[0]:Te}async _call_moonshine(se,F){const pe=!Array.isArray(se);pe&&(se=[se]);const Ee=this.processor.feature_extractor.config.sampling_rate,Me=await f(se,Ee),Pe=[];for(const ye of Me){const ke=await this.processor(ye),be=Math.floor(ye.length/Ee)*6,Oe=await this.model.generate({max_new_tokens:be,...F,...ke}),je=this.processor.batch_decode(Oe,{skip_special_tokens:!0})[0];Pe.push({text:je})}return pe?Pe[0]:Pe}}class G extends m{constructor(se){super(se)}async _call(se,F={}){const pe=Array.isArray(se),Ee=await d(se),{pixel_values:Me}=await this.processor(Ee),Pe=[];for(const ye of Me){ye.dims=[1,...ye.dims];const ke=await this.model.generate({inputs:ye,...F}),be=this.tokenizer.batch_decode(ke,{skip_special_tokens:!0}).map(Oe=>({generated_text:Oe.trim()}));Pe.push(be)}return pe?Pe:Pe[0]}}class ee extends m{constructor(se){super(se)}async _call(se,{top_k:F=5}={}){const pe=await d(se),{pixel_values:Ee}=await this.processor(pe),Me=await this.model({pixel_values:Ee}),Pe=this.model.config.id2label,ye=[];for(const ke of Me.logits){const be=await(0,h.topk)(new h.Tensor("float32",(0,l.softmax)(ke.data),ke.dims),F),Oe=be[0].tolist(),Je=be[1].tolist().map((Te,ot)=>({label:Pe?Pe[Te]:`LABEL_${Te}`,score:Oe[ot]}));ye.push(Je)}return Array.isArray(se)?ye:ye[0]}}class Y extends m{constructor(se){super(se),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(se,{threshold:F=.5,mask_threshold:pe=.5,overlap_mask_area_threshold:Ee=.8,label_ids_to_fuse:Me=null,target_sizes:Pe=null,subtask:ye=null}={}){if(Array.isArray(se)&&se.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const be=await d(se),Oe=be.map(Ne=>[Ne.height,Ne.width]),je=await this.processor(be),{inputNames:Je,outputNames:Te}=this.model.sessions.model;if(!Je.includes("pixel_values")){if(Je.length!==1)throw Error(`Expected a single input name, but got ${Je.length} inputs: ${Je}.`);const Ne=Je[0];if(Ne in je)throw Error(`Input name ${Ne} already exists in the inputs.`);je[Ne]=je.pixel_values}const ot=await this.model(je);let Ze=null;if(ye!==null)Ze=this.subtasks_mapping[ye];else if(this.processor.image_processor){for(const[Ne,qe]of Object.entries(this.subtasks_mapping))if(qe in this.processor.image_processor){Ze=this.processor.image_processor[qe].bind(this.processor.image_processor),ye=Ne;break}}const it=this.model.config.id2label,nt=[];if(ye)if(ye==="panoptic"||ye==="instance"){const Ne=Ze(ot,F,pe,Ee,Me,Pe??Oe)[0],qe=Ne.segmentation;for(const Mt of Ne.segments_info){const bt=new Uint8ClampedArray(qe.data.length);for(let yt=0;yt<qe.data.length;++yt)qe.data[yt]===Mt.id&&(bt[yt]=255);const jt=new c.RawImage(bt,qe.dims[1],qe.dims[0],1);nt.push({score:Mt.score,label:it[Mt.label_id],mask:jt})}}else if(ye==="semantic"){const{segmentation:Ne,labels:qe}=Ze(ot,Pe??Oe)[0];for(const Mt of qe){const bt=new Uint8ClampedArray(Ne.data.length);for(let yt=0;yt<Ne.data.length;++yt)Ne.data[yt]===Mt&&(bt[yt]=255);const jt=new c.RawImage(bt,Ne.dims[1],Ne.dims[0],1);nt.push({score:null,label:it[Mt],mask:jt})}}else throw Error(`Subtask ${ye} not supported.`);else{const qe=ot[Te[0]];for(let Mt=0;Mt<Oe.length;++Mt){const bt=Oe[Mt],jt=qe[Mt];jt.data.some(pr=>pr<-1e-5||pr>1+1e-5)&&jt.sigmoid_();const yt=await c.RawImage.fromTensor(jt.mul_(255).to("uint8")).resize(bt[1],bt[0]);nt.push({label:null,score:null,mask:yt})}}return nt}}class W extends Y{constructor(se){super(se)}async _call(se,F={}){if(Array.isArray(se)&&se.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const Ee=await d(se),Me=await super._call(se,F);return Ee.map((ye,ke)=>{const be=ye.clone();return be.putAlpha(Me[ke].mask),be})}}class te extends m{constructor(se){super(se)}async _call(se,F,{hypothesis_template:pe="This is a photo of {}"}={}){const Ee=Array.isArray(se),Me=await d(se),Pe=F.map(Je=>pe.replace("{}",Je)),ye=this.tokenizer(Pe,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:ke}=await this.processor(Me),be=await this.model({...ye,pixel_values:ke}),Oe=this.model.config.model_type==="siglip"?Je=>Je.sigmoid().data:Je=>(0,l.softmax)(Je.data),je=[];for(const Je of be.logits_per_image){const ot=[...Oe(Je)].map((Ze,it)=>({score:Ze,label:F[it]}));ot.sort((Ze,it)=>it.score-Ze.score),je.push(ot)}return Ee?je:je[0]}}class le extends m{constructor(se){super(se)}async _call(se,{threshold:F=.9,percentage:pe=!1}={}){const Ee=Array.isArray(se);if(Ee&&se.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Me=await d(se),Pe=pe?null:Me.map(Te=>[Te.height,Te.width]),{pixel_values:ye,pixel_mask:ke}=await this.processor(Me),be=await this.model({pixel_values:ye,pixel_mask:ke}),Oe=this.processor.image_processor.post_process_object_detection(be,F,Pe),je=this.model.config.id2label,Je=Oe.map(Te=>Te.boxes.map((ot,Ze)=>({score:Te.scores[Ze],label:je[Te.classes[Ze]],box:p(ot,!pe)})));return Ee?Je:Je[0]}}class oe extends m{constructor(se){super(se)}async _call(se,F,{threshold:pe=.1,top_k:Ee=null,percentage:Me=!1}={}){const Pe=Array.isArray(se),ye=await d(se),ke=this.tokenizer(F,{padding:!0,truncation:!0}),be=await this.processor(ye),Oe=[];for(let je=0;je<ye.length;++je){const Je=ye[je],Te=Me?null:[[Je.height,Je.width]],ot=be.pixel_values[je].unsqueeze_(0),Ze=await this.model({...ke,pixel_values:ot});let it;if("post_process_grounded_object_detection"in this.processor){const nt=this.processor.post_process_grounded_object_detection(Ze,ke.input_ids,{box_threshold:pe,text_threshold:pe,target_sizes:Te})[0];it=nt.boxes.map((Ne,qe)=>({score:nt.scores[qe],label:nt.labels[qe],box:p(Ne,!Me)}))}else{const nt=this.processor.image_processor.post_process_object_detection(Ze,pe,Te,!0)[0];it=nt.boxes.map((Ne,qe)=>({score:nt.scores[qe],label:F[nt.classes[qe]],box:p(Ne,!Me)}))}it.sort((nt,Ne)=>Ne.score-nt.score),Ee!==null&&(it=it.slice(0,Ee)),Oe.push(it)}return Pe?Oe:Oe[0]}}class U extends m{constructor(se){super(se)}async _call(se,F,pe={}){const Ee=(await d(se))[0],{pixel_values:Me}=await this.processor(Ee),Pe=`<s_docvqa><s_question>${F}</s_question><s_answer>`,ye=this.tokenizer(Pe,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,ke=await this.model.generate({inputs:Me,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:ye,...pe}),Oe=this.tokenizer.batch_decode(ke)[0].match(/<s_answer>(.*?)<\/s_answer>/);let je=null;return Oe&&Oe.length>=2&&(je=Oe[1].trim()),[{answer:je}]}}class R extends m{constructor(F){super(F);ae(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=F.vocoder??null}async _prepare_speaker_embeddings(F){if((typeof F=="string"||F instanceof URL)&&(F=new Float32Array(await(await fetch(F)).arrayBuffer())),F instanceof Float32Array)F=new h.Tensor("float32",F,[F.length]);else if(!(F instanceof h.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");return F}async _call(F,{speaker_embeddings:pe=null,num_inference_steps:Ee,speed:Me}={}){return this.processor?this._call_text_to_spectrogram(F,{speaker_embeddings:pe}):this.model.config.model_type==="supertonic"?this._call_supertonic(F,{speaker_embeddings:pe,num_inference_steps:Ee,speed:Me}):this._call_text_to_waveform(F)}async _call_supertonic(F,{speaker_embeddings:pe,num_inference_steps:Ee,speed:Me}){if(!pe)throw new Error("Speaker embeddings must be provided for Supertonic models.");pe=await this._prepare_speaker_embeddings(pe);const{sampling_rate:Pe,style_dim:ye}=this.model.config;pe=pe.view(1,-1,ye);const ke=this.tokenizer(F,{padding:!0,truncation:!0}),{waveform:be}=await this.model.generate_speech({...ke,style:pe,num_inference_steps:Ee,speed:Me});return new u.RawAudio(be.data,Pe)}async _call_text_to_waveform(F){const pe=this.tokenizer(F,{padding:!0,truncation:!0}),{waveform:Ee}=await this.model(pe),Me=this.model.config.sampling_rate;return new u.RawAudio(Ee.data,Me)}async _call_text_to_spectrogram(F,{speaker_embeddings:pe}){this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await s.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"}));const{input_ids:Ee}=this.tokenizer(F,{padding:!0,truncation:!0});pe=await this._prepare_speaker_embeddings(pe),pe=pe.view(1,-1);const{waveform:Me}=await this.model.generate_speech(Ee,pe,{vocoder:this.vocoder}),Pe=this.processor.feature_extractor.config.sampling_rate;return new u.RawAudio(Me.data,Pe)}}class X extends m{constructor(se){super(se)}async _call(se){const F=await d(se),pe=await this.processor(F),Ee=await this.model(pe),Me=[];for(const Pe of Ee.reconstruction){const ye=Pe.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Me.push(c.RawImage.fromTensor(ye))}return Me.length>1?Me:Me[0]}}class ce extends m{constructor(se){super(se)}async _call(se){const F=await d(se),pe=await this.processor(F),{predicted_depth:Ee}=await this.model(pe),Me=[];for(let Pe=0;Pe<F.length;++Pe){const ye=Ee[Pe],[ke,be]=ye.dims.slice(-2),[Oe,je]=F[Pe].size,Je=(await(0,h.interpolate_4d)(ye.view(1,1,ke,be),{size:[je,Oe],mode:"bilinear"})).view(je,Oe),Te=Je.min().item(),ot=Je.max().item(),Ze=Je.sub(Te).div_(ot-Te).mul_(255).to("uint8").unsqueeze(0),it=c.RawImage.fromTensor(Ze);Me.push({predicted_depth:Je,depth:it})}return Me.length>1?Me:Me[0]}}const ne=Object.freeze({"text-classification":{tokenizer:n.AutoTokenizer,pipeline:b,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:n.AutoTokenizer,pipeline:g,model:s.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:n.AutoTokenizer,pipeline:_,model:s.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:n.AutoTokenizer,pipeline:y,model:s.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:n.AutoTokenizer,pipeline:M,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:n.AutoTokenizer,pipeline:E,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:n.AutoTokenizer,pipeline:v,model:s.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:n.AutoTokenizer,pipeline:S,model:s.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:n.AutoTokenizer,pipeline:A,model:s.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:N,model:s.AutoModelForAudioClassification,processor:o.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:n.AutoTokenizer,pipeline:z,model:s.AutoModel,processor:o.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:n.AutoTokenizer,pipeline:q,model:[s.AutoModelForSpeechSeq2Seq,s.AutoModelForCTC],processor:o.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:n.AutoTokenizer,pipeline:R,model:[s.AutoModelForTextToWaveform,s.AutoModelForTextToSpectrogram],processor:[o.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:n.AutoTokenizer,pipeline:G,model:s.AutoModelForVision2Seq,processor:o.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:ee,model:s.AutoModelForImageClassification,processor:o.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:Y,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:o.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:W,model:[s.AutoModelForImageSegmentation,s.AutoModelForSemanticSegmentation,s.AutoModelForUniversalSegmentation],processor:o.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:n.AutoTokenizer,pipeline:te,model:s.AutoModel,processor:o.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:le,model:s.AutoModelForObjectDetection,processor:o.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:n.AutoTokenizer,pipeline:oe,model:s.AutoModelForZeroShotObjectDetection,processor:o.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:n.AutoTokenizer,pipeline:U,model:s.AutoModelForDocumentQuestionAnswering,processor:o.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:X,model:s.AutoModelForImageToImage,processor:o.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:ce,model:s.AutoModelForDepthEstimation,processor:o.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:n.AutoTokenizer,pipeline:I,model:s.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:o.AutoProcessor,pipeline:V,model:[s.AutoModelForImageFeatureExtraction,s.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),we=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function De($e,se=null,{progress_callback:F=null,config:pe=null,cache_dir:Ee=null,local_files_only:Me=!1,revision:Pe="main",device:ye=null,dtype:ke=null,subfolder:be="onnx",use_external_data_format:Oe=null,model_file_name:je=null,session_options:Je={}}={}){$e=we[$e]??$e;const Te=ne[$e.split("_",1)[0]];if(!Te)throw Error(`Unsupported pipeline: ${$e}. Must be one of [${Object.keys(ne)}]`);se||(se=Te.default.model,console.log(`No model specified. Using default model: "${se}".`));const ot={progress_callback:F,config:pe,cache_dir:Ee,local_files_only:Me,revision:Pe,device:ye,dtype:ke,subfolder:be,use_external_data_format:Oe,model_file_name:je,session_options:Je},Ze=new Map([["tokenizer",Te.tokenizer],["model",Te.model],["processor",Te.processor]]),it=await Be(Ze,se,ot);it.task=$e,(0,a.dispatchCallback)(F,{status:"ready",task:$e,model:se});const nt=Te.pipeline;return new nt(it)}async function Be($e,se,F){const pe=Object.create(null),Ee=[];for(const[Me,Pe]of $e.entries()){if(!Pe)continue;let ye;Array.isArray(Pe)?ye=new Promise(async(ke,be)=>{var je,Je;let Oe;for(const Te of Pe){if(Te===null){ke(null);return}try{ke(await Te.from_pretrained(se,F));return}catch(ot){if((je=ot.message)!=null&&je.includes("Unsupported model type"))Oe=ot;else if((Je=ot.message)!=null&&Je.includes("Could not locate file"))Oe=ot;else{be(ot);return}}}be(Oe)}):ye=Pe.from_pretrained(se,F),pe[Me]=ye,Ee.push(ye)}await Promise.all(Ee);for(const[Me,Pe]of Object.entries(pe))pe[Me]=await Pe;return pe}},"./src/tokenizers.js":(e,t,r)=>{r.r(t),r.d(t,{AlbertTokenizer:()=>ct,AutoTokenizer:()=>ma,BartTokenizer:()=>Kt,BertTokenizer:()=>Ht,BlenderbotSmallTokenizer:()=>qo,BlenderbotTokenizer:()=>cr,BloomTokenizer:()=>Lr,CLIPTokenizer:()=>On,CamembertTokenizer:()=>dt,CodeGenTokenizer:()=>Ko,CodeLlamaTokenizer:()=>ks,CohereTokenizer:()=>ha,ConvBertTokenizer:()=>ue,DebertaTokenizer:()=>re,DebertaV2Tokenizer:()=>B,DistilBertTokenizer:()=>Re,ElectraTokenizer:()=>Tt,Ernie4_5_Tokenizer:()=>pa,EsmTokenizer:()=>rn,FalconTokenizer:()=>$o,GPT2Tokenizer:()=>lt,GPTNeoXTokenizer:()=>Ao,GemmaTokenizer:()=>rs,Grok1Tokenizer:()=>Pn,HerbertTokenizer:()=>Z,LlamaTokenizer:()=>Nr,M2M100Tokenizer:()=>$r,MBart50Tokenizer:()=>In,MBartTokenizer:()=>ur,MPNetTokenizer:()=>fn,MarianTokenizer:()=>We,MgpstrTokenizer:()=>fa,MobileBertTokenizer:()=>Wt,NllbTokenizer:()=>qr,NougatTokenizer:()=>ds,PreTrainedTokenizer:()=>Ge,Qwen2Tokenizer:()=>As,RoFormerTokenizer:()=>xe,RobertaTokenizer:()=>Vn,SiglipTokenizer:()=>Ve,SpeechT5Tokenizer:()=>Js,SqueezeBertTokenizer:()=>$,T5Tokenizer:()=>Ot,TokenizerModel:()=>V,VitsTokenizer:()=>da,Wav2Vec2CTCTokenizer:()=>ut,WhisperTokenizer:()=>Os,XLMRobertaTokenizer:()=>$s,XLMTokenizer:()=>Ct,is_chinese_char:()=>y});var n=r("./src/utils/generic.js"),s=r("./src/utils/core.js"),o=r("./src/utils/hub.js"),i=r("./src/utils/maths.js"),a=r("./src/utils/tensor.js"),l=r("./src/utils/data-structures.js"),u=r("./node_modules/@huggingface/jinja/dist/index.js"),h=r("./src/models/whisper/common_whisper.js");async function c(ge,O){const H=await Promise.all([(0,o.getModelJSON)(ge,"tokenizer.json",!0,O),(0,o.getModelJSON)(ge,"tokenizer_config.json",!0,O)]);return O.legacy!==null&&(H[1].legacy=O.legacy),H}function d(ge,O){const H=[];let ie=0;for(const he of ge.matchAll(O)){const me=he[0];ie<he.index&&H.push(ge.slice(ie,he.index)),me.length>0&&H.push(me),ie=he.index+me.length}return ie<ge.length&&H.push(ge.slice(ie)),H}function f(ge,O=!0){if(ge.Regex!==void 0){let H=ge.Regex.replace(/\\([#&~])/g,"$1");for(const[ie,he]of A)H=H.replaceAll(ie,he);return new RegExp(H,"gu")}else if(ge.String!==void 0){const H=(0,s.escapeRegExp)(ge.String);return new RegExp(O?H:`(${H})`,"gu")}else return console.warn("Unknown pattern type:",ge),null}function p(ge){return new Map(Object.entries(ge))}function m(ge){const O=ge.dims;switch(O.length){case 1:return ge.tolist();case 2:if(O[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return ge.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${O.length}.`)}}function b(ge){return ge.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function g(ge){return ge.replace(new RegExp("\\p{M}","gu"),"")}function _(ge){return g(ge.toLowerCase())}function y(ge){return ge>=19968&&ge<=40959||ge>=13312&&ge<=19903||ge>=131072&&ge<=173791||ge>=173824&&ge<=177983||ge>=177984&&ge<=178207||ge>=178208&&ge<=183983||ge>=63744&&ge<=64255||ge>=194560&&ge<=195103}function v(ge,O,H){const ie=[];let he=0;for(;he<ge.length;){if(ie.push(ge[he]),(O.get(ge[he])??H)!==H){++he;continue}for(;++he<ge.length&&(O.get(ge[he])??H)===H;)O.get(ie.at(-1))!==H&&(ie[ie.length-1]+=ge[he])}return ie}function M(ge){return ge.match(/\S+/g)||[]}const E="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",T=new RegExp(`^[${E}]+$`,"gu"),S=".,!?",A=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${S}])]+`,` ?[^\\s${S}]+`]]);class I{constructor(O){this.content=O.content,this.id=O.id,this.single_word=O.single_word??!1,this.lstrip=O.lstrip??!1,this.rstrip=O.rstrip??!1,this.special=O.special??!1,this.normalized=O.normalized??null}}class V extends n.Callable{constructor(O){super(),this.config=O,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(O,...H){switch(O.type){case"WordPiece":return new N(O);case"Unigram":return new z(O,...H);case"BPE":return new ee(O);default:if(O.vocab)return Array.isArray(O.vocab)?new z(O,...H):Object.hasOwn(O,"continuing_subword_prefix")&&Object.hasOwn(O,"unk_token")?Object.hasOwn(O,"merges")?new ee(O):new N(O):new Y(O,...H);throw new Error(`Unknown TokenizerModel type: ${O.type}`)}}_call(O){return O=this.encode(O),this.fuse_unk&&(O=v(O,this.tokens_to_ids,this.unk_token_id)),O}encode(O){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(O){return O.map(H=>this.tokens_to_ids.get(H)??this.unk_token_id)}convert_ids_to_tokens(O){return O.map(H=>this.vocab[H]??this.unk_token)}}class N extends V{constructor(O){super(O),this.tokens_to_ids=p(O.vocab),this.unk_token_id=this.tokens_to_ids.get(O.unk_token),this.unk_token=O.unk_token,this.max_input_chars_per_word=O.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[H,ie]of this.tokens_to_ids)this.vocab[ie]=H}encode(O){const H=[];for(const ie of O){const he=[...ie];if(he.length>this.max_input_chars_per_word){H.push(this.unk_token);continue}let me=!1,Ie=0;const He=[];for(;Ie<he.length;){let st=he.length,Ye=null;for(;Ie<st;){let at=he.slice(Ie,st).join("");if(Ie>0&&(at=this.config.continuing_subword_prefix+at),this.tokens_to_ids.has(at)){Ye=at;break}--st}if(Ye===null){me=!0;break}He.push(Ye),Ie=st}me?H.push(this.unk_token):H.push(...He)}return H}}class z extends V{constructor(O,H){super(O);const ie=O.vocab.length;this.vocab=new Array(ie),this.scores=new Array(ie);for(let he=0;he<ie;++he)[this.vocab[he],this.scores[he]]=O.vocab[he];this.unk_token_id=O.unk_id,this.unk_token=this.vocab[O.unk_id],this.tokens_to_ids=new Map(this.vocab.map((he,me)=>[he,me])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=H.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,i.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new l.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(O){const H=O.chars,ie=1;let he=0;for(;he<H.length;){let me=!1;const Ie=H.slice(he).join(""),He=this.trie.commonPrefixSearch(Ie);for(const st of He){const Ye=this.tokens_to_ids.get(st),at=this.scores[Ye],$t=(0,s.len)(st);O.insert(he,$t,at,Ye),!me&&$t===ie&&(me=!0)}me||O.insert(he,ie,this.unk_score,this.unk_token_id),he+=ie}}tokenize(O){const H=new l.TokenLattice(O,this.bos_token_id,this.eos_token_id);return this.populateNodes(H),H.tokens()}encode(O){const H=[];for(const ie of O){const he=this.tokenize(ie);H.push(...he)}return H}}const q=(()=>{const ge=[...Array.from({length:94},(he,me)=>me+33),...Array.from({length:12},(he,me)=>me+161),...Array.from({length:82},(he,me)=>me+174)],O=ge.slice();let H=0;for(let he=0;he<256;++he)ge.includes(he)||(ge.push(he),O.push(256+H),H+=1);const ie=O.map(he=>String.fromCharCode(he));return Object.fromEntries(ge.map((he,me)=>[he,ie[me]]))})(),G=(0,s.reverseDictionary)(q);class ee extends V{constructor(O){super(O),this.tokens_to_ids=p(O.vocab),this.unk_token_id=this.tokens_to_ids.get(O.unk_token),this.unk_token=O.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[ie,he]of this.tokens_to_ids)this.vocab[he]=ie;const H=Array.isArray(O.merges[0]);this.merges=H?O.merges:O.merges.map(ie=>ie.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((ie,he)=>[JSON.stringify(ie),he])),this.end_of_word_suffix=O.end_of_word_suffix,this.continuing_subword_suffix=O.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new l.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(O){if(O.length===0)return[];const H=this.cache.get(O);if(H!==void 0)return H;const ie=Array.from(O);this.end_of_word_suffix&&(ie[ie.length-1]+=this.end_of_word_suffix);let he=[];if(ie.length>1){const me=new l.PriorityQueue((st,Ye)=>st.score<Ye.score);let Ie={token:ie[0],bias:0,prev:null,next:null},He=Ie;for(let st=1;st<ie.length;++st){const Ye={bias:st/ie.length,token:ie[st],prev:He,next:null};He.next=Ye,this._add_node(me,He),He=Ye}for(;!me.isEmpty();){const st=me.pop();if(st.deleted||!st.next||st.next.deleted)continue;if(st.deleted=!0,st.next.deleted=!0,st.prev){const at={...st.prev};st.prev.deleted=!0,st.prev=at,at.prev?at.prev.next=at:Ie=at}const Ye={token:st.token+st.next.token,bias:st.bias,prev:st.prev,next:st.next.next};Ye.prev?(Ye.prev.next=Ye,this._add_node(me,Ye.prev)):Ie=Ye,Ye.next&&(Ye.next.prev=Ye,this._add_node(me,Ye))}for(let st=Ie;st!==null;st=st.next)he.push(st.token)}else he=ie;if(this.continuing_subword_suffix)for(let me=0;me<he.length-1;++me)he[me]+=this.continuing_subword_suffix;return O.length<this.max_length_to_cache&&this.cache.put(O,he),he}_add_node(O,H){const ie=this.bpe_ranks.get(JSON.stringify([H.token,H.next.token]));ie!==void 0&&(H.score=ie+H.bias,O.push(H))}encode(O){const H=[];for(const ie of O){if(this.ignore_merges&&this.tokens_to_ids.has(ie)){H.push(ie);continue}const he=this.bpe(ie);for(const me of he)if(this.tokens_to_ids.has(me))H.push(me);else if(this.byte_fallback){const Ie=Array.from(this.text_encoder.encode(me)).map(He=>`<0x${He.toString(16).toUpperCase().padStart(2,"0")}>`);Ie.every(He=>this.tokens_to_ids.has(He))?H.push(...Ie):H.push(this.unk_token)}else H.push(this.unk_token)}return H}}class Y extends V{constructor(O,H){super(O),this.tokens_to_ids=p(H.target_lang?O.vocab[H.target_lang]:O.vocab),this.bos_token=H.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=H.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=H.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=H.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[ie,he]of this.tokens_to_ids)this.vocab[he]=ie}encode(O){return O}}class W extends n.Callable{constructor(O){super(),this.config=O}static fromConfig(O){if(O===null)return null;switch(O.type){case"BertNormalizer":return new $e(O);case"Precompiled":return new Rr(O);case"Sequence":return new Be(O);case"Replace":return new te(O);case"NFC":return new oe(O);case"NFD":return new U(O);case"NFKC":return new R(O);case"NFKD":return new X(O);case"Strip":return new ce(O);case"StripAccents":return new ne(O);case"Lowercase":return new we(O);case"Prepend":return new De(O);default:throw new Error(`Unknown Normalizer type: ${O.type}`)}}normalize(O){throw Error("normalize should be implemented in subclass.")}_call(O){return this.normalize(O)}}class te extends W{normalize(O){const H=f(this.config.pattern);return H===null?O:O.replaceAll(H,this.config.content)}}class le extends W{constructor(){super(...arguments);ae(this,"form")}normalize(H){return H=H.normalize(this.form),H}}class oe extends le{constructor(){super(...arguments);ae(this,"form","NFC")}}class U extends le{constructor(){super(...arguments);ae(this,"form","NFD")}}class R extends le{constructor(){super(...arguments);ae(this,"form","NFKC")}}class X extends le{constructor(){super(...arguments);ae(this,"form","NFKD")}}class ce extends W{normalize(O){return this.config.strip_left&&this.config.strip_right?O=O.trim():(this.config.strip_left&&(O=O.trimStart()),this.config.strip_right&&(O=O.trimEnd())),O}}class ne extends W{normalize(O){return O=g(O),O}}class we extends W{normalize(O){return O=O.toLowerCase(),O}}class De extends W{normalize(O){return O=this.config.prepend+O,O}}class Be extends W{constructor(O){super(O),this.normalizers=O.normalizers.map(H=>W.fromConfig(H))}normalize(O){return this.normalizers.reduce((H,ie)=>ie.normalize(H),O)}}class $e extends W{_tokenize_chinese_chars(O){const H=[];for(let ie=0;ie<O.length;++ie){const he=O[ie],me=he.charCodeAt(0);y(me)?(H.push(" "),H.push(he),H.push(" ")):H.push(he)}return H.join("")}stripAccents(O){return O.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(O){switch(O){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(O)}}_clean_text(O){const H=[];for(const ie of O){const he=ie.charCodeAt(0);he===0||he===65533||this._is_control(ie)||(/^\s$/.test(ie)?H.push(" "):H.push(ie))}return H.join("")}normalize(O){return this.config.clean_text&&(O=this._clean_text(O)),this.config.handle_chinese_chars&&(O=this._tokenize_chinese_chars(O)),this.config.lowercase?(O=O.toLowerCase(),this.config.strip_accents!==!1&&(O=this.stripAccents(O))):this.config.strip_accents&&(O=this.stripAccents(O)),O}}class se extends n.Callable{static fromConfig(O){if(O===null)return null;switch(O.type){case"BertPreTokenizer":return new F(O);case"Sequence":return new wn(O);case"Whitespace":return new mr(O);case"WhitespaceSplit":return new Kr(O);case"Metaspace":return new pr(O);case"ByteLevel":return new pe(O);case"Split":return new Ee(O);case"Punctuation":return new Me(O);case"Digits":return new Pe(O);case"Replace":return new Qs(O);case"FixedLength":return new ko(O);default:throw new Error(`Unknown PreTokenizer type: ${O.type}`)}}pre_tokenize_text(O,H){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(O,H){return(Array.isArray(O)?O.map(ie=>this.pre_tokenize_text(ie,H)):this.pre_tokenize_text(O,H)).flat()}_call(O,H){return this.pre_tokenize(O,H)}}class F extends se{constructor(O){super(),this.pattern=new RegExp(`[^\\s${E}]+|[${E}]`,"gu")}pre_tokenize_text(O,H){return O.trim().match(this.pattern)||[]}}class pe extends se{constructor(O){super(),this.config=O,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=q,this.text_encoder=new TextEncoder}pre_tokenize_text(O,H){return this.add_prefix_space&&!O.startsWith(" ")&&(O=" "+O),(this.use_regex?O.match(this.pattern)||[]:[O]).map(he=>Array.from(this.text_encoder.encode(he),me=>this.byte_encoder[me]).join(""))}}class Ee extends se{constructor(O){super(),this.config=O,this.pattern=f(this.config.pattern,this.config.invert)}pre_tokenize_text(O,H){var ie;return this.pattern===null?[]:this.config.invert?O.match(this.pattern)||[]:((ie=this.config.behavior)==null?void 0:ie.toLowerCase())==="removed"?O.split(this.pattern).filter(he=>he):d(O,this.pattern)}}class Me extends se{constructor(O){super(),this.config=O,this.pattern=new RegExp(`[^${E}]+|[${E}]+`,"gu")}pre_tokenize_text(O,H){return O.match(this.pattern)||[]}}class Pe extends se{constructor(O){super(),this.config=O;const H=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(H,"gu")}pre_tokenize_text(O,H){return O.match(this.pattern)||[]}}class ye extends n.Callable{constructor(O){super(),this.config=O}static fromConfig(O){if(O===null)return null;switch(O.type){case"TemplateProcessing":return new Oe(O);case"ByteLevel":return new je(O);case"RobertaProcessing":return new be(O);case"BertProcessing":return new ke(O);case"Sequence":return new Je(O);default:throw new Error(`Unknown PostProcessor type: ${O.type}`)}}post_process(O,...H){throw Error("post_process should be implemented in subclass.")}_call(O,...H){return this.post_process(O,...H)}}class ke extends ye{constructor(O){super(O),this.cls=O.cls[0],this.sep=O.sep[0]}post_process(O,H=null,{add_special_tokens:ie=!0}={}){ie&&(O=(0,s.mergeArrays)([this.cls],O,[this.sep]));let he=new Array(O.length).fill(0);if(H!==null){const me=ie&&this instanceof be?[this.sep]:[],Ie=ie?[this.sep]:[];O=(0,s.mergeArrays)(O,me,H,Ie),he=(0,s.mergeArrays)(he,new Array(H.length+me.length+Ie.length).fill(1))}return{tokens:O,token_type_ids:he}}}class be extends ke{}class Oe extends ye{constructor(O){super(O),this.single=O.single,this.pair=O.pair}post_process(O,H=null,{add_special_tokens:ie=!0}={}){const he=H===null?this.single:this.pair;let me=[],Ie=[];for(const He of he)"SpecialToken"in He?ie&&(me.push(He.SpecialToken.id),Ie.push(He.SpecialToken.type_id)):"Sequence"in He&&(He.Sequence.id==="A"?(me=(0,s.mergeArrays)(me,O),Ie=(0,s.mergeArrays)(Ie,new Array(O.length).fill(He.Sequence.type_id))):He.Sequence.id==="B"&&(me=(0,s.mergeArrays)(me,H),Ie=(0,s.mergeArrays)(Ie,new Array(H.length).fill(He.Sequence.type_id))));return{tokens:me,token_type_ids:Ie}}}class je extends ye{post_process(O,H=null){return H&&(O=(0,s.mergeArrays)(O,H)),{tokens:O}}}class Je extends ye{constructor(O){super(O),this.processors=O.processors.map(H=>ye.fromConfig(H))}post_process(O,H=null,ie={}){let he;for(const me of this.processors)if(me instanceof je)O=me.post_process(O).tokens,H&&(H=me.post_process(H).tokens);else{const Ie=me.post_process(O,H,ie);O=Ie.tokens,he=Ie.token_type_ids}return{tokens:O,token_type_ids:he}}}class Te extends n.Callable{constructor(O){super(),this.config=O,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=O.trim_offsets}static fromConfig(O){if(O===null)return null;switch(O.type){case"WordPiece":return new Ne(O);case"Metaspace":return new Hr(O);case"ByteLevel":return new qe(O);case"Replace":return new ot(O);case"ByteFallback":return new Ze(O);case"Fuse":return new it(O);case"Strip":return new nt(O);case"Sequence":return new bt(O);case"CTC":return new Mt(O);case"BPEDecoder":return new jt(O);default:throw new Error(`Unknown Decoder type: ${O.type}`)}}_call(O){return this.decode(O)}decode(O){return this.decode_chain(O).join("")}decode_chain(O){throw Error("`decode_chain` should be implemented in subclass.")}}class ot extends Te{decode_chain(O){const H=f(this.config.pattern);return H===null?O:O.map(ie=>ie.replaceAll(H,this.config.content))}}class Ze extends Te{constructor(O){super(O),this.text_decoder=new TextDecoder}decode_chain(O){const H=[];let ie=[];for(const he of O){let me=null;if(he.length===6&&he.startsWith("<0x")&&he.endsWith(">")){const Ie=parseInt(he.slice(3,5),16);isNaN(Ie)||(me=Ie)}if(me!==null)ie.push(me);else{if(ie.length>0){const Ie=this.text_decoder.decode(Uint8Array.from(ie));H.push(Ie),ie=[]}H.push(he)}}if(ie.length>0){const he=this.text_decoder.decode(Uint8Array.from(ie));H.push(he),ie=[]}return H}}class it extends Te{decode_chain(O){return[O.join("")]}}class nt extends Te{constructor(O){super(O),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(O){return O.map(H=>{let ie=0;for(let me=0;me<this.start&&H[me]===this.content;++me){ie=me+1;continue}let he=H.length;for(let me=0;me<this.stop;++me){const Ie=H.length-me-1;if(H[Ie]===this.content){he=Ie;continue}else break}return H.slice(ie,he)})}}class Ne extends Te{constructor(O){super(O),this.cleanup=O.cleanup}decode_chain(O){return O.map((H,ie)=>(ie!==0&&(H.startsWith(this.config.prefix)?H=H.replace(this.config.prefix,""):H=" "+H),this.cleanup&&(H=b(H)),H))}}class qe extends Te{constructor(O){super(O),this.byte_decoder=G,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(O){const H=O.join(""),ie=new Uint8Array([...H].map(me=>this.byte_decoder[me]));return this.text_decoder.decode(ie)}decode_chain(O){const H=[];let ie=[];for(const he of O)this.added_tokens.find(me=>me.content===he)!==void 0?(ie.length>0&&(H.push(this.convert_tokens_to_string(ie)),ie=[]),H.push(he)):ie.push(he);return ie.length>0&&H.push(this.convert_tokens_to_string(ie)),H}}class Mt extends Te{constructor(O){super(O),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(O){if(O.length===0)return"";const H=[O[0]];for(let me=1;me<O.length;++me)O[me]!==H.at(-1)&&H.push(O[me]);let he=H.filter(me=>me!==this.pad_token).join("");return this.cleanup&&(he=b(he).replaceAll(this.word_delimiter_token," ").trim()),he}decode_chain(O){return[this.convert_tokens_to_string(O)]}}class bt extends Te{constructor(O){super(O),this.decoders=O.decoders.map(H=>Te.fromConfig(H))}decode_chain(O){return this.decoders.reduce((H,ie)=>ie.decode_chain(H),O)}}class jt extends Te{constructor(O){super(O),this.suffix=this.config.suffix}decode_chain(O){return O.map((H,ie)=>H.replaceAll(this.suffix,ie===O.length-1?"":" "))}}class yt extends Te{decode_chain(O){let H="";for(let ie=1;ie<O.length;ie+=2)H+=O[ie];return[H]}}class pr extends se{constructor(O){super(),this.replacement=O.replacement,this.strRep=O.str_rep||this.replacement,this.prepend_scheme=O.prepend_scheme??"always"}pre_tokenize_text(O,{section_index:H=void 0}={}){let ie=O.replaceAll(" ",this.strRep);return!ie.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&H===0)&&(ie=this.strRep+ie),[ie]}}class Hr extends Te{constructor(O){super(O),this.replacement=O.replacement}decode_chain(O){const H=[];for(let ie=0;ie<O.length;++ie){let he=O[ie].replaceAll(this.replacement," ");ie==0&&he.startsWith(" ")&&(he=he.substring(1)),H.push(he)}return H}}class Rr extends W{constructor(O){super(O),this.charsmap=O.precompiled_charsmap}normalize(O){return O=O.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),O=O.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),O.includes("")?O=O.split("").map(ie=>ie.normalize("NFKC")).join(""):O=O.normalize("NFKC"),O}}class wn extends se{constructor(O){super(),this.tokenizers=O.pretokenizers.map(H=>se.fromConfig(H))}pre_tokenize_text(O,H){return this.tokenizers.reduce((ie,he)=>he.pre_tokenize(ie,H),[O])}}class mr extends se{constructor(O){super()}pre_tokenize_text(O,H){return O.match(/\w+|[^\w\s]+/g)||[]}}class Kr extends se{constructor(O){super()}pre_tokenize_text(O,H){return M(O)}}class Qs extends se{constructor(O){super(),this.config=O,this.pattern=f(this.config.pattern),this.content=this.config.content}pre_tokenize_text(O,H){return this.pattern===null?[O]:[O.replaceAll(this.pattern,this.config.content)]}}class ko extends se{constructor(O){super(),this._length=O.length}pre_tokenize_text(O,H){const ie=[];for(let he=0;he<O.length;he+=this._length)ie.push(O.slice(he,he+this._length));return ie}}const Cs=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function Yr(ge,O,H,ie){for(const he of Object.keys(ge)){const me=O-ge[he].length,Ie=H(he),He=new Array(me).fill(Ie);ge[he]=ie==="right"?(0,s.mergeArrays)(ge[he],He):(0,s.mergeArrays)(He,ge[he])}}function Xs(ge,O){for(const H of Object.keys(ge))ge[H].length=O}class Ge extends n.Callable{constructor(H,ie){super();ae(this,"return_token_type_ids",!1);ae(this,"padding_side","right");this.config=ie,this.normalizer=W.fromConfig(H.normalizer),this.pre_tokenizer=se.fromConfig(H.pre_tokenizer),this.model=V.fromConfig(H.model,ie),this.post_processor=ye.fromConfig(H.post_processor),this.decoder=Te.fromConfig(H.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const he of H.added_tokens){const me=new I(he);this.added_tokens.push(me),this.model.tokens_to_ids.set(me.content,me.id),this.model.vocab[me.id]=me.content,me.special&&(this.special_tokens.push(me.content),this.all_special_ids.push(me.id))}if(this.additional_special_tokens=ie.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new l.DictionarySplitter(this.added_tokens.map(he=>he.content)),this.added_tokens_map=new Map(this.added_tokens.map(he=>[he.content,he])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=ie.model_max_length,this.remove_space=ie.remove_space,this.clean_up_tokenization_spaces=ie.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=ie.do_lowercase_and_remove_accent??!1,ie.padding_side&&(this.padding_side=ie.padding_side),this.add_bos_token=ie.add_bos_token,this.add_eos_token=ie.add_eos_token,this.legacy=!1,this.chat_template=ie.chat_template??null,Array.isArray(this.chat_template)){const he=Object.create(null);for(const{name:me,template:Ie}of this.chat_template){if(typeof me!="string"||typeof Ie!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');he[me]=Ie}this.chat_template=he}this._compiled_template_cache=new Map}getToken(...H){for(const ie of H){const he=this.config[ie];if(he)if(typeof he=="object"){if(he.__type==="AddedToken")return he.content;throw Error(`Unknown token: ${he}`)}else return he}return null}static async from_pretrained(H,{progress_callback:ie=null,config:he=null,cache_dir:me=null,local_files_only:Ie=!1,revision:He="main",legacy:st=null}={}){const Ye=await c(H,{progress_callback:ie,config:he,cache_dir:me,local_files_only:Ie,revision:He,legacy:st});return new this(...Ye)}_call(H,{text_pair:ie=null,add_special_tokens:he=!0,padding:me=!1,truncation:Ie=null,max_length:He=null,return_tensor:st=!0,return_token_type_ids:Ye=null}={}){const at=Array.isArray(H);let $t;if(at){if(H.length===0)throw Error("text array must be non-empty");if(ie!==null){if(Array.isArray(ie)){if(H.length!==ie.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");$t=H.map((Yt,Ar)=>this._encode_plus(Yt,{text_pair:ie[Ar],add_special_tokens:he,return_token_type_ids:Ye}))}else $t=H.map(Yt=>this._encode_plus(Yt,{add_special_tokens:he,return_token_type_ids:Ye}))}else{if(H==null)throw Error("text may not be null or undefined");if(Array.isArray(ie))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");$t=[this._encode_plus(H,{text_pair:ie,add_special_tokens:he,return_token_type_ids:Ye})]}if(He===null?He=this.model_max_length:Ie===null&&(me===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),He=this.model_max_length):me===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),Ie=!0)),me===!0&&(He=Math.min((0,i.max)($t.map(Yt=>Yt.input_ids.length))[0],He??1/0)),He=Math.min(He,this.model_max_length??1/0),me||Ie)for(let Yt=0;Yt<$t.length;++Yt)$t[Yt].input_ids.length!==He&&($t[Yt].input_ids.length>He?Ie&&Xs($t[Yt],He):me&&Yr($t[Yt],He,Ar=>Ar==="input_ids"?this.pad_token_id:0,this.padding_side));const qt={};if(st){if(!(me&&Ie)&&$t.some(Ar=>{var ar;for(const Er of Object.keys(Ar))if(Ar[Er].length!==((ar=$t[0][Er])==null?void 0:ar.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const Yt=[$t.length,$t[0].input_ids.length];for(const Ar of Object.keys($t[0]))qt[Ar]=new a.Tensor("int64",BigInt64Array.from($t.flatMap(ar=>ar[Ar]).map(BigInt)),Yt)}else{for(const Yt of Object.keys($t[0]))qt[Yt]=$t.map(Ar=>Ar[Yt]);if(!at)for(const Yt of Object.keys(qt))qt[Yt]=qt[Yt][0]}return qt}_encode_text(H){if(H===null)return null;const ie=this.added_tokens_splitter.split(H);for(let me=0;me<ie.length;++me){const Ie=this.added_tokens_map.get(ie[me]);Ie&&(Ie.lstrip&&me>0&&(ie[me-1]=ie[me-1].trimEnd()),Ie.rstrip&&me<ie.length-1&&(ie[me+1]=ie[me+1].trimStart()))}return ie.flatMap((me,Ie)=>{if(me.length===0)return[];if(this.added_tokens_map.has(me))return[me];if(this.remove_space===!0&&(me=me.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(me=_(me)),this.normalizer!==null&&(me=this.normalizer(me)),me.length===0)return[];const He=this.pre_tokenizer!==null?this.pre_tokenizer(me,{section_index:Ie}):[me];return this.model(He)})}_encode_plus(H,{text_pair:ie=null,add_special_tokens:he=!0,return_token_type_ids:me=null}={}){const{tokens:Ie,token_type_ids:He}=this._tokenize_helper(H,{pair:ie,add_special_tokens:he}),st=this.model.convert_tokens_to_ids(Ie),Ye={input_ids:st,attention_mask:new Array(st.length).fill(1)};return(me??this.return_token_type_ids)&&He&&(Ye.token_type_ids=He),Ye}_tokenize_helper(H,{pair:ie=null,add_special_tokens:he=!1}={}){const me=this._encode_text(H),Ie=this._encode_text(ie);return this.post_processor?this.post_processor(me,Ie,{add_special_tokens:he}):{tokens:(0,s.mergeArrays)(me??[],Ie??[])}}tokenize(H,{pair:ie=null,add_special_tokens:he=!1}={}){return this._tokenize_helper(H,{pair:ie,add_special_tokens:he}).tokens}encode(H,{text_pair:ie=null,add_special_tokens:he=!0,return_token_type_ids:me=null}={}){return this._encode_plus(H,{text_pair:ie,add_special_tokens:he,return_token_type_ids:me}).input_ids}batch_decode(H,ie={}){return H instanceof a.Tensor&&(H=H.tolist()),H.map(he=>this.decode(he,ie))}decode(H,ie={}){if(H instanceof a.Tensor&&(H=m(H)),!Array.isArray(H)||H.length===0||!(0,s.isIntegralNumber)(H[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(H,ie)}decode_single(H,{skip_special_tokens:ie=!1,clean_up_tokenization_spaces:he=null}){let me=this.model.convert_ids_to_tokens(H);ie&&(me=me.filter(He=>!this.special_tokens.includes(He)));let Ie=this.decoder?this.decoder(me):me.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(Ie=Ie.replaceAll(this.decoder.end_of_word_suffix," "),ie&&(Ie=Ie.trim())),(he??this.clean_up_tokenization_spaces)&&(Ie=b(Ie)),Ie}get_chat_template({chat_template:H=null,tools:ie=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const he=this.chat_template;if(H!==null&&Object.hasOwn(he,H))H=he[H];else if(H===null)if(ie!==null&&"tool_use"in he)H=he.tool_use;else if("default"in he)H=he.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(he).sort()}.`)}else if(H===null)if(this.chat_template)H=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return H}apply_chat_template(H,{tools:ie=null,documents:he=null,chat_template:me=null,add_generation_prompt:Ie=!1,tokenize:He=!0,padding:st=!1,truncation:Ye=!1,max_length:at=null,return_tensor:$t=!0,return_dict:qt=!1,tokenizer_kwargs:Yt={},...Ar}={}){if(me=this.get_chat_template({chat_template:me,tools:ie}),typeof me!="string")throw Error(`chat_template must be a string, but got ${typeof me}`);let ar=this._compiled_template_cache.get(me);ar===void 0&&(ar=new u.Template(me),this._compiled_template_cache.set(me,ar));const Er=Object.create(null);for(const Pr of Cs){const Wn=this.getToken(Pr);Wn&&(Er[Pr]=Wn)}const Ir=ar.render({messages:H,add_generation_prompt:Ie,tools:ie,documents:he,...Er,...Ar});if(He){const Pr=this._call(Ir,{add_special_tokens:!1,padding:st,truncation:Ye,max_length:at,return_tensor:$t,...Yt});return qt?Pr:Pr.input_ids}return Ir}}class Ht extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class ct extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class Wt extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class $ extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class re extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class B extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class Z extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class ue extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class xe extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class Re extends Ge{}class dt extends Ge{}class Ct extends Ge{constructor(H,ie){super(H,ie);ae(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Tt extends Ge{constructor(){super(...arguments);ae(this,"return_token_type_ids",!0)}}class Ot extends Ge{}class lt extends Ge{}class Kt extends Ge{}class ur extends Ge{constructor(O,H){super(O,H),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)),this.lang_to_token=ie=>ie}_build_translation_inputs(O,H,ie){return Is(this,O,H,ie)}}class In extends ur{}class Vn extends Ge{}class Lr extends Ge{}const Zr="";class Nr extends Ge{constructor(H,ie){super(H,ie);ae(this,"padding_side","left");this.legacy=ie.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new pr({replacement:Zr,prepend_scheme:"first"}))}_encode_text(H){if(H===null)return null;if(this.legacy||H.length===0)return super._encode_text(H);let ie=super._encode_text(Zr+H.replaceAll(Zr," "));return ie.length>1&&ie[0]===Zr&&this.special_tokens.includes(ie[1])&&(ie=ie.slice(1)),ie}}class ks extends Ge{}class $s extends Ge{}class fn extends Ge{}class $o extends Ge{}class Ao extends Ge{}class rn extends Ge{}class As extends Ge{}class rs extends Ge{}class Pn extends Ge{}function Is(ge,O,H,ie){if(!("language_codes"in ge)||!Array.isArray(ge.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in ge)||!(ge.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in ge)||typeof ge.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const he=ie.src_lang,me=ie.tgt_lang;if(!ge.language_codes.includes(me))throw new Error(`Target language code "${me}" is not valid. Must be one of: {${ge.language_codes.join(", ")}}`);if(he!==void 0){if(!ge.language_codes.includes(he))throw new Error(`Source language code "${he}" is not valid. Must be one of: {${ge.language_codes.join(", ")}}`);for(const Ie of ge.post_processor.config.single)if("SpecialToken"in Ie&&ge.languageRegex.test(Ie.SpecialToken.id)){Ie.SpecialToken.id=ge.lang_to_token(he);break}}return ie.forced_bos_token_id=ge.model.convert_tokens_to_ids([ge.lang_to_token(me)])[0],ge._call(O,H)}class qr extends Ge{constructor(O,H){super(O,H),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)),this.lang_to_token=ie=>ie}_build_translation_inputs(O,H,ie){return Is(this,O,H,ie)}}class $r extends Ge{constructor(O,H){super(O,H),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(ie=>this.languageRegex.test(ie)).map(ie=>ie.slice(2,-2)),this.lang_to_token=ie=>`__${ie}__`}_build_translation_inputs(O,H,ie){return Is(this,O,H,ie)}}class Os extends Ge{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(O,{return_timestamps:H=!1,return_language:ie=!1,time_precision:he=null,force_full_sequences:me=!0}={}){if(he===null)throw Error("Must specify time_precision");let Ie=null;const He=H==="word";function st(){return{language:Ie,timestamp:[null,null],text:""}}const Ye=[];let at=st(),$t=0;const qt=this.timestamp_begin,Ar=qt+1500;let ar=[],Er=[],Ir=!1,Pr=null;const Wn=new Set(this.all_special_ids);for(const gr of O){const jr=gr.tokens,bn=He?gr.token_timestamps:null;let Ds=null,Fs=qt;if("stride"in gr){const[sn,zr,wr]=gr.stride;if($t-=zr,Pr=sn-wr,zr&&(Fs=zr/he+qt),wr)for(let Qr=jr.length-1;Qr>=0;--Qr){const Fn=Number(jr[Qr]);if(Fn>=qt){if(Ds!==null&&(Fn-qt)*he<Pr)break;Ds=Fn}}}let xn=[],Dn=[];for(let sn=0;sn<jr.length;++sn){const zr=Number(jr[sn]);if(Wn.has(zr)){const wr=this.decode([zr]),Qr=h.WHISPER_LANGUAGE_MAPPING.get(wr.slice(2,-2));if(Qr!==void 0){if(Ie!==null&&Qr!==Ie&&!H){ar.push(xn);const Fn=this.findLongestCommonSequence(ar)[0],Rs=this.decode(Fn);at.text=Rs,Ye.push(at),ar=[],xn=[],at=st()}Ie=at.language=Qr}}else if(zr>=qt&&zr<=Ar){const wr=(zr-qt)*he+$t,Qr=(0,i.round)(wr,2);if(Ds!==null&&zr>=Ds)Ir=!0;else if(Ir||ar.length>0&&zr<Fs)Ir=!1;else if(at.timestamp[0]===null)at.timestamp[0]=Qr;else if(Qr!==at.timestamp[0]){at.timestamp[1]=Qr,ar.push(xn),He&&Er.push(Dn);const[Fn,Rs]=this.findLongestCommonSequence(ar,Er),gl=this.decode(Fn);at.text=gl,He&&(at.words=this.collateWordTimestamps(Fn,Rs,Ie)),Ye.push(at),ar=[],xn=[],Er=[],Dn=[],at=st()}}else if(xn.push(zr),He){let wr=(0,i.round)(bn[sn]+$t,2),Qr;if(sn+1<bn.length){Qr=(0,i.round)(bn[sn+1]+$t,2);const Fn=this.decode([zr]);T.test(Fn)&&(Qr=(0,i.round)(Math.min(wr+he,Qr),2))}else Qr=null;Dn.push([wr,Qr])}}if("stride"in gr){const[sn,zr,wr]=gr.stride;$t+=sn-wr}xn.length>0?(ar.push(xn),He&&Er.push(Dn)):ar.every(sn=>sn.length===0)&&(at=st(),ar=[],xn=[],Er=[],Dn=[])}if(ar.length>0){if(me&&H)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[gr,jr]=this.findLongestCommonSequence(ar,Er),bn=this.decode(gr);at.text=bn,He&&(at.words=this.collateWordTimestamps(gr,jr,Ie)),Ye.push(at)}let nn=Object.create(null);const Ys=Ye.map(gr=>gr.text).join("");if(H||ie){for(let gr=0;gr<Ye.length;++gr){const jr=Ye[gr];H||delete jr.timestamp,ie||delete jr.language}if(He){const gr=[];for(const jr of Ye)for(const bn of jr.words)gr.push(bn);nn={chunks:gr}}else nn={chunks:Ye}}return[Ys,nn]}findLongestCommonSequence(O,H=null){let ie=O[0],he=ie.length,me=[];const Ie=Array.isArray(H)&&H.length>0;let He=Ie?[]:null,st=Ie?H[0]:null;for(let Ye=1;Ye<O.length;++Ye){const at=O[Ye];let $t=0,qt=[he,he,0,0];const Yt=at.length;for(let nn=1;nn<he+Yt;++nn){const Ys=Math.max(0,he-nn),gr=Math.min(he,he+Yt-nn),jr=ie.slice(Ys,gr),bn=Math.max(0,nn-he),Ds=Math.min(Yt,nn),Fs=at.slice(bn,Ds);if(jr.length!==Fs.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let xn;Ie?xn=jr.filter((zr,wr)=>zr===Fs[wr]&&st[Ys+wr]<=H[Ye][bn+wr]).length:xn=jr.filter((zr,wr)=>zr===Fs[wr]).length;const Dn=nn/1e4,sn=xn/nn+Dn;xn>1&&sn>$t&&($t=sn,qt=[Ys,gr,bn,Ds])}const[Ar,ar,Er,Ir]=qt,Pr=Math.floor((ar+Ar)/2),Wn=Math.floor((Ir+Er)/2);me.push(...ie.slice(0,Pr)),ie=at.slice(Wn),he=ie.length,Ie&&(He.push(...st.slice(0,Pr)),st=H[Ye].slice(Wn))}return me.push(...ie),Ie?(He.push(...st),[me,He]):[me,[]]}collateWordTimestamps(O,H,ie){const[he,me,Ie]=this.combineTokensIntoWords(O,ie),He=[];for(let st=0;st<he.length;++st){const Ye=Ie[st];He.push({text:he[st],timestamp:[H[Ye.at(0)][0],H[Ye.at(-1)][1]]})}return He}combineTokensIntoWords(O,H,ie=`"'([{-`,he=`"'.,!?:)]}`){H=H??"english";let me,Ie,He;return["chinese","japanese","thai","lao","myanmar"].includes(H)?[me,Ie,He]=this.splitTokensOnUnicode(O):[me,Ie,He]=this.splitTokensOnSpaces(O),this.mergePunctuations(me,Ie,He,ie,he)}decode(O,H){let ie;return H!=null&&H.decode_with_timestamps?(O instanceof a.Tensor&&(O=m(O)),ie=this.decodeWithTimestamps(O,H)):ie=super.decode(O,H),ie}decodeWithTimestamps(O,H){const ie=(H==null?void 0:H.time_precision)??.02,he=Array.from(this.all_special_ids).at(-1)+1;let me=[[]];for(let Ie of O)if(Ie=Number(Ie),Ie>=he){const He=((Ie-he)*ie).toFixed(2);me.push(`<|${He}|>`),me.push([])}else me[me.length-1].push(Ie);return me=me.map(Ie=>typeof Ie=="string"?Ie:super.decode(Ie,H)),me.join("")}splitTokensOnUnicode(O){const H=this.decode(O,{decode_with_timestamps:!0}),ie="",he=[],me=[],Ie=[];let He=[],st=[],Ye=0;for(let at=0;at<O.length;++at){const $t=O[at];He.push($t),st.push(at);const qt=this.decode(He,{decode_with_timestamps:!0});(!qt.includes(ie)||H[Ye+qt.indexOf(ie)]===ie)&&(he.push(qt),me.push(He),Ie.push(st),He=[],st=[],Ye+=qt.length)}return[he,me,Ie]}splitTokensOnSpaces(O){const[H,ie,he]=this.splitTokensOnUnicode(O),me=[],Ie=[],He=[],st=new RegExp(`^[${E}]$`,"gu");for(let Ye=0;Ye<H.length;++Ye){const at=H[Ye],$t=ie[Ye],qt=he[Ye],Yt=$t[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Ar=at.startsWith(" "),ar=at.trim(),Er=st.test(ar);if(Yt||Ar||Er||me.length===0)me.push(at),Ie.push($t),He.push(qt);else{const Ir=me.length-1;me[Ir]+=at,Ie[Ir].push(...$t),He[Ir].push(...qt)}}return[me,Ie,He]}mergePunctuations(O,H,ie,he,me){const Ie=structuredClone(O),He=structuredClone(H),st=structuredClone(ie);let Ye=Ie.length-2,at=Ie.length-1;for(;Ye>=0;)Ie[Ye].startsWith(" ")&&he.includes(Ie[Ye].trim())?(Ie[at]=Ie[Ye]+Ie[at],He[at]=(0,s.mergeArrays)(He[Ye],He[at]),st[at]=(0,s.mergeArrays)(st[Ye],st[at]),Ie[Ye]="",He[Ye]=[],st[Ye]=[]):at=Ye,--Ye;for(Ye=0,at=1;at<Ie.length;)!Ie[Ye].endsWith(" ")&&me.includes(Ie[at])?(Ie[Ye]+=Ie[at],He[Ye]=(0,s.mergeArrays)(He[Ye],He[at]),st[Ye]=(0,s.mergeArrays)(st[Ye],st[at]),Ie[at]="",He[at]=[],st[at]=[]):Ye=at,++at;return[Ie.filter($t=>$t),He.filter($t=>$t.length>0),st.filter($t=>$t.length>0)]}}class Ko extends Ge{}class On extends Ge{}class Ve extends Ge{}class We extends Ge{constructor(O,H){super(O,H),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(ie=>this.languageRegex.test(ie)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(O){if(O===null)return null;const[H,...ie]=O.trim().split(this.languageRegex);if(ie.length===0)return super._encode_text(H);if(ie.length===2){const[he,me]=ie;return this.supported_language_codes.includes(he)||console.warn(`Unsupported language code "${he}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,s.mergeArrays)([he],super._encode_text(me))}}}class ut extends Ge{}class cr extends Ge{}class qo extends Ge{}class Js extends Ge{}class ds extends Ge{}class da extends Ge{constructor(O,H){super(O,H),this.decoder=new yt({})}}class ha extends Ge{}class fa extends Ge{}class pa extends Ge{}class ma{static async from_pretrained(O,{progress_callback:H=null,config:ie=null,cache_dir:he=null,local_files_only:me=!1,revision:Ie="main",legacy:He=null}={}){var qt;const[st,Ye]=await c(O,{progress_callback:H,config:ie,cache_dir:he,local_files_only:me,revision:Ie,legacy:He}),at=((qt=Ye.tokenizer_class)==null?void 0:qt.replace(/Fast$/,""))??"PreTrainedTokenizer";let $t=this.TOKENIZER_CLASS_MAPPING[at];return $t||(console.warn(`Unknown tokenizer class "${at}", attempting to construct from base class.`),$t=Ge),new $t(st,Ye)}}ae(ma,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:Ot,DistilBertTokenizer:Re,CamembertTokenizer:dt,DebertaTokenizer:re,DebertaV2Tokenizer:B,BertTokenizer:Ht,HerbertTokenizer:Z,ConvBertTokenizer:ue,RoFormerTokenizer:xe,XLMTokenizer:Ct,ElectraTokenizer:Tt,MobileBertTokenizer:Wt,SqueezeBertTokenizer:$,AlbertTokenizer:ct,GPT2Tokenizer:lt,BartTokenizer:Kt,MBartTokenizer:ur,MBart50Tokenizer:In,RobertaTokenizer:Vn,WhisperTokenizer:Os,CodeGenTokenizer:Ko,CLIPTokenizer:On,SiglipTokenizer:Ve,MarianTokenizer:We,BloomTokenizer:Lr,NllbTokenizer:qr,M2M100Tokenizer:$r,LlamaTokenizer:Nr,CodeLlamaTokenizer:ks,XLMRobertaTokenizer:$s,MPNetTokenizer:fn,FalconTokenizer:$o,GPTNeoXTokenizer:Ao,EsmTokenizer:rn,Wav2Vec2CTCTokenizer:ut,BlenderbotTokenizer:cr,BlenderbotSmallTokenizer:qo,SpeechT5Tokenizer:Js,NougatTokenizer:ds,VitsTokenizer:da,Qwen2Tokenizer:As,GemmaTokenizer:rs,Grok1Tokenizer:Pn,CohereTokenizer:ha,MgpstrTokenizer:fa,Ernie4_5_Tokenizer:pa,PreTrainedTokenizer:Ge})},"./src/utils/audio.js":(e,t,r)=>{r.r(t),r.d(t,{RawAudio:()=>N,hamming:()=>d,hanning:()=>c,mel_filter_bank:()=>y,read_audio:()=>u,spectrogram:()=>S,window_function:()=>A});var n=r("./src/utils/hub.js"),s=r("./src/utils/maths.js"),o=r("./src/utils/core.js"),i=r("./src/env.js"),a=r("./src/utils/tensor.js"),l=r("?7992");async function u(z,q){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const G=await(await(0,n.getFile)(z)).arrayBuffer(),ee=new AudioContext({sampleRate:q});typeof q>"u"&&console.warn(`No sampling rate provided, using default of ${ee.sampleRate}Hz.`);const Y=await ee.decodeAudioData(G);let W;if(Y.numberOfChannels===2){const te=Math.sqrt(2),le=Y.getChannelData(0),oe=Y.getChannelData(1);W=new Float32Array(le.length);for(let U=0;U<Y.length;++U)W[U]=te*(le[U]+oe[U])/2}else W=Y.getChannelData(0);return W}function h(z,q){if(z<1)return new Float64Array;if(z===1)return new Float64Array([1]);const G=1-q,ee=2*Math.PI/(z-1),Y=new Float64Array(z);for(let W=0;W<z;++W)Y[W]=q-G*Math.cos(W*ee);return Y}function c(z){return h(z,.5)}function d(z){return h(z,.54)}const f={htk:z=>2595*Math.log10(1+z/700),kaldi:z=>1127*Math.log(1+z/700),slaney:(z,q=1e3,G=15,ee=27/Math.log(6.4))=>z>=q?G+Math.log(z/q)*ee:3*z/200};function p(z,q="htk"){const G=f[q];if(!G)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof z=="number"?G(z):z.map(ee=>G(ee))}const m={htk:z=>700*(10**(z/2595)-1),kaldi:z=>700*(Math.exp(z/1127)-1),slaney:(z,q=1e3,G=15,ee=Math.log(6.4)/27)=>z>=G?q*Math.exp(ee*(z-G)):200*z/3};function b(z,q="htk"){const G=m[q];if(!G)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof z=="number"?G(z):z.map(ee=>G(ee))}function g(z,q){const G=Float64Array.from({length:q.length-1},(te,le)=>q[le+1]-q[le]),ee=Array.from({length:z.length},()=>new Array(q.length));for(let te=0;te<z.length;++te){const le=ee[te];for(let oe=0;oe<q.length;++oe)le[oe]=q[oe]-z[te]}const Y=q.length-2,W=Array.from({length:Y},()=>new Array(z.length));for(let te=0;te<z.length;++te){const le=ee[te];for(let oe=0;oe<Y;++oe){const U=-le[oe]/G[oe],R=le[oe+2]/G[oe+1];W[oe][te]=Math.max(0,Math.min(U,R))}}return W}function _(z,q,G){const ee=(q-z)/(G-1);return Float64Array.from({length:G},(Y,W)=>z+ee*W)}function y(z,q,G,ee,Y,W=null,te="htk",le=!1){if(W!==null&&W!=="slaney")throw new Error('norm must be one of null or "slaney"');if(z<2)throw new Error(`Require num_frequency_bins: ${z} >= 2`);if(G>ee)throw new Error(`Require min_frequency: ${G} <= max_frequency: ${ee}`);const oe=p(G,te),U=p(ee,te),R=_(oe,U,q+2);let X=b(R,te),ce;if(le){const we=Y/((z-1)*2);ce=p(Float64Array.from({length:z},(De,Be)=>Be*we),te),X=R}else ce=_(0,Math.floor(Y/2),z);const ne=g(ce,X);if(W!==null&&W==="slaney")for(let we=0;we<q;++we){const De=ne[we],Be=2/(X[we+2]-X[we]);for(let $e=0;$e<z;++$e)De[$e]*=Be}return ne}function v(z,q,G){const ee=new z.constructor(z.length+q+G),Y=z.length-1;for(let W=0;W<z.length;++W)ee[q+W]=z[W];for(let W=1;W<=q;++W)ee[q-W]=z[(0,o.calculateReflectOffset)(W,Y)];for(let W=1;W<=G;++W)ee[Y+q+W]=z[(0,o.calculateReflectOffset)(Y-W,Y)];return ee}function M(z,q,G,ee,Y){if(G<=0)throw new Error("reference must be greater than zero");if(ee<=0)throw new Error("min_value must be greater than zero");G=Math.max(ee,G);const W=Math.log10(G);for(let te=0;te<z.length;++te)z[te]=q*Math.log10(Math.max(ee,z[te])-W);if(Y!==null){if(Y<=0)throw new Error("db_range must be greater than zero");const te=(0,s.max)(z)[0]-Y;for(let le=0;le<z.length;++le)z[le]=Math.max(z[le],te)}return z}function E(z,q=1,G=1e-5,ee=null){return M(z,20,q,G,ee)}function T(z,q=1,G=1e-10,ee=null){return M(z,10,q,G,ee)}async function S(z,q,G,ee,{fft_length:Y=null,power:W=1,center:te=!0,pad_mode:le="reflect",onesided:oe=!0,preemphasis:U=null,preemphasis_htk_flavor:R=!0,mel_filters:X=null,mel_floor:ce=1e-10,log_mel:ne=null,reference:we=1,min_value:De=1e-10,db_range:Be=null,remove_dc_offset:$e=null,min_num_frames:se=null,max_num_frames:F=null,do_pad:pe=!0,transpose:Ee=!1,mel_offset:Me=0}={}){const Pe=q.length;if(Y===null&&(Y=G),G>Y)throw Error(`frame_length (${G}) may not be larger than fft_length (${Y})`);if(Pe!==G)throw new Error(`Length of the window (${Pe}) must equal frame_length (${G})`);if(ee<=0)throw new Error("hop_length must be greater than zero");if(W===null&&X!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!R)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(te)switch(le){case"reflect":{const Ne=Math.floor((Y-1)/2)+1;z=v(z,Ne,Ne);break}case"constant":{const Ne=Math.floor(Y/2),qe=new z.constructor(z.length+2*Ne);qe.set(z,Ne),z=qe;break}default:throw new Error(`pad_mode="${le}" not implemented yet.`)}let ye=Math.floor(1+Math.floor((z.length-G)/ee));se!==null&&ye<se&&(ye=se);const ke=oe?Math.floor(Y/2)+1:Y;let be=ye,Oe=ye;F!==null&&(F>ye?pe&&(Oe=F):Oe=be=F);const je=new s.FFT(Y),Je=new Float64Array(Y),Te=new Float64Array(je.outputBufferSize),ot=new Float32Array(ke*Oe);for(let Ne=0;Ne<be;++Ne){const qe=Ne*ee,Mt=Math.min(z.length-qe,G);Mt!==G&&Je.fill(0,0,G);for(let bt=0;bt<Mt;++bt)Je[bt]=z[qe+bt];if($e){let bt=0;for(let yt=0;yt<Mt;++yt)bt+=Je[yt];const jt=bt/Mt;for(let yt=0;yt<Mt;++yt)Je[yt]-=jt}if(U!==null){for(let bt=Mt-1;bt>=1;--bt)Je[bt]-=U*Je[bt-1];Je[0]*=1-U}for(let bt=0;bt<q.length;++bt)Je[bt]*=q[bt];je.realTransform(Te,Je);for(let bt=0;bt<ke;++bt){const jt=bt<<1;ot[bt*Oe+Ne]=Te[jt]**2+Te[jt+1]**2}}if(W!==null&&W!==2){const Ne=W/2;for(let qe=0;qe<ot.length;++qe)ot[qe]**=Ne}const Ze=X.length;let it=await(0,a.matmul)(new a.Tensor("float32",X.flat(),[Ze,ke]),new a.Tensor("float32",ot,[ke,Oe]));Ee&&(it=it.transpose(1,0));const nt=it.data;for(let Ne=0;Ne<nt.length;++Ne)nt[Ne]=Me+Math.max(ce,nt[Ne]);if(W!==null&&ne!==null){const Ne=Math.min(nt.length,be*Ze);switch(ne){case"log":for(let qe=0;qe<Ne;++qe)nt[qe]=Math.log(nt[qe]);break;case"log10":for(let qe=0;qe<Ne;++qe)nt[qe]=Math.log10(nt[qe]);break;case"dB":if(W===1)E(nt,we,De,Be);else if(W===2)T(nt,we,De,Be);else throw new Error(`Cannot use log_mel option '${ne}' with power ${W}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${ne}'`)}}return it}function A(z,q,{periodic:G=!0,frame_length:ee=null,center:Y=!0}={}){const W=G?z+1:z;let te;switch(q){case"boxcar":te=new Float64Array(W).fill(1);break;case"hann":case"hann_window":te=c(W);break;case"hamming":te=d(W);break;case"povey":te=c(W).map(le=>Math.pow(le,.85));break;default:throw new Error(`Unknown window type ${q}.`)}if(G&&(te=te.subarray(0,z)),ee===null)return te;if(z>ee)throw new Error(`Length of the window (${z}) may not be larger than frame_length (${ee})`);return te}function I(z,q){let G=44;const ee=new ArrayBuffer(G+z.length*4),Y=new DataView(ee);V(Y,0,"RIFF"),Y.setUint32(4,36+z.length*4,!0),V(Y,8,"WAVE"),V(Y,12,"fmt "),Y.setUint32(16,16,!0),Y.setUint16(20,3,!0),Y.setUint16(22,1,!0),Y.setUint32(24,q,!0),Y.setUint32(28,q*4,!0),Y.setUint16(32,4,!0),Y.setUint16(34,32,!0),V(Y,36,"data"),Y.setUint32(40,z.length*4,!0);for(let W=0;W<z.length;++W,G+=4)Y.setFloat32(G,z[W],!0);return ee}function V(z,q,G){for(let ee=0;ee<G.length;++ee)z.setUint8(q+ee,G.charCodeAt(ee))}class N{constructor(q,G){this.audio=q,this.sampling_rate=G}toWav(){return I(this.audio,this.sampling_rate)}toBlob(){const q=this.toWav();return new Blob([q],{type:"audio/wav"})}async save(q){let G;if(i.apis.IS_BROWSER_ENV){if(i.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");G=o.saveBlob}else if(i.apis.IS_FS_AVAILABLE)G=async(ee,Y)=>{let W=await Y.arrayBuffer();l.writeFileSync(ee,Buffer.from(W))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await G(q,this.toBlob())}}},"./src/utils/constants.js":(e,t,r)=>{r.r(t),r.d(t,{CHAT_TEMPLATE_NAME:()=>l,CONFIG_NAME:()=>s,FEATURE_EXTRACTOR_NAME:()=>o,GENERATION_CONFIG_NAME:()=>u,GITHUB_ISSUE_URL:()=>n,IMAGE_PROCESSOR_NAME:()=>i,PROCESSOR_NAME:()=>a});const n="https://github.com/huggingface/transformers.js/issues/new/choose",s="config.json",o="preprocessor_config.json",i=o,a="processor_config.json",l="chat_template.jinja",u="generation_config.json"},"./src/utils/core.js":(e,t,r)=>{r.r(t),r.d(t,{calculateDimensions:()=>u,calculateReflectOffset:()=>f,count:()=>g,dispatchCallback:()=>n,escapeRegExp:()=>o,isIntegralNumber:()=>a,isNullishDimension:()=>l,isTypedArray:()=>i,len:()=>b,mergeArrays:()=>c,pick:()=>m,pop:()=>h,product:()=>d,reverseDictionary:()=>s,saveBlob:()=>p});function n(_,y){_&&_(y)}function s(_){return Object.fromEntries(Object.entries(_).map(([y,v])=>[v,y]))}function o(_){return _.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(_){var y,v,M;return((M=(v=(y=_==null?void 0:_.prototype)==null?void 0:y.__proto__)==null?void 0:v.constructor)==null?void 0:M.name)==="TypedArray"}function a(_){return Number.isInteger(_)||typeof _=="bigint"}function l(_){return _==null||_===-1}function u(_){const y=[];let v=_;for(;Array.isArray(v);)y.push(v.length),v=v[0];return y}function h(_,y,v=void 0){const M=_[y];if(M!==void 0)return delete _[y],M;if(v===void 0)throw Error(`Key ${y} does not exist in object.`);return v}function c(..._){return Array.prototype.concat.apply([],_)}function d(..._){return _.reduce((y,v)=>y.flatMap(M=>v.map(E=>[M,E])))}function f(_,y){return Math.abs((_+y)%(2*y)-y)}function p(_,y){const v=URL.createObjectURL(y),M=document.createElement("a");M.href=v,M.download=_,M.click(),M.remove(),URL.revokeObjectURL(v)}function m(_,y){return Object.assign({},...y.map(v=>{if(_[v]!==void 0)return{[v]:_[v]}}))}function b(_){let y=0;for(const v of _)++y;return y}function g(_,y){let v=0;for(const M of _)M===y&&++v;return v}},"./src/utils/data-structures.js":(e,t,r)=>{r.r(t),r.d(t,{CharTrie:()=>s,DictionarySplitter:()=>l,LRUCache:()=>u,PriorityQueue:()=>n,TokenLattice:()=>i});class n{constructor(c=(f,p)=>f>p,d=1/0){this._heap=[],this._comparator=c,this._maxSize=d}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...c){return this.extend(c)}extend(c){for(const d of c)if(this.size<this._maxSize)this._heap.push(d),this._siftUp();else{const f=this._smallest();this._comparator(d,this._heap[f])&&(this._heap[f]=d,this._siftUpFrom(f))}return this.size}pop(){const c=this.peek(),d=this.size-1;return d>0&&this._swap(0,d),this._heap.pop(),this._siftDown(),c}replace(c){const d=this.peek();return this._heap[0]=c,this._siftDown(),d}_parent(c){return(c+1>>>1)-1}_left(c){return(c<<1)+1}_right(c){return c+1<<1}_greater(c,d){return this._comparator(this._heap[c],this._heap[d])}_swap(c,d){const f=this._heap[c];this._heap[c]=this._heap[d],this._heap[d]=f}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(c){for(;c>0&&this._greater(c,this._parent(c));)this._swap(c,this._parent(c)),c=this._parent(c)}_siftDown(){let c=0;for(;this._left(c)<this.size&&this._greater(this._left(c),c)||this._right(c)<this.size&&this._greater(this._right(c),c);){const d=this._right(c)<this.size&&this._greater(this._right(c),this._left(c))?this._right(c):this._left(c);this._swap(c,d),c=d}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class s{constructor(){this.root=o.default()}extend(c){for(const d of c)this.push(d)}push(c){let d=this.root;for(const f of c){let p=d.children.get(f);p===void 0&&(p=o.default(),d.children.set(f,p)),d=p}d.isLeaf=!0}*commonPrefixSearch(c){let d=this.root;if(d===void 0)return;let f="";for(const p of c){if(f+=p,d=d.children.get(p),d===void 0)return;d.isLeaf&&(yield f)}}}class o{constructor(c,d){this.isLeaf=c,this.children=d}static default(){return new o(!1,new Map)}}class i{constructor(c,d,f){this.chars=Array.from(c),this.len=this.chars.length,this.bosTokenId=d,this.eosTokenId=f,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const p=new a(this.bosTokenId,0,0,0,0),m=new a(this.eosTokenId,1,this.len,0,0);this.nodes.push(p.clone()),this.nodes.push(m.clone()),this.beginNodes[this.len].push(m),this.endNodes[0].push(p)}insert(c,d,f,p){const m=this.nodes.length,b=new a(p,m,c,d,f);this.beginNodes[c].push(b),this.endNodes[c+d].push(b),this.nodes.push(b)}viterbi(){const c=this.len;let d=0;for(;d<=c;){if(this.beginNodes[d].length==0)return[];for(let g of this.beginNodes[d]){g.prev=null;let _=0,y=null;for(let v of this.endNodes[d]){const M=v.backtraceScore+g.score;(y===null||M>_)&&(y=v.clone(),_=M)}if(y!==null)g.prev=y,g.backtraceScore=_;else return[]}++d}const f=[],m=this.beginNodes[c][0].prev;if(m===null)return[];let b=m.clone();for(;b.prev!==null;)f.push(b.clone()),b=b.clone().prev.clone();return f.reverse(),f}piece(c){return this.chars.slice(c.pos,c.pos+c.length).join("")}tokens(){return this.viterbi().map(d=>this.piece(d))}tokenIds(){return this.viterbi().map(d=>d.tokenId)}}class a{constructor(c,d,f,p,m){this.tokenId=c,this.nodeId=d,this.pos=f,this.length=p,this.score=m,this.prev=null,this.backtraceScore=0}clone(){const c=new a(this.tokenId,this.nodeId,this.pos,this.length,this.score);return c.prev=this.prev,c.backtraceScore=this.backtraceScore,c}}class l{constructor(c){this.trie=this._buildTrie(c)}_buildTrie(c){var f;const d=Object.create(null);for(const p of c){let m=d;for(let b=0;b<p.length;++b)m=m[f=p[b]]??(m[f]=Object.create(null));m.end=p}return d}split(c){const d=[],f=c.length;let p=0,m=0;for(;m<f;){let b=this.trie,g=null,_=m;for(;_<f&&(b=b[c[_]]);)b.end&&(g=b.end),++_;g?(m>p&&d.push(c.slice(p,m)),d.push(g),m+=g.length,p=m):++m}return p<f&&d.push(c.slice(p)),d}}class u{constructor(c){this.capacity=c,this.cache=new Map}get(c){if(!this.cache.has(c))return;const d=this.cache.get(c);return this.cache.delete(c),this.cache.set(c,d),d}put(c,d){this.cache.has(c)&&this.cache.delete(c),this.cache.set(c,d),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}},"./src/utils/devices.js":(e,t,r)=>{r.r(t),r.d(t,{DEVICE_TYPES:()=>n});const n=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})},"./src/utils/dtypes.js":(e,t,r)=>{r.r(t),r.d(t,{DATA_TYPES:()=>i,DEFAULT_DEVICE_DTYPE_MAPPING:()=>a,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>l,isWebGpuFp16Supported:()=>o});var n=r("./src/env.js"),s=r("./src/utils/devices.js");const o=function(){let u;return async function(){if(u===void 0)if(!n.apis.IS_WEBGPU_AVAILABLE)u=!1;else try{u=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{u=!1}return u}}(),i=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),a=Object.freeze({[s.DEVICE_TYPES.wasm]:i.q8}),l=Object.freeze({[i.fp32]:"",[i.fp16]:"_fp16",[i.int8]:"_int8",[i.uint8]:"_uint8",[i.q8]:"_quantized",[i.q4]:"_q4",[i.q4f16]:"_q4f16",[i.bnb4]:"_bnb4"})},"./src/utils/generic.js":(e,t,r)=>{r.r(t),r.d(t,{Callable:()=>n});const n=class{constructor(){let s=function(...o){return s._call(...o)};return Object.setPrototypeOf(s,new.target.prototype)}_call(...s){throw Error("Must implement _call method in subclass")}}},"./src/utils/hub.js":(e,t,r)=>{r.r(t),r.d(t,{MAX_EXTERNAL_DATA_CHUNKS:()=>a,getFile:()=>f,getModelFile:()=>_,getModelJSON:()=>v,getModelText:()=>y});var n=r("?7992"),s=r("?5af5"),o=r("./src/env.js"),i=r("./src/utils/core.js");const a=100,l={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class u{constructor(S){if(this.filePath=S,this.headers=new Headers,this.exists=n.existsSync(S),this.exists){this.status=200,this.statusText="OK";let A=n.statSync(S);this.headers.set("content-length",A.size.toString()),this.updateContentType();const I=n.createReadStream(S);this.body=new ReadableStream({start(V){I.on("data",N=>V.enqueue(N)),I.on("end",()=>V.close()),I.on("error",N=>V.error(N))},cancel(){I.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const S=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",l[S]??"application/octet-stream")}clone(){let S=new u(this.filePath);return S.exists=this.exists,S.status=this.status,S.statusText=this.statusText,S.headers=new Headers(this.headers),S}async arrayBuffer(){return(await n.promises.readFile(this.filePath)).buffer}async blob(){const S=await n.promises.readFile(this.filePath);return new Blob([S],{type:this.headers.get("content-type")})}async text(){return await n.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function h(T,S=null,A=null){let I;try{I=new URL(T)}catch{return!1}return!(S&&!S.includes(I.protocol)||A&&!A.includes(I.hostname))}const c=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function d(T){return!(!c.test(T)||T.includes("..")||T.includes("--")||T.endsWith(".git")||T.endsWith(".ipynb"))}async function f(T){var S;if(o.env.useFS&&!h(T,["http:","https:","blob:"]))return new u(T instanceof URL?T.protocol==="file:"?T.pathname:T.toString():T);if(typeof process<"u"&&((S=process==null?void 0:process.release)==null?void 0:S.name)==="node"){const A=!!(Zo!=null&&Zo.TESTING_REMOTELY),I=o.env.version,V=new Headers;if(V.set("User-Agent",`transformers.js/${I}; is_ci/${A};`),h(T,["http:","https:"],["huggingface.co","hf.co"])){const z=(Zo==null?void 0:Zo.HF_TOKEN)??(Zo==null?void 0:Zo.HF_ACCESS_TOKEN);z&&V.set("Authorization",`Bearer ${z}`)}return fetch(T,{headers:V})}else return fetch(T)}const p={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function m(T,S,A){if(!A)return null;const I=p[T]??`Error (${T}) occurred while trying to load file`;throw Error(`${I}: "${S}".`)}class b{constructor(S){this.path=S}async match(S){let A=s.join(this.path,S),I=new u(A);if(I.exists)return I}async put(S,A,I=void 0){let V=s.join(this.path,S);try{const N=A.headers.get("Content-Length"),z=parseInt(N??"0");let q=0;await n.promises.mkdir(s.dirname(V),{recursive:!0});const G=n.createWriteStream(V),ee=A.body.getReader();for(;;){const{done:Y,value:W}=await ee.read();if(Y)break;await new Promise((le,oe)=>{G.write(W,U=>{if(U){oe(U);return}le()})}),q+=W.length;const te=z?q/z*100:0;I==null||I({progress:te,loaded:q,total:z})}G.close()}catch(N){try{await n.promises.unlink(V)}catch{}throw N}}}async function g(T,...S){for(let A of S)try{let I=await T.match(A);if(I)return I}catch{continue}}async function _(T,S,A=!0,I={},V=!1){if(!o.env.allowLocalModels){if(I.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!o.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,i.dispatchCallback)(I.progress_callback,{status:"initiate",name:T,file:S});let N;if(!N&&o.env.useCustomCache){if(!o.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!o.env.customCache.match||!o.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");N=o.env.customCache}if(!N&&o.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{N=await caches.open("transformers-cache")}catch(ce){console.warn("An error occurred while opening the browser cache:",ce)}}if(!N&&o.env.useFSCache){if(!o.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");N=new b(I.cache_dir??o.env.cacheDir)}const z=I.revision??"main",q=E(T,S),G=d(T),ee=G?E(o.env.localModelPath,q):q,Y=E(o.env.remoteHost,o.env.remotePathTemplate.replaceAll("{model}",T).replaceAll("{revision}",encodeURIComponent(z)),S);let W;const te=N instanceof b?z==="main"?q:E(T,z,S):Y;let le=!1,oe;N&&(oe=await g(N,ee,te));const U=oe!==void 0;if(oe===void 0){if(o.env.allowLocalModels)if(h(q,["http:","https:"])){if(I.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${q}.`);if(!o.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${q}.`)}else try{oe=await f(ee),W=ee}catch(ne){console.warn(`Unable to load from local path "${ee}": "${ne}"`)}if(oe===void 0||oe.status===404){if(I.local_files_only||!o.env.allowRemoteModels){if(A)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${ee}".`);return null}if(!G)throw Error(`Local file missing at "${ee}" and download aborted due to invalid model ID "${T}".`);if(oe=await f(Y),oe.status!==200)return m(oe.status,Y,A);W=te}le=N&&typeof Response<"u"&&oe instanceof Response&&oe.status===200}(0,i.dispatchCallback)(I.progress_callback,{status:"download",name:T,file:S});let R;if(!(o.apis.IS_NODE_ENV&&V)){let ce;I.progress_callback?U&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(ce=new Uint8Array(await oe.arrayBuffer()),(0,i.dispatchCallback)(I.progress_callback,{status:"progress",name:T,file:S,progress:100,loaded:ce.length,total:ce.length})):ce=await M(oe,ne=>{(0,i.dispatchCallback)(I.progress_callback,{status:"progress",name:T,file:S,...ne})}):ce=new Uint8Array(await oe.arrayBuffer()),R=ce}if(le&&W&&await N.match(W)===void 0)if(R)await N.put(W,new Response(R,{headers:oe.headers})).catch(ce=>{console.warn(`Unable to add response to browser cache: ${ce}.`)});else{const ce=I.progress_callback?ne=>(0,i.dispatchCallback)(I.progress_callback,{status:"progress",name:T,file:S,...ne}):void 0;await N.put(W,oe,ce)}if((0,i.dispatchCallback)(I.progress_callback,{status:"done",name:T,file:S}),R){if(!o.apis.IS_NODE_ENV&&V)throw new Error("Cannot return path in a browser environment.");return R}if(oe instanceof u)return oe.filePath;const X=await(N==null?void 0:N.match(W));if(X instanceof u)return X.filePath;if(X instanceof Response)return new Uint8Array(await X.arrayBuffer());if(typeof X=="string")return X;throw new Error("Unable to get model file path or buffer.")}async function y(T,S,A=!0,I={}){const V=await _(T,S,A,I,!1);return V===null?null:new TextDecoder("utf-8").decode(V)}async function v(T,S,A=!0,I={}){const V=await y(T,S,A,I);return V===null?{}:JSON.parse(V)}async function M(T,S){const A=T.headers.get("Content-Length");A===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let I=parseInt(A??"0"),V=new Uint8Array(I),N=0;const z=T.body.getReader();async function q(){const{done:G,value:ee}=await z.read();if(G)return;const Y=N+ee.length;if(Y>I){I=Y;const te=new Uint8Array(I);te.set(V),V=te}V.set(ee,N),N=Y;const W=N/I*100;return S({progress:W,loaded:N,total:I}),q()}return await q(),V}function E(...T){return T=T.map((S,A)=>(A&&(S=S.replace(new RegExp("^/"),"")),A!==T.length-1&&(S=S.replace(new RegExp("/$"),"")),S)),T.join("/")}},"./src/utils/image.js":(e,t,r)=>{r.r(t),r.d(t,{RawImage:()=>p,load_image:()=>m});var n=r("./src/utils/core.js"),s=r("./src/utils/hub.js"),o=r("./src/env.js"),i=r("./src/utils/tensor.js"),a=r("?2b25");let l,u,h;const c=o.apis.IS_BROWSER_ENV||o.apis.IS_WEBWORKER_ENV;if(c)l=(b,g)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(b,g)},h=self.createImageBitmap,u=self.ImageData;else if(a)h=async b=>{const _=(await b.metadata()).channels,{data:y,info:v}=await b.rotate().raw().toBuffer({resolveWithObject:!0}),M=new p(new Uint8ClampedArray(y),v.width,v.height,v.channels);return _!==void 0&&_!==v.channels&&M.convert(_),M};else throw new Error("Unable to load image processing library.");const d={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},f=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class p{constructor(g,_,y,v){this.data=g,this.width=_,this.height=y,this.channels=v}get size(){return[this.width,this.height]}static async read(g){if(g instanceof p)return g;if(typeof g=="string"||g instanceof URL)return await this.fromURL(g);if(g instanceof Blob)return await this.fromBlob(g);if(typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&g instanceof OffscreenCanvas)return this.fromCanvas(g);throw new Error(`Unsupported input type: ${typeof g}`)}static fromCanvas(g){if(!c)throw new Error("fromCanvas() is only supported in browser environments.");const y=g.getContext("2d").getImageData(0,0,g.width,g.height).data;return new p(y,g.width,g.height,4)}static async fromURL(g){const _=await(0,s.getFile)(g);if(_.status!==200)throw new Error(`Unable to read image from "${g}" (${_.status} ${_.statusText})`);const y=await _.blob();return this.fromBlob(y)}static async fromBlob(g){if(c){const _=await h(g),y=l(_.width,_.height).getContext("2d");return y.drawImage(_,0,0),new this(y.getImageData(0,0,_.width,_.height).data,_.width,_.height,4)}else{const _=a(await g.arrayBuffer());return await h(_)}}static fromTensor(g,_="CHW"){if(g.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${g.dims.length} dimensions.`);if(_==="CHW")g=g.transpose(1,2,0);else if(_!=="HWC")throw new Error(`Unsupported channel format: ${_}`);if(!(g.data instanceof Uint8ClampedArray||g.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${g.type}`);switch(g.dims[2]){case 1:case 2:case 3:case 4:return new p(g.data,g.dims[1],g.dims[0],g.dims[2]);default:throw new Error(`Unsupported number of channels: ${g.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const g=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let _=0,y=0;_<this.data.length;_+=this.channels){const v=this.data[_],M=this.data[_+1],E=this.data[_+2];g[y++]=Math.round(.2989*v+.587*M+.114*E)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const g=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let _=0,y=0;_<this.data.length;++_)g[y++]=this.data[_],g[y++]=this.data[_],g[y++]=this.data[_];break;case 4:for(let _=0,y=0;_<this.data.length;_+=4)g[y++]=this.data[_],g[y++]=this.data[_+1],g[y++]=this.data[_+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const g=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let _=0,y=0;_<this.data.length;++_)g[y++]=this.data[_],g[y++]=this.data[_],g[y++]=this.data[_],g[y++]=255;break;case 3:for(let _=0,y=0;_<this.data.length;_+=3)g[y++]=this.data[_],g[y++]=this.data[_+1],g[y++]=this.data[_+2],g[y++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(g,this.width,this.height,4)}putAlpha(g){if(g.width!==this.width||g.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${g.width}x${g.height}`);if(g.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${g.channels}`);const _=this.data,y=g.data,v=this.width*this.height;if(this.channels===3){const M=new Uint8ClampedArray(v*4);for(let E=0,T=0,S=0;E<v;++E)M[S++]=_[T++],M[S++]=_[T++],M[S++]=_[T++],M[S++]=y[E];return this._update(M,this.width,this.height,4)}else if(this.channels===4){for(let M=0;M<v;++M)_[4*M+3]=y[M];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(g,_,{resample:y=2}={}){if(this.width===g&&this.height===_)return this;let v=d[y]??y;const M=(0,n.isNullishDimension)(g),E=(0,n.isNullishDimension)(_);if(M&&E)return this;if(M?g=_/this.height*this.width:E&&(_=g/this.width*this.height),c){const T=this.channels,S=this.toCanvas(),A=l(g,_).getContext("2d");return A.drawImage(S,0,0,g,_),new p(A.getImageData(0,0,g,_).data,g,_,4).convert(T)}else{let T=this.toSharp();switch(v){case"box":case"hamming":(v==="box"||v==="hamming")&&(console.warn(`Resampling method ${v} is not yet supported. Using bilinear instead.`),v="bilinear");case"nearest":case"bilinear":case"bicubic":T=T.affine([g/this.width,0,0,_/this.height],{interpolator:v});break;case"lanczos":T=T.resize({width:g,height:_,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${v} is not supported.`)}return await h(T)}}async pad([g,_,y,v]){if(g=Math.max(g,0),_=Math.max(_,0),y=Math.max(y,0),v=Math.max(v,0),g===0&&_===0&&y===0&&v===0)return this;if(c){const M=this.channels,E=this.toCanvas(),T=this.width+g+_,S=this.height+y+v,A=l(T,S).getContext("2d");return A.drawImage(E,0,0,this.width,this.height,g,y,this.width,this.height),new p(A.getImageData(0,0,T,S).data,T,S,4).convert(M)}else{const M=this.toSharp().extend({left:g,right:_,top:y,bottom:v});return await h(M)}}async crop([g,_,y,v]){if(g=Math.max(g,0),_=Math.max(_,0),y=Math.min(y,this.width-1),v=Math.min(v,this.height-1),g===0&&_===0&&y===this.width-1&&v===this.height-1)return this;const M=y-g+1,E=v-_+1;if(c){const T=this.channels,S=this.toCanvas(),A=l(M,E).getContext("2d");return A.drawImage(S,g,_,M,E,0,0,M,E),new p(A.getImageData(0,0,M,E).data,M,E,4).convert(T)}else{const T=this.toSharp().extract({left:g,top:_,width:M,height:E});return await h(T)}}async center_crop(g,_){if(this.width===g&&this.height===_)return this;const y=(this.width-g)/2,v=(this.height-_)/2;if(c){const M=this.channels,E=this.toCanvas(),T=l(g,_).getContext("2d");let S=0,A=0,I=0,V=0;return y>=0?S=y:I=-y,v>=0?A=v:V=-v,T.drawImage(E,S,A,g,_,I,V,g,_),new p(T.getImageData(0,0,g,_).data,g,_,4).convert(M)}else{let M=this.toSharp();if(y>=0&&v>=0)M=M.extract({left:Math.floor(y),top:Math.floor(v),width:g,height:_});else if(y<=0&&v<=0){const E=Math.floor(-v),T=Math.floor(-y);M=M.extend({top:E,left:T,right:g-this.width-T,bottom:_-this.height-E})}else{let E=[0,0],T=0;v<0?(E[0]=Math.floor(-v),E[1]=_-this.height-E[0]):T=Math.floor(v);let S=[0,0],A=0;y<0?(S[0]=Math.floor(-y),S[1]=g-this.width-S[0]):A=Math.floor(y),M=M.extend({top:E[0],bottom:E[1],left:S[0],right:S[1]}).extract({left:A,top:T,width:g,height:_})}return await h(M)}}async toBlob(g="image/png",_=1){if(!c)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:g,quality:_})}toTensor(g="CHW"){let _=new i.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(g!=="HWC")if(g==="CHW")_=_.permute(2,0,1);else throw new Error(`Unsupported channel format: ${g}`);return _}toCanvas(){if(!c)throw new Error("toCanvas() is only supported in browser environments.");const g=this.clone().rgba(),_=l(g.width,g.height),y=new u(g.data,g.width,g.height);return _.getContext("2d").putImageData(y,0,0),_}split(){const{data:g,width:_,height:y,channels:v}=this,M=g.constructor,E=g.length/v,T=Array.from({length:v},()=>new M(E));for(let S=0;S<E;++S){const A=v*S;for(let I=0;I<v;++I)T[I][S]=g[A+I]}return T.map(S=>new p(S,_,y,1))}_update(g,_,y,v=null){return this.data=g,this.width=_,this.height=y,v!==null&&(this.channels=v),this}clone(){return new p(this.data.slice(),this.width,this.height,this.channels)}convert(g){if(this.channels===g)return this;switch(g){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(g){if(c){if(o.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const _=g.split(".").pop().toLowerCase(),y=f.get(_)??"image/png",v=await this.toBlob(y);(0,n.saveBlob)(g,v)}else{if(o.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(g);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(c)throw new Error("toSharp() is only supported in server-side environments.");return a(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const m=p.read.bind(p)},"./src/utils/maths.js":(e,t,r)=>{r.r(t),r.d(t,{FFT:()=>m,bankers_round:()=>_,cos_sim:()=>l,dot:()=>a,dynamic_time_warping:()=>y,interpolate_data:()=>n,log_softmax:()=>i,magnitude:()=>u,max:()=>c,medianFilter:()=>b,min:()=>h,permute_data:()=>s,round:()=>g,softmax:()=>o});function n(v,[M,E,T],[S,A],I="bilinear",V=!1){const N=A/T,z=S/E,q=new v.constructor(S*A*M),G=E*T,ee=S*A;for(let Y=0;Y<S;++Y)for(let W=0;W<A;++W){const te=Y*A+W,le=(W+.5)/N-.5,oe=(Y+.5)/z-.5;let U=Math.floor(le),R=Math.floor(oe);const X=Math.min(U+1,T-1),ce=Math.min(R+1,E-1);U=Math.max(U,0),R=Math.max(R,0);const ne=le-U,we=oe-R,De=(1-ne)*(1-we),Be=ne*(1-we),$e=(1-ne)*we,se=ne*we,F=R*T,pe=ce*T,Ee=F+U,Me=F+X,Pe=pe+U,ye=pe+X;for(let ke=0;ke<M;++ke){const be=ke*G;q[ke*ee+te]=De*v[be+Ee]+Be*v[be+Me]+$e*v[be+Pe]+se*v[be+ye]}}return q}function s(v,M,E){const T=new Array(E.length),S=new Array(E.length);for(let V=E.length-1,N=1;V>=0;--V)S[V]=N,T[V]=M[E[V]],N*=T[V];const A=E.map((V,N)=>S[E.indexOf(N)]),I=new v.constructor(v.length);for(let V=0;V<v.length;++V){let N=0;for(let z=M.length-1,q=V;z>=0;--z)N+=q%M[z]*A[z],q=Math.floor(q/M[z]);I[N]=v[V]}return[I,T]}function o(v){const M=c(v)[0],E=v.map(A=>Math.exp(A-M)),T=E.reduce((A,I)=>A+I,0);return E.map(A=>A/T)}function i(v){const M=c(v)[0];let E=0;for(let A=0;A<v.length;++A)E+=Math.exp(v[A]-M);const T=Math.log(E);return v.map(A=>A-M-T)}function a(v,M){let E=0;for(let T=0;T<v.length;++T)E+=v[T]*M[T];return E}function l(v,M){const E=a(v,M),T=u(v),S=u(M);return E/(T*S)}function u(v){return Math.sqrt(v.reduce((M,E)=>M+E*E,0))}function h(v){if(v.length===0)throw Error("Array must not be empty");let M=v[0],E=0;for(let T=1;T<v.length;++T)v[T]<M&&(M=v[T],E=T);return[M,E]}function c(v){if(v.length===0)throw Error("Array must not be empty");let M=v[0],E=0;for(let T=1;T<v.length;++T)v[T]>M&&(M=v[T],E=T);return[M,E]}function d(v){return v>0&&(v&v-1)===0}class f{constructor(M){if(this.size=M|0,this.size<=1||!d(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=M<<1,this.table=new Float64Array(this.size*2);for(let T=0;T<this.table.length;T+=2){const S=Math.PI*T/this.size;this.table[T]=Math.cos(S),this.table[T+1]=-Math.sin(S)}let E=0;for(let T=1;this.size>T;T<<=1)++E;this._width=E%2===0?E-1:E,this._bitrev=new Int32Array(1<<this._width);for(let T=0;T<this._bitrev.length;++T){this._bitrev[T]=0;for(let S=0;S<this._width;S+=2){const A=this._width-S-2;this._bitrev[T]|=(T>>>S&3)<<A}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(M,E){const T=E||new Array(M.length>>>1);for(let S=0;S<M.length;S+=2)T[S>>>1]=M[S];return T}toComplexArray(M,E){const T=E||this.createComplexArray();for(let S=0;S<T.length;S+=2)T[S]=M[S>>>1],T[S+1]=0;return T}transform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._transform4(M,E,1)}realTransform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._realTransform4(M,E,1)}inverseTransform(M,E){if(M===E)throw new Error("Input and output buffers must be different");this._transform4(M,E,-1);for(let T=0;T<M.length;++T)M[T]/=this.size}_transform4(M,E,T){const S=this._csize;let I=1<<this._width,V=S/I<<1,N,z;const q=this._bitrev;if(V===4)for(N=0,z=0;N<S;N+=V,++z){const ee=q[z];this._singleTransform2(E,M,N,ee,I)}else for(N=0,z=0;N<S;N+=V,++z){const ee=q[z];this._singleTransform4(E,M,N,ee,I,T)}const G=this.table;for(I>>=2;I>=2;I>>=2){V=S/I<<1;const ee=V>>>2;for(N=0;N<S;N+=V){const Y=N+ee-1;for(let W=N,te=0;W<Y;W+=2,te+=I){const le=W,oe=le+ee,U=oe+ee,R=U+ee,X=M[le],ce=M[le+1],ne=M[oe],we=M[oe+1],De=M[U],Be=M[U+1],$e=M[R],se=M[R+1],F=G[te],pe=T*G[te+1],Ee=ne*F-we*pe,Me=ne*pe+we*F,Pe=G[2*te],ye=T*G[2*te+1],ke=De*Pe-Be*ye,be=De*ye+Be*Pe,Oe=G[3*te],je=T*G[3*te+1],Je=$e*Oe-se*je,Te=$e*je+se*Oe,ot=X+ke,Ze=ce+be,it=X-ke,nt=ce-be,Ne=Ee+Je,qe=Me+Te,Mt=T*(Ee-Je),bt=T*(Me-Te);M[le]=ot+Ne,M[le+1]=Ze+qe,M[oe]=it+bt,M[oe+1]=nt-Mt,M[U]=ot-Ne,M[U+1]=Ze-qe,M[R]=it-bt,M[R+1]=nt+Mt}}}}_singleTransform2(M,E,T,S,A){const I=M[S],V=M[S+1],N=M[S+A],z=M[S+A+1];E[T]=I+N,E[T+1]=V+z,E[T+2]=I-N,E[T+3]=V-z}_singleTransform4(M,E,T,S,A,I){const V=A*2,N=A*3,z=M[S],q=M[S+1],G=M[S+A],ee=M[S+A+1],Y=M[S+V],W=M[S+V+1],te=M[S+N],le=M[S+N+1],oe=z+Y,U=q+W,R=z-Y,X=q-W,ce=G+te,ne=ee+le,we=I*(G-te),De=I*(ee-le);E[T]=oe+ce,E[T+1]=U+ne,E[T+2]=R+De,E[T+3]=X-we,E[T+4]=oe-ce,E[T+5]=U-ne,E[T+6]=R-De,E[T+7]=X+we}_realTransform4(M,E,T){const S=this._csize;let I=1<<this._width,V=S/I<<1,N,z;const q=this._bitrev;if(V===4)for(N=0,z=0;N<S;N+=V,++z){const Y=q[z];this._singleRealTransform2(E,M,N,Y>>>1,I>>>1)}else for(N=0,z=0;N<S;N+=V,++z){const Y=q[z];this._singleRealTransform4(E,M,N,Y>>>1,I>>>1,T)}const G=this.table;for(I>>=2;I>=2;I>>=2){V=S/I<<1;const Y=V>>>1,W=Y>>>1,te=W>>>1;for(N=0;N<S;N+=V)for(let le=0,oe=0;le<=te;le+=2,oe+=I){const U=N+le,R=U+W,X=R+W,ce=X+W,ne=M[U],we=M[U+1],De=M[R],Be=M[R+1],$e=M[X],se=M[X+1],F=M[ce],pe=M[ce+1],Ee=ne,Me=we,Pe=G[oe],ye=T*G[oe+1],ke=De*Pe-Be*ye,be=De*ye+Be*Pe,Oe=G[2*oe],je=T*G[2*oe+1],Je=$e*Oe-se*je,Te=$e*je+se*Oe,ot=G[3*oe],Ze=T*G[3*oe+1],it=F*ot-pe*Ze,nt=F*Ze+pe*ot,Ne=Ee+Je,qe=Me+Te,Mt=Ee-Je,bt=Me-Te,jt=ke+it,yt=be+nt,pr=T*(ke-it),Hr=T*(be-nt);if(M[U]=Ne+jt,M[U+1]=qe+yt,M[R]=Mt+Hr,M[R+1]=bt-pr,le===0){M[X]=Ne-jt,M[X+1]=qe-yt;continue}if(le===te)continue;const Rr=N+W-le,wn=N+Y-le;M[Rr]=Mt-T*Hr,M[Rr+1]=-bt-T*pr,M[wn]=Ne-T*jt,M[wn+1]=-qe+T*yt}}const ee=S>>>1;for(let Y=2;Y<ee;Y+=2)M[S-Y]=M[Y],M[S-Y+1]=-M[Y+1]}_singleRealTransform2(M,E,T,S,A){const I=M[S],V=M[S+A];E[T]=I+V,E[T+1]=0,E[T+2]=I-V,E[T+3]=0}_singleRealTransform4(M,E,T,S,A,I){const V=A*2,N=A*3,z=M[S],q=M[S+A],G=M[S+V],ee=M[S+N],Y=z+G,W=z-G,te=q+ee,le=I*(q-ee);E[T]=Y+te,E[T+1]=0,E[T+2]=W,E[T+3]=-le,E[T+4]=Y-te,E[T+5]=0,E[T+6]=W,E[T+7]=le}}class p{constructor(M){const E=2*(M-1),T=2*(2*M-1),S=2**Math.ceil(Math.log2(T));this.bufferSize=S,this._a=E;const A=new Float64Array(T),I=new Float64Array(S);this._chirpBuffer=new Float64Array(S),this._buffer1=new Float64Array(S),this._buffer2=new Float64Array(S),this._outBuffer1=new Float64Array(S),this._outBuffer2=new Float64Array(S);const V=-2*Math.PI/M,N=Math.cos(V),z=Math.sin(V);for(let q=0;q<T>>1;++q){const G=(q+1-M)**2/2,ee=Math.sqrt(N**2+z**2)**G,Y=G*Math.atan2(z,N),W=2*q;A[W]=ee*Math.cos(Y),A[W+1]=ee*Math.sin(Y),I[W]=A[W],I[W+1]=-A[W+1]}this._slicedChirpBuffer=A.subarray(E,T),this._f=new f(S>>1),this._f.transform(this._chirpBuffer,I)}_transform(M,E,T){const S=this._buffer1,A=this._buffer2,I=this._outBuffer1,V=this._outBuffer2,N=this._chirpBuffer,z=this._slicedChirpBuffer,q=this._a;if(T)for(let G=0;G<z.length;G+=2){const ee=G+1,Y=G>>1,W=E[Y];S[G]=W*z[G],S[ee]=W*z[ee]}else for(let G=0;G<z.length;G+=2){const ee=G+1;S[G]=E[G]*z[G]-E[ee]*z[ee],S[ee]=E[G]*z[ee]+E[ee]*z[G]}this._f.transform(I,S);for(let G=0;G<N.length;G+=2){const ee=G+1;A[G]=I[G]*N[G]-I[ee]*N[ee],A[ee]=I[G]*N[ee]+I[ee]*N[G]}this._f.inverseTransform(V,A);for(let G=0;G<V.length;G+=2){const ee=V[G+q],Y=V[G+q+1],W=z[G],te=z[G+1];M[G]=ee*W-Y*te,M[G+1]=ee*te+Y*W}}transform(M,E){this._transform(M,E,!1)}realTransform(M,E){this._transform(M,E,!0)}}class m{constructor(M){this.fft_length=M,this.isPowerOfTwo=d(M),this.isPowerOfTwo?(this.fft=new f(M),this.outputBufferSize=2*M):(this.fft=new p(M),this.outputBufferSize=this.fft.bufferSize)}realTransform(M,E){this.fft.realTransform(M,E)}transform(M,E){this.fft.transform(M,E)}}function b(v,M){if(M%2===0||M<=0)throw new Error("Window size must be a positive odd number");const E=new v.constructor(v.length),T=new v.constructor(M),S=Math.floor(M/2);for(let A=0;A<v.length;++A){let I=0;for(let V=-S;V<=S;++V){let N=A+V;N<0?N=Math.abs(N):N>=v.length&&(N=2*(v.length-1)-N),T[I++]=v[N]}T.sort(),E[A]=T[S]}return E}function g(v,M){const E=Math.pow(10,M);return Math.round(v*E)/E}function _(v){const M=Math.round(v);return Math.abs(v)%1===.5?M%2===0?M:M-1:M}function y(v){const M=v.length,E=v[0].length,T=[M+1,E+1],S=Array.from({length:T[0]},()=>Array(T[1]).fill(1/0));S[0][0]=0;const A=Array.from({length:T[0]},()=>Array(T[1]).fill(-1));for(let q=1;q<T[1];++q)for(let G=1;G<T[0];++G){const ee=S[G-1][q-1],Y=S[G-1][q],W=S[G][q-1];let te,le;ee<Y&&ee<W?(te=ee,le=0):Y<ee&&Y<W?(te=Y,le=1):(te=W,le=2),S[G][q]=v[G-1][q-1]+te,A[G][q]=le}for(let q=0;q<T[1];++q)A[0][q]=2;for(let q=0;q<T[0];++q)A[q][0]=1;let I=M,V=E,N=[],z=[];for(;I>0||V>0;)switch(N.push(I-1),z.push(V-1),A[I][V]){case 0:--I,--V;break;case 1:--I;break;case 2:--V;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${I}, ${V}]. Please file a bug report.`)}return N.reverse(),z.reverse(),[N,z]}},"./src/utils/tensor.js":(e,t,r)=>{r.r(t),r.d(t,{DataTypeMap:()=>i,Tensor:()=>a,cat:()=>E,full:()=>z,full_like:()=>q,interpolate:()=>h,interpolate_4d:()=>c,layer_norm:()=>_,matmul:()=>d,mean:()=>I,mean_pooling:()=>g,ones:()=>G,ones_like:()=>ee,permute:()=>u,quantize_embeddings:()=>oe,rand:()=>te,randn:()=>le,rfft:()=>f,slice:()=>b,stack:()=>T,std_mean:()=>A,topk:()=>p,zeros:()=>Y,zeros_like:()=>W});var n=r("./src/utils/maths.js"),s=r("./src/backends/onnx.js"),o=r("./src/ops/registry.js");const i=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class a{constructor(...R){ae(this,"ort_tensor");return(0,s.isONNXTensor)(R[0])?this.ort_tensor=R[0]:this.ort_tensor=new s.Tensor(R[0],R[1],R[2]),new Proxy(this,{get:(X,ce)=>{if(typeof ce=="string"){let ne=Number(ce);if(Number.isInteger(ne))return X._getitem(ne)}return X[ce]},set:(X,ce,ne)=>X[ce]=ne})}get dims(){return this.ort_tensor.dims}set dims(R){this.ort_tensor.dims=R}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[R,...X]=this.dims;if(X.length>0){const ce=X.reduce((ne,we)=>ne*we);for(let ne=0;ne<R;++ne)yield this._subarray(ne,ce,X)}else yield*this.data}_getitem(R){const[X,...ce]=this.dims;if(R=M(R,X),ce.length>0){const ne=ce.reduce((we,De)=>we*De);return this._subarray(R,ne,ce)}else return new a(this.type,[this.data[R]],ce)}indexOf(R){const X=this.data;for(let ce=0;ce<X.length;++ce)if(X[ce]==R)return ce;return-1}_subarray(R,X,ce){const ne=R*X,we=(R+1)*X,De="subarray"in this.data?this.data.subarray(ne,we):this.data.slice(ne,we);return new a(this.type,De,ce)}item(){const R=this.data;if(R.length!==1)throw new Error(`a Tensor with ${R.length} elements cannot be converted to Scalar`);return R[0]}tolist(){return l(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=1/(1+Math.exp(-R[X]));return this}map(R){return this.clone().map_(R)}map_(R){const X=this.data;for(let ce=0;ce<X.length;++ce)X[ce]=R(X[ce],ce,X);return this}mul(R){return this.clone().mul_(R)}mul_(R){const X=this.data;for(let ce=0;ce<X.length;++ce)X[ce]*=R;return this}div(R){return this.clone().div_(R)}div_(R){const X=this.data;for(let ce=0;ce<X.length;++ce)X[ce]/=R;return this}add(R){return this.clone().add_(R)}add_(R){const X=this.data;for(let ce=0;ce<X.length;++ce)X[ce]+=R;return this}sub(R){return this.clone().sub_(R)}sub_(R){const X=this.data;for(let ce=0;ce<X.length;++ce)X[ce]-=R;return this}clone(){return new a(this.type,this.data.slice(),this.dims.slice())}slice(...R){const X=[],ce=[];for(let F=0;F<this.dims.length;++F){let pe=R[F];if(pe==null)ce.push([0,this.dims[F]]),X.push(this.dims[F]);else if(typeof pe=="number")pe=M(pe,this.dims[F],F),ce.push([pe,pe+1]);else if(Array.isArray(pe)&&pe.length===2){let[Ee,Me]=pe;if(Ee=Ee===null?0:M(Ee,this.dims[F],F,!1),Me=Me===null?this.dims[F]:M(Me,this.dims[F],F,!1),Ee>Me)throw new Error(`Invalid slice: ${pe}`);const Pe=[Math.max(Ee,0),Math.min(Me,this.dims[F])];ce.push(Pe),X.push(Pe[1]-Pe[0])}else throw new Error(`Invalid slice: ${pe}`)}const ne=ce.map(([F,pe])=>pe-F),we=ne.reduce((F,pe)=>F*pe),De=this.data,Be=new De.constructor(we),$e=this.stride();let se=!0;for(let F=1;F<ne.length;++F)if(ce[F][0]!==0||ce[F][1]!==this.dims[F]){se=!1;break}if(se){const F=ce[0][0]*$e[0],pe=ce[0][1]*$e[0];if(ArrayBuffer.isView(De))Be.set(De.subarray(F,pe));else if(Array.isArray(De)){const Ee=De.slice(F,pe);for(let Me=0;Me<Ee.length;++Me)Be[Me]=Ee[Me]}else throw new Error("Unsupported data type for slicing")}else for(let F=0;F<we;++F){let pe=0;for(let Ee=ne.length-1,Me=F;Ee>=0;--Ee){const Pe=ne[Ee];pe+=(Me%Pe+ce[Ee][0])*$e[Ee],Me=Math.floor(Me/Pe)}Be[F]=De[pe]}return new a(this.type,Be,X)}permute(...R){return u(this,R)}transpose(...R){return this.permute(...R)}sum(R=null,X=!1){return this.norm(1,R,X)}norm(R="fro",X=null,ce=!1){if(R==="fro")R=2;else if(typeof R=="string")throw Error(`Unsupported norm: ${R}`);const ne=this.data,we=(se,F)=>se+F**R;if(X===null){const se=ne.reduce(we,0)**(1/R);return new a(this.type,[se],[])}const[De,Be,$e]=S(we,this,X,ce);if(R!==1)for(let se=0;se<Be.length;++se)Be[se]=Be[se]**(1/R);return new a(De,Be,$e)}normalize_(R=2,X=1){X=M(X,this.dims.length);const ce=this.norm(R,X,!0),ne=this.data,we=ce.data;for(let De=0;De<ne.length;++De){let Be=0;for(let $e=this.dims.length-1,se=De,F=1;$e>=0;--$e){const pe=this.dims[$e];if($e!==X){const Ee=se%pe;Be+=Ee*F,F*=this.dims[$e]}se=Math.floor(se/pe)}ne[De]/=we[Be]}return this}normalize(R=2,X=1){return this.clone().normalize_(R,X)}stride(){return V(this.dims)}squeeze(R=null){return new a(this.type,this.data,y(this.dims,R))}squeeze_(R=null){return this.dims=y(this.dims,R),this}unsqueeze(R=null){return new a(this.type,this.data,v(this.dims,R))}unsqueeze_(R=null){return this.dims=v(this.dims,R),this}flatten_(R=0,X=-1){X=(X+this.dims.length)%this.dims.length;let ce=this.dims.slice(0,R),ne=this.dims.slice(R,X+1),we=this.dims.slice(X+1);return this.dims=[...ce,ne.reduce((De,Be)=>De*Be,1),...we],this}flatten(R=0,X=-1){return this.clone().flatten_(R,X)}view(...R){let X=-1;for(let ne=0;ne<R.length;++ne)if(R[ne]===-1){if(X!==-1)throw new Error("Only one dimension can be inferred");X=ne}const ce=this.data;if(X!==-1){const ne=R.reduce((we,De,Be)=>Be!==X?we*De:we,1);R[X]=ce.length/ne}return new a(this.type,ce,R)}neg_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=-R[X];return this}neg(){return this.clone().neg_()}gt(R){const X=new Uint8Array(this.data.length),ce=this.data;for(let ne=0;ne<ce.length;++ne)X[ne]=ce[ne]>R?1:0;return new a("bool",X,this.dims)}lt(R){const X=new Uint8Array(this.data.length),ce=this.data;for(let ne=0;ne<ce.length;++ne)X[ne]=ce[ne]<R?1:0;return new a("bool",X,this.dims)}clamp_(R,X){const ce=this.data;for(let ne=0;ne<ce.length;++ne)ce[ne]=Math.min(Math.max(ce[ne],R),X);return this}clamp(R,X){return this.clone().clamp_(R,X)}round_(){const R=this.data;for(let X=0;X<R.length;++X)R[X]=Math.round(R[X]);return this}round(){return this.clone().round_()}mean(R=null,X=!1){return I(this,R,X)}min(R=null,X=!1){if(R===null){const De=(0,n.min)(this.data)[0];return new a(this.type,[De],[])}const[ce,ne,we]=S((De,Be)=>Math.min(De,Be),this,R,X,1/0);return new a(ce,ne,we)}max(R=null,X=!1){if(R===null){const De=(0,n.max)(this.data)[0];return new a(this.type,[De],[])}const[ce,ne,we]=S((De,Be)=>Math.max(De,Be),this,R,X,-1/0);return new a(ce,ne,we)}argmin(R=null,X=!1){if(R!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,n.min)(this.data)[1];return new a("int64",[BigInt(ce)],[])}argmax(R=null,X=!1){if(R!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,n.max)(this.data)[1];return new a("int64",[BigInt(ce)],[])}to(R){if(this.type===R)return this;if(!i.hasOwnProperty(R))throw new Error(`Unsupported type: ${R}`);let X;const ce=["int64","uint64"].includes(this.type),ne=["int64","uint64"].includes(R);return ce&&!ne?X=Number:!ce&&ne&&(["float16","float32","float64"].includes(this.type)?X=we=>BigInt(Math.floor(we)):X=BigInt),new a(R,i[R].from(this.data,X),this.dims)}}function l(U,R){const X=U.length,ce=R.reduce((we,De)=>we*De);if(X!==ce)throw Error(`cannot reshape array of size ${X} into shape (${R})`);let ne=U;for(let we=R.length-1;we>=0;we--)ne=ne.reduce((De,Be)=>{let $e=De[De.length-1];return $e.length<R[we]?$e.push(Be):De.push([Be]),De},[[]]);return ne[0]}function u(U,R){const[X,ce]=(0,n.permute_data)(U.data,U.dims,R);return new a(U.type,X,ce)}function h(U,[R,X],ce="bilinear",ne=!1){const we=U.dims.at(-3)??1,De=U.dims.at(-2),Be=U.dims.at(-1);let $e=(0,n.interpolate_data)(U.data,[we,De,Be],[R,X],ce,ne);return new a(U.type,$e,[we,R,X])}async function c(U,{size:R=null,mode:X="bilinear"}={}){if(U.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!R)throw new Error("`interpolate_4d` requires a `size` argument.");let ce;if(R.length===2)ce=[...U.dims.slice(0,2),...R];else if(R.length===3)ce=[U.dims[0],...R];else if(R.length===4)ce=R;else throw new Error("`size` must be of length 2, 3, or 4.");let ne;if(X==="nearest")ne=await o.TensorOpRegistry.nearest_interpolate_4d;else if(X==="bilinear")ne=await o.TensorOpRegistry.bilinear_interpolate_4d;else if(X==="bicubic")ne=await o.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${X}`);const we=new a("int64",new BigInt64Array(ce.map(BigInt)),[ce.length]);return await ne({x:U,s:we})}async function d(U,R){return await(await o.TensorOpRegistry.matmul)({a:U,b:R})}async function f(U,R){return await(await o.TensorOpRegistry.rfft)({x:U,a:R})}async function p(U,R){const X=await o.TensorOpRegistry.top_k;return R==null?R=U.dims.at(-1):R=Math.min(R,U.dims.at(-1)),await X({x:U,k:new a("int64",[BigInt(R)],[1])})}const m=U=>new a("int64",U,[U.length]);async function b(U,R,X,ce,ne){return await(await o.TensorOpRegistry.slice)({x:U,s:m(R),e:m(X),a:m(ce),t:m(ne??new Array(ce.length).fill(1))})}function g(U,R){const X=U.data,ce=R.data,ne=[U.dims[0],U.dims[2]],we=new X.constructor(ne[0]*ne[1]),[De,Be,$e]=U.dims;let se=0;for(let F=0;F<De;++F){const pe=F*$e*Be;for(let Ee=0;Ee<$e;++Ee){let Me=0,Pe=0;const ye=F*Be,ke=pe+Ee;for(let Oe=0;Oe<Be;++Oe){const je=Number(ce[ye+Oe]);Pe+=je,Me+=X[ke+Oe*$e]*je}const be=Me/Pe;we[se++]=be}}return new a(U.type,we,ne)}function _(U,R,{eps:X=1e-5}={}){if(U.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[ce,ne]=U.dims;if(R.length!==1&&R[0]!==ne)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[we,De]=A(U,1,0,!0),Be=we.data,$e=De.data,se=U.data,F=new se.constructor(se.length);for(let pe=0;pe<ce;++pe){const Ee=pe*ne;for(let Me=0;Me<ne;++Me){const Pe=Ee+Me;F[Pe]=(se[Pe]-$e[pe])/(Be[pe]+X)}}return new a(U.type,F,U.dims)}function y(U,R){return U=U.slice(),R===null?U=U.filter(X=>X!==1):typeof R=="number"?U[R]===1&&U.splice(R,1):Array.isArray(R)&&(U=U.filter((X,ce)=>X!==1||!R.includes(ce))),U}function v(U,R){return R=M(R,U.length+1),U=U.slice(),U.splice(R,0,1),U}function M(U,R,X=null,ce=!0){if(U<-R||U>=R){if(ce)throw new Error(`IndexError: index ${U} is out of bounds for dimension${X===null?"":" "+X} with size ${R}`);return U<-R?0:R}return U<0&&(U=(U%R+R)%R),U}function E(U,R=0){R=M(R,U[0].dims.length);const X=U[0].dims.slice();X[R]=U.reduce((De,Be)=>De+Be.dims[R],0);const ce=X.reduce((De,Be)=>De*Be,1),ne=new U[0].data.constructor(ce),we=U[0].type;if(R===0){let De=0;for(const Be of U){const $e=Be.data;ne.set($e,De),De+=$e.length}}else{let De=0;for(let Be=0;Be<U.length;++Be){const{data:$e,dims:se}=U[Be];for(let F=0;F<$e.length;++F){let pe=0;for(let Ee=se.length-1,Me=F,Pe=1;Ee>=0;--Ee){const ye=se[Ee];let ke=Me%ye;Ee===R&&(ke+=De),pe+=ke*Pe,Pe*=X[Ee],Me=Math.floor(Me/ye)}ne[pe]=$e[F]}De+=se[R]}}return new a(we,ne,X)}function T(U,R=0){return E(U.map(X=>X.unsqueeze(R)),R)}function S(U,R,X=null,ce=!1,ne=null){const we=R.data,De=R.dims;X=M(X,De.length);const Be=De.slice();Be[X]=1;const $e=new we.constructor(we.length/De[X]);ne!==null&&$e.fill(ne);for(let se=0;se<we.length;++se){let F=0;for(let pe=De.length-1,Ee=se,Me=1;pe>=0;--pe){const Pe=De[pe];if(pe!==X){const ye=Ee%Pe;F+=ye*Me,Me*=Be[pe]}Ee=Math.floor(Ee/Pe)}$e[F]=U($e[F],we[se],se,F)}return ce||Be.splice(X,1),[R.type,$e,Be]}function A(U,R=null,X=1,ce=!1){const ne=U.data,we=U.dims;if(R===null){const Me=ne.reduce((be,Oe)=>be+Oe,0)/ne.length,Pe=Math.sqrt(ne.reduce((be,Oe)=>be+(Oe-Me)**2,0)/(ne.length-X)),ye=new a(U.type,[Me],[]);return[new a(U.type,[Pe],[]),ye]}R=M(R,we.length);const De=I(U,R,ce),Be=De.data,[$e,se,F]=S((Ee,Me,Pe,ye)=>Ee+(Me-Be[ye])**2,U,R,ce);for(let Ee=0;Ee<se.length;++Ee)se[Ee]=Math.sqrt(se[Ee]/(we[R]-X));return[new a($e,se,F),De]}function I(U,R=null,X=!1){const ce=U.dims,ne=U.data;if(R===null){const $e=ne.reduce((se,F)=>se+F,0);return new a(U.type,[$e/ne.length],[])}R=M(R,ce.length);const[we,De,Be]=S(($e,se)=>$e+se,U,R,X);if(ce[R]!==1)for(let $e=0;$e<De.length;++$e)De[$e]/=ce[R];return new a(we,De,Be)}function V(U){const R=new Array(U.length);for(let X=U.length-1,ce=1;X>=0;--X)R[X]=ce,ce*=U[X];return R}function N(U,R,X,ce){const ne=U.reduce((we,De)=>we*De,1);return new a(X,new ce(ne).fill(R),U)}function z(U,R){let X,ce;if(typeof R=="number")X="float32",ce=Float32Array;else if(typeof R=="bigint")X="int64",ce=BigInt64Array;else if(typeof R=="boolean")X="bool",ce=Uint8Array;else throw new Error(`Unsupported data type: ${typeof R}`);return N(U,R,X,ce)}function q(U,R){return z(U.dims,R)}function G(U){return N(U,1n,"int64",BigInt64Array)}function ee(U){return G(U.dims)}function Y(U){return N(U,0n,"int64",BigInt64Array)}function W(U){return Y(U.dims)}function te(U){const R=U.reduce((X,ce)=>X*ce,1);return new a("float32",Float32Array.from({length:R},()=>Math.random()),U)}function le(U){const R=U.reduce((ce,ne)=>ce*ne,1);function X(){const ce=1-Math.random(),ne=1-Math.random();return Math.sqrt(-2*Math.log(ce))*Math.cos(2*Math.PI*ne)}return new a("float32",Float32Array.from({length:R},()=>X()),U)}function oe(U,R){if(U.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(U.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(R))throw new Error("The precision must be either 'binary' or 'ubinary'");const X=R==="binary",ce=X?"int8":"uint8",ne=X?Int8Array:Uint8Array,we=U.data,De=new ne(we.length/8);for(let Be=0;Be<we.length;++Be){const $e=we[Be]>0?1:0,se=Math.floor(Be/8),F=Be%8;De[se]|=$e<<7-F,X&&F===0&&(De[se]-=128)}return new a(ce,De,[U.dims[0],U.dims[1]/8])}},"./src/utils/video.js":(e,t,r)=>{r.r(t),r.d(t,{RawVideo:()=>i,RawVideoFrame:()=>o,load_video:()=>a});var n=r("./src/utils/image.js"),s=r("./src/env.js");class o{constructor(u,h){this.image=u,this.timestamp=h}}class i{constructor(u,h){u.length>0&&u[0]instanceof n.RawImage&&(u=u.map((c,d)=>new o(c,(d+1)/(u.length+1)*h))),this.frames=u,this.duration=h}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function a(l,{num_frames:u=null,fps:h=null}={}){if(!s.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(u==null&&h==null)throw new Error("Either num_frames or fps must be provided.");const c=[],d=document.createElement("video");if(d.crossOrigin="anonymous",d.muted=!0,typeof l=="string")d.src=l;else if(l instanceof Blob)d.src=URL.createObjectURL(l);else if(l instanceof HTMLVideoElement)d.src=l.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(y=>d.onloadedmetadata=y),d.seekable.start(0)===d.seekable.end(0)){const v=await(await fetch(d.src)).blob();d.src=URL.createObjectURL(v),await new Promise(M=>d.onloadedmetadata=M)}const f=d.duration;let p,m;u!=null?(p=u,m=u===1?0:f/(u-1)):(m=1/h,p=Math.floor(f/m));let b=[];for(let y=0;y<p;++y)b.push(u===1?f/2:y*m);const g=document.createElement("canvas");g.width=d.videoWidth,g.height=d.videoHeight;const _=g.getContext("2d",{willReadFrequently:!0});for(const y of b){d.currentTime=y,await new Promise(T=>{d.onseeked=T}),_.drawImage(d,0,0,g.width,g.height);const v=_.getImageData(0,0,g.width,g.height),M=new n.RawImage(v.data,g.width,g.height,4),E=new o(M,y);c.push(E)}return d.remove(),new i(c,f)}}},MA={};function nr(e){var t=MA[e];if(t!==void 0)return t.exports;var r=MA[e]={exports:{}};return e9[e](r,r.exports,nr),r.exports}(()=>{var e=Object.getPrototypeOf?r=>Object.getPrototypeOf(r):r=>r.__proto__,t;nr.t=function(r,n){if(n&1&&(r=this(r)),n&8||typeof r=="object"&&r&&(n&4&&r.__esModule||n&16&&typeof r.then=="function"))return r;var s=Object.create(null);nr.r(s);var o={};t=t||[null,e({}),e([]),e(e)];for(var i=n&2&&r;typeof i=="object"&&!~t.indexOf(i);i=e(i))Object.getOwnPropertyNames(i).forEach(a=>o[a]=()=>r[a]);return o.default=()=>r,nr.d(s,o),s}})();nr.d=(e,t)=>{for(var r in t)nr.o(t,r)&&!nr.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})};nr.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);nr.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var x={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/nr.r(x),nr.d(x,{ASTFeatureExtractor:()=>c.ASTFeatureExtractor,ASTForAudioClassification:()=>r.ASTForAudioClassification,ASTModel:()=>r.ASTModel,ASTPreTrainedModel:()=>r.ASTPreTrainedModel,AlbertForMaskedLM:()=>r.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>r.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>r.AlbertForSequenceClassification,AlbertModel:()=>r.AlbertModel,AlbertPreTrainedModel:()=>r.AlbertPreTrainedModel,AlbertTokenizer:()=>n.AlbertTokenizer,ArceeForCausalLM:()=>r.ArceeForCausalLM,ArceeModel:()=>r.ArceeModel,ArceePreTrainedModel:()=>r.ArceePreTrainedModel,AudioClassificationPipeline:()=>t.AudioClassificationPipeline,AutoConfig:()=>s.AutoConfig,AutoFeatureExtractor:()=>d.AutoFeatureExtractor,AutoImageProcessor:()=>m.AutoImageProcessor,AutoModel:()=>r.AutoModel,AutoModelForAudioClassification:()=>r.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>r.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>r.AutoModelForAudioTextToText,AutoModelForCTC:()=>r.AutoModelForCTC,AutoModelForCausalLM:()=>r.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>r.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>r.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>r.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>r.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>r.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>r.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>r.AutoModelForImageTextToText,AutoModelForImageToImage:()=>r.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>r.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>r.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>r.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>r.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>r.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>r.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>r.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>r.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>r.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>r.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>r.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>r.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>r.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>r.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>r.AutoModelForVision2Seq,AutoModelForXVector:()=>r.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>r.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>_.AutoProcessor,AutoTokenizer:()=>n.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>t.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>t.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>r.BartForConditionalGeneration,BartForSequenceClassification:()=>r.BartForSequenceClassification,BartModel:()=>r.BartModel,BartPretrainedModel:()=>r.BartPretrainedModel,BartTokenizer:()=>n.BartTokenizer,BaseModelOutput:()=>r.BaseModelOutput,BaseStreamer:()=>y.BaseStreamer,BeitFeatureExtractor:()=>p.BeitFeatureExtractor,BeitForImageClassification:()=>r.BeitForImageClassification,BeitModel:()=>r.BeitModel,BeitPreTrainedModel:()=>r.BeitPreTrainedModel,BertForMaskedLM:()=>r.BertForMaskedLM,BertForQuestionAnswering:()=>r.BertForQuestionAnswering,BertForSequenceClassification:()=>r.BertForSequenceClassification,BertForTokenClassification:()=>r.BertForTokenClassification,BertModel:()=>r.BertModel,BertPreTrainedModel:()=>r.BertPreTrainedModel,BertTokenizer:()=>n.BertTokenizer,BitImageProcessor:()=>p.BitImageProcessor,BlenderbotForConditionalGeneration:()=>r.BlenderbotForConditionalGeneration,BlenderbotModel:()=>r.BlenderbotModel,BlenderbotPreTrainedModel:()=>r.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>r.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>r.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>r.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>n.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>n.BlenderbotTokenizer,BloomForCausalLM:()=>r.BloomForCausalLM,BloomModel:()=>r.BloomModel,BloomPreTrainedModel:()=>r.BloomPreTrainedModel,BloomTokenizer:()=>n.BloomTokenizer,CLIPFeatureExtractor:()=>p.CLIPFeatureExtractor,CLIPImageProcessor:()=>p.CLIPImageProcessor,CLIPModel:()=>r.CLIPModel,CLIPPreTrainedModel:()=>r.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>r.CLIPSegForImageSegmentation,CLIPSegModel:()=>r.CLIPSegModel,CLIPSegPreTrainedModel:()=>r.CLIPSegPreTrainedModel,CLIPTextModel:()=>r.CLIPTextModel,CLIPTextModelWithProjection:()=>r.CLIPTextModelWithProjection,CLIPTokenizer:()=>n.CLIPTokenizer,CLIPVisionModel:()=>r.CLIPVisionModel,CLIPVisionModelWithProjection:()=>r.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>r.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>r.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>r.CamembertForSequenceClassification,CamembertForTokenClassification:()=>r.CamembertForTokenClassification,CamembertModel:()=>r.CamembertModel,CamembertPreTrainedModel:()=>r.CamembertPreTrainedModel,CamembertTokenizer:()=>n.CamembertTokenizer,CausalLMOutput:()=>r.CausalLMOutput,CausalLMOutputWithPast:()=>r.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>p.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>r.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>r.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>r.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>c.ClapFeatureExtractor,ClapModel:()=>r.ClapModel,ClapPreTrainedModel:()=>r.ClapPreTrainedModel,ClapTextModelWithProjection:()=>r.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>M.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>r.CodeGenForCausalLM,CodeGenModel:()=>r.CodeGenModel,CodeGenPreTrainedModel:()=>r.CodeGenPreTrainedModel,CodeGenTokenizer:()=>n.CodeGenTokenizer,CodeLlamaTokenizer:()=>n.CodeLlamaTokenizer,CohereForCausalLM:()=>r.CohereForCausalLM,CohereModel:()=>r.CohereModel,CoherePreTrainedModel:()=>r.CoherePreTrainedModel,CohereTokenizer:()=>n.CohereTokenizer,ConvBertForMaskedLM:()=>r.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>r.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>r.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>r.ConvBertForTokenClassification,ConvBertModel:()=>r.ConvBertModel,ConvBertPreTrainedModel:()=>r.ConvBertPreTrainedModel,ConvBertTokenizer:()=>n.ConvBertTokenizer,ConvNextFeatureExtractor:()=>p.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>r.ConvNextForImageClassification,ConvNextImageProcessor:()=>p.ConvNextImageProcessor,ConvNextModel:()=>r.ConvNextModel,ConvNextPreTrainedModel:()=>r.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>r.ConvNextV2ForImageClassification,ConvNextV2Model:()=>r.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>r.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>r.DFineForObjectDetection,DFineModel:()=>r.DFineModel,DFinePreTrainedModel:()=>r.DFinePreTrainedModel,DINOv3ConvNextModel:()=>r.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>r.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>p.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>r.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>r.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>p.DPTFeatureExtractor,DPTForDepthEstimation:()=>r.DPTForDepthEstimation,DPTImageProcessor:()=>p.DPTImageProcessor,DPTModel:()=>r.DPTModel,DPTPreTrainedModel:()=>r.DPTPreTrainedModel,DacDecoderModel:()=>r.DacDecoderModel,DacDecoderOutput:()=>r.DacDecoderOutput,DacEncoderModel:()=>r.DacEncoderModel,DacEncoderOutput:()=>r.DacEncoderOutput,DacFeatureExtractor:()=>c.DacFeatureExtractor,DacModel:()=>r.DacModel,DacPreTrainedModel:()=>r.DacPreTrainedModel,DataTypeMap:()=>l.DataTypeMap,DebertaForMaskedLM:()=>r.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>r.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>r.DebertaForSequenceClassification,DebertaForTokenClassification:()=>r.DebertaForTokenClassification,DebertaModel:()=>r.DebertaModel,DebertaPreTrainedModel:()=>r.DebertaPreTrainedModel,DebertaTokenizer:()=>n.DebertaTokenizer,DebertaV2ForMaskedLM:()=>r.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>r.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>r.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>r.DebertaV2ForTokenClassification,DebertaV2Model:()=>r.DebertaV2Model,DebertaV2PreTrainedModel:()=>r.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>n.DebertaV2Tokenizer,DecisionTransformerModel:()=>r.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>r.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>p.DeiTFeatureExtractor,DeiTForImageClassification:()=>r.DeiTForImageClassification,DeiTImageProcessor:()=>p.DeiTImageProcessor,DeiTModel:()=>r.DeiTModel,DeiTPreTrainedModel:()=>r.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>r.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>r.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>t.DepthEstimationPipeline,DepthProForDepthEstimation:()=>r.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>r.DepthProPreTrainedModel,DetrFeatureExtractor:()=>p.DetrFeatureExtractor,DetrForObjectDetection:()=>r.DetrForObjectDetection,DetrForSegmentation:()=>r.DetrForSegmentation,DetrImageProcessor:()=>p.DetrImageProcessor,DetrModel:()=>r.DetrModel,DetrObjectDetectionOutput:()=>r.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>r.DetrPreTrainedModel,DetrSegmentationOutput:()=>r.DetrSegmentationOutput,Dinov2ForImageClassification:()=>r.Dinov2ForImageClassification,Dinov2Model:()=>r.Dinov2Model,Dinov2PreTrainedModel:()=>r.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>r.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>r.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>r.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>r.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>r.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>r.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>r.DistilBertForTokenClassification,DistilBertModel:()=>r.DistilBertModel,DistilBertPreTrainedModel:()=>r.DistilBertPreTrainedModel,DistilBertTokenizer:()=>n.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>t.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>p.DonutFeatureExtractor,DonutImageProcessor:()=>p.DonutImageProcessor,DonutSwinModel:()=>r.DonutSwinModel,DonutSwinPreTrainedModel:()=>r.DonutSwinPreTrainedModel,EdgeTamModel:()=>r.EdgeTamModel,EfficientNetForImageClassification:()=>r.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>p.EfficientNetImageProcessor,EfficientNetModel:()=>r.EfficientNetModel,EfficientNetPreTrainedModel:()=>r.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>r.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>r.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>r.ElectraForSequenceClassification,ElectraForTokenClassification:()=>r.ElectraForTokenClassification,ElectraModel:()=>r.ElectraModel,ElectraPreTrainedModel:()=>r.ElectraPreTrainedModel,ElectraTokenizer:()=>n.ElectraTokenizer,EncodecFeatureExtractor:()=>c.EncodecFeatureExtractor,EosTokenCriteria:()=>v.EosTokenCriteria,Ernie4_5_ForCausalLM:()=>r.Ernie4_5_ForCausalLM,Ernie4_5_Model:()=>r.Ernie4_5_Model,Ernie4_5_PretrainedModel:()=>r.Ernie4_5_PretrainedModel,Ernie4_5_Tokenizer:()=>n.Ernie4_5_Tokenizer,EsmForMaskedLM:()=>r.EsmForMaskedLM,EsmForSequenceClassification:()=>r.EsmForSequenceClassification,EsmForTokenClassification:()=>r.EsmForTokenClassification,EsmModel:()=>r.EsmModel,EsmPreTrainedModel:()=>r.EsmPreTrainedModel,EsmTokenizer:()=>n.EsmTokenizer,ExaoneForCausalLM:()=>r.ExaoneForCausalLM,ExaoneModel:()=>r.ExaoneModel,ExaonePreTrainedModel:()=>r.ExaonePreTrainedModel,FFT:()=>u.FFT,FalconForCausalLM:()=>r.FalconForCausalLM,FalconModel:()=>r.FalconModel,FalconPreTrainedModel:()=>r.FalconPreTrainedModel,FalconTokenizer:()=>n.FalconTokenizer,FastViTForImageClassification:()=>r.FastViTForImageClassification,FastViTModel:()=>r.FastViTModel,FastViTPreTrainedModel:()=>r.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>t.FeatureExtractionPipeline,FeatureExtractor:()=>h.FeatureExtractor,FillMaskPipeline:()=>t.FillMaskPipeline,Florence2ForConditionalGeneration:()=>r.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>r.Florence2PreTrainedModel,Florence2Processor:()=>g.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>M.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>M.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>p.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>r.GLPNForDepthEstimation,GLPNModel:()=>r.GLPNModel,GLPNPreTrainedModel:()=>r.GLPNPreTrainedModel,GPT2LMHeadModel:()=>r.GPT2LMHeadModel,GPT2Model:()=>r.GPT2Model,GPT2PreTrainedModel:()=>r.GPT2PreTrainedModel,GPT2Tokenizer:()=>n.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>r.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>r.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>r.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>r.GPTJForCausalLM,GPTJModel:()=>r.GPTJModel,GPTJPreTrainedModel:()=>r.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>r.GPTNeoForCausalLM,GPTNeoModel:()=>r.GPTNeoModel,GPTNeoPreTrainedModel:()=>r.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>r.GPTNeoXForCausalLM,GPTNeoXModel:()=>r.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>r.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>n.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>r.Gemma2ForCausalLM,Gemma2Model:()=>r.Gemma2Model,Gemma2PreTrainedModel:()=>r.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>r.Gemma3ForCausalLM,Gemma3Model:()=>r.Gemma3Model,Gemma3PreTrainedModel:()=>r.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>c.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>r.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>r.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>g.Gemma3nProcessor,GemmaForCausalLM:()=>r.GemmaForCausalLM,GemmaModel:()=>r.GemmaModel,GemmaPreTrainedModel:()=>r.GemmaPreTrainedModel,GemmaTokenizer:()=>n.GemmaTokenizer,GlmForCausalLM:()=>r.GlmForCausalLM,GlmModel:()=>r.GlmModel,GlmPreTrainedModel:()=>r.GlmPreTrainedModel,GraniteForCausalLM:()=>r.GraniteForCausalLM,GraniteModel:()=>r.GraniteModel,GraniteMoeHybridForCausalLM:()=>r.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>r.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>r.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>r.GranitePreTrainedModel,Grok1Tokenizer:()=>n.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>r.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>p.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>r.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>g.GroundingDinoProcessor,GroupViTModel:()=>r.GroupViTModel,GroupViTPreTrainedModel:()=>r.GroupViTPreTrainedModel,HeliumForCausalLM:()=>r.HeliumForCausalLM,HeliumModel:()=>r.HeliumModel,HeliumPreTrainedModel:()=>r.HeliumPreTrainedModel,HerbertTokenizer:()=>n.HerbertTokenizer,HieraForImageClassification:()=>r.HieraForImageClassification,HieraModel:()=>r.HieraModel,HieraPreTrainedModel:()=>r.HieraPreTrainedModel,HubertForCTC:()=>r.HubertForCTC,HubertForSequenceClassification:()=>r.HubertForSequenceClassification,HubertModel:()=>r.HubertModel,HubertPreTrainedModel:()=>r.HubertPreTrainedModel,IJepaForImageClassification:()=>r.IJepaForImageClassification,IJepaModel:()=>r.IJepaModel,IJepaPreTrainedModel:()=>r.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>r.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>p.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>r.Idefics3PreTrainedModel,Idefics3Processor:()=>g.Idefics3Processor,ImageClassificationPipeline:()=>t.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>t.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>c.ImageFeatureExtractor,ImageMattingOutput:()=>r.ImageMattingOutput,ImageProcessor:()=>f.ImageProcessor,ImageSegmentationPipeline:()=>t.ImageSegmentationPipeline,ImageToImagePipeline:()=>t.ImageToImagePipeline,ImageToTextPipeline:()=>t.ImageToTextPipeline,InterruptableStoppingCriteria:()=>v.InterruptableStoppingCriteria,JAISLMHeadModel:()=>r.JAISLMHeadModel,JAISModel:()=>r.JAISModel,JAISPreTrainedModel:()=>r.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>p.JinaCLIPImageProcessor,JinaCLIPModel:()=>r.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>r.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>g.JinaCLIPProcessor,JinaCLIPTextModel:()=>r.JinaCLIPTextModel,JinaCLIPVisionModel:()=>r.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>r.Lfm2ForCausalLM,Lfm2Model:()=>r.Lfm2Model,Lfm2PreTrainedModel:()=>r.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>r.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>r.Llama4ForCausalLM,Llama4PreTrainedModel:()=>r.Llama4PreTrainedModel,LlamaForCausalLM:()=>r.LlamaForCausalLM,LlamaModel:()=>r.LlamaModel,LlamaPreTrainedModel:()=>r.LlamaPreTrainedModel,LlamaTokenizer:()=>n.LlamaTokenizer,LlavaForConditionalGeneration:()=>r.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>r.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>p.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>r.LlavaPreTrainedModel,LlavaProcessor:()=>g.LlavaProcessor,LlavaQwen2ForCausalLM:()=>r.LlavaQwen2ForCausalLM,LogitsProcessor:()=>M.LogitsProcessor,LogitsProcessorList:()=>M.LogitsProcessorList,LogitsWarper:()=>M.LogitsWarper,LongT5ForConditionalGeneration:()=>r.LongT5ForConditionalGeneration,LongT5Model:()=>r.LongT5Model,LongT5PreTrainedModel:()=>r.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>r.M2M100ForConditionalGeneration,M2M100Model:()=>r.M2M100Model,M2M100PreTrainedModel:()=>r.M2M100PreTrainedModel,M2M100Tokenizer:()=>n.M2M100Tokenizer,MBart50Tokenizer:()=>n.MBart50Tokenizer,MBartForCausalLM:()=>r.MBartForCausalLM,MBartForConditionalGeneration:()=>r.MBartForConditionalGeneration,MBartForSequenceClassification:()=>r.MBartForSequenceClassification,MBartModel:()=>r.MBartModel,MBartPreTrainedModel:()=>r.MBartPreTrainedModel,MBartTokenizer:()=>n.MBartTokenizer,MPNetForMaskedLM:()=>r.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>r.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>r.MPNetForSequenceClassification,MPNetForTokenClassification:()=>r.MPNetForTokenClassification,MPNetModel:()=>r.MPNetModel,MPNetPreTrainedModel:()=>r.MPNetPreTrainedModel,MPNetTokenizer:()=>n.MPNetTokenizer,MT5ForConditionalGeneration:()=>r.MT5ForConditionalGeneration,MT5Model:()=>r.MT5Model,MT5PreTrainedModel:()=>r.MT5PreTrainedModel,MarianMTModel:()=>r.MarianMTModel,MarianModel:()=>r.MarianModel,MarianPreTrainedModel:()=>r.MarianPreTrainedModel,MarianTokenizer:()=>n.MarianTokenizer,Mask2FormerImageProcessor:()=>p.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>p.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>r.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>p.MaskFormerImageProcessor,MaskFormerModel:()=>r.MaskFormerModel,MaskFormerPreTrainedModel:()=>r.MaskFormerPreTrainedModel,MaskedLMOutput:()=>r.MaskedLMOutput,MaxLengthCriteria:()=>v.MaxLengthCriteria,Metric3DForDepthEstimation:()=>r.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>r.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>r.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>r.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>r.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>r.MgpstrModelOutput,MgpstrPreTrainedModel:()=>r.MgpstrPreTrainedModel,MgpstrProcessor:()=>g.MgpstrProcessor,MgpstrTokenizer:()=>n.MgpstrTokenizer,MimiDecoderModel:()=>r.MimiDecoderModel,MimiDecoderOutput:()=>r.MimiDecoderOutput,MimiEncoderModel:()=>r.MimiEncoderModel,MimiEncoderOutput:()=>r.MimiEncoderOutput,MimiModel:()=>r.MimiModel,MimiPreTrainedModel:()=>r.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>M.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>M.MinNewTokensLengthLogitsProcessor,MistralForCausalLM:()=>r.MistralForCausalLM,MistralModel:()=>r.MistralModel,MistralPreTrainedModel:()=>r.MistralPreTrainedModel,MobileBertForMaskedLM:()=>r.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>r.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>r.MobileBertForSequenceClassification,MobileBertModel:()=>r.MobileBertModel,MobileBertPreTrainedModel:()=>r.MobileBertPreTrainedModel,MobileBertTokenizer:()=>n.MobileBertTokenizer,MobileLLMForCausalLM:()=>r.MobileLLMForCausalLM,MobileLLMModel:()=>r.MobileLLMModel,MobileLLMPreTrainedModel:()=>r.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>p.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>r.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>r.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>p.MobileNetV1ImageProcessor,MobileNetV1Model:()=>r.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>r.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>p.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>r.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>r.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>p.MobileNetV2ImageProcessor,MobileNetV2Model:()=>r.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>r.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>p.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>r.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>r.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>p.MobileNetV3ImageProcessor,MobileNetV3Model:()=>r.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>r.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>p.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>r.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>r.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>p.MobileNetV4ImageProcessor,MobileNetV4Model:()=>r.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>r.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>p.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>r.MobileViTForImageClassification,MobileViTImageProcessor:()=>p.MobileViTImageProcessor,MobileViTModel:()=>r.MobileViTModel,MobileViTPreTrainedModel:()=>r.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>r.MobileViTV2ForImageClassification,MobileViTV2Model:()=>r.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>r.MobileViTV2PreTrainedModel,ModelOutput:()=>r.ModelOutput,ModernBertDecoderForCausalLM:()=>r.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>r.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>r.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>r.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>r.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>r.ModernBertForTokenClassification,ModernBertModel:()=>r.ModernBertModel,ModernBertPreTrainedModel:()=>r.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>r.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>c.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>r.MoonshineForConditionalGeneration,MoonshineModel:()=>r.MoonshineModel,MoonshinePreTrainedModel:()=>r.MoonshinePreTrainedModel,MoonshineProcessor:()=>g.MoonshineProcessor,MptForCausalLM:()=>r.MptForCausalLM,MptModel:()=>r.MptModel,MptPreTrainedModel:()=>r.MptPreTrainedModel,MultiModalityCausalLM:()=>r.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>r.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>r.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>r.MusicgenForConditionalGeneration,MusicgenModel:()=>r.MusicgenModel,MusicgenPreTrainedModel:()=>r.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>r.NanoChatForCausalLM,NanoChatModel:()=>r.NanoChatModel,NanoChatPreTrainedModel:()=>r.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>r.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>r.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>r.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>r.NeoBertForTokenClassification,NeoBertModel:()=>r.NeoBertModel,NeoBertPreTrainedModel:()=>r.NeoBertPreTrainedModel,NllbTokenizer:()=>n.NllbTokenizer,NoBadWordsLogitsProcessor:()=>M.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>M.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>r.NomicBertModel,NomicBertPreTrainedModel:()=>r.NomicBertPreTrainedModel,NougatImageProcessor:()=>p.NougatImageProcessor,NougatTokenizer:()=>n.NougatTokenizer,OPTForCausalLM:()=>r.OPTForCausalLM,OPTModel:()=>r.OPTModel,OPTPreTrainedModel:()=>r.OPTPreTrainedModel,ObjectDetectionPipeline:()=>t.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>r.Olmo2ForCausalLM,Olmo2Model:()=>r.Olmo2Model,Olmo2PreTrainedModel:()=>r.Olmo2PreTrainedModel,OlmoForCausalLM:()=>r.OlmoForCausalLM,OlmoModel:()=>r.OlmoModel,OlmoPreTrainedModel:()=>r.OlmoPreTrainedModel,OpenELMForCausalLM:()=>r.OpenELMForCausalLM,OpenELMModel:()=>r.OpenELMModel,OpenELMPreTrainedModel:()=>r.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>p.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>r.OwlViTForObjectDetection,OwlViTImageProcessor:()=>p.OwlViTImageProcessor,OwlViTModel:()=>r.OwlViTModel,OwlViTPreTrainedModel:()=>r.OwlViTPreTrainedModel,OwlViTProcessor:()=>g.OwlViTProcessor,Owlv2ForObjectDetection:()=>r.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>p.Owlv2ImageProcessor,Owlv2Model:()=>r.Owlv2Model,Owlv2PreTrainedModel:()=>r.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>r.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>r.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>g.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>c.ParakeetFeatureExtractor,ParakeetForCTC:()=>r.ParakeetForCTC,ParakeetPreTrainedModel:()=>r.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>r.PatchTSMixerForPrediction,PatchTSMixerModel:()=>r.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>r.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>r.PatchTSTForPrediction,PatchTSTModel:()=>r.PatchTSTModel,PatchTSTPreTrainedModel:()=>r.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>r.Phi3ForCausalLM,Phi3Model:()=>r.Phi3Model,Phi3PreTrainedModel:()=>r.Phi3PreTrainedModel,Phi3VForCausalLM:()=>r.Phi3VForCausalLM,Phi3VImageProcessor:()=>p.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>r.Phi3VPreTrainedModel,Phi3VProcessor:()=>g.Phi3VProcessor,PhiForCausalLM:()=>r.PhiForCausalLM,PhiModel:()=>r.PhiModel,PhiPreTrainedModel:()=>r.PhiPreTrainedModel,Pipeline:()=>t.Pipeline,PreTrainedModel:()=>r.PreTrainedModel,PreTrainedTokenizer:()=>n.PreTrainedTokenizer,PretrainedConfig:()=>s.PretrainedConfig,PretrainedMixin:()=>r.PretrainedMixin,Processor:()=>b.Processor,PvtForImageClassification:()=>r.PvtForImageClassification,PvtImageProcessor:()=>p.PvtImageProcessor,PvtModel:()=>r.PvtModel,PvtPreTrainedModel:()=>r.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>c.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>r.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>r.PyAnnoteModel,PyAnnotePreTrainedModel:()=>r.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>g.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>r.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>t.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>r.Qwen2ForCausalLM,Qwen2Model:()=>r.Qwen2Model,Qwen2PreTrainedModel:()=>r.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>n.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>r.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>p.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>r.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>g.Qwen2VLProcessor,Qwen3ForCausalLM:()=>r.Qwen3ForCausalLM,Qwen3Model:()=>r.Qwen3Model,Qwen3PreTrainedModel:()=>r.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>r.RFDetrForObjectDetection,RFDetrModel:()=>r.RFDetrModel,RFDetrObjectDetectionOutput:()=>r.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>r.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>r.RTDetrForObjectDetection,RTDetrImageProcessor:()=>p.RTDetrImageProcessor,RTDetrModel:()=>r.RTDetrModel,RTDetrObjectDetectionOutput:()=>r.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>r.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>r.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>r.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>r.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>r.RTDetrV2PreTrainedModel,RawAudio:()=>o.RawAudio,RawImage:()=>i.RawImage,RawVideo:()=>a.RawVideo,RawVideoFrame:()=>a.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>M.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>r.ResNetForImageClassification,ResNetModel:()=>r.ResNetModel,ResNetPreTrainedModel:()=>r.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>r.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>r.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>r.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>r.RoFormerForTokenClassification,RoFormerModel:()=>r.RoFormerModel,RoFormerPreTrainedModel:()=>r.RoFormerPreTrainedModel,RoFormerTokenizer:()=>n.RoFormerTokenizer,RobertaForMaskedLM:()=>r.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>r.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>r.RobertaForSequenceClassification,RobertaForTokenClassification:()=>r.RobertaForTokenClassification,RobertaModel:()=>r.RobertaModel,RobertaPreTrainedModel:()=>r.RobertaPreTrainedModel,RobertaTokenizer:()=>n.RobertaTokenizer,Sam2ImageProcessor:()=>p.Sam2ImageProcessor,Sam2ImageSegmentationOutput:()=>r.Sam2ImageSegmentationOutput,Sam2Model:()=>r.Sam2Model,Sam2PreTrainedModel:()=>r.Sam2PreTrainedModel,Sam2Processor:()=>g.Sam2Processor,Sam2VideoProcessor:()=>g.Sam2VideoProcessor,Sam3ImageProcessor:()=>p.Sam3ImageProcessor,Sam3TrackerModel:()=>r.Sam3TrackerModel,SamImageProcessor:()=>p.SamImageProcessor,SamImageSegmentationOutput:()=>r.SamImageSegmentationOutput,SamModel:()=>r.SamModel,SamPreTrainedModel:()=>r.SamPreTrainedModel,SamProcessor:()=>g.SamProcessor,SapiensForDepthEstimation:()=>r.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>r.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>r.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>r.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>c.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>p.SegformerFeatureExtractor,SegformerForImageClassification:()=>r.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>r.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>p.SegformerImageProcessor,SegformerModel:()=>r.SegformerModel,SegformerPreTrainedModel:()=>r.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>r.Seq2SeqLMOutput,SequenceClassifierOutput:()=>r.SequenceClassifierOutput,SiglipImageProcessor:()=>p.SiglipImageProcessor,SiglipModel:()=>r.SiglipModel,SiglipPreTrainedModel:()=>r.SiglipPreTrainedModel,SiglipTextModel:()=>r.SiglipTextModel,SiglipTokenizer:()=>n.SiglipTokenizer,SiglipVisionModel:()=>r.SiglipVisionModel,SmolLM3ForCausalLM:()=>r.SmolLM3ForCausalLM,SmolLM3Model:()=>r.SmolLM3Model,SmolLM3PreTrainedModel:()=>r.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>r.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>p.SmolVLMImageProcessor,SmolVLMProcessor:()=>g.SmolVLMProcessor,SnacDecoderModel:()=>r.SnacDecoderModel,SnacEncoderModel:()=>r.SnacEncoderModel,SnacFeatureExtractor:()=>c.SnacFeatureExtractor,SnacModel:()=>r.SnacModel,SnacPreTrainedModel:()=>r.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>c.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>r.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>r.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>r.SpeechT5HifiGan,SpeechT5Model:()=>r.SpeechT5Model,SpeechT5PreTrainedModel:()=>r.SpeechT5PreTrainedModel,SpeechT5Processor:()=>g.SpeechT5Processor,SpeechT5Tokenizer:()=>n.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>r.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>r.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>r.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>r.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>r.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>n.SqueezeBertTokenizer,StableLmForCausalLM:()=>r.StableLmForCausalLM,StableLmModel:()=>r.StableLmModel,StableLmPreTrainedModel:()=>r.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>r.Starcoder2ForCausalLM,Starcoder2Model:()=>r.Starcoder2Model,Starcoder2PreTrainedModel:()=>r.Starcoder2PreTrainedModel,StoppingCriteria:()=>v.StoppingCriteria,StoppingCriteriaList:()=>v.StoppingCriteriaList,StyleTextToSpeech2Model:()=>r.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>r.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>t.SummarizationPipeline,SupertonicForConditionalGeneration:()=>r.SupertonicForConditionalGeneration,SupertonicPreTrainedModel:()=>r.SupertonicPreTrainedModel,SuppressTokensAtBeginLogitsProcessor:()=>M.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>r.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>p.Swin2SRImageProcessor,Swin2SRModel:()=>r.Swin2SRModel,Swin2SRPreTrainedModel:()=>r.Swin2SRPreTrainedModel,SwinForImageClassification:()=>r.SwinForImageClassification,SwinForSemanticSegmentation:()=>r.SwinForSemanticSegmentation,SwinModel:()=>r.SwinModel,SwinPreTrainedModel:()=>r.SwinPreTrainedModel,T5ForConditionalGeneration:()=>r.T5ForConditionalGeneration,T5Model:()=>r.T5Model,T5PreTrainedModel:()=>r.T5PreTrainedModel,T5Tokenizer:()=>n.T5Tokenizer,TableTransformerForObjectDetection:()=>r.TableTransformerForObjectDetection,TableTransformerModel:()=>r.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>r.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>r.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>M.TemperatureLogitsWarper,Tensor:()=>l.Tensor,Text2TextGenerationPipeline:()=>t.Text2TextGenerationPipeline,TextClassificationPipeline:()=>t.TextClassificationPipeline,TextGenerationPipeline:()=>t.TextGenerationPipeline,TextStreamer:()=>y.TextStreamer,TextToAudioPipeline:()=>t.TextToAudioPipeline,TokenClassificationPipeline:()=>t.TokenClassificationPipeline,TokenClassifierOutput:()=>r.TokenClassifierOutput,TokenizerModel:()=>n.TokenizerModel,TopKLogitsWarper:()=>M.TopKLogitsWarper,TopPLogitsWarper:()=>M.TopPLogitsWarper,TrOCRForCausalLM:()=>r.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>r.TrOCRPreTrainedModel,TranslationPipeline:()=>t.TranslationPipeline,UltravoxModel:()=>r.UltravoxModel,UltravoxPreTrainedModel:()=>r.UltravoxPreTrainedModel,UltravoxProcessor:()=>g.UltravoxProcessor,UniSpeechForCTC:()=>r.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>r.UniSpeechForSequenceClassification,UniSpeechModel:()=>r.UniSpeechModel,UniSpeechPreTrainedModel:()=>r.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>r.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>r.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>r.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>r.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>r.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>g.VLChatProcessor,VLMImageProcessor:()=>p.VLMImageProcessor,VaultGemmaForCausalLM:()=>r.VaultGemmaForCausalLM,VaultGemmaModel:()=>r.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>r.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>p.ViTFeatureExtractor,ViTForImageClassification:()=>r.ViTForImageClassification,ViTImageProcessor:()=>p.ViTImageProcessor,ViTMAEModel:()=>r.ViTMAEModel,ViTMAEPreTrainedModel:()=>r.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>r.ViTMSNForImageClassification,ViTMSNModel:()=>r.ViTMSNModel,ViTMSNPreTrainedModel:()=>r.ViTMSNPreTrainedModel,ViTModel:()=>r.ViTModel,ViTPreTrainedModel:()=>r.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>r.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>r.VitMatteForImageMatting,VitMatteImageProcessor:()=>p.VitMatteImageProcessor,VitMattePreTrainedModel:()=>r.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>r.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>p.VitPoseImageProcessor,VitPosePreTrainedModel:()=>r.VitPosePreTrainedModel,VitsModel:()=>r.VitsModel,VitsModelOutput:()=>r.VitsModelOutput,VitsPreTrainedModel:()=>r.VitsPreTrainedModel,VitsTokenizer:()=>n.VitsTokenizer,VoxtralForConditionalGeneration:()=>r.VoxtralForConditionalGeneration,VoxtralProcessor:()=>g.VoxtralProcessor,Wav2Vec2BertForCTC:()=>r.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>r.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>r.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>r.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>n.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>c.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>r.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>r.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>r.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>r.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>r.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>g.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>g.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>r.WavLMForAudioFrameClassification,WavLMForCTC:()=>r.WavLMForCTC,WavLMForSequenceClassification:()=>r.WavLMForSequenceClassification,WavLMForXVector:()=>r.WavLMForXVector,WavLMModel:()=>r.WavLMModel,WavLMPreTrainedModel:()=>r.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>c.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>r.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>r.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>c.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>r.WhisperForConditionalGeneration,WhisperModel:()=>r.WhisperModel,WhisperPreTrainedModel:()=>r.WhisperPreTrainedModel,WhisperProcessor:()=>g.WhisperProcessor,WhisperTextStreamer:()=>y.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>M.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>n.WhisperTokenizer,XLMForQuestionAnswering:()=>r.XLMForQuestionAnswering,XLMForSequenceClassification:()=>r.XLMForSequenceClassification,XLMForTokenClassification:()=>r.XLMForTokenClassification,XLMModel:()=>r.XLMModel,XLMPreTrainedModel:()=>r.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>r.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>r.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>r.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>r.XLMRobertaForTokenClassification,XLMRobertaModel:()=>r.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>r.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>n.XLMRobertaTokenizer,XLMTokenizer:()=>n.XLMTokenizer,XLMWithLMHeadModel:()=>r.XLMWithLMHeadModel,XVectorOutput:()=>r.XVectorOutput,YolosFeatureExtractor:()=>p.YolosFeatureExtractor,YolosForObjectDetection:()=>r.YolosForObjectDetection,YolosImageProcessor:()=>p.YolosImageProcessor,YolosModel:()=>r.YolosModel,YolosObjectDetectionOutput:()=>r.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>r.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>t.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>t.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>t.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>t.ZeroShotObjectDetectionPipeline,bankers_round:()=>u.bankers_round,cat:()=>l.cat,cos_sim:()=>u.cos_sim,dot:()=>u.dot,dynamic_time_warping:()=>u.dynamic_time_warping,env:()=>e.env,full:()=>l.full,full_like:()=>l.full_like,getCacheShapes:()=>s.getCacheShapes,hamming:()=>o.hamming,hanning:()=>o.hanning,interpolate:()=>l.interpolate,interpolate_4d:()=>l.interpolate_4d,interpolate_data:()=>u.interpolate_data,is_chinese_char:()=>n.is_chinese_char,layer_norm:()=>l.layer_norm,load_image:()=>i.load_image,load_video:()=>a.load_video,log_softmax:()=>u.log_softmax,magnitude:()=>u.magnitude,matmul:()=>l.matmul,max:()=>u.max,mean:()=>l.mean,mean_pooling:()=>l.mean_pooling,medianFilter:()=>u.medianFilter,mel_filter_bank:()=>o.mel_filter_bank,min:()=>u.min,ones:()=>l.ones,ones_like:()=>l.ones_like,permute:()=>l.permute,permute_data:()=>u.permute_data,pipeline:()=>t.pipeline,quantize_embeddings:()=>l.quantize_embeddings,rand:()=>l.rand,randn:()=>l.randn,read_audio:()=>o.read_audio,rfft:()=>l.rfft,round:()=>u.round,slice:()=>l.slice,softmax:()=>u.softmax,spectrogram:()=>o.spectrogram,stack:()=>l.stack,std_mean:()=>l.std_mean,topk:()=>l.topk,window_function:()=>o.window_function,zeros:()=>l.zeros,zeros_like:()=>l.zeros_like});var e=nr("./src/env.js"),t=nr("./src/pipelines.js"),r=nr("./src/models.js"),n=nr("./src/tokenizers.js"),s=nr("./src/configs.js"),o=nr("./src/utils/audio.js"),i=nr("./src/utils/image.js"),a=nr("./src/utils/video.js"),l=nr("./src/utils/tensor.js"),u=nr("./src/utils/maths.js"),h=nr("./src/base/feature_extraction_utils.js"),c=nr("./src/models/feature_extractors.js"),d=nr("./src/models/auto/feature_extraction_auto.js"),f=nr("./src/base/image_processors_utils.js"),p=nr("./src/models/image_processors.js"),m=nr("./src/models/auto/image_processing_auto.js"),b=nr("./src/base/processing_utils.js"),g=nr("./src/models/processors.js"),_=nr("./src/models/auto/processing_auto.js"),y=nr("./src/generation/streamers.js"),v=nr("./src/generation/stopping_criteria.js"),M=nr("./src/generation/logits_process.js")})();x.ASTFeatureExtractor;x.ASTForAudioClassification;x.ASTModel;x.ASTPreTrainedModel;x.AlbertForMaskedLM;x.AlbertForQuestionAnswering;x.AlbertForSequenceClassification;x.AlbertModel;x.AlbertPreTrainedModel;x.AlbertTokenizer;x.ArceeForCausalLM;x.ArceeModel;x.ArceePreTrainedModel;x.AudioClassificationPipeline;x.AutoConfig;x.AutoFeatureExtractor;x.AutoImageProcessor;x.AutoModel;x.AutoModelForAudioClassification;x.AutoModelForAudioFrameClassification;x.AutoModelForAudioTextToText;x.AutoModelForCTC;x.AutoModelForCausalLM;x.AutoModelForDepthEstimation;x.AutoModelForDocumentQuestionAnswering;x.AutoModelForImageClassification;x.AutoModelForImageFeatureExtraction;x.AutoModelForImageMatting;x.AutoModelForImageSegmentation;x.AutoModelForImageTextToText;x.AutoModelForImageToImage;x.AutoModelForMaskGeneration;x.AutoModelForMaskedLM;x.AutoModelForNormalEstimation;x.AutoModelForObjectDetection;x.AutoModelForPoseEstimation;x.AutoModelForQuestionAnswering;x.AutoModelForSemanticSegmentation;x.AutoModelForSeq2SeqLM;x.AutoModelForSequenceClassification;x.AutoModelForSpeechSeq2Seq;x.AutoModelForTextToSpectrogram;x.AutoModelForTextToWaveform;x.AutoModelForTokenClassification;x.AutoModelForUniversalSegmentation;x.AutoModelForVision2Seq;x.AutoModelForXVector;x.AutoModelForZeroShotObjectDetection;x.AutoProcessor;x.AutoTokenizer;x.AutomaticSpeechRecognitionPipeline;x.BackgroundRemovalPipeline;x.BartForConditionalGeneration;x.BartForSequenceClassification;x.BartModel;x.BartPretrainedModel;x.BartTokenizer;x.BaseModelOutput;x.BaseStreamer;x.BeitFeatureExtractor;x.BeitForImageClassification;x.BeitModel;x.BeitPreTrainedModel;x.BertForMaskedLM;x.BertForQuestionAnswering;x.BertForSequenceClassification;x.BertForTokenClassification;x.BertModel;x.BertPreTrainedModel;x.BertTokenizer;x.BitImageProcessor;x.BlenderbotForConditionalGeneration;x.BlenderbotModel;x.BlenderbotPreTrainedModel;x.BlenderbotSmallForConditionalGeneration;x.BlenderbotSmallModel;x.BlenderbotSmallPreTrainedModel;x.BlenderbotSmallTokenizer;x.BlenderbotTokenizer;x.BloomForCausalLM;x.BloomModel;x.BloomPreTrainedModel;x.BloomTokenizer;x.CLIPFeatureExtractor;x.CLIPImageProcessor;x.CLIPModel;x.CLIPPreTrainedModel;x.CLIPSegForImageSegmentation;x.CLIPSegModel;x.CLIPSegPreTrainedModel;x.CLIPTextModel;x.CLIPTextModelWithProjection;x.CLIPTokenizer;x.CLIPVisionModel;x.CLIPVisionModelWithProjection;x.CamembertForMaskedLM;x.CamembertForQuestionAnswering;x.CamembertForSequenceClassification;x.CamembertForTokenClassification;x.CamembertModel;x.CamembertPreTrainedModel;x.CamembertTokenizer;x.CausalLMOutput;x.CausalLMOutputWithPast;x.ChineseCLIPFeatureExtractor;x.ChineseCLIPModel;x.ChineseCLIPPreTrainedModel;x.ClapAudioModelWithProjection;x.ClapFeatureExtractor;x.ClapModel;x.ClapPreTrainedModel;x.ClapTextModelWithProjection;x.ClassifierFreeGuidanceLogitsProcessor;x.CodeGenForCausalLM;x.CodeGenModel;x.CodeGenPreTrainedModel;x.CodeGenTokenizer;x.CodeLlamaTokenizer;x.CohereForCausalLM;x.CohereModel;x.CoherePreTrainedModel;x.CohereTokenizer;x.ConvBertForMaskedLM;x.ConvBertForQuestionAnswering;x.ConvBertForSequenceClassification;x.ConvBertForTokenClassification;x.ConvBertModel;x.ConvBertPreTrainedModel;x.ConvBertTokenizer;x.ConvNextFeatureExtractor;x.ConvNextForImageClassification;x.ConvNextImageProcessor;x.ConvNextModel;x.ConvNextPreTrainedModel;x.ConvNextV2ForImageClassification;x.ConvNextV2Model;x.ConvNextV2PreTrainedModel;x.DFineForObjectDetection;x.DFineModel;x.DFinePreTrainedModel;x.DINOv3ConvNextModel;x.DINOv3ConvNextPreTrainedModel;x.DINOv3ViTImageProcessor;x.DINOv3ViTModel;x.DINOv3ViTPreTrainedModel;x.DPTFeatureExtractor;x.DPTForDepthEstimation;x.DPTImageProcessor;x.DPTModel;x.DPTPreTrainedModel;x.DacDecoderModel;x.DacDecoderOutput;x.DacEncoderModel;x.DacEncoderOutput;x.DacFeatureExtractor;x.DacModel;x.DacPreTrainedModel;x.DataTypeMap;x.DebertaForMaskedLM;x.DebertaForQuestionAnswering;x.DebertaForSequenceClassification;x.DebertaForTokenClassification;x.DebertaModel;x.DebertaPreTrainedModel;x.DebertaTokenizer;x.DebertaV2ForMaskedLM;x.DebertaV2ForQuestionAnswering;x.DebertaV2ForSequenceClassification;x.DebertaV2ForTokenClassification;x.DebertaV2Model;x.DebertaV2PreTrainedModel;x.DebertaV2Tokenizer;x.DecisionTransformerModel;x.DecisionTransformerPreTrainedModel;x.DeiTFeatureExtractor;x.DeiTForImageClassification;x.DeiTImageProcessor;x.DeiTModel;x.DeiTPreTrainedModel;x.DepthAnythingForDepthEstimation;x.DepthAnythingPreTrainedModel;x.DepthEstimationPipeline;x.DepthProForDepthEstimation;x.DepthProPreTrainedModel;x.DetrFeatureExtractor;x.DetrForObjectDetection;x.DetrForSegmentation;x.DetrImageProcessor;x.DetrModel;x.DetrObjectDetectionOutput;x.DetrPreTrainedModel;x.DetrSegmentationOutput;x.Dinov2ForImageClassification;x.Dinov2Model;x.Dinov2PreTrainedModel;x.Dinov2WithRegistersForImageClassification;x.Dinov2WithRegistersModel;x.Dinov2WithRegistersPreTrainedModel;x.DistilBertForMaskedLM;x.DistilBertForQuestionAnswering;x.DistilBertForSequenceClassification;x.DistilBertForTokenClassification;x.DistilBertModel;x.DistilBertPreTrainedModel;x.DistilBertTokenizer;x.DocumentQuestionAnsweringPipeline;x.DonutFeatureExtractor;x.DonutImageProcessor;x.DonutSwinModel;x.DonutSwinPreTrainedModel;x.EdgeTamModel;x.EfficientNetForImageClassification;x.EfficientNetImageProcessor;x.EfficientNetModel;x.EfficientNetPreTrainedModel;x.ElectraForMaskedLM;x.ElectraForQuestionAnswering;x.ElectraForSequenceClassification;x.ElectraForTokenClassification;x.ElectraModel;x.ElectraPreTrainedModel;x.ElectraTokenizer;x.EncodecFeatureExtractor;x.EosTokenCriteria;x.Ernie4_5_ForCausalLM;x.Ernie4_5_Model;x.Ernie4_5_PretrainedModel;x.Ernie4_5_Tokenizer;x.EsmForMaskedLM;x.EsmForSequenceClassification;x.EsmForTokenClassification;x.EsmModel;x.EsmPreTrainedModel;x.EsmTokenizer;x.ExaoneForCausalLM;x.ExaoneModel;x.ExaonePreTrainedModel;x.FFT;x.FalconForCausalLM;x.FalconModel;x.FalconPreTrainedModel;x.FalconTokenizer;x.FastViTForImageClassification;x.FastViTModel;x.FastViTPreTrainedModel;x.FeatureExtractionPipeline;x.FeatureExtractor;x.FillMaskPipeline;x.Florence2ForConditionalGeneration;x.Florence2PreTrainedModel;x.Florence2Processor;x.ForcedBOSTokenLogitsProcessor;x.ForcedEOSTokenLogitsProcessor;x.GLPNFeatureExtractor;x.GLPNForDepthEstimation;x.GLPNModel;x.GLPNPreTrainedModel;x.GPT2LMHeadModel;x.GPT2Model;x.GPT2PreTrainedModel;x.GPT2Tokenizer;x.GPTBigCodeForCausalLM;x.GPTBigCodeModel;x.GPTBigCodePreTrainedModel;x.GPTJForCausalLM;x.GPTJModel;x.GPTJPreTrainedModel;x.GPTNeoForCausalLM;x.GPTNeoModel;x.GPTNeoPreTrainedModel;x.GPTNeoXForCausalLM;x.GPTNeoXModel;x.GPTNeoXPreTrainedModel;x.GPTNeoXTokenizer;x.Gemma2ForCausalLM;x.Gemma2Model;x.Gemma2PreTrainedModel;x.Gemma3ForCausalLM;x.Gemma3Model;x.Gemma3PreTrainedModel;x.Gemma3nAudioFeatureExtractor;x.Gemma3nForConditionalGeneration;x.Gemma3nPreTrainedModel;x.Gemma3nProcessor;x.GemmaForCausalLM;x.GemmaModel;x.GemmaPreTrainedModel;x.GemmaTokenizer;x.GlmForCausalLM;x.GlmModel;x.GlmPreTrainedModel;x.GraniteForCausalLM;x.GraniteModel;x.GraniteMoeHybridForCausalLM;x.GraniteMoeHybridModel;x.GraniteMoeHybridPreTrainedModel;x.GranitePreTrainedModel;x.Grok1Tokenizer;x.GroundingDinoForObjectDetection;x.GroundingDinoImageProcessor;x.GroundingDinoPreTrainedModel;x.GroundingDinoProcessor;x.GroupViTModel;x.GroupViTPreTrainedModel;x.HeliumForCausalLM;x.HeliumModel;x.HeliumPreTrainedModel;x.HerbertTokenizer;x.HieraForImageClassification;x.HieraModel;x.HieraPreTrainedModel;x.HubertForCTC;x.HubertForSequenceClassification;x.HubertModel;x.HubertPreTrainedModel;x.IJepaForImageClassification;x.IJepaModel;x.IJepaPreTrainedModel;x.Idefics3ForConditionalGeneration;x.Idefics3ImageProcessor;x.Idefics3PreTrainedModel;x.Idefics3Processor;x.ImageClassificationPipeline;x.ImageFeatureExtractionPipeline;x.ImageFeatureExtractor;x.ImageMattingOutput;x.ImageProcessor;x.ImageSegmentationPipeline;x.ImageToImagePipeline;x.ImageToTextPipeline;x.InterruptableStoppingCriteria;x.JAISLMHeadModel;x.JAISModel;x.JAISPreTrainedModel;x.JinaCLIPImageProcessor;x.JinaCLIPModel;x.JinaCLIPPreTrainedModel;x.JinaCLIPProcessor;x.JinaCLIPTextModel;x.JinaCLIPVisionModel;x.Lfm2ForCausalLM;x.Lfm2Model;x.Lfm2PreTrainedModel;x.LiteWhisperForConditionalGeneration;x.Llama4ForCausalLM;x.Llama4PreTrainedModel;x.LlamaForCausalLM;x.LlamaModel;x.LlamaPreTrainedModel;x.LlamaTokenizer;x.LlavaForConditionalGeneration;x.LlavaOnevisionForConditionalGeneration;x.LlavaOnevisionImageProcessor;x.LlavaPreTrainedModel;x.LlavaProcessor;x.LlavaQwen2ForCausalLM;x.LogitsProcessor;x.LogitsProcessorList;x.LogitsWarper;x.LongT5ForConditionalGeneration;x.LongT5Model;x.LongT5PreTrainedModel;x.M2M100ForConditionalGeneration;x.M2M100Model;x.M2M100PreTrainedModel;x.M2M100Tokenizer;x.MBart50Tokenizer;x.MBartForCausalLM;x.MBartForConditionalGeneration;x.MBartForSequenceClassification;x.MBartModel;x.MBartPreTrainedModel;x.MBartTokenizer;x.MPNetForMaskedLM;x.MPNetForQuestionAnswering;x.MPNetForSequenceClassification;x.MPNetForTokenClassification;x.MPNetModel;x.MPNetPreTrainedModel;x.MPNetTokenizer;x.MT5ForConditionalGeneration;x.MT5Model;x.MT5PreTrainedModel;x.MarianMTModel;x.MarianModel;x.MarianPreTrainedModel;x.MarianTokenizer;x.Mask2FormerImageProcessor;x.MaskFormerFeatureExtractor;x.MaskFormerForInstanceSegmentation;x.MaskFormerImageProcessor;x.MaskFormerModel;x.MaskFormerPreTrainedModel;x.MaskedLMOutput;x.MaxLengthCriteria;x.Metric3DForDepthEstimation;x.Metric3DPreTrainedModel;x.Metric3Dv2ForDepthEstimation;x.Metric3Dv2PreTrainedModel;x.MgpstrForSceneTextRecognition;x.MgpstrModelOutput;x.MgpstrPreTrainedModel;x.MgpstrProcessor;x.MgpstrTokenizer;x.MimiDecoderModel;x.MimiDecoderOutput;x.MimiEncoderModel;x.MimiEncoderOutput;x.MimiModel;x.MimiPreTrainedModel;x.MinLengthLogitsProcessor;x.MinNewTokensLengthLogitsProcessor;x.MistralForCausalLM;x.MistralModel;x.MistralPreTrainedModel;x.MobileBertForMaskedLM;x.MobileBertForQuestionAnswering;x.MobileBertForSequenceClassification;x.MobileBertModel;x.MobileBertPreTrainedModel;x.MobileBertTokenizer;x.MobileLLMForCausalLM;x.MobileLLMModel;x.MobileLLMPreTrainedModel;x.MobileNetV1FeatureExtractor;x.MobileNetV1ForImageClassification;x.MobileNetV1ForSemanticSegmentation;x.MobileNetV1ImageProcessor;x.MobileNetV1Model;x.MobileNetV1PreTrainedModel;x.MobileNetV2FeatureExtractor;x.MobileNetV2ForImageClassification;x.MobileNetV2ForSemanticSegmentation;x.MobileNetV2ImageProcessor;x.MobileNetV2Model;x.MobileNetV2PreTrainedModel;x.MobileNetV3FeatureExtractor;x.MobileNetV3ForImageClassification;x.MobileNetV3ForSemanticSegmentation;x.MobileNetV3ImageProcessor;x.MobileNetV3Model;x.MobileNetV3PreTrainedModel;x.MobileNetV4FeatureExtractor;x.MobileNetV4ForImageClassification;x.MobileNetV4ForSemanticSegmentation;x.MobileNetV4ImageProcessor;x.MobileNetV4Model;x.MobileNetV4PreTrainedModel;x.MobileViTFeatureExtractor;x.MobileViTForImageClassification;x.MobileViTImageProcessor;x.MobileViTModel;x.MobileViTPreTrainedModel;x.MobileViTV2ForImageClassification;x.MobileViTV2Model;x.MobileViTV2PreTrainedModel;x.ModelOutput;x.ModernBertDecoderForCausalLM;x.ModernBertDecoderModel;x.ModernBertDecoderPreTrainedModel;x.ModernBertForMaskedLM;x.ModernBertForSequenceClassification;x.ModernBertForTokenClassification;x.ModernBertModel;x.ModernBertPreTrainedModel;x.Moondream1ForConditionalGeneration;x.MoonshineFeatureExtractor;x.MoonshineForConditionalGeneration;x.MoonshineModel;x.MoonshinePreTrainedModel;x.MoonshineProcessor;x.MptForCausalLM;x.MptModel;x.MptPreTrainedModel;x.MultiModalityCausalLM;x.MultiModalityPreTrainedModel;x.MusicgenForCausalLM;x.MusicgenForConditionalGeneration;x.MusicgenModel;x.MusicgenPreTrainedModel;x.NanoChatForCausalLM;x.NanoChatModel;x.NanoChatPreTrainedModel;x.NeoBertForMaskedLM;x.NeoBertForQuestionAnswering;x.NeoBertForSequenceClassification;x.NeoBertForTokenClassification;x.NeoBertModel;x.NeoBertPreTrainedModel;x.NllbTokenizer;x.NoBadWordsLogitsProcessor;x.NoRepeatNGramLogitsProcessor;x.NomicBertModel;x.NomicBertPreTrainedModel;x.NougatImageProcessor;x.NougatTokenizer;x.OPTForCausalLM;x.OPTModel;x.OPTPreTrainedModel;x.ObjectDetectionPipeline;x.Olmo2ForCausalLM;x.Olmo2Model;x.Olmo2PreTrainedModel;x.OlmoForCausalLM;x.OlmoModel;x.OlmoPreTrainedModel;x.OpenELMForCausalLM;x.OpenELMModel;x.OpenELMPreTrainedModel;x.OwlViTFeatureExtractor;x.OwlViTForObjectDetection;x.OwlViTImageProcessor;x.OwlViTModel;x.OwlViTPreTrainedModel;x.OwlViTProcessor;x.Owlv2ForObjectDetection;x.Owlv2ImageProcessor;x.Owlv2Model;x.Owlv2PreTrainedModel;x.PaliGemmaForConditionalGeneration;x.PaliGemmaPreTrainedModel;x.PaliGemmaProcessor;x.ParakeetFeatureExtractor;x.ParakeetForCTC;x.ParakeetPreTrainedModel;x.PatchTSMixerForPrediction;x.PatchTSMixerModel;x.PatchTSMixerPreTrainedModel;x.PatchTSTForPrediction;x.PatchTSTModel;x.PatchTSTPreTrainedModel;x.Phi3ForCausalLM;x.Phi3Model;x.Phi3PreTrainedModel;x.Phi3VForCausalLM;x.Phi3VImageProcessor;x.Phi3VPreTrainedModel;x.Phi3VProcessor;x.PhiForCausalLM;x.PhiModel;x.PhiPreTrainedModel;x.Pipeline;x.PreTrainedModel;x.PreTrainedTokenizer;x.PretrainedConfig;x.PretrainedMixin;x.Processor;x.PvtForImageClassification;x.PvtImageProcessor;x.PvtModel;x.PvtPreTrainedModel;x.PyAnnoteFeatureExtractor;x.PyAnnoteForAudioFrameClassification;x.PyAnnoteModel;x.PyAnnotePreTrainedModel;x.PyAnnoteProcessor;x.QuestionAnsweringModelOutput;x.QuestionAnsweringPipeline;x.Qwen2ForCausalLM;x.Qwen2Model;x.Qwen2PreTrainedModel;x.Qwen2Tokenizer;x.Qwen2VLForConditionalGeneration;x.Qwen2VLImageProcessor;x.Qwen2VLPreTrainedModel;x.Qwen2VLProcessor;x.Qwen3ForCausalLM;x.Qwen3Model;x.Qwen3PreTrainedModel;x.RFDetrForObjectDetection;x.RFDetrModel;x.RFDetrObjectDetectionOutput;x.RFDetrPreTrainedModel;x.RTDetrForObjectDetection;x.RTDetrImageProcessor;x.RTDetrModel;x.RTDetrObjectDetectionOutput;x.RTDetrPreTrainedModel;x.RTDetrV2ForObjectDetection;x.RTDetrV2Model;x.RTDetrV2ObjectDetectionOutput;x.RTDetrV2PreTrainedModel;x.RawAudio;x.RawImage;x.RawVideo;x.RawVideoFrame;x.RepetitionPenaltyLogitsProcessor;x.ResNetForImageClassification;x.ResNetModel;x.ResNetPreTrainedModel;x.RoFormerForMaskedLM;x.RoFormerForQuestionAnswering;x.RoFormerForSequenceClassification;x.RoFormerForTokenClassification;x.RoFormerModel;x.RoFormerPreTrainedModel;x.RoFormerTokenizer;x.RobertaForMaskedLM;x.RobertaForQuestionAnswering;x.RobertaForSequenceClassification;x.RobertaForTokenClassification;x.RobertaModel;x.RobertaPreTrainedModel;x.RobertaTokenizer;x.Sam2ImageProcessor;x.Sam2ImageSegmentationOutput;x.Sam2Model;x.Sam2PreTrainedModel;x.Sam2Processor;x.Sam2VideoProcessor;x.Sam3ImageProcessor;x.Sam3TrackerModel;x.SamImageProcessor;x.SamImageSegmentationOutput;x.SamModel;x.SamPreTrainedModel;x.SamProcessor;x.SapiensForDepthEstimation;x.SapiensForNormalEstimation;x.SapiensForSemanticSegmentation;x.SapiensPreTrainedModel;x.SeamlessM4TFeatureExtractor;x.SegformerFeatureExtractor;x.SegformerForImageClassification;x.SegformerForSemanticSegmentation;x.SegformerImageProcessor;x.SegformerModel;x.SegformerPreTrainedModel;x.Seq2SeqLMOutput;x.SequenceClassifierOutput;x.SiglipImageProcessor;x.SiglipModel;x.SiglipPreTrainedModel;x.SiglipTextModel;x.SiglipTokenizer;x.SiglipVisionModel;x.SmolLM3ForCausalLM;x.SmolLM3Model;x.SmolLM3PreTrainedModel;x.SmolVLMForConditionalGeneration;x.SmolVLMImageProcessor;x.SmolVLMProcessor;x.SnacDecoderModel;x.SnacEncoderModel;x.SnacFeatureExtractor;x.SnacModel;x.SnacPreTrainedModel;x.SpeechT5FeatureExtractor;x.SpeechT5ForSpeechToText;x.SpeechT5ForTextToSpeech;x.SpeechT5HifiGan;x.SpeechT5Model;x.SpeechT5PreTrainedModel;x.SpeechT5Processor;x.SpeechT5Tokenizer;x.SqueezeBertForMaskedLM;x.SqueezeBertForQuestionAnswering;x.SqueezeBertForSequenceClassification;x.SqueezeBertModel;x.SqueezeBertPreTrainedModel;x.SqueezeBertTokenizer;x.StableLmForCausalLM;x.StableLmModel;x.StableLmPreTrainedModel;x.Starcoder2ForCausalLM;x.Starcoder2Model;x.Starcoder2PreTrainedModel;x.StoppingCriteria;x.StoppingCriteriaList;x.StyleTextToSpeech2Model;x.StyleTextToSpeech2PreTrainedModel;x.SummarizationPipeline;x.SupertonicForConditionalGeneration;x.SupertonicPreTrainedModel;x.SuppressTokensAtBeginLogitsProcessor;x.Swin2SRForImageSuperResolution;x.Swin2SRImageProcessor;x.Swin2SRModel;x.Swin2SRPreTrainedModel;x.SwinForImageClassification;x.SwinForSemanticSegmentation;x.SwinModel;x.SwinPreTrainedModel;x.T5ForConditionalGeneration;x.T5Model;x.T5PreTrainedModel;x.T5Tokenizer;x.TableTransformerForObjectDetection;x.TableTransformerModel;x.TableTransformerObjectDetectionOutput;x.TableTransformerPreTrainedModel;x.TemperatureLogitsWarper;x.Tensor;x.Text2TextGenerationPipeline;x.TextClassificationPipeline;x.TextGenerationPipeline;x.TextStreamer;x.TextToAudioPipeline;x.TokenClassificationPipeline;x.TokenClassifierOutput;x.TokenizerModel;x.TopKLogitsWarper;x.TopPLogitsWarper;x.TrOCRForCausalLM;x.TrOCRPreTrainedModel;x.TranslationPipeline;x.UltravoxModel;x.UltravoxPreTrainedModel;x.UltravoxProcessor;x.UniSpeechForCTC;x.UniSpeechForSequenceClassification;x.UniSpeechModel;x.UniSpeechPreTrainedModel;x.UniSpeechSatForAudioFrameClassification;x.UniSpeechSatForCTC;x.UniSpeechSatForSequenceClassification;x.UniSpeechSatModel;x.UniSpeechSatPreTrainedModel;x.VLChatProcessor;x.VLMImageProcessor;x.VaultGemmaForCausalLM;x.VaultGemmaModel;x.VaultGemmaPreTrainedModel;x.ViTFeatureExtractor;x.ViTForImageClassification;x.ViTImageProcessor;x.ViTMAEModel;x.ViTMAEPreTrainedModel;x.ViTMSNForImageClassification;x.ViTMSNModel;x.ViTMSNPreTrainedModel;x.ViTModel;x.ViTPreTrainedModel;x.VisionEncoderDecoderModel;x.VitMatteForImageMatting;x.VitMatteImageProcessor;x.VitMattePreTrainedModel;x.VitPoseForPoseEstimation;x.VitPoseImageProcessor;x.VitPosePreTrainedModel;x.VitsModel;x.VitsModelOutput;x.VitsPreTrainedModel;x.VitsTokenizer;x.VoxtralForConditionalGeneration;x.VoxtralProcessor;x.Wav2Vec2BertForCTC;x.Wav2Vec2BertForSequenceClassification;x.Wav2Vec2BertModel;x.Wav2Vec2BertPreTrainedModel;x.Wav2Vec2CTCTokenizer;x.Wav2Vec2FeatureExtractor;x.Wav2Vec2ForAudioFrameClassification;x.Wav2Vec2ForCTC;x.Wav2Vec2ForSequenceClassification;x.Wav2Vec2Model;x.Wav2Vec2PreTrainedModel;x.Wav2Vec2Processor;x.Wav2Vec2ProcessorWithLM;x.WavLMForAudioFrameClassification;x.WavLMForCTC;x.WavLMForSequenceClassification;x.WavLMForXVector;x.WavLMModel;x.WavLMPreTrainedModel;x.WeSpeakerFeatureExtractor;x.WeSpeakerResNetModel;x.WeSpeakerResNetPreTrainedModel;x.WhisperFeatureExtractor;x.WhisperForConditionalGeneration;x.WhisperModel;x.WhisperPreTrainedModel;x.WhisperProcessor;x.WhisperTextStreamer;x.WhisperTimeStampLogitsProcessor;x.WhisperTokenizer;x.XLMForQuestionAnswering;x.XLMForSequenceClassification;x.XLMForTokenClassification;x.XLMModel;x.XLMPreTrainedModel;x.XLMRobertaForMaskedLM;x.XLMRobertaForQuestionAnswering;x.XLMRobertaForSequenceClassification;x.XLMRobertaForTokenClassification;x.XLMRobertaModel;x.XLMRobertaPreTrainedModel;x.XLMRobertaTokenizer;x.XLMTokenizer;x.XLMWithLMHeadModel;x.XVectorOutput;x.YolosFeatureExtractor;x.YolosForObjectDetection;x.YolosImageProcessor;x.YolosModel;x.YolosObjectDetectionOutput;x.YolosPreTrainedModel;x.ZeroShotAudioClassificationPipeline;x.ZeroShotClassificationPipeline;x.ZeroShotImageClassificationPipeline;x.ZeroShotObjectDetectionPipeline;x.bankers_round;x.cat;x.cos_sim;x.dot;x.dynamic_time_warping;x.env;x.full;x.full_like;x.getCacheShapes;x.hamming;x.hanning;x.interpolate;x.interpolate_4d;x.interpolate_data;x.is_chinese_char;x.layer_norm;x.load_image;x.load_video;x.log_softmax;x.magnitude;x.matmul;x.max;x.mean;x.mean_pooling;x.medianFilter;x.mel_filter_bank;x.min;x.ones;x.ones_like;x.permute;x.permute_data;var t9=x.pipeline;x.quantize_embeddings;x.rand;x.randn;x.read_audio;x.rfft;x.round;x.slice;x.softmax;x.spectrogram;x.stack;x.std_mean;x.topk;x.window_function;x.zeros;x.zeros_like;let Uw=null;const kj=async()=>{try{console.log("Initializing NLP models..."),Uw=await t9("sentiment-analysis","Xenova/distilbert-base-uncased-finetuned-sst-2-english",{device:"wasm"}),console.log("NLP models initialized successfully")}catch(e){console.error("Error initializing NLP models:",e)}},r9=async e=>{Uw||await kj();try{return(await Uw(e))[0]}catch(t){return console.error("Sentiment analysis error:",t),{label:"NEUTRAL",score:.5}}},n9=e=>{const t=e.toLowerCase();return t.includes("send")||t.includes("transfer")||t.includes("pay")?"transaction":t.includes("deploy")||t.includes("contract")||t.includes("smart contract")?"deployment":t.includes("check")||t.includes("status")||t.includes("balance")?"query":t.includes("security")||t.includes("threat")||t.includes("protect")?"security":t.includes("stake")||t.includes("yield")||t.includes("liquidity")?"defi":"general"},s9=e=>{const t=[],r=/((?:\d+(?:\.\d*)?|\.\d+))\s*ADA/gi,n=e.match(r);n&&n.forEach(i=>{t.push({type:"amount",value:i})});const s=/addr[a-z0-9]{50,}/gi,o=e.match(s);return o&&o.forEach(i=>{t.push({type:"address",value:i})}),t},o9=e=>({transaction:"payment",deployment:"aegis",query:"sentinel",security:"sentinel",defi:"defi",general:"general"})[e]||"general",i9=()=>{var p,m;const{isListening:e,transcript:t,startListening:r,stopListening:n}=pK(),{processCommand:s,isProcessing:o}=UR(),[i,a]=Q.useState(""),[l,u]=Q.useState(""),[h,c]=Q.useState(null),d=()=>{e?n():r()},f=async b=>{if(!b.trim())return;const g=n9(b),_=o9(g),y=s9(b),v=await r9(b);c({intent:g,agent:_,entities:y,sentiment:v});const M=await s(b,_,`Intent: ${g}, Entities: ${JSON.stringify(y)}`);M&&u(M.response),a("")};return Q.useEffect(()=>{t&&!e&&t!=="Listening..."&&f(t)},[t,e]),J.jsxs("div",{className:"glass-card p-6 rounded-2xl",children:[J.jsxs("div",{className:"flex items-center justify-between mb-4",children:[J.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"AI Voice Command Interface"}),J.jsx(Bp,{variant:e?"destructive":"default",size:"lg",onClick:d,disabled:o,className:`rounded-full w-16 h-16 ${e?"animate-pulse-glow glow-cyan":""}`,children:e?J.jsx(gV,{className:"h-6 w-6"}):J.jsx(_V,{className:"h-6 w-6"})})]}),J.jsxs("div",{className:"flex gap-2 mb-4",children:[J.jsx(NF,{value:i,onChange:b=>a(b.target.value),onKeyPress:b=>b.key==="Enter"&&f(i),placeholder:"Type a command or use voice...",className:"flex-1 bg-muted/20 border-primary/20",disabled:o}),J.jsx(Bp,{onClick:()=>f(i),disabled:o||!i.trim(),className:"glow-cyan",children:J.jsx(vV,{className:"h-4 w-4"})})]}),t&&J.jsxs("div",{className:"mb-4 p-4 bg-gradient-holographic rounded-lg border border-primary/20",children:[J.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Voice Input:"}),J.jsx("p",{className:"text-foreground font-medium",children:t})]}),h&&J.jsxs("div",{className:"mb-4 p-4 bg-muted/20 rounded-lg border border-border/50",children:[J.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"NLP Analysis:"}),J.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[J.jsxs("div",{children:[J.jsx("span",{className:"text-muted-foreground",children:"Intent:"})," ",J.jsx("span",{className:"text-primary font-medium",children:h.intent})]}),J.jsxs("div",{children:[J.jsx("span",{className:"text-muted-foreground",children:"Agent:"})," ",J.jsx("span",{className:"text-secondary font-medium",children:h.agent})]}),J.jsxs("div",{children:[J.jsx("span",{className:"text-muted-foreground",children:"Sentiment:"})," ",J.jsx("span",{className:"text-success font-medium",children:(p=h.sentiment)==null?void 0:p.label})]}),J.jsxs("div",{children:[J.jsx("span",{className:"text-muted-foreground",children:"Entities:"})," ",J.jsx("span",{className:"text-foreground",children:((m=h.entities)==null?void 0:m.length)||0})]})]})]}),l&&J.jsxs("div",{className:"mb-4 p-4 bg-gradient-primary rounded-lg border border-primary/30 glow-cyan",children:[J.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"AI Response:"}),J.jsx("p",{className:"text-foreground",children:l})]}),o&&J.jsx("div",{className:"mb-4 p-3 bg-warning/10 rounded-lg border border-warning/30 animate-pulse",children:J.jsx("p",{className:"text-sm text-warning text-center",children:"Processing with AI..."})}),J.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[J.jsxs("button",{onClick:()=>f("Deploy smart contract on pre-prod"),className:"p-3 bg-muted/20 rounded-lg border border-border/50 hover:border-primary/40 transition-all text-left",children:[J.jsx("p",{className:"text-xs text-muted-foreground",children:"Example:"}),J.jsx("p",{className:"text-sm text-foreground mt-1",children:'"Deploy smart contract"'})]}),J.jsxs("button",{onClick:()=>f("Check network security status"),className:"p-3 bg-muted/20 rounded-lg border border-border/50 hover:border-primary/40 transition-all text-left",children:[J.jsx("p",{className:"text-xs text-muted-foreground",children:"Example:"}),J.jsx("p",{className:"text-sm text-foreground mt-1",children:'"Check security status"'})]})]})]})};var Qy="focusScope.autoFocusOnMount",Xy="focusScope.autoFocusOnUnmount",TA={bubbles:!1,cancelable:!0},a9="FocusScope",$j=Q.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=e,[a,l]=Q.useState(null),u=Wo(s),h=Wo(o),c=Q.useRef(null),d=Yn(t,m=>l(m)),f=Q.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Q.useEffect(()=>{if(n){let m=function(y){if(f.paused||!a)return;const v=y.target;a.contains(v)?c.current=v:Ii(c.current,{select:!0})},b=function(y){if(f.paused||!a)return;const v=y.relatedTarget;v!==null&&(a.contains(v)||Ii(c.current,{select:!0}))},g=function(y){if(document.activeElement===document.body)for(const M of y)M.removedNodes.length>0&&Ii(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",b);const _=new MutationObserver(g);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",b),_.disconnect()}}},[n,a,f.paused]),Q.useEffect(()=>{if(a){PA.add(f);const m=document.activeElement;if(!a.contains(m)){const g=new CustomEvent(Qy,TA);a.addEventListener(Qy,u),a.dispatchEvent(g),g.defaultPrevented||(l9(f9(Aj(a)),{select:!0}),document.activeElement===m&&Ii(a))}return()=>{a.removeEventListener(Qy,u),setTimeout(()=>{const g=new CustomEvent(Xy,TA);a.addEventListener(Xy,h),a.dispatchEvent(g),g.defaultPrevented||Ii(m??document.body,{select:!0}),a.removeEventListener(Xy,h),PA.remove(f)},0)}}},[a,u,h,f]);const p=Q.useCallback(m=>{if(!r&&!n||f.paused)return;const b=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,g=document.activeElement;if(b&&g){const _=m.currentTarget,[y,v]=u9(_);y&&v?!m.shiftKey&&g===v?(m.preventDefault(),r&&Ii(y,{select:!0})):m.shiftKey&&g===y&&(m.preventDefault(),r&&Ii(v,{select:!0})):g===_&&m.preventDefault()}},[r,n,f.paused]);return J.jsx(hn.div,{tabIndex:-1,...i,ref:d,onKeyDown:p})});$j.displayName=a9;function l9(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Ii(n,{select:t}),document.activeElement!==r)return}function u9(e){const t=Aj(e),r=EA(t,e),n=EA(t.reverse(),e);return[r,n]}function Aj(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function EA(e,t){for(const r of e)if(!c9(r,{upTo:t}))return r}function c9(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function d9(e){return e instanceof HTMLInputElement&&"select"in e}function Ii(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&d9(e)&&t&&e.select()}}var PA=h9();function h9(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=SA(e,t),e.unshift(t)},remove(t){var r;e=SA(e,t),(r=e[0])==null||r.resume()}}}function SA(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function f9(e){return e.filter(t=>t.tagName!=="A")}var Jy=0;function p9(){Q.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??CA()),document.body.insertAdjacentElement("beforeend",e[1]??CA()),Jy++,()=>{Jy===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Jy--}},[])}function CA(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var lp="right-scroll-bar-position",up="width-before-scroll-bar",m9="with-scroll-bars-hidden",g9="--removed-body-scroll-bar-size";function Yy(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function _9(e,t){var r=Q.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var y9=typeof window<"u"?Q.useLayoutEffect:Q.useEffect,kA=new WeakMap;function v9(e,t){var r=_9(null,function(n){return e.forEach(function(s){return Yy(s,n)})});return y9(function(){var n=kA.get(r);if(n){var s=new Set(n),o=new Set(e),i=r.current;s.forEach(function(a){o.has(a)||Yy(a,null)}),o.forEach(function(a){s.has(a)||Yy(a,i)})}kA.set(r,e)},[e]),r}function w9(e){return e}function b9(e,t){t===void 0&&(t=w9);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var i=t(o,n);return r.push(i),function(){r=r.filter(function(a){return a!==i})}},assignSyncMedium:function(o){for(n=!0;r.length;){var i=r;r=[],i.forEach(o)}r={push:function(a){return o(a)},filter:function(){return r}}},assignMedium:function(o){n=!0;var i=[];if(r.length){var a=r;r=[],a.forEach(o),i=r}var l=function(){var h=i;i=[],h.forEach(o)},u=function(){return Promise.resolve().then(l)};u(),r={push:function(h){i.push(h),u()},filter:function(h){return i=i.filter(h),r}}}};return s}function x9(e){e===void 0&&(e={});var t=b9(null);return t.options=Us({async:!0,ssr:!1},e),t}var Ij=function(e){var t=e.sideCar,r=la(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return Q.createElement(n,Us({},r))};Ij.isSideCarExport=!0;function M9(e,t){return e.useMedium(t),Ij}var Oj=x9(),Zy=function(){},Im=Q.forwardRef(function(e,t){var r=Q.useRef(null),n=Q.useState({onScrollCapture:Zy,onWheelCapture:Zy,onTouchMoveCapture:Zy}),s=n[0],o=n[1],i=e.forwardProps,a=e.children,l=e.className,u=e.removeScrollBar,h=e.enabled,c=e.shards,d=e.sideCar,f=e.noRelative,p=e.noIsolation,m=e.inert,b=e.allowPinchZoom,g=e.as,_=g===void 0?"div":g,y=e.gapMode,v=la(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),M=d,E=v9([r,t]),T=Us(Us({},v),s);return Q.createElement(Q.Fragment,null,h&&Q.createElement(M,{sideCar:Oj,removeScrollBar:u,shards:c,noRelative:f,noIsolation:p,inert:m,setCallbacks:o,allowPinchZoom:!!b,lockRef:r,gapMode:y}),i?Q.cloneElement(Q.Children.only(a),Us(Us({},T),{ref:E})):Q.createElement(_,Us({},T,{className:l,ref:E}),a))});Im.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Im.classNames={fullWidth:up,zeroRight:lp};var T9=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function E9(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=T9();return t&&e.setAttribute("nonce",t),e}function P9(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function S9(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var C9=function(){var e=0,t=null;return{add:function(r){e==0&&(t=E9())&&(P9(t,r),S9(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},k9=function(){var e=C9();return function(t,r){Q.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},Dj=function(){var e=k9(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},$9={left:0,top:0,right:0,gap:0},ev=function(e){return parseInt(e||"",10)||0},A9=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[ev(r),ev(n),ev(s)]},I9=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return $9;var t=A9(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},O9=Dj(),_u="data-scroll-locked",D9=function(e,t,r,n){var s=e.left,o=e.top,i=e.right,a=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(m9,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(_u,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }

  .`).concat(lp,` {
    right: `).concat(a,"px ").concat(n,`;
  }

  .`).concat(up,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }

  .`).concat(lp," .").concat(lp,` {
    right: 0 `).concat(n,`;
  }

  .`).concat(up," .").concat(up,` {
    margin-right: 0 `).concat(n,`;
  }

  body[`).concat(_u,`] {
    `).concat(g9,": ").concat(a,`px;
  }
`)},$A=function(){var e=parseInt(document.body.getAttribute(_u)||"0",10);return isFinite(e)?e:0},F9=function(){Q.useEffect(function(){return document.body.setAttribute(_u,($A()+1).toString()),function(){var e=$A()-1;e<=0?document.body.removeAttribute(_u):document.body.setAttribute(_u,e.toString())}},[])},R9=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;F9();var o=Q.useMemo(function(){return I9(s)},[s]);return Q.createElement(O9,{styles:D9(o,!t,s,r?"":"!important")})},Vw=!1;if(typeof window<"u")try{var jf=Object.defineProperty({},"passive",{get:function(){return Vw=!0,!0}});window.addEventListener("test",jf,jf),window.removeEventListener("test",jf,jf)}catch{Vw=!1}var zl=Vw?{passive:!1}:!1,L9=function(e){return e.tagName==="TEXTAREA"},Fj=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!L9(e)&&r[t]==="visible")},N9=function(e){return Fj(e,"overflowY")},j9=function(e){return Fj(e,"overflowX")},AA=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=Rj(e,n);if(s){var o=Lj(e,n),i=o[1],a=o[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},z9=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},B9=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},Rj=function(e,t){return e==="v"?N9(t):j9(t)},Lj=function(e,t){return e==="v"?z9(t):B9(t)},U9=function(e,t){return e==="h"&&t==="rtl"?-1:1},V9=function(e,t,r,n,s){var o=U9(e,window.getComputedStyle(t).direction),i=o*n,a=r.target,l=t.contains(a),u=!1,h=i>0,c=0,d=0;do{if(!a)break;var f=Lj(e,a),p=f[0],m=f[1],b=f[2],g=m-b-o*p;(p||g)&&Rj(e,a)&&(c+=g,d+=p);var _=a.parentNode;a=_&&_.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_.host:_}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(h&&(Math.abs(c)<1||!s)||!h&&(Math.abs(d)<1||!s))&&(u=!0),u},zf=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},IA=function(e){return[e.deltaX,e.deltaY]},OA=function(e){return e&&"current"in e?e.current:e},W9=function(e,t){return e[0]===t[0]&&e[1]===t[1]},G9=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},H9=0,Bl=[];function K9(e){var t=Q.useRef([]),r=Q.useRef([0,0]),n=Q.useRef(),s=Q.useState(H9++)[0],o=Q.useState(Dj)[0],i=Q.useRef(e);Q.useEffect(function(){i.current=e},[e]),Q.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var m=sb([e.lockRef.current],(e.shards||[]).map(OA),!0).filter(Boolean);return m.forEach(function(b){return b.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),m.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var a=Q.useCallback(function(m,b){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var g=zf(m),_=r.current,y="deltaX"in m?m.deltaX:_[0]-g[0],v="deltaY"in m?m.deltaY:_[1]-g[1],M,E=m.target,T=Math.abs(y)>Math.abs(v)?"h":"v";if("touches"in m&&T==="h"&&E.type==="range")return!1;var S=AA(T,E);if(!S)return!0;if(S?M=T:(M=T==="v"?"h":"v",S=AA(T,E)),!S)return!1;if(!n.current&&"changedTouches"in m&&(y||v)&&(n.current=M),!M)return!0;var A=n.current||M;return V9(A,b,m,A==="h"?y:v,!0)},[]),l=Q.useCallback(function(m){var b=m;if(!(!Bl.length||Bl[Bl.length-1]!==o)){var g="deltaY"in b?IA(b):zf(b),_=t.current.filter(function(M){return M.name===b.type&&(M.target===b.target||b.target===M.shadowParent)&&W9(M.delta,g)})[0];if(_&&_.should){b.cancelable&&b.preventDefault();return}if(!_){var y=(i.current.shards||[]).map(OA).filter(Boolean).filter(function(M){return M.contains(b.target)}),v=y.length>0?a(b,y[0]):!i.current.noIsolation;v&&b.cancelable&&b.preventDefault()}}},[]),u=Q.useCallback(function(m,b,g,_){var y={name:m,delta:b,target:g,should:_,shadowParent:q9(g)};t.current.push(y),setTimeout(function(){t.current=t.current.filter(function(v){return v!==y})},1)},[]),h=Q.useCallback(function(m){r.current=zf(m),n.current=void 0},[]),c=Q.useCallback(function(m){u(m.type,IA(m),m.target,a(m,e.lockRef.current))},[]),d=Q.useCallback(function(m){u(m.type,zf(m),m.target,a(m,e.lockRef.current))},[]);Q.useEffect(function(){return Bl.push(o),e.setCallbacks({onScrollCapture:c,onWheelCapture:c,onTouchMoveCapture:d}),document.addEventListener("wheel",l,zl),document.addEventListener("touchmove",l,zl),document.addEventListener("touchstart",h,zl),function(){Bl=Bl.filter(function(m){return m!==o}),document.removeEventListener("wheel",l,zl),document.removeEventListener("touchmove",l,zl),document.removeEventListener("touchstart",h,zl)}},[]);var f=e.removeScrollBar,p=e.inert;return Q.createElement(Q.Fragment,null,p?Q.createElement(o,{styles:G9(s)}):null,f?Q.createElement(R9,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function q9(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Q9=M9(Oj,K9);var Nj=Q.forwardRef(function(e,t){return Q.createElement(Im,Us({},e,{ref:t,sideCar:Q9}))});Nj.classNames=Im.classNames;var X9=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Ul=new WeakMap,Bf=new WeakMap,Uf={},tv=0,jj=function(e){return e&&(e.host||jj(e.parentNode))},J9=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=jj(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Y9=function(e,t,r,n){var s=J9(t,Array.isArray(e)?e:[e]);Uf[r]||(Uf[r]=new WeakMap);var o=Uf[r],i=[],a=new Set,l=new Set(s),u=function(c){!c||a.has(c)||(a.add(c),u(c.parentNode))};s.forEach(u);var h=function(c){!c||l.has(c)||Array.prototype.forEach.call(c.children,function(d){if(a.has(d))h(d);else try{var f=d.getAttribute(n),p=f!==null&&f!=="false",m=(Ul.get(d)||0)+1,b=(o.get(d)||0)+1;Ul.set(d,m),o.set(d,b),i.push(d),m===1&&p&&Bf.set(d,!0),b===1&&d.setAttribute(r,"true"),p||d.setAttribute(n,"true")}catch(g){console.error("aria-hidden: cannot operate on ",d,g)}})};return h(t),a.clear(),tv++,function(){i.forEach(function(c){var d=Ul.get(c)-1,f=o.get(c)-1;Ul.set(c,d),o.set(c,f),d||(Bf.has(c)||c.removeAttribute(n),Bf.delete(c)),f||c.removeAttribute(r)}),tv--,tv||(Ul=new WeakMap,Ul=new WeakMap,Bf=new WeakMap,Uf={})}},Z9=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=X9(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),Y9(n,s,r,"aria-hidden")):function(){return null}},Om="Dialog",[zj,z7]=Gd(Om),[e7,Co]=zj(Om),Bj=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:i=!0}=e,a=Q.useRef(null),l=Q.useRef(null),[u,h]=cD({prop:n,defaultProp:s??!1,onChange:o,caller:Om});return J.jsx(e7,{scope:t,triggerRef:a,contentRef:l,contentId:R_(),titleId:R_(),descriptionId:R_(),open:u,onOpenChange:h,onOpenToggle:Q.useCallback(()=>h(c=>!c),[h]),modal:i,children:r})};Bj.displayName=Om;var Uj="DialogTrigger",t7=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Co(Uj,r),o=Yn(t,s.triggerRef);return J.jsx(hn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Wb(s.open),...n,ref:o,onClick:Dr(e.onClick,s.onOpenToggle)})});t7.displayName=Uj;var Ub="DialogPortal",[r7,Vj]=zj(Ub,{forceMount:void 0}),Wj=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=Co(Ub,t);return J.jsx(r7,{scope:t,forceMount:r,children:Q.Children.map(n,i=>J.jsx(Bu,{present:r||o.open,children:J.jsx(j0,{asChild:!0,container:s,children:i})}))})};Wj.displayName=Ub;var Zp="DialogOverlay",Gj=Q.forwardRef((e,t)=>{const r=Vj(Zp,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Co(Zp,e.__scopeDialog);return o.modal?J.jsx(Bu,{present:n||o.open,children:J.jsx(s7,{...s,ref:t})}):null});Gj.displayName=Zp;var n7=Td("DialogOverlay.RemoveScroll"),s7=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Co(Zp,r);return J.jsx(Nj,{as:n7,allowPinchZoom:!0,shards:[s.contentRef],children:J.jsx(hn.div,{"data-state":Wb(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),dl="DialogContent",Hj=Q.forwardRef((e,t)=>{const r=Vj(dl,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Co(dl,e.__scopeDialog);return J.jsx(Bu,{present:n||o.open,children:o.modal?J.jsx(o7,{...s,ref:t}):J.jsx(i7,{...s,ref:t})})});Hj.displayName=dl;var o7=Q.forwardRef((e,t)=>{const r=Co(dl,e.__scopeDialog),n=Q.useRef(null),s=Yn(t,r.contentRef,n);return Q.useEffect(()=>{const o=n.current;if(o)return Z9(o)},[]),J.jsx(Kj,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Dr(e.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Dr(e.onPointerDownOutside,o=>{const i=o.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&o.preventDefault()}),onFocusOutside:Dr(e.onFocusOutside,o=>o.preventDefault())})}),i7=Q.forwardRef((e,t)=>{const r=Co(dl,e.__scopeDialog),n=Q.useRef(!1),s=Q.useRef(!1);return J.jsx(Kj,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,a;(i=e.onCloseAutoFocus)==null||i.call(e,o),o.defaultPrevented||(n.current||(a=r.triggerRef.current)==null||a.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var l,u;(l=e.onInteractOutside)==null||l.call(e,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;((u=r.triggerRef.current)==null?void 0:u.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Kj=Q.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=e,a=Co(dl,r),l=Q.useRef(null),u=Yn(t,l);return p9(),J.jsxs(J.Fragment,{children:[J.jsx($j,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:J.jsx(gm,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Wb(a.open),...i,ref:u,onDismiss:()=>a.onOpenChange(!1)})}),J.jsxs(J.Fragment,{children:[J.jsx(a7,{titleId:a.titleId}),J.jsx(u7,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Vb="DialogTitle",qj=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Co(Vb,r);return J.jsx(hn.h2,{id:s.titleId,...n,ref:t})});qj.displayName=Vb;var Qj="DialogDescription",Xj=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Co(Qj,r);return J.jsx(hn.p,{id:s.descriptionId,...n,ref:t})});Xj.displayName=Qj;var Jj="DialogClose",Yj=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Co(Jj,r);return J.jsx(hn.button,{type:"button",...n,ref:t,onClick:Dr(e.onClick,()=>s.onOpenChange(!1))})});Yj.displayName=Jj;function Wb(e){return e?"open":"closed"}var Zj="DialogTitleWarning",[B7,ez]=aU(Zj,{contentName:dl,titleName:Vb,docsSlug:"dialog"}),a7=({titleId:e})=>{const t=ez(Zj),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Q.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},l7="DialogDescriptionWarning",u7=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ez(l7).contentName}}.`;return Q.useEffect(()=>{var o;const s=(o=e.current)==null?void 0:o.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},c7=Bj,d7=Wj,tz=Gj,rz=Hj,nz=qj,sz=Xj,h7=Yj;const f7=c7,p7=d7,oz=Q.forwardRef(({className:e,...t},r)=>J.jsx(tz,{ref:r,className:ts("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));oz.displayName=tz.displayName;const iz=Q.forwardRef(({className:e,children:t,...r},n)=>J.jsxs(p7,{children:[J.jsx(oz,{}),J.jsxs(rz,{ref:n,className:ts("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,J.jsxs(h7,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[J.jsx(FD,{className:"h-4 w-4"}),J.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));iz.displayName=rz.displayName;const az=({className:e,...t})=>J.jsx("div",{className:ts("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});az.displayName="DialogHeader";const lz=Q.forwardRef(({className:e,...t},r)=>J.jsx(nz,{ref:r,className:ts("text-lg font-semibold leading-none tracking-tight",e),...t}));lz.displayName=nz.displayName;const m7=Q.forwardRef(({className:e,...t},r)=>J.jsx(sz,{ref:r,className:ts("text-sm text-muted-foreground",e),...t}));m7.displayName=sz.displayName;const g7=()=>{const{processCommand:e,isProcessing:t}=UR();Wd(),Q.useState(null);const[r,n]=Q.useState(null),[s,o]=Q.useState([]),i=[{id:"eid",name:"EID: Earth Intelligence",status:"active",icon:J.jsx(hV,{className:"h-6 w-6"}),description:"Planetary monitoring, weather analysis, IoT grid, disaster prediction.",capabilities:["Planetary Monitoring","Weather Analysis","Satellite Uplink","Disaster Forecast"]},{id:"enid",name:"ENID: Enterprise Intelligence",status:"active",icon:J.jsx(iV,{className:"h-6 w-6"}),description:"Business automation, marketing, compliance, data insights.",capabilities:["Workflow Automation","Marketing GenAI","Compliance & KYC","Smart Audit"]},{id:"dtad",name:"DTAD: DeFi & Transactions",status:"processing",icon:J.jsx(sV,{className:"h-6 w-6"}),description:"Financial brain, yield optimization, insurance, payments.",capabilities:["Yield Optimization","Smart Treasury","Risk Scoring","Global Payments"]},{id:"hid",name:"HID: Human Interaction",status:"active",icon:J.jsx(fV,{className:"h-6 w-6"}),description:"Support, personalization, user journey, recommendations.",capabilities:["24/7 Support","Personalization","Ticket Resolution","Voice Interface"]}],a=c=>{n(c),o([])},l=async c=>{if(!r)return;const d=Date.now();o(p=>[...p,{id:d,text:`Initiating ${c}...`,type:"pending"}]);const f=await e(`Execute ${c} for ${r.name}`,r.id,`User triggered specific capability: ${c}`);f?(o(p=>p.map(m=>m.id===d?{id:m.id,text:`> ${c} EXECUTION COMPLETE`,type:"success"}:m)),o(p=>[...p,{id:Date.now()+1,text:f.response,type:"response",details:f.tool_usage}])):o(p=>p.map(m=>m.id===d?{id:m.id,text:`> ${c} FAILED`,type:"error"}:m))},u=c=>{switch(c){case"active":return"text-cyan-400";case"processing":return"text-yellow-400 animate-pulse";case"idle":return"text-gray-500"}},h=c=>{switch(c){case"active":return"bg-cyan-500/10 border-cyan-500/30";case"processing":return"bg-yellow-500/10 border-yellow-500/30";case"idle":return"bg-gray-500/10 border-gray-500/30"}};return J.jsxs(J.Fragment,{children:[J.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-full",children:i.map(c=>J.jsxs("button",{onClick:()=>a(c),className:`relative group p-4 rounded-xl border ${h(c.status)} transition-all duration-300 hover:scale-[1.02] hover:bg-white/5 cursor-pointer text-left`,children:[J.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[J.jsx("div",{className:`w-2 h-2 rounded-full ${c.status==="active"?"bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.8)]":"bg-yellow-400"} animate-pulse`}),J.jsx("span",{className:`text-[10px] font-mono tracking-widest ${u(c.status)} uppercase`,children:c.status})]}),J.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[J.jsx("div",{className:`p-3 rounded-lg bg-black/40 border border-white/10 ${u(c.status)} group-hover:scale-110 transition-transform`,children:c.icon}),J.jsxs("div",{children:[J.jsx("h3",{className:"font-bold text-white text-lg tracking-tight",children:c.name}),J.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:["ID: ",c.id.toUpperCase(),"-001"]})]})]}),J.jsx("p",{className:"text-sm text-gray-300 mb-4 line-clamp-2",children:c.description}),J.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.capabilities.slice(0,3).map(d=>J.jsx("span",{className:"px-2 py-1 text-[10px] rounded bg-white/5 border border-white/10 text-gray-400 font-mono",children:d},d)),c.capabilities.length>3&&J.jsxs("span",{className:"px-2 py-1 text-[10px] rounded bg-white/5 border border-white/10 text-gray-400 font-mono",children:["+",c.capabilities.length-3]})]})]},c.id))}),J.jsx(f7,{open:!!r,onOpenChange:()=>n(null),children:J.jsxs(iz,{className:"bg-black/95 border-primary/20 text-white max-w-2xl",children:[J.jsx(az,{children:J.jsxs(lz,{className:"flex items-center gap-3 text-xl font-bold font-mono",children:[r==null?void 0:r.icon,r==null?void 0:r.name,J.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-primary/20 text-primary border border-primary/30",children:"ONLINE"})]})}),J.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[J.jsxs("div",{className:"space-y-2",children:[J.jsx("h4",{className:"text-xs font-mono text-gray-500 uppercase mb-2",children:"Operational Controls"}),r==null?void 0:r.capabilities.map(c=>J.jsxs("button",{onClick:()=>l(c),disabled:t,className:"w-full text-left px-3 py-2 rounded text-sm font-mono text-cyan-100 hover:bg-cyan-500/20 hover:text-cyan-400 transition-colors border border-transparent hover:border-cyan-500/30 flex items-center justify-between group",children:[c,J.jsx(Yv,{className:"w-3 h-3 opacity-0 group-hover:opacity-100"})]},c))]}),J.jsxs("div",{className:"md:col-span-2 bg-black rounded-lg border border-white/10 p-4 font-mono text-xs h-[300px] overflow-y-auto relative",children:[J.jsx("div",{className:"absolute top-2 right-2 text-gray-600",children:J.jsx(DD,{className:"w-4 h-4"})}),s.length===0&&J.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-600 gap-2",children:[J.jsx(Yv,{className:"w-8 h-8 opacity-20"}),J.jsx("p",{children:"Select a capability to initiate neural link..."})]}),J.jsxs("div",{className:"space-y-3",children:[s.map(c=>J.jsxs("div",{className:"animate-fade-in",children:[c.type==="pending"&&J.jsx("span",{className:"text-yellow-500",children:c.text}),c.type==="success"&&J.jsx("span",{className:"text-green-400",children:c.text}),c.type==="error"&&J.jsx("span",{className:"text-red-500",children:c.text}),c.type==="response"&&J.jsx("div",{className:"mt-1 p-2 bg-white/5 rounded border-l-2 border-cyan-500 text-gray-300 whitespace-pre-wrap",children:c.text})]},c.id)),t&&J.jsx("div",{className:"text-cyan-500 animate-pulse",children:"Processing request..."})]})]})]})]})})]})},_7=()=>{const{toast:e}=Wd(),[t,r]=Q.useState(!1),n=async()=>{r(!0),await new Promise(o=>setTimeout(o,1500)),e({title:"Network Status Updated",description:"All systems operational"}),r(!1)},s=[{icon:J.jsx(cV,{className:"h-5 w-5"}),label:"Cardano Network",value:"Pre-Prod",status:"Connected",color:"text-success"},{icon:J.jsx(pV,{className:"h-5 w-5"}),label:"Masumi Protocol",value:"Active",status:"Synced",color:"text-success"},{icon:J.jsx(wV,{className:"h-5 w-5"}),label:"AEOS Core",value:"v2.5.1",status:"Online",color:"text-success"},{icon:J.jsx(Yv,{className:"h-5 w-5"}),label:"Transaction Pool",value:"12",status:"Pending",color:"text-warning"}];return J.jsxs("div",{className:"glass-card p-6 rounded-2xl",children:[J.jsxs("div",{className:"flex items-center justify-between mb-4",children:[J.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Network Status"}),J.jsx(Bp,{onClick:n,disabled:t,variant:"outline",size:"sm",className:"border-primary/20",children:J.jsx(yV,{className:`h-4 w-4 ${t?"animate-spin":""}`})})]}),J.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:s.map((o,i)=>J.jsxs("button",{onClick:()=>e({title:o.label,description:`Status: ${o.status} - ${o.value}`}),className:"p-4 bg-gradient-holographic rounded-xl border border-primary/20 hover:border-primary/40 transition-all cursor-pointer",children:[J.jsx("div",{className:`${o.color} mb-3`,children:o.icon}),J.jsxs("div",{className:"space-y-1 text-left",children:[J.jsx("p",{className:"text-xs text-muted-foreground",children:o.label}),J.jsx("p",{className:"text-lg font-bold text-foreground",children:o.value}),J.jsx("p",{className:`text-xs font-medium ${o.color}`,children:o.status})]})]},i))})]})},y7=V0("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",success:"border-transparent bg-success text-success-foreground hover:bg-success/80",warning:"border-transparent bg-warning text-warning-foreground hover:bg-warning/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function v7({className:e,variant:t,...r}){return J.jsx("div",{className:ts(y7({variant:t}),e),...r})}const w7=()=>{const e=[{id:"tx_001",type:"Smart Contract Deploy",amount:"2.5 ADA",status:"completed",timestamp:"2 mins ago",from:"AEOS Wallet",to:"Pre-Prod Network"},{id:"tx_002",type:"DID Verification",amount:"0.5 ADA",status:"pending",timestamp:"5 mins ago",from:"Veritas Agent",to:"Identity Layer"},{id:"tx_003",type:"Agent Payment",amount:"10 ADA",status:"completed",timestamp:"8 mins ago",from:"DeFi Agent",to:"Compliance Agent"}],t=n=>{switch(n){case"completed":return J.jsx(lV,{className:"h-4 w-4 text-success"});case"pending":return J.jsx(uV,{className:"h-4 w-4 text-warning animate-pulse"});case"failed":return J.jsx(aV,{className:"h-4 w-4 text-destructive"})}},r=n=>{switch(n){case"completed":return"default";case"pending":return"secondary";case"failed":return"destructive"}};return J.jsxs("div",{className:"glass-card p-6 rounded-2xl",children:[J.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Transaction Monitor"}),J.jsx("div",{className:"space-y-3",children:e.map(n=>J.jsxs("div",{className:"p-4 bg-muted/20 rounded-xl border border-border/50 hover:border-primary/30 transition-all",children:[J.jsxs("div",{className:"flex items-start justify-between mb-2",children:[J.jsxs("div",{className:"flex items-center gap-2",children:[t(n.status),J.jsx("span",{className:"font-semibold text-foreground",children:n.type})]}),J.jsx(v7,{variant:r(n.status),className:"text-xs",children:n.status})]}),J.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[J.jsx("span",{children:n.from}),J.jsx(nV,{className:"h-4 w-4"}),J.jsx("span",{children:n.to})]}),J.jsxs("div",{className:"flex items-center justify-between text-xs",children:[J.jsx("span",{className:"text-primary font-mono",children:n.amount}),J.jsx("span",{className:"text-muted-foreground",children:n.timestamp})]})]},n.id))})]})},b7=()=>{const e=[{icon:J.jsx(mV,{className:"h-5 w-5"}),title:"Private Key Protection",status:"Secured",detail:"Hardware-isolated signing enclave"},{icon:J.jsx(bV,{className:"h-5 w-5"}),title:"DID Identity",status:"Active",detail:"Decentralized authentication"},{icon:J.jsx(dV,{className:"h-5 w-5"}),title:"Transaction Simulation",status:"Running",detail:"Pre-execution validation"},{icon:J.jsx(TV,{className:"h-5 w-5"}),title:"Threat Detection",status:"Monitoring",detail:"Real-time security analysis"}];return J.jsxs("div",{className:"glass-card p-6 rounded-2xl",children:[J.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Security & Compliance"}),J.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.map((t,r)=>J.jsx("div",{className:"p-4 bg-gradient-holographic rounded-xl border border-success/20 hover:border-success/40 transition-all",children:J.jsxs("div",{className:"flex items-start gap-3",children:[J.jsx("div",{className:"p-2 rounded-lg bg-success/10 text-success",children:t.icon}),J.jsxs("div",{className:"flex-1",children:[J.jsx("h3",{className:"font-semibold text-foreground",children:t.title}),J.jsx("p",{className:"text-sm text-success font-medium mt-1",children:t.status}),J.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.detail})]})]})},r))})]})},x7=()=>{const[e,t]=Q.useState({totalCommands:0,aiAccuracy:0,responseTime:0,activeModels:3});Q.useEffect(()=>{const n=setInterval(()=>{t(s=>({totalCommands:s.totalCommands+Math.floor(Math.random()*3),aiAccuracy:95+Math.random()*4,responseTime:120+Math.random()*80,activeModels:3}))},3e3);return()=>clearInterval(n)},[]);const r=[{icon:J.jsx(oV,{className:"h-5 w-5"}),label:"AI Commands",value:e.totalCommands,unit:"processed",color:"text-primary"},{icon:J.jsx(OD,{className:"h-5 w-5"}),label:"Model Accuracy",value:e.aiAccuracy.toFixed(1),unit:"%",color:"text-success"},{icon:J.jsx(EV,{className:"h-5 w-5"}),label:"Avg Response",value:Math.round(e.responseTime),unit:"ms",color:"text-warning"},{icon:J.jsx(MV,{className:"h-5 w-5"}),label:"Active Models",value:e.activeModels,unit:"models",color:"text-secondary"}];return J.jsxs("div",{className:"glass-card p-6 rounded-2xl",children:[J.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"AI Analytics"}),J.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:r.map((n,s)=>J.jsxs("div",{className:"p-4 bg-gradient-holographic rounded-xl border border-primary/20 hover:border-primary/40 transition-all",children:[J.jsx("div",{className:`${n.color} mb-3`,children:n.icon}),J.jsxs("div",{className:"space-y-1",children:[J.jsx("p",{className:"text-xs text-muted-foreground",children:n.label}),J.jsxs("div",{className:"flex items-baseline gap-1",children:[J.jsx("p",{className:"text-2xl font-bold text-foreground",children:n.value}),J.jsx("p",{className:"text-xs text-muted-foreground",children:n.unit})]})]})]},s))})]})},M7=()=>(Q.useEffect(()=>{kj().catch(console.error)},[]),J.jsxs("div",{className:"min-h-screen p-4 md:p-8",children:[J.jsx("header",{className:"mb-8",children:J.jsx("div",{className:"glass-card p-6 rounded-2xl",children:J.jsxs("div",{className:"flex items-center justify-between",children:[J.jsxs("div",{className:"flex items-center gap-4",children:[J.jsx("div",{className:"p-3 bg-gradient-primary rounded-xl glow-cyan animate-float",children:J.jsx(OD,{className:"h-8 w-8 text-primary-foreground"})}),J.jsxs("div",{children:[J.jsxs("div",{className:"flex items-center gap-2",children:[J.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-foreground tracking-tight",children:"AEOS"}),J.jsx(xV,{className:"h-5 w-5 text-primary animate-pulse"})]}),J.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Autonomous Earth Operating System  AI-Powered  Multi-Agent Intelligence"})]})]}),J.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[J.jsx(DD,{className:"h-5 w-5 text-primary"}),J.jsx("span",{className:"text-sm font-mono text-muted-foreground",children:"v2.5.1"}),J.jsxs("div",{className:"flex items-center gap-1 ml-4 px-3 py-1 bg-success/10 rounded-full border border-success/30",children:[J.jsx("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"}),J.jsx("span",{className:"text-xs text-success font-medium",children:"AI Online"})]})]})]})})}),J.jsxs("div",{className:"space-y-6",children:[J.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[J.jsx(i9,{}),J.jsx(_7,{})]}),J.jsx(x7,{}),J.jsx(g7,{}),J.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[J.jsx(w7,{}),J.jsx(b7,{})]})]}),J.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:J.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-primary/5 via-transparent to-transparent opacity-30"})})]})),T7=()=>{const e=LF();return Q.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),J.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:J.jsxs("div",{className:"text-center",children:[J.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),J.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),J.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},E7=new X8,P7=()=>J.jsx(Y8,{client:E7,children:J.jsxs(P8,{children:[J.jsx(aW,{}),J.jsx(jW,{}),J.jsx(LG,{children:J.jsxs(DG,{children:[J.jsx(uw,{path:"/",element:J.jsx(M7,{})}),J.jsx(uw,{path:"*",element:J.jsx(T7,{})})]})})]})});nD(document.getElementById("root")).render(J.jsx(P7,{}));
